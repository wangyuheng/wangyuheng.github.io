<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2017年终总结</title>
    <url>/2018/02/24/2017/</url>
    <content><![CDATA[<p>keyword <code>变</code></p>
<p><img src="http://img.yuheng.wang/2017-0.jpg" alt="2017-0"></p>
<p>2017于我而言，是变化的一年。从东北到江南，从在线教育到互联网金融，工作、生活都经历了很多变动，在这个过程中，努力拥抱变化，提升自己。有提升，也有不足。总结一下这一年的种种：</p>
<span id="more"></span>

<h3 id="dev"><a href="#dev" class="headerlink" title="dev"></a>dev</h3><p>安身立命的根本，工作环境的改变，发觉“纸上得来终觉浅”，难怪之前看的书，有些细节总是不理解，活着记不住。其实就是缺少场景。之前的工作服务与各大高校，更偏向于传统软件行业，而架构的风格也是以稳健著称，基于spring3+mybatis源码定制了一套自己的框架，技术相对局限，这也是我离开的原因之一。</p>
<ol>
<li>springboot 微服务。之前看过很多书籍，现在终于有机会在工作中使用，并且马上就会有需求迭代、用户反馈，考验着你的架构，不断试错、不断调整。</li>
<li>kafka，公司重度依赖kafka消息，提供了多种相关中间件，在阅读中间件源码过程中，除了巧妙的设计外，也发现迭代中踩过的坑。</li>
<li>dubbo 熟悉而陌生，之前有学习过，但是没有实际项目使用。接触之后，发现确实是微服务的有力支持。</li>
<li>java8 stream。 函数式，不只是语法糖，解决了并发问题，更是编程思维的一种改变。</li>
<li>设计模式，工作中会画一些类图，会思考应用哪种模式可以解决哪个问题，而不是一个else，一个需求。</li>
<li>git、gc、日志、健康检查、业务监控、报警、灰度 and so on。不要嘲笑，这些确实是今年才开始注意的一些点。编码不只是完成需求功能那么简单。</li>
</ol>
<h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><p>跑步跑的很少，工作时间压缩了运动时间，体重飙升，过劳肥。</p>
<ol>
<li>横店马拉松 半马 1小时48分</li>
</ol>
<h3 id="剁手"><a href="#剁手" class="headerlink" title="剁手"></a>剁手</h3><p>打着更好coding的旗号，满足了自己的腐败。</p>
<ol>
<li>beatsX 跑步听歌耳机</li>
<li>iPhone8</li>
<li>富士X100F 拔草要趁早，只是兴趣，不需要过于专业的设备</li>
<li>sony MDR-1000X 降噪耳机，写代码时的神器</li>
<li>filco 圣手二代 蓝牙青轴</li>
<li>iwatch3 替换了Garmin表</li>
</ol>
<h3 id="work"><a href="#work" class="headerlink" title="work"></a>work</h3><ol>
<li>年内晋升为资深研发</li>
<li>担任跨部门项目PM，承担了更多的沟通、交流、协调工作，把控项目开发进度</li>
<li>团建导游。。什么鬼。。。 你可知带着50多个程序员跨省团建有多么坑爹么？！</li>
</ol>
<h3 id="私活"><a href="#私活" class="headerlink" title="私活"></a>私活</h3><p>遇到瓶颈，更多的利用经验和已有代码堆砌功能，需要技术难度的工作，一般也不会找私人完成，而我的时薪增加了，保障质量完成私活导致的时间开销与压力，已经没有等价的收入和提升目的。会减少死活，留出时间跑步和看书。</p>
<ol>
<li>监控报警平台（微信企业号|短信 推送）</li>
<li>网红直播管理平台，用于直播间预定、服装准备、道具租赁、场控记录等，总之是一套神奇的业务，程序员就是缺乏变现的眼光。</li>
<li>自行车停车位app，日本某市，帮助政府管理自行车停车位，并提升用户附近最近的空余停车位。</li>
</ol>
<h3 id="travel"><a href="#travel" class="headerlink" title="travel"></a>travel</h3><p>希望在30岁之前走遍全国的每一个省（含港澳台），但是又不会为了填图而每个省跑过去只为打卡，也不会裸辞，说走就走，来场穷游。我觉得旅行和工作都是生活的一部分，可以做好平衡（主要是穷），珍惜每个双休，去想去的每个地方。</p>
<p>拍了很多照片之前有发布过。 <a href="https://hacpai.com/article/1516457510336">上半年</a> &amp; <a href="https://hacpai.com/article/1516891850324">下半年</a></p>
<ol>
<li>浙江-(杭州、临安、安吉、富阳、嘉兴、横店、千岛湖、丽水)</li>
<li>江西-(上饶)</li>
<li>安徽-(宁国、西递、宏村)</li>
<li>上海</li>
<li>云南-(昆明、丽江、大理)</li>
<li>福建-(鼓浪屿)</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>2017 是变化的一年，但是没有达到蜕变，很多地方可以做的更好，原谅自己是堕落的开始。需要做的事情太多，不给自己找借口，战胜安逸和拖延。</p>
<p>永不妥协</p>
<h3 id="关于职业"><a href="#关于职业" class="headerlink" title="关于职业"></a>关于职业</h3><p>毕业时做的规划，3～5年内定位为一线研发，要做接近用户的工作。之后校准自己的定位，基于是否还热爱技术，是否有能力担任架构职位。今年做了更多思考</p>
<ol>
<li>技术是为业务服务，脱离实际场景谈技术都是不懂技术的人。</li>
<li>和D神的看法苟同，认为未来的技术架构会更少。可能更需要的是具备产品思维，和有着系统解决方案的架构。如果研发一直吐槽产品，而市场又迷信产品，这不是痛点吗？</li>
<li>“35定律”，帮朋友推荐工作时，对方追问年龄是否超过35岁。架构职位、现在管理70人团队，居然被要求不能高于35岁，有些受打击。留给自己的时间不多了。想想年内轰轰烈烈的某司辞退34岁以上员工事件，也是沉思。</li>
</ol>
<h3 id="关于行业"><a href="#关于行业" class="headerlink" title="关于行业"></a>关于行业</h3><p>目前接触两个行业，在线教育&amp;互联网。</p>
<ol>
<li>教育是第一选择，因为我是通过网络视频自学的编程技术，我希望能帮助更多的学生，在迷茫时，知道还有这个选择，而不是浑浑噩噩。作为没有背景、无老可啃的普通人，生活不算体面，至少赚个辛苦钱，可以养活自己。但是实际工作内容却让人失望，平台的学生用户更多的是为了拿学历，挂机、金手指点视频暂停弹窗、老师帮忙刷学分等等。。我觉得我当时的想法是正确的，但是发觉三观各不相同，可能开个直播比你写代码赚钱容易又多，又能说什么呢。只是希望你自己不学习，但是不要告诉其他人，学习无用。所以现在不再输出三观，我不理解你，但是我支持你，做自己。</li>
<li>逃到杭州，蹭互联网金融的热度。为了提升自己，选择了这个快速发展的行业，有大并发、有大数据、而金融又要求安全、严谨、稳健。这期间对自己的技术水平提升很多，但是对这个行业无感，看了很多的恶，我们是极少数不需要讨好用户的行业，加之劣币驱逐良币，社会名声日渐变差。不愿意和任何一个用户做朋友的行业，会让人没有成就感。不是为了让世界变的更美好吗？</li>
</ol>
<p>以上，写给自己</p>
]]></content>
      <categories>
        <category>年终总结</category>
      </categories>
      <tags>
        <tag>年终总结</tag>
        <tag>2017</tag>
      </tags>
  </entry>
  <entry>
    <title>js获取script参数</title>
    <url>/2016/06/29/160629-skill-javascript-script-param/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>js插件挡住了页面元素，希望自定义js插件显示的布局位置。</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><p>在<code>&lt;script&gt;</code>引入js插件时传递layout布局参数。</p>
<h3 id="1-通过url参数方式获取"><a href="#1-通过url参数方式获取" class="headerlink" title="1. 通过url参数方式获取"></a>1. 通过url参数方式获取</h3><p>js可以获取url中的参数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(location.href.indexOf(<span class="string">&quot;?&quot;</span>)&gt;-<span class="number">1</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> params = location.href.substr(location.href.indexOf(<span class="string">&quot;?&quot;</span>)+<span class="number">1</span>).split(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;params.length;i++)&#123;</span><br><span class="line">		<span class="keyword">var</span> kv = params[i].split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> key = kv[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">var</span> value = kv[<span class="number">1</span>];</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;key=&quot;</span>+key+<span class="string">&quot; value=&quot;</span>+value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同理，可以先获取script标签中的src属性，再通过上面的方法，获取layout参数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;listen.js?layout=right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在js插件文件中通过如下代码获取</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> layout=<span class="string">&quot;right&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> scripts = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;script&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt; scripts.length;i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> script = scripts[i];</span><br><span class="line">    <span class="keyword">if</span> (script &amp;&amp; script.getAttribute(<span class="string">&quot;src&quot;</span>) &amp;&amp; script.getAttribute(<span class="string">&quot;src&quot;</span>).indexOf(<span class="string">&quot;listen.js&quot;</span>)&gt;-<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = script.getAttribute(<span class="string">&quot;src&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> params = url.substr(url.indexOf(<span class="string">&quot;?&quot;</span>)+<span class="number">1</span>).split(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;params.length;i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> kv = params[i].split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> key = kv[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> value = kv[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;layout&quot;</span> == key) &#123;</span><br><span class="line">            	layout = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(layout);</span><br></pre></td></tr></table></figure>

<h3 id="2-通过自定义属性获取"><a href="#2-通过自定义属性获取" class="headerlink" title="2. 通过自定义属性获取"></a>2. 通过自定义属性获取</h3><p>通过上面的方法，可以想到既然能获取src属性，那么也可以自定义布局属性，并通过getAttribute()方法获取。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;listen.js&quot;</span> <span class="attr">layout</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在js插件文件中通过如下代码获取</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> layout=<span class="string">&quot;right&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> scripts = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;script&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt; scripts.length;i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> script = scripts[i];</span><br><span class="line">    <span class="keyword">if</span> (script &amp;&amp; script.getAttribute(<span class="string">&quot;src&quot;</span>) &amp;&amp; script.getAttribute(<span class="string">&quot;src&quot;</span>).indexOf(<span class="string">&quot;listen.js&quot;</span>)&gt;-<span class="number">1</span> &amp;&amp; script.getAttribute(<span class="string">&quot;layout&quot;</span>)) &#123;</span><br><span class="line">        layout = script.getAttribute(<span class="string">&quot;layout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(layout);</span><br></pre></td></tr></table></figure>

<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>通过从代码上来看，第二种方法更简单，而问过几个朋友，都更喜欢第二种配置方式，所以在这里推荐使用自定义属性获取属性。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;listen.js?layout=right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;listen.js&quot;</span> <span class="attr">layout</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>skill</category>
      </categories>
      <tags>
        <tag>skill</tag>
        <tag>javascript</tag>
        <tag>listen</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring MappingJackson2JsonView 视图的怪异问题</title>
    <url>/2016/05/13/MappingJackson2JsonView/</url>
    <content><![CDATA[<p>时间比较匆忙，可能记录有些乱。</p>
<p>先说明一下问题：我用Spring MVC 4.0+ 编写restful框架， 因为看到了提供有MappingJackson2JsonView类，就没有通过自己转换json， 返回字符串。</p>
<p>但是遇到一个灵异的问题：如果利用javaBean类接收参数，在返回值中，会自动把javaBean的键值对以json格式返回，效果等同于对javaBean参数使用了标签@ModelAttribute</p>
<p>如<br><img src="http://img.yuheng.wang/MappingJackson2JsonView-0.png" alt="MappingJackson2JsonView-0"></p>
<p>会返回</p>
<p><img src="http://img.yuheng.wang/MappingJackson2JsonView-1.png" alt="MappingJackson2JsonView-1"></p>
<p>使用 View 是因为以后有需要的话，可能会重写一个JsonView。</p>
<p>翻了一天的源码，看到了如下几个部分（以图片中的代码举例）：</p>
<pre><code>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter#getModelAndView(ModelAndViewContainer mavContainer, ModelFactory modelFactory, NativeWebRequest webRequest)
</code></pre>
<p>初始container的model里有2个对象，但并没有返回的data Map， 而是一个user和一个BindingResult，user是入参，BindingResult用于validation绑定页面元素。</p>
<p>在<br>    org.springframework.web.servlet.DispatcherServlet#processDispatchResult(HttpServletRequest request, HttpServletResponse response, HandlerExecutionChain mappedHandler, ModelAndView mv, Exception exception) </p>
<p>方法中通过</p>
<pre><code>org.springframework.web.servlet.view.AbstractView#createMergedOutputModel(Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response)
</code></pre>
<p>方法将data Map参数放入model，由ModelAndView对象持有。</p>
<p>然后MappingJackson2JsonView#filterModel 方法会过滤掉BindingResult 以及 指定的filter规则类</p>
<pre><code>protected Object filterModel(Map&lt;String, Object&gt; model) &#123;
    Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(model.size());
    Set&lt;String&gt; modelKeys = (!CollectionUtils.isEmpty(this.modelKeys) ? this.modelKeys : model.keySet());
    for (Map.Entry&lt;String, Object&gt; entry : model.entrySet()) &#123;
        if (!(entry.getValue() instanceof BindingResult) &amp;&amp; modelKeys.contains(entry.getKey()) &amp;&amp;
                !entry.getKey().equals(JsonView.class.getName()) &amp;&amp;
                !entry.getKey().equals(FilterProvider.class.getName())) &#123;
            result.put(entry.getKey(), entry.getValue());
        &#125;
    &#125;
    return (this.extractValueFromSingleKeyModel &amp;&amp; result.size() == 1 ? result.values().iterator().next() : result);
&#125;
</code></pre>
<p>modelKeys 可以通过 MappingJackson2JsonView#setModelKeys方法指定，所以如果希望只返回data Map 需要指定 </p>
<pre><code>    MappingJackson2JsonView model = new MappingJackson2JsonView();
    Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
    params.put(&quot;data&quot;, object);
    model.setModelKeys(params.keySet());
    
</code></pre>
<p>这种设计默认全部返回，通过Set数组参数 指定需要返回的json对象。如果全部展平为一级的map，是不是就可以不经过转换，而通过此参数指定给客户端返回的参数？</p>
<p>BindingResult 是将校验结果返回给页面展现，包括元素和错误message等信息。restful不需要此信息，所以系统自动忽略。 </p>
<p>但是可以通过此规则进行入参校验</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>spring-boot aop 打印 http 日志</title>
    <url>/2017/11/18/aop-log/</url>
    <content><![CDATA[<p>本文项目已发布到github，后续学习项目也会添加到此工程下，欢迎fork点赞。<br><a href="https://github.com/wangyuheng/spring-boot-sample">https://github.com/wangyuheng/spring-boot-sample</a></p>
<p>需要具备少量aop基础，通过springboot构建项目方便演示。</p>
<h3 id="AOP-面向切面编程"><a href="#AOP-面向切面编程" class="headerlink" title="AOP-面向切面编程"></a>AOP-面向切面编程</h3><p>一句话描述，在java对象增加切点，在不改变对象的前提下通过代理扩展功能。</p>
<h3 id="http日志打印拦截器"><a href="#http日志打印拦截器" class="headerlink" title="http日志打印拦截器"></a>http日志打印拦截器</h3><h4 id="restful-api"><a href="#restful-api" class="headerlink" title="restful api"></a>restful api</h4><p>通过springboot快速搭建一个RestController接口。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> wang.crick.study.httplog.annotation.HttpLog;</span><br><span class="line"><span class="keyword">import</span> wang.crick.study.httplog.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/log/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestApiResponse&lt;User&gt; <span class="title">getInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         <span class="meta">@RequestParam(&quot;age&quot;)</span> <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setUsername(String.valueOf(<span class="keyword">new</span> Random().nextLong()));</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        <span class="keyword">return</span> RestApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/log/pwd/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestApiResponse&lt;User&gt; <span class="title">getInfoWithPwd</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestHeader(&quot;username&quot;)</span> String username,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestHeader(&quot;password&quot;)</span> String password)</span></span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> RestApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/log/pwdExcludeResponse/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestApiResponse&lt;User&gt; <span class="title">getInfoWithPwd</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestParam(&quot;age&quot;)</span> <span class="keyword">int</span> age,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestHeader(&quot;password&quot;)</span> String password)</span></span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        <span class="keyword">return</span> RestApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="切面选择"><a href="#切面选择" class="headerlink" title="切面选择"></a>切面选择</h4><p>一般教程会选择拦截所有http请求，并打印request.parameters。但是存在问题：</p>
<ol>
<li>不够灵活，部分参数不想打印，如文件数据（过大）、敏感数据（身份证）等。</li>
<li>显式的标注日志输出，避免给维护人员造成疑惑。</li>
<li>部分参数通过header传输</li>
</ol>
<p>因此，自定义日志输出@annotation <strong>HttpLog</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> HttpLog &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 忽略参数，避免文件or无意义参数打印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 忽略参数数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要打印的header参数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> header参数名数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] headerParams() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoreResponse</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取HttpServletRequest"><a href="#获取HttpServletRequest" class="headerlink" title="获取HttpServletRequest"></a>获取HttpServletRequest</h4><p>spring通过ThreadLocal持有request参数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> HttpServletRequest <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   RequestAttributes ra = RequestContextHolder.getRequestAttributes();</span><br><span class="line">   ServletRequestAttributes sra = (ServletRequestAttributes) ra;</span><br><span class="line">   <span class="keyword">return</span> sra.getRequest();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取uri"><a href="#获取uri" class="headerlink" title="获取uri"></a>获取uri</h4><p>根据拦截规则不同，getServletPath()和request.getPathInfo()可能为空，简单的做一次健壮性判断。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getRequestPath</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> (<span class="keyword">null</span> != request.getServletPath() &amp;&amp; request.getServletPath().length() &gt; <span class="number">0</span>)</span><br><span class="line">           ? request.getServletPath() : request.getPathInfo();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="aop日志输出"><a href="#aop日志输出" class="headerlink" title="aop日志输出"></a>aop日志输出</h4><ol>
<li>Pointcut自定义@annotation <strong>HttpLog</strong></li>
<li>拿到@annotation，读取自定义属性，如忽略response、打印headers等</li>
<li>遍历request &amp; headers中需打印参数</li>
<li>定制日志格式并打印log</li>
<li>拦截返回值并打印log</li>
</ol>
<p>Aspect代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="keyword">import</span> wang.crick.study.httplog.annotation.HttpLog;</span><br><span class="line"><span class="keyword">import</span> wang.crick.study.httplog.api.RestApiResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpLogAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger log = LoggerFactory.getLogger(HttpLogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(wang.crick.study.httplog.annotation.HttpLog)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logAnnotation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Optional&lt;HttpLog&gt; <span class="title">getLogAnnotation</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (joinPoint <span class="keyword">instanceof</span> MethodInvocationProceedingJoinPoint) &#123;</span><br><span class="line">            Signature signature = joinPoint.getSignature();</span><br><span class="line">            <span class="keyword">if</span> (signature <span class="keyword">instanceof</span> MethodSignature) &#123;</span><br><span class="line">                MethodSignature methodSignature = (MethodSignature) signature;</span><br><span class="line">                Method method = methodSignature.getMethod();</span><br><span class="line">                <span class="keyword">if</span> (method.isAnnotationPresent(HttpLog.class)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> Optional.of(method.getAnnotation(HttpLog.class));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> HttpServletRequest <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestAttributes ra = RequestContextHolder.getRequestAttributes();</span><br><span class="line">        ServletRequestAttributes sra = (ServletRequestAttributes) ra;</span><br><span class="line">        <span class="keyword">return</span> sra.getRequest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getRequestPath</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">null</span> != request.getServletPath() &amp;&amp; request.getServletPath().length() &gt; <span class="number">0</span>)</span><br><span class="line">                ? request.getServletPath() : request.getPathInfo();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;logAnnotation()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Optional&lt;HttpLog&gt; httpLog = getLogAnnotation(joinPoint);</span><br><span class="line">            httpLog.ifPresent(anno -&gt; &#123;</span><br><span class="line">                HttpServletRequest request = getRequest();</span><br><span class="line">                List&lt;String&gt; excludes = Arrays.asList(anno.exclude());</span><br><span class="line">                List&lt;Object&gt; params = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                StringBuilder logMsg = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                logMsg.append(<span class="string">&quot;REQUEST_LOG. sessionId:&#123;&#125;. &quot;</span>)</span><br><span class="line">                        .append(<span class="string">&quot;requestUrl: &quot;</span>)</span><br><span class="line">                        .append(getRequestPath(request))</span><br><span class="line">                        .append(<span class="string">&quot; -PARAMS- &quot;</span>);</span><br><span class="line">                params.add(request.getSession().getId());</span><br><span class="line">                request.getParameterMap().forEach((k, v) -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!excludes.contains(k)) &#123;</span><br><span class="line">                        logMsg.append(k).append(<span class="string">&quot;: &#123;&#125;, &quot;</span>);</span><br><span class="line">                        params.add(v);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">if</span> (anno.headerParams().length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    logMsg.append(<span class="string">&quot; -HEADER_PARAMS- &quot;</span>);</span><br><span class="line">                    Arrays.asList(anno.headerParams()).forEach(param -&gt; &#123;</span><br><span class="line">                        logMsg.append(param).append(<span class="string">&quot;: &#123;&#125;, &quot;</span>);</span><br><span class="line">                        params.add(request.getHeader(param));</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                log.info(logMsg.toString(), params.toArray());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignore) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;print request log fail!&quot;</span>, ignore);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(returning = &quot;restApiResponse&quot;, pointcut = &quot;logAnnotation()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">(JoinPoint joinPoint, RestApiResponse restApiResponse)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Optional&lt;HttpLog&gt; httpLog = getLogAnnotation(joinPoint);</span><br><span class="line">            httpLog.ifPresent(anno -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (!anno.ignoreResponse()) &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;RESPONSE_LOG. sessionId:&#123;&#125;. result:&#123;&#125;&quot;</span>, getRequest().getSession().getId(), restApiResponse);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignore) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;print response log fail!&quot;</span>, ignore);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="在RestController中增加自定义注解HttpLog"><a href="#在RestController中增加自定义注解HttpLog" class="headerlink" title="在RestController中增加自定义注解HttpLog"></a>在RestController中增加自定义注解HttpLog</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> wang.crick.study.httplog.annotation.HttpLog;</span><br><span class="line"><span class="keyword">import</span> wang.crick.study.httplog.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * curl -H &#x27;username:12b4&#x27; -H &#x27;password:34ndd&#x27; -v &#x27;http://localhost:8080/user/log/123?age=32&#x27;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/log/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HttpLog()</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestApiResponse&lt;User&gt; <span class="title">getInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         <span class="meta">@RequestParam(&quot;age&quot;)</span> <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setUsername(String.valueOf(<span class="keyword">new</span> Random().nextLong()));</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        <span class="keyword">return</span> RestApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * curl -H &#x27;username:12b4&#x27; -H &#x27;password:34ndd&#x27; -v &#x27;http://localhost:8080/user/log/pwd/123?age=32&#x27;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/log/pwd/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HttpLog(headerParams=&quot;password&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestApiResponse&lt;User&gt; <span class="title">getInfoWithPwd</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestHeader(&quot;username&quot;)</span> String username,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestHeader(&quot;password&quot;)</span> String password)</span></span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> RestApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * curl -H &#x27;username:12b4&#x27; -H &#x27;password:34ndd&#x27; -v &#x27;http://localhost:8080/user/log/pwdExcludeResponse/123?age=32&#x27;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/log/pwdExcludeResponse/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HttpLog(headerParams=&quot;username&quot;, ignoreResponse = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestApiResponse&lt;User&gt; <span class="title">getInfoWithPwd</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestParam(&quot;age&quot;)</span> <span class="keyword">int</span> age,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                <span class="meta">@RequestHeader(&quot;password&quot;)</span> String password)</span></span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line">        user.setAge(age);</span><br><span class="line">        <span class="keyword">return</span> RestApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="加载HttpLogAspect对象"><a href="#加载HttpLogAspect对象" class="headerlink" title="加载HttpLogAspect对象"></a>加载HttpLogAspect对象</h4><p>可以在@SpringBootApplication类下直接加在，也可以在HttpLogAspect中增加@Component注解，推荐前者，更清晰。不需要增加@EnableAspectJAutoProxy类 <strong>(注:1)</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HttpLogAspect <span class="title">httpLogAspect</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> HttpLogAspect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="启动容器并访问"><a href="#启动容器并访问" class="headerlink" title="启动容器并访问"></a>启动容器并访问</h4><p>header参数可以通过curl验证。**(注:2)**</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>可测试的代码才是好代码。所以其实我没写过几行好代码。。。</p>
<p>日志输出到控制台，可以通过获取控制台中内容进行contains验证</p>
<h4 id="获取控制台输出字符"><a href="#获取控制台输出字符" class="headerlink" title="获取控制台输出字符"></a>获取控制台输出字符</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ByteArrayOutputStream outContent = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">System.setOut(<span class="keyword">new</span> PrintStream(outContent));</span><br></pre></td></tr></table></figure>

<h4 id="执行request请求"><a href="#执行request请求" class="headerlink" title="执行request请求"></a>执行request请求</h4><p>基于spring test提供的mockMvc方法，测试代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.RequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.result.MockMvcResultHandlers;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.setup.MockMvcBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertFalse;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertTrue;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApiTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserApi userApi;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ByteArrayOutputStream outContent;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId = <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age = <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> username = <span class="keyword">new</span> Random().nextLong();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> password = <span class="keyword">new</span> Random().nextLong();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 坚挺控制台输出</span></span><br><span class="line">        outContent = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        System.setOut(<span class="keyword">new</span> PrintStream(outContent));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//项目拦截器有效</span></span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(context).build();</span><br><span class="line">        <span class="comment">//单个类，拦截器无效</span></span><br><span class="line">        <span class="comment">// mockMvc = MockMvcBuilders.standaloneSteup(userApi).build();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_log</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">&quot;/user/log/&quot;</span> + userId;</span><br><span class="line">        String uri = path + <span class="string">&quot;?age=&quot;</span> + age;</span><br><span class="line">        RequestBuilder request = MockMvcRequestBuilders.get(uri)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON_UTF8)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">        mockMvc.perform(request).andExpect(MockMvcResultMatchers.status().isOk());</span><br><span class="line">        String console = outContent.toString();</span><br><span class="line">        assertTrue(console.contains(<span class="string">&quot;REQUEST_LOG&quot;</span>));</span><br><span class="line">        assertFalse(console.contains(<span class="string">&quot;HEADER_PARAMS&quot;</span>));</span><br><span class="line">        assertTrue(console.contains(<span class="string">&quot;RESPONSE_LOG&quot;</span>));</span><br><span class="line">        assertTrue(console.contains(path));</span><br><span class="line">        assertTrue(console.contains(String.valueOf(age)));</span><br><span class="line">        assertFalse(console.contains(String.valueOf(username)));</span><br><span class="line">        assertFalse(console.contains(String.valueOf(password)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_log_header</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">&quot;/user/log/pwd/&quot;</span> + userId;</span><br><span class="line">        String uri = path + <span class="string">&quot;?age=&quot;</span> + age;</span><br><span class="line">        RequestBuilder request = MockMvcRequestBuilders.get(uri)</span><br><span class="line">                .header(<span class="string">&quot;username&quot;</span>, username)</span><br><span class="line">                .header(<span class="string">&quot;password&quot;</span>, password)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON_UTF8)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">        mockMvc.perform(request).andExpect(MockMvcResultMatchers.status().isOk());</span><br><span class="line"></span><br><span class="line">        String console = outContent.toString();</span><br><span class="line">        assertTrue(console.contains(<span class="string">&quot;REQUEST_LOG&quot;</span>));</span><br><span class="line">        assertTrue(console.contains(<span class="string">&quot;HEADER_PARAMS&quot;</span>));</span><br><span class="line">        assertTrue(console.contains(<span class="string">&quot;RESPONSE_LOG&quot;</span>));</span><br><span class="line">        assertTrue(console.contains(path));</span><br><span class="line">        assertTrue(console.contains(String.valueOf(age)));</span><br><span class="line">        assertFalse(console.contains(String.valueOf(username)));</span><br><span class="line">        assertTrue(console.contains(String.valueOf(password)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_log_header_excludeResponse</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">&quot;/user/log/pwdExcludeResponse/&quot;</span> + userId;</span><br><span class="line">        String uri = path + <span class="string">&quot;?age=&quot;</span> + age;</span><br><span class="line">        RequestBuilder request = MockMvcRequestBuilders.get(uri)</span><br><span class="line">                .header(<span class="string">&quot;username&quot;</span>, username)</span><br><span class="line">                .header(<span class="string">&quot;password&quot;</span>, password)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON_UTF8)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">        mockMvc.perform(request).andExpect(MockMvcResultMatchers.status().isOk());</span><br><span class="line"></span><br><span class="line">        String console = outContent.toString();</span><br><span class="line">        assertTrue(console.contains(<span class="string">&quot;REQUEST_LOG&quot;</span>));</span><br><span class="line">        assertTrue(console.contains(<span class="string">&quot;HEADER_PARAMS&quot;</span>));</span><br><span class="line">        assertFalse(console.contains(<span class="string">&quot;RESPONSE_LOG&quot;</span>));</span><br><span class="line">        assertTrue(console.contains(path));</span><br><span class="line">        assertTrue(console.contains(String.valueOf(age)));</span><br><span class="line">        assertTrue(console.contains(String.valueOf(username)));</span><br><span class="line">        assertFalse(console.contains(String.valueOf(password)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注-1-EnableAspectJAutoProxy"><a href="#注-1-EnableAspectJAutoProxy" class="headerlink" title="注:1 @EnableAspectJAutoProxy"></a>注:1 @EnableAspectJAutoProxy</h3><h3 id="注-2-curl增加header参数"><a href="#注-2-curl增加header参数" class="headerlink" title="注:2 curl增加header参数"></a>注:2 curl增加header参数</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -H &#x27;username:123&#x27; -H &#x27;password:345&#x27;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>aop</tag>
      </tags>
  </entry>
  <entry>
    <title>eclipse报错Resource is out of sync with the file system</title>
    <url>/2016/08/30/bug-eclipse-resource-is-out-of-sync-with-the-file-system/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>在eclipse中搜索时，搜索完之后有时候会弹出错误对话框，错误摘录如下</p>
<pre><code>Resource is out of sync with the file system......
</code></pre>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>由于eclipse中文件不同步引起的。</p>
<p>在eclipse中，工程文件是由eclipse自动扫描添加的，如果在外部修改了工程目录中的文件但又关闭了自动刷新功能，则会引起文件不同步，从而搜索时出现Resource is out of sync with the file system问题（其它功能可能也会如此）。此外，在外部没有修改eclipse工程中的文件也有可能引起该问题。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>有两种解决方法</p>
<ol>
<li>手动刷新。即在eclipse的工程目录中，右键refresh（或者按下F5）。</li>
<li>配置eclipse的选项<ul>
<li>eclipse启动时，刷新workspace，即勾选         window—&gt;preferences—&gt;general—&gt;startup and shutdown—&gt;refresh workspace on startup</li>
<li>window—&gt;preferences—&gt;general—&gt;workspace中：勾选选项：refresh using native hooks or polling和refresh on access；</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>eclipse</tag>
      </tags>
  </entry>
  <entry>
    <title>git clone http 失败 401</title>
    <url>/2016/08/31/bug-git-clone-401/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>通过http方式执行git clone时报错</p>
<pre><code>error: The requested URL returned error: 401 Unauthorized while accessing https://git.oschina.net/xxx/xxx.git/info/refs

fatal: HTTP request failed
</code></pre>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>git版本过低，为1.7.0</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>升级git</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>input text 回车自动提交表单</title>
    <url>/2016/08/31/bug-html-autosubmit/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>表单以ajax方式提交数据，但是input text 按回车后自动提交</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>当form只有一个input text时，回车后会自动提交表单 </p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>增加一个隐藏的input text， 通过样式来隐藏</p>
<pre><code>&lt;input type=&quot;text&quot; style=&quot;display:none;” /&gt;
</code></pre>
<p>并在form元素中增加onsubmit=”return false;” 阻止表单提交</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>bug html ie8 hided radio</title>
    <url>/2016/09/06/bug-html-ie8-hided-radio/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>将radio表单元素放在隐藏的div中，利用显示的label for 试图改变radio的值 </p>
<p>IE8下不起作用</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>IE8无法通过label for 修改隐藏的表单元素值</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>利用input hidden 通过js监听label的click事件并改变hidden表单元素的值</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>Iterator调用remove()时抛出异常 java.lang.IllegalStateException</title>
    <url>/2016/06/29/bug-java-iterator-illegalstateexception/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="问题"><a href="#问题" class="headerlink" title="[问题]"></a>[问题]</h3><p>Iterator remove()时抛出异常 java.lang.IllegalStateException</p>
<pre><code>List&lt;String&gt; list = new ArrayList&lt;String&gt;();
list.add(&quot;a&quot;);
list.add(&quot;b&quot;);
list.add(&quot;c&quot;);
list.add(&quot;d&quot;);
Iterator&lt;String&gt; it = list.iterator();
int i =3;
while(it.hasNext()) &#123;
//                it.next();
    if (i--&gt;1) &#123;
        it.remove();
    &#125;
&#125;
System.out.println(list.size());
</code></pre>
<h3 id="原因"><a href="#原因" class="headerlink" title="[原因]"></a>[原因]</h3><p>没有调用next() 方法</p>
<h3 id="怎么发现的"><a href="#怎么发现的" class="headerlink" title="[怎么发现的]"></a>[怎么发现的]</h3><p>跟踪代码，查看Iterator.class源码，在源码注释中看到</p>
<pre><code>/**
 * 
 * Removes from the underlying collection the last element returned by the
 * iterator (optional operation).  This method can be called only once per
 * call to &lt;tt&gt;next&lt;/tt&gt;.  The behavior of an iterator is unspecified if
 * the underlying collection is modified while the iteration is in
 * progress in any way other than by calling this method.
 *
 * @exception UnsupportedOperationException if the &lt;tt&gt;remove&lt;/tt&gt;
 *          operation is not supported by this Iterator.
 
 * @exception IllegalStateException if the &lt;tt&gt;next&lt;/tt&gt; method has not
 *          yet been called, or the &lt;tt&gt;remove&lt;/tt&gt; method has already
 *          been called after the last call to the &lt;tt&gt;next&lt;/tt&gt;
 *          method.
 */
void remove();
</code></pre>
<h3 id="修复"><a href="#修复" class="headerlink" title="[修复]"></a>[修复]</h3><p>先调用next()方法，再调用remove()方法</p>
<h3 id="我导致的"><a href="#我导致的" class="headerlink" title="[我导致的]"></a>[我导致的]</h3><p>是的</p>
<h3 id="解决Bug的时间"><a href="#解决Bug的时间" class="headerlink" title="[解决Bug的时间]"></a>[解决Bug的时间]</h3><p>3分钟</p>
<h3 id="教训"><a href="#教训" class="headerlink" title="[教训]"></a>[教训]</h3><p>需要熟悉Iterator使用方法及设计原理</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>Set集合通过Comparable 排序不好用</title>
    <url>/2016/09/04/bug-java-set-comparable-unsort/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>Set集合通过Comparable 排序不好用</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>HashSet不能排序</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>可以改为TreeSet</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>java toString()方法无意识递归调用</title>
    <url>/2016/09/05/bug-java-toString-recursion/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>调用toString()时死循环</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>在toString()方法中使用了this关键字和+<br>String 后面的+后调用自动类型转换， 将this转换为String，而转换方法就是toString()，导致递归</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>toString()禁用this关键字</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>JS Uncaught RangeError： Maximum call stack size exceeded</title>
    <url>/2016/09/04/bug-javascript-Maximum-call-stack-size-exceeded/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>使用第三方js库时报错</p>
<pre><code>JS Uncaught RangeError: Maximum call stack size exceeded
</code></pre>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>第三方方法名重复，常为同一类库的不同版本被引用多次。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>注意引用类库版本及引用次数。自己编写的方法注意使用闭包，避免污染全局环境</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>js对象调用属性时报错</title>
    <url>/2016/09/03/bug-javascript-attr-error/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>js对象调用属性时报错 </p>
<pre><code>missing name after . operator
</code></pre>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>用关键字 保留字 作为属性名，如 obj.static </p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>可以修改属性获取方式为 obj[‘static’]</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>利用js抽象通用面包屑导航片段失败</title>
    <url>/2016/09/06/bug-javascript-breadcrumb/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>利用js记录路由值，抽象面包屑导航模块，导致业务复杂度上升</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>每个导航菜单都包含多个参数，利用js记录每个来源请求的地址+参数, 但抽象能力不足，导致设计过分复杂，而且是无用功。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>在每个页面中写静态导航</p>
<h3 id="附录为失败的导航js"><a href="#附录为失败的导航js" class="headerlink" title="附录为失败的导航js"></a>附录为失败的导航js</h3><pre><code>var breadcrumb = &#123;
    _cachekey: &#39;breadcrumbs&#39;,
    _breadcrumbs: [],
    init: function() &#123;
        this.clearBreadcrumb();
    &#125;,
    courseIndexInit: function() &#123;
        if (breadcrumb._breadcrumbs.length == 0) &#123;
            breadcrumb._breadcrumbs = WName.get(breadcrumb._cachekey);
            for (var i = 0; i &lt; breadcrumb._breadcrumbs.length; i++) &#123;
                var _thisBreadcrumb = breadcrumb._breadcrumbs[i];
                $(&quot;#breadCrumbMenu #&quot; + _thisBreadcrumb.name).length == 0 &amp;&amp; $(&#39;#breadCrumbMenu&#39;).append(_thisBreadcrumb.htmlTxt);
                $(&quot;#breadCrumbMenu #&quot; + _thisBreadcrumb.name).on(&quot;click&quot;, _thisBreadcrumb.fn);
            &#125;
        &#125;
    &#125;,
    refreshWNCache: function() &#123;
        WName.get(breadcrumb._cachekey) &amp;&amp; WName.remove(breadcrumb._cachekey);
        WName.put(breadcrumb._cachekey, breadcrumb._breadcrumbs);
    &#125;,
    refresh: function() &#123;
        this.refreshWNCache();
        $(&#39;#breadCrumbMenu&#39;).children().remove();
        for (var i = 0; i &lt; breadcrumb._breadcrumbs.length; i++) &#123;
            var _thisBreadcrumb = breadcrumb._breadcrumbs[i];
            $(&quot;#breadCrumbMenu #&quot; + _thisBreadcrumb.name).length == 0 &amp;&amp; $(&#39;#breadCrumbMenu&#39;).append(_thisBreadcrumb.htmlTxt);
            $(&quot;#breadCrumbMenu #&quot; + _thisBreadcrumb.name).on(&quot;click&quot;, _thisBreadcrumb.fn);
        &#125;
    &#125;,
    fillBreadcrumb: function(vName, vFoo, vIndex) &#123;
        var _thisBreadcrumb = this.breadcrumbTemplate[vName];
        $(&quot;#breadCrumbMenu #&quot; + vName).length == 0 &amp;&amp; $(&#39;#breadCrumbMenu&#39;).append(_thisBreadcrumb.htmlTxt);
        if (vFoo) &#123;
            _thisBreadcrumb.fn = vFoo;
        &#125;
        this._breadcrumbs[_thisBreadcrumb.seq] = _thisBreadcrumb;
        this._breadcrumbs.splice(1 + _thisBreadcrumb.seq, this._breadcrumbs.length);
        $(&quot;#breadCrumbMenu #&quot; + vName).on(&quot;click&quot;, _thisBreadcrumb.fn);
        this.refresh();
    &#125;,
    clearBreadcrumb: function() &#123;
        this._breadcrumbs = [];
        $(&#39;#breadCrumbMenu&#39;).children().remove();
        WName.put(breadcrumb._cachekey, null);
        WName.get(breadcrumb._cachekey) &amp;&amp; WName.remove(breadcrumb._cachekey);
    &#125;,
    breadcrumbTemplate: &#123;
        courseList: &#123; name: &#39;courseList&#39;, htmlTxt: &#39;&lt;span&gt;&lt;b&gt;/&lt;/b&gt;&lt;a href=&quot;#courseList&quot; id=&quot;courseList&quot;&gt;课程列表&lt;/a&gt;&lt;/span&gt;&#39;, seq: 0 &#125;,
        course: &#123; name: &#39;course&#39;, htmlTxt: &#39;&lt;span&gt;&lt;b&gt;/&lt;/b&gt;&lt;a href=&quot;#course&quot; id=&quot;course&quot;&gt;课程首页&lt;/a&gt;&lt;/span&gt;&#39;, seq: 1 &#125;,
        user: &#123; name: &#39;user&#39;, htmlTxt: &#39;&lt;span&gt;&lt;b&gt;/&lt;/b&gt;&lt;a href=&quot;#userBase&quot; id=&quot;user&quot;&gt;电子档案&lt;/a&gt;&lt;/span&gt;&#39;, seq: 0, fn: function() &#123; user.forupdateinfo() &#125; &#125;
    &#125;
&#125;
</code></pre>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>ie8不兼容stopPropagation</title>
    <url>/2016/09/03/bug-javascript-ie8-stopPropagation/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>IE8下stopPropagation，事件仍被父类捕获执行</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>IE8 无法通过stopPropagation阻止事件冒泡</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>通过return false阻止事件执行。</p>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><h4 id="event-stopPropagation"><a href="#event-stopPropagation" class="headerlink" title="event.stopPropagation();"></a>event.stopPropagation();</h4><p>事件处理过程中，阻止了事件冒泡，但不会阻止默认行为<br>stopPropagation() 相当好用, 可是 IE8 及以前版本都不支持.<br>IE 的事件对象包含特有的属性 cancelBubble, 只要将它赋值为 false 即可阻止事件继续. 如:</p>
<p>  // 在弹出对话框上点击时, 不进行任何页面操作, 并阻止冒泡<br>  document.getElementByIdx_x(‘dialog’).onclick = function(ev) {<br>      event.cancelBubble = false;<br>  };</p>
<h4 id="return-false"><a href="#return-false" class="headerlink" title="return false;"></a>return false;</h4><p>事件处理过程中，阻止了事件冒泡，也阻止了默认行为（包括超链接的跳转）</p>
<h4 id="event-preventDefault"><a href="#event-preventDefault" class="headerlink" title="event.preventDefault();"></a>event.preventDefault();</h4><p>事件处理过程中，不阻击事件冒泡，但会阻止默认行为（它会执行所有事件，却不执行超链接跳转）</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>执行innerHTML后绑定事件消失</title>
    <url>/2016/06/29/bug-javascript-innerhtml-appendchild/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="问题"><a href="#问题" class="headerlink" title="[问题]"></a>[问题]</h3><p>编写js插件，利用innerHTML=innerHTML+plugin_content 渲染插件内容后，原网站绑定事件失效。</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="[原因]"></a>[原因]</h3><p>jquery html元素绑定后，重新渲染页面后，没有重新绑定，所以失效。</p>
<h3 id="怎么发现的"><a href="#怎么发现的" class="headerlink" title="[怎么发现的]"></a>[怎么发现的]</h3><p>引用插件后，页面上的click事件无效。</p>
<h3 id="修复"><a href="#修复" class="headerlink" title="[修复]"></a>[修复]</h3><p>修改插件的渲染方式为 createElement元素后，通过appendChild添加到页面上。</p>
<h3 id="我导致的"><a href="#我导致的" class="headerlink" title="[我导致的]"></a>[我导致的]</h3><p>是的</p>
<h3 id="解决Bug的时间"><a href="#解决Bug的时间" class="headerlink" title="[解决Bug的时间]"></a>[解决Bug的时间]</h3><p>5分钟</p>
<h3 id="教训"><a href="#教训" class="headerlink" title="[教训]"></a>[教训]</h3><p>编写插件时，不能影响已有元素，不能侵入和耦合。了解页面的重绘。</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>listen</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>jstl if标签判断不起作用，都按false处理</title>
    <url>/2016/09/05/bug-jstl-if-all-false/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>&lt;c:if test判断不起作用，都按false处理</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>因为test=” {exp}”前多了一个空格</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>去掉多余空格</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 tomcat启动后外网无法访问</title>
    <url>/2016/09/07/bug-linux-outgoing-access/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>CentOS7 tomcat启动后外网无法访问</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>网络防火墙</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>关闭防火墙</p>
<p>centos 7</p>
<p>停止</p>
<pre><code>systemctl stop firewalld.service 
</code></pre>
<p>禁用</p>
<pre><code>systemctl disable firewalld.service 
</code></pre>
<p>之前的版本</p>
<p>停止</p>
<pre><code>service iptables stop
</code></pre>
<p>禁用</p>
<pre><code>chkconfig iptables off
</code></pre>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>package package_name is intended for different architec</title>
    <url>/2016/09/07/bug-linux-package-is-intended-for-different-architec/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>通过rpm安装jdk时提示<br><strong>package package_name is intended for different architec</strong></p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>安装包和当前操作系统不符，常见在x86 32位系统安装64位软件包</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>下载安装对应软件包</p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatis绑定错误</title>
    <url>/2016/09/08/bug-mybatis-invalid-bound-statement/</url>
    <content><![CDATA[<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>java程序报错 </p>
<pre><code>org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)
</code></pre>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>未扫描xml所在包路径</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>一般的原因是Mapper interface和xml文件的定义对应不上，需要检查包名，namespace，函数名称等能否对应上，需要比较细致的对比。</p>
<p>按以下步骤一一执行</p>
<ol>
<li>检查xml文件所在的package名称是否和interface对应的package名称一一对应</li>
<li>检查xml文件的namespace是否和xml文件的package名称一一对应</li>
<li>检查函数名称能否对应上</li>
<li>去掉xml文件中的中文注释</li>
<li>随意在xml文件中加一个空格或者空行然后保存</li>
</ol>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>idea创建的spring4允许单元测试时报错</title>
    <url>/2016/09/09/bug-spring-javax-servlet-sessioncoo/</url>
    <content><![CDATA[<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>idea创建的spring4允许单元测试时报错 </p>
<pre><code>java.lang.NoClassDefFoundError: javax/servlet/SessionCoo
</code></pre>
<p>servlet为2.5，Spring版本为4.1.1，tomcat 6</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>Spring Reference中提到，虽然Spring4仍然支持2.5，但它的主要目标是Servlet3.0及以上版本。如果你用Spring MVC Test Framework进行测试，则必须添加<br>兼容Servlet3.0的jar包(即3.0以上的servlet的jar包)，</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>在pom.xml中添加依赖</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
    &lt;version&gt;3.0.1&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>限制scope为test即可。</p>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><p><a href="https://jira.spring.io/browse/SPR-11292">https://jira.spring.io/browse/SPR-11292</a></p>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>bug</tag>
      </tags>
  </entry>
  <entry>
    <title>sql使用sum后 没有记录的数据 查出了一条空记录</title>
    <url>/2016/08/30/bug-sql-sum-null/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>通过sum()函数 查询sql时，报空指针异常</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>sum对空结果，返回null，预期返回int。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>在sql中进行过滤</p>
<pre><code>having column is not null
</code></pre>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>update事务死锁</title>
    <url>/2016/08/30/bug-sql-update-lock/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>java程序报错 </p>
<pre><code>java.sql.SQLException: Lock wait timeout exceeded; try restarting transaction
</code></pre>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>业务中update语句需要通过子查询where条件，子查询的select中需要调用外部表的参数作为条件。<br>随着数据量的增加，sql语句执行过慢，请求过于频繁，导致死锁。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ul>
<li>不建议增加线程锁，可通过适当的增加索引，优化sql语句执行速度。</li>
<li>尽量避免子查询，exists替代in</li>
<li>亦可先执行select查询，保存在结果集中，再进行批量update操作。</li>
<li>将两个操作增加事务标签。</li>
<li>如果sql语句无法优化，可能是由错误的业务逻辑导致。</li>
</ul>
]]></content>
      <categories>
        <category>bug</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 通过yum方式安装mysql5.7</title>
    <url>/2016/05/19/centos-mysql/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>在CentOS7环境下搭建mysql5.7数据库服务，强调一下版本号，因为安装过程中需要指定。</p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="下载mysql仓库rpm"><a href="#下载mysql仓库rpm" class="headerlink" title="下载mysql仓库rpm"></a>下载mysql仓库rpm</h3><pre><code>wget http://repo.mysql.com//mysql57-community-release-el7-8.noarch.rpm
</code></pre>
<h3 id="安装仓库"><a href="#安装仓库" class="headerlink" title="安装仓库"></a>安装仓库</h3><pre><code>sudo rpm -Uvh /mysql57-community-release-el7-8.noarch.rpm
</code></pre>
<p>也可以手动配置repo，此时不需要下载rpm文件。</p>
<h3 id="配置仓库"><a href="#配置仓库" class="headerlink" title="配置仓库"></a>配置仓库</h3><pre><code>vi /etc/yum.repos.d/mysql-community.repo 
</code></pre>
<p>通过命令打开文档，输入如下内容</p>
<blockquote>
<p>[mysql57-community]<br>name=MySQL 5.7 Community Server<br>baseurl=<a href="http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/">http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/</a><br>enabled=1<br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</p>
</blockquote>
<p>注意baseurl中的版本号需要与当前系统环境一致。如/el/7中的7与系统centOS7版本一致。</p>
<h3 id="查看可用软件源"><a href="#查看可用软件源" class="headerlink" title="查看可用软件源"></a>查看可用软件源</h3><pre><code>yum repolist enabled | grep mysql
</code></pre>
<h3 id="执行yum安装"><a href="#执行yum安装" class="headerlink" title="执行yum安装"></a>执行yum安装</h3><pre><code>yum install mysql-community-server 
</code></pre>
<h3 id="启动mysql服务"><a href="#启动mysql服务" class="headerlink" title="启动mysql服务"></a>启动mysql服务</h3><pre><code>service mysqld start
</code></pre>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="查询root密码"><a href="#查询root密码" class="headerlink" title="查询root密码"></a>查询root密码</h3><p>密码由mysql自动生成，可以在log文件中查看。</p>
<pre><code>sudo grep &#39;temporary password&#39; /var/log/mysqld.log
</code></pre>
<h3 id="登陆mysql"><a href="#登陆mysql" class="headerlink" title="登陆mysql"></a>登陆mysql</h3><pre><code>mysql -uroot -p上步获取的密码
</code></pre>
<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><pre><code>登陆成功后，不能执行操作，需要先修改密码。犹豫安全策略，新设置的密码必须包含大小写字母，数字以及符号。

ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;MyNewPass4!&#39;; 
</code></pre>
<h3 id="修改访问权限"><a href="#修改访问权限" class="headerlink" title="修改访问权限"></a>修改访问权限</h3><p>此时的数据库只能本机访问，通过修改表的方式将权限开放给全部用户。</p>
<pre><code>mysql -uroot -pMyNewPass4!

use mysql;

update user set Host = &#39;%&#39; where User=&#39;root&#39;;
</code></pre>
<p>注意，修改表后，必须重启mysql服务，修改才能生效。</p>
<pre><code>service mysqld restart;
</code></pre>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 通过yum方式安装Nginx</title>
    <url>/2016/05/19/centos-nginx/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>在CentOS环境下搭建一个nginx的服务器，安装过程比较简单，做一个简单的记录。</p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="配置repo"><a href="#配置repo" class="headerlink" title="配置repo"></a>配置repo</h3><pre><code>vi /etc/yum.repos.d/nginx.repo 
</code></pre>
<p>通过命令打开文档，输入如下内容</p>
<blockquote>
<p>[nginx]<br>name=nginx repo<br>baseurl=<a href="http://nginx.org/packages/centos/7/$basearch/">http://nginx.org/packages/centos/7/$basearch/</a><br>gpgcheck=0<br>enabled=1</p>
</blockquote>
<p>其中centos表明当前系统，7表示系统版本。</p>
<h3 id="执行yum安装"><a href="#执行yum安装" class="headerlink" title="执行yum安装"></a>执行yum安装</h3><pre><code>sudo yum install -y nginx
</code></pre>
<p>安装程序执行完毕后，可以通过</p>
<pre><code>nginx -v
</code></pre>
<p>查看安装nginx版本，并确认程序安装成功。</p>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><pre><code>service nginx start 
</code></pre>
<p>此时会提示 Redirecting to /bin/systemctl start  nginx.service<br>因为在centos7中将service 和 chkconfig 命令合并到systemctl中，但仍可通过service启动nginx服务。<br>此时通过浏览器访问<a href="http://localhost,可以看到nginx启动成功的提示./">http://localhost，可以看到nginx启动成功的提示。</a></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="修改服务目录"><a href="#修改服务目录" class="headerlink" title="修改服务目录"></a>修改服务目录</h3><pre><code>vi /etc/nginx/conf.d/default.conf
</code></pre>
<p>listen 80; 表示监听80端口<br>server_name localhost;表示域名或ip，可以以此搭建反向代理服务器，实现负载均衡。这个后续会有文档单独写。<br>location / {} root表示指向的静态文件目录路径，index表示首页文件，可以自定义修改root目录， 或者直接修改默认目录下的首页文件 /usr/share/nginx/www/index.html<br>重启nginx服务</p>
<pre><code>service nginx restart
</code></pre>
<p>刷新浏览器，可以看见修改以生效。</p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>清空mysql查询缓存</title>
    <url>/2015/12/14/clear-mysql-query-cache/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="mysql-查询缓存"><a href="#mysql-查询缓存" class="headerlink" title="mysql 查询缓存"></a>mysql 查询缓存</h1><p>在sql调优的过程中，发现原本很慢的一条sql（将近1分钟） 在第二次运行时， 瞬间就完成了（0.04sec）。<br>这是因为mysql自带的缓存机制，将查询结果进行缓存，如果table数据未发生变化，再次使用同一条sql进行查询时，直接从上次的查询结果缓存中读取数据，而不是重新分析、执行sql。<br>如果table数据发生变化，所有与之相关的缓存都会被释放刷新，这样就不会出现数据脏读问题。</p>
<blockquote>
<p>The query cache stores the text of a SELECT statement together with the corresponding result that was sent to the client. If an identical statement is received later, the server retrieves the results from the query cache rather than parsing and executing the statement again. The query cache is shared among sessions, so a result set generated by one client can be sent in response to the same query issued by another client.</p>
</blockquote>
<hr>
<h1 id="是否使用查询缓存"><a href="#是否使用查询缓存" class="headerlink" title="是否使用查询缓存"></a>是否使用查询缓存</h1><p>为了避免缓存，可以在sql查询语句的字段前增加 <strong>SQL_NO_CACHE</strong> 关键字<br>如：</p>
<pre><code>select * from t_user;

select SQL_NO_CACHE * from t_user;
</code></pre>
<p>反之，你也可以使用 <strong>SQL_CACHE</strong> 关键字，强制mysql从缓存中读取数据</p>
<pre><code>select SQL_CACHE * from t_user;
</code></pre>
<p>mysql还提供了一种释放全部缓存的方法</p>
<pre><code>reset query cache;  
</code></pre>
<hr>
<h1 id="设置查询缓存"><a href="#设置查询缓存" class="headerlink" title="设置查询缓存"></a>设置查询缓存</h1><p>查看是否有查询缓存。</p>
<pre><code>SHOW VARIABLES LIKE &#39;have_query_cache&#39;;
</code></pre>
<p><strong>注意</strong>，只要数据库拥有查询缓存功能，这个VALUE就是YES，无论查询缓存是否启用。</p>
<p>则查询缓存为启用状态。mysql默认为启用状态</p>
<p>mysql查询缓存可以通过两个变量来控制，<strong>query_cache_type</strong>和<strong>query_cache_size</strong>。</p>
<hr>
<h2 id="query-cache-type"><a href="#query-cache-type" class="headerlink" title="query_cache_type"></a>query_cache_type</h2><pre><code>SHOW VARIABLES LIKE &#39;query_cache_type&#39;;
</code></pre>
<p><strong>query_cache_type</strong>包含三种状态</p>
<ul>
<li><strong>0</strong> or <strong>OFF</strong> 此时不会从缓存中读取查询数据</li>
<li><strong>1</strong> or <strong>ON</strong> 表示除非声明了<strong>SELECT SQL_NO_CACHE</strong>，否则都会从缓存中读取数据</li>
<li><strong>2</strong> or <strong>DEMAND</strong> 表示所有语句都会从缓存中读取，相当于所有查询语句都使用了<strong>SELECT SQL_CACHE</strong></li>
</ul>
<p>通过如下命令可以设置查询缓存状态(需要管理员权限)，执行后，需要重启mysql服务才能生效。</p>
<pre><code>SET GLOBAL query_cache_type = 1;  
</code></pre>
<p>但是此命令会影响所有的使用此mysql服务的client。可以通过如下命令，关闭此客户端的查询缓存状态，但是同样需要重启server后才能生效。</p>
<pre><code>SET SESSION query_cache_type = OFF;

SHOW VARIABLES LIKE &#39;query_cache_type&#39;;
</code></pre>
<h2 id="query-cache-size"><a href="#query-cache-size" class="headerlink" title="query_cache_size"></a>query_cache_size</h2><pre><code>SHOW VARIABLES LIKE &#39;query_cache_size&#39;;
</code></pre>
<p><strong>query_cache_size</strong>表示缓存大小，默认为1M。如果设置为0，则相当于<strong>query_cache_size=OFF</strong>。</p>
<p>同样可通过 <strong>SET GLOBAL</strong> 进行设置</p>
<pre><code>SET GLOBAL query_cache_size=40000;
</code></pre>
<p>需要注意的是，设置的query_cache_size，并不全是用于存储数据，还有约40KB的空间来维护查询缓存的结构。</p>
<hr>
<p><strong>Best regards</strong><br><strong>Wang Yuheng</strong></p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>query cache</tag>
      </tags>
  </entry>
  <entry>
    <title>朋友，你听说过跨域吗</title>
    <url>/2021/03/16/cors/</url>
    <content><![CDATA[<p>大部分开发人员在前后端分离的场景下，都遇到过浏览器跨域问题，然后在网上搜了几个配置就解决了。但是，你真的了解跨域这件事吗？而你找到的配置又做什么？</p>
<p>看一下这几个问题，测试一下你对跨域的理解程度。</p>
<ol>
<li>什么是跨域？和CORS是什么关系？</li>
<li>如果通过curl直接请求接口，并在header中增加origin，是否有跨域限制？</li>
<li>为什么有跨域限制？</li>
<li>什么时候会触发预检(PreFlight by OPTIONS)机制？</li>
<li>如何区分OPTIONS请求和预检(PreFlight)</li>
<li>跨域请求会携带cookie信息吗？</li>
</ol>
<span id="more"></span>

<h2 id="1-什么是跨域？和CORS是什么关系？"><a href="#1-什么是跨域？和CORS是什么关系？" class="headerlink" title="1. 什么是跨域？和CORS是什么关系？"></a>1. 什么是跨域？和CORS是什么关系？</h2><p>CORS 是解决浏览器跨域限制的方案之一。</p>
<p>跨域: 简单来说是指浏览器在domain-a.com的域名下，异步加载非当前访问域名(e.g: domain-b.com)下的资源。如果协议+域名+端口号均相同，则是同域，否则，则是跨域。</p>
<p><img src="https://img.yuheng.wang/mweb/cors_03.png" alt="cors_00"></p>
<blockquote>
<p>CORS:Cross-origin resource sharing (跨源资源共享) （或通俗地译为跨域资源共享）是一种基于HTTP 头的机制，该机制通过允许服务器标示除了它自己以外的其它origin（域，协议和端口），这样浏览器可以访问加载这些资源。</p>
</blockquote>
<p><img src="https://img.yuheng.wang/mweb/cors_00.png" alt="cors_01"></p>
<h2 id="2-如果通过curl直接请求接口，并在header中增加origin，是否有跨域限制？"><a href="#2-如果通过curl直接请求接口，并在header中增加origin，是否有跨域限制？" class="headerlink" title="2. 如果通过curl直接请求接口，并在header中增加origin，是否有跨域限制？"></a>2. 如果通过curl直接请求接口，并在header中增加origin，是否有跨域限制？</h2><p>不会。跨域限制是浏览器行为。</p>
<p>服务端可以通过Request Header中的Origin判断是否跨域。如果服务端不做限制，浏览器的请求也会被执行，并返回结果。但是浏览器会解析Response中的header是否包含<code>Access-Control-Allow-Origin</code>且Value与当前同源，否则不会解析response body并抛出<code>CORS error</code></p>
<p><img src="https://img.yuheng.wang/mweb/cors_11.png" alt="cors_02"></p>
<p>Origin在CORS或POST请求中才存在。</p>
<h2 id="3-为什么有跨域限制？"><a href="#3-为什么有跨域限制？" class="headerlink" title="3. 为什么有跨域限制？"></a>3. 为什么有跨域限制？</h2><p>如果允许跨域，用户可能会遭到CSRF攻击。</p>
<blockquote>
<p>跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack 或者 session riding，通常缩写为 CSRF 或者 XSRF， 是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。跟跨网站脚本（XSS）相比，XSS 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。</p>
</blockquote>
<p><img src="https://img.yuheng.wang/mweb/cors_01.png" alt="cors_03"></p>
<p>一个典型场景是，如果你在通过web浏览器访问email邮箱，点开了某个奇怪的链接，而这个链接则是自动向你的email邮箱服务器提交某个规则变更请求。如果没有跨域限制，则服务器判断为是你本人在登陆状态下发送的变更请求，而这个变更可能导致你的邮件全部被转发到攻击者邮箱内。</p>
<p>另一个经典场景则是iframe包裹真实网站，诱导用户进行敏感操作</p>
<h2 id="4-什么时候会触发预检-PreFlight-by-OPTIONS-机制？"><a href="#4-什么时候会触发预检-PreFlight-by-OPTIONS-机制？" class="headerlink" title="4. 什么时候会触发预检(PreFlight by OPTIONS)机制？"></a>4. 什么时候会触发预检(PreFlight by OPTIONS)机制？</h2><p>预检请求先使用 OPTIONS 方法发起一个预检请求到服务器，以获知服务器是否允许该实际请求。”预检请求”的使用，可以避免跨域请求对服务器的用户数据产生未预期的影响。</p>
<p>以Spring为例，如果预检请求不通过，则会直接返回<code>403</code>阻止后续继续发送实际请求。</p>
<p><img src="https://img.yuheng.wang/mweb/cors_02.png" alt="cors_04"></p>
<p><img src="https://img.yuheng.wang/mweb/cors_05.png" alt="cors_05"><br><img src="https://img.yuheng.wang/mweb/cors_06.png" alt="cors_06"></p>
<p>请求会区分简单请求和预检请求。非简单请求都会触发预检操作。</p>
<p>简单请求包括但不局限</p>
<ol>
<li>使用下列方法之一：<ol>
<li>GET</li>
<li>HEAD</li>
<li>POST</li>
</ol>
</li>
<li>Content-Type 的值仅限于下列三者之一：<ol>
<li>text/plain</li>
<li>multipart/form-data</li>
<li>application/x-www-form-urlencoded</li>
</ol>
</li>
</ol>
<h2 id="5-如何区分OPTIONS请求和预检-PreFlight"><a href="#5-如何区分OPTIONS请求和预检-PreFlight" class="headerlink" title="5. 如何区分OPTIONS请求和预检(PreFlight)"></a>5. 如何区分OPTIONS请求和预检(PreFlight)</h2><p>预检请求 会在header中增加<code>Access-Control-Request-Method</code></p>
<p>比如跨域请求put请求，则会先发送一个 OPTIONS 请求，且header包括<code>Access-Control-Request-Method=PUT</code></p>
<p><img src="https://img.yuheng.wang/mweb/cors_07.png" alt="cors_07"></p>
<p><img src="https://img.yuheng.wang/mweb/cors_08.png" alt="cors_08"></p>
<h2 id="6-跨域请求会携带cookie信息吗？"><a href="#6-跨域请求会携带cookie信息吗？" class="headerlink" title="6. 跨域请求会携带cookie信息吗？"></a>6. 跨域请求会携带cookie信息吗？</h2><p>默认不会发送，可以通过设置<code>withCredentials = true;</code>让客户端发送cookie信息。<br>如果客户端设置<code>withCredentials = true;</code>但是服务端response未返回<code>Access-Control-Allow-Credentials: true</code>，则会抛出<code>CORS error</code>。<br><img src="https://img.yuheng.wang/mweb/cors_09.png" alt="cors_09"><br>同时，为了避免误用导致的安全性问题，如果设置了<code>allowCredentials</code>，则不允许将<code>Access-Control-Allow-Origin</code>设置通配符<code>*</code>，只能设置具体的某个源。</p>
<p>Spring5.3版本提供了相关限制</p>
<p><img src="https://img.yuheng.wang/mweb/cors_10.png" alt="cors_10"></p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>知识点</tag>
        <tag>跨域</tag>
      </tags>
  </entry>
  <entry>
    <title>如何用GraphQL+JavaPoet把前端逼成瓶颈</title>
    <url>/2020/12/21/ddd-generator/</url>
    <content><![CDATA[<p>AKA: 如何炒了自己 -_-#</p>
<p>代码已开源： <a href="https://github.com/YituHealthcare/Arc">https://github.com/YituHealthcare/Arc</a></p>
<span id="more"></span>

<p>上篇文章<a href="https://wangyuheng.github.io/2020/08/09/ddd-graphql-dgraph/">《DDD探险——基于GraphQL+Dgraph实践》</a>中提到了一种假设</p>
<blockquote>
<p>如果前端能通过领域模型进行数据操作，能否通过<code>GraphQL Schema</code>同时描述领域模型、API接口以及数据库结构？</p>
</blockquote>
<p>基于此假设提供了<code>Arc</code>框架，同时采用<code>Dgraph</code>作为数据存储。<br>既然我们已经有了<strong>Schema</strong>，能否基于这个描述自动生成系统实现？通过降低开发成本、提升效率，达成快速迭代、试错<strong>领域模型</strong>的目的。</p>
<p>尝试通过<strong>代码生成器</strong>来完成这个假设。</p>
<h2 id="1-GraphQL-Schema-gt-Dgraphql-Schema"><a href="#1-GraphQL-Schema-gt-Dgraphql-Schema" class="headerlink" title="1. GraphQL Schema -&gt; Dgraphql Schema"></a>1. GraphQL Schema -&gt; Dgraphql Schema</h2><h3 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念:"></a>1.1 概念:</h3><ol>
<li><strong>Dgraph Schema:</strong> <code>Dgraph</code>数据库结构化语句，类似<code>mysql</code>中的<strong>DDL</strong></li>
<li><strong>predicate:</strong> <code>Dgraph</code>的数据库字段，一个<code>predicate</code>可以被多个<code>type</code>使用</li>
<li><strong>domainClass:</strong> <code>Arc</code>框架中定义<code>javaBean</code>类型，用于反序列化</li>
</ol>
<h3 id="1-2-方案"><a href="#1-2-方案" class="headerlink" title="1.2 方案"></a>1.2 方案</h3><p>解析<code>GraphQL Schema</code>后，根据转换逻辑生成<code>Dgraph Schema</code></p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxMzNweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjk3OHB4O2hlaWdodDoxMzNweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA5NzggMTMzIiB3aWR0aD0iOTc4cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMTI5IiB4Mj0iMTI5IiB5MT0iMzYuMjk2OSIgeTI9Ijk4LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMzU0IiB4Mj0iMzU0IiB5MT0iMzYuMjk2OSIgeTI9Ijk4LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iNTcyIiB4Mj0iNTcyIiB5MT0iMzYuMjk2OSIgeTI9Ijk4LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iODM2IiB4Mj0iODM2IiB5MT0iMzYuMjk2OSIgeTI9Ijk4LjI5NjkiLz48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI0OCIgeD0iNSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzNCIgeD0iMTIiIHk9IjI0Ljk5NTEiPklucHV0U3RyZWFtIGZvciBHcmFwaHFsU2NoZW1hPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjQ4IiB4PSI1IiB5PSI5Ny4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjM0IiB4PSIxMiIgeT0iMTE3LjI5MiI+SW5wdXRTdHJlYW0gZm9yIEdyYXBocWxTY2hlbWE8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxODIiIHg9IjI2MyIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2OCIgeD0iMjcwIiB5PSIyNC45OTUxIj5UeXBlRGVmaW5pdGlvblJlZ2lzdHJ5PC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTgyIiB4PSIyNjMiIHk9Ijk3LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjgiIHg9IjI3MCIgeT0iMTE3LjI5MiI+VHlwZURlZmluaXRpb25SZWdpc3RyeTwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIzNSIgeD0iNDU1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjIxIiB4PSI0NjIiIHk9IjI0Ljk5NTEiPlN0cmVhbSZsdDtEZ3JhcGhTY2hlbWFUeXBlJmd0OzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIzNSIgeD0iNDU1IiB5PSI5Ny4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjIxIiB4PSI0NjIiIHk9IjExNy4yOTIiPlN0cmVhbSZsdDtEZ3JhcGhTY2hlbWFUeXBlJmd0OzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI3MiIgeD0iNzAwIiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU4IiB4PSI3MDciIHk9IjI0Ljk5NTEiPlN0cmVhbSZsdDtTdHJpbmcmZ3Q7IGZvciBEZ3JhcGhTY2hlbWE8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNzIiIHg9IjcwMCIgeT0iOTcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1OCIgeD0iNzA3IiB5PSIxMTcuMjkyIj5TdHJlYW0mbHQ7U3RyaW5nJmd0OyBmb3IgRGdyYXBoU2NoZW1hPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzQyLDQ4LjI5NjksMzUyLDUyLjI5NjksMzQyLDU2LjI5NjksMzQ2LDUyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEyOSIgeDI9IjM0OCIgeTE9IjUyLjI5NjkiIHkyPSI1Mi4yOTY5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NjAuNSw2Mi4yOTY5LDU3MC41LDY2LjI5NjksNTYwLjUsNzAuMjk2OSw1NjQuNSw2Ni4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzNTQiIHgyPSI1NjYuNSIgeTE9IjY2LjI5NjkiIHkyPSI2Ni4yOTY5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4MjQsNzYuMjk2OSw4MzQsODAuMjk2OSw4MjQsODQuMjk2OSw4MjgsODAuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTcyLjUiIHgyPSI4MzAiIHkxPSI4MC4yOTY5IiB5Mj0iODAuMjk2OSIvPjwhLS1TUkM9W1JPdXoyaUNtMzRQdGRxOWF4bXJBODYwZU5JRFZHMEo3NEpJRXdnWDNSanpPTmJCZU9GdDAtdnVpTDlHZDVpZUF0SkZCSHI1QmYxTmNoUzJaYTJwbDVxdkJOQWEzc2M1bVNXczRHd0FGQ3NUTXRsOE80LXpRM1lFMzd0X1B2aHR4TEFMRE1VRXpxVVduX0NORm5aZHJ6ZnJoakFOR2tHNWtsSHF4Tm50REw4aWotMEswXS0tPjwvZz48L3N2Zz4='>

<p>注意<code>Arc</code>框架限制</p>
<ol>
<li>DB结构中拥有框架依赖通用<code>predicate</code>，如 <code>domainClass</code></li>
<li>为了解决<code>predicate</code>跨<code>type</code>定义问题，<code>dgraph</code>中的<code>predicate</code>命名增加<code>type</code>为<strong>前缀</strong></li>
</ol>
<h3 id="1-3-注意"><a href="#1-3-注意" class="headerlink" title="1.3 注意"></a>1.3 注意</h3><ol>
<li>需要框架提供根据<code>DgraphSchema</code>自动初始化数据库的能力</li>
</ol>
<h2 id="2-GraphQL-Schema-gt-JavaCode"><a href="#2-GraphQL-Schema-gt-JavaCode" class="headerlink" title="2. GraphQL Schema -&gt; JavaCode"></a>2. GraphQL Schema -&gt; JavaCode</h2><h3 id="2-1-JavaPoet"><a href="#2-1-JavaPoet" class="headerlink" title="2.1 JavaPoet"></a>2.1 JavaPoet</h3><blockquote>
<p>JavaPoet is a Java API for generating .java source files.</p>
</blockquote>
<p>通过<code>JavaPoet</code>可以方便、详细的描述<strong>Java源文件</strong>并生成。</p>
<p>看官方issue发现很多人希望提供快速生成<code>getter</code>、<code>setter</code>方法的方式，官方并未采纳，给出的回复是</p>
<blockquote>
<p>Basically we’re a tool for generating exactly what you tell us and not a tool for inferring code to generate. You can write a static method or helper class which can produce a field, getter, and setting in one shot onto a TypeSpec.Builder.</p>
</blockquote>
<p>这个回复也明确了<code>JavaPoet</code>的定位。其实生成相关方法的方式非常简单</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldSpecGenSetter</span> <span class="keyword">implements</span> <span class="title">Function</span>&lt;<span class="title">FieldSpec</span>, <span class="title">MethodSpec</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MethodSpec <span class="title">apply</span><span class="params">(FieldSpec fieldSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MethodSpec.methodBuilder(<span class="string">&quot;set&quot;</span> + StringUtils.capitalize(fieldSpec.name))</span><br><span class="line">                .addModifiers(Modifier.PUBLIC)</span><br><span class="line">                .addParameter(fieldSpec.type, fieldSpec.name)</span><br><span class="line">                .addStatement(<span class="string">&quot;this.$L = $L&quot;</span>, fieldSpec.name, fieldSpec.name)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldSpecGenGetter</span> <span class="keyword">implements</span> <span class="title">Function</span>&lt;<span class="title">FieldSpec</span>, <span class="title">MethodSpec</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MethodSpec <span class="title">apply</span><span class="params">(FieldSpec fieldSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MethodSpec.methodBuilder(GenSpecUtil.getGetterPrefix(fieldSpec) + StringUtils.capitalize(fieldSpec.name))</span><br><span class="line">                .addModifiers(Modifier.PUBLIC)</span><br><span class="line">                .addStatement(<span class="string">&quot;return $L&quot;</span>, fieldSpec.name)</span><br><span class="line">                .returns(fieldSpec.type)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提供一个生成<code>Builder</code>的示例，基本涵盖了全部定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TypeSpecGenBuilder</span> <span class="keyword">implements</span> <span class="title">UnaryOperator</span>&lt;<span class="title">TypeSpec</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TypeSpec <span class="title">apply</span><span class="params">(TypeSpec source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(source.fieldSpecs)) &#123;</span><br><span class="line">            <span class="keyword">return</span> source;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            TypeSpec target = TypeSpec.classBuilder(source.name + <span class="string">&quot;Builder&quot;</span>).build();</span><br><span class="line">            <span class="keyword">return</span> source.toBuilder()</span><br><span class="line">                    .addMethod(getAllArgsConstructor(source.fieldSpecs))</span><br><span class="line">                    .addMethod(getNoArgsConstructor())</span><br><span class="line">                    .addMethod(getBuilderInstanceMethod(target))</span><br><span class="line">                    .addType(getBuilderType(source, target))</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> MethodSpec <span class="title">getAllArgsConstructor</span><span class="params">(List&lt;FieldSpec&gt; fieldSpecs)</span> </span>&#123;</span><br><span class="line">        MethodSpec.Builder builder = MethodSpec.constructorBuilder()</span><br><span class="line">                .addModifiers(Modifier.PUBLIC)</span><br><span class="line">                .addParameters(fieldSpecs.stream().map(f -&gt; ParameterSpec.builder(f.type, f.name).build()).collect(Collectors.toList()));</span><br><span class="line">        fieldSpecs.forEach(fieldSpec -&gt; builder.addStatement(<span class="string">&quot;this.$L = $L&quot;</span>, fieldSpec.name, fieldSpec.name));</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> MethodSpec <span class="title">getNoArgsConstructor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MethodSpec.constructorBuilder().addModifiers(Modifier.PUBLIC).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> MethodSpec <span class="title">getBuilderInstanceMethod</span><span class="params">(TypeSpec target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MethodSpec.methodBuilder(<span class="string">&quot;builder&quot;</span>)</span><br><span class="line">                .addModifiers(Modifier.PUBLIC, Modifier.STATIC)</span><br><span class="line">                .returns(getType(target))</span><br><span class="line">                .addStatement(<span class="string">&quot;return new $T()&quot;</span>, getType(target))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TypeSpec <span class="title">getBuilderType</span><span class="params">(TypeSpec source, TypeSpec target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> target.toBuilder()</span><br><span class="line">                .addFields(source.fieldSpecs.stream().map(it -&gt; FieldSpec.builder(it.type, it.name, Modifier.PRIVATE).build()).collect(Collectors.toList()))</span><br><span class="line">                .addModifiers(Modifier.PUBLIC, Modifier.STATIC)</span><br><span class="line">                .addMethod(MethodSpec.constructorBuilder().addModifiers(Modifier.PRIVATE).build())</span><br><span class="line">                .addMethods(getBuilderSetMethodSpecList(source, target))</span><br><span class="line">                .addMethod(getSourceInstanceMethod(source))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;MethodSpec&gt; <span class="title">getBuilderSetMethodSpecList</span><span class="params">(TypeSpec source, TypeSpec target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> source.fieldSpecs.stream()</span><br><span class="line">                .map(fieldSpec -&gt; MethodSpec.methodBuilder(fieldSpec.name)</span><br><span class="line">                        .addModifiers(Modifier.PUBLIC)</span><br><span class="line">                        .returns(getType(target))</span><br><span class="line">                        .addParameter(ParameterSpec.builder(fieldSpec.type, fieldSpec.name).build())</span><br><span class="line">                        .addStatement(<span class="string">&quot;this.$L = $L&quot;</span>, fieldSpec.name, fieldSpec.name)</span><br><span class="line">                        .addStatement(<span class="string">&quot;return this&quot;</span>)</span><br><span class="line">                        .build()).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> MethodSpec <span class="title">getSourceInstanceMethod</span><span class="params">(TypeSpec source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MethodSpec.methodBuilder(<span class="string">&quot;build&quot;</span>)</span><br><span class="line">                .addStatement(<span class="string">&quot;return new $L($L)&quot;</span>, source.name, source.fieldSpecs.stream().map(f -&gt; f.name).collect(Collectors.joining(<span class="string">&quot;,&quot;</span>)))</span><br><span class="line">                .addModifiers(Modifier.PUBLIC)</span><br><span class="line">                .returns(ClassName.get(<span class="string">&quot;&quot;</span>, source.name))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TypeName <span class="title">getType</span><span class="params">(TypeSpec typeSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ClassName.get(<span class="string">&quot;&quot;</span>, typeSpec.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-实现"><a href="#2-2-实现" class="headerlink" title="2.2 实现"></a>2.2 实现</h3><p>基于 <code>graphql-java</code> 解析 <code>GraphqlSchema</code>，通过 <code>javapoet</code> 按照<code>Arc</code>约束生成相关<strong>java文件</strong></p>
<ul>
<li><code>Graphql Enum</code> -&gt; <code>dictionary</code></li>
<li><code>Graphql input</code> -&gt; <code>input</code></li>
<li><code>Graphql type</code> -&gt; <code>type</code>、<code>api</code>、<code>repository</code></li>
</ul>
<h3 id="2-3-注意"><a href="#2-3-注意" class="headerlink" title="2.3 注意"></a>2.3 注意</h3><ol>
<li>通过只提供<code>interface</code>方式，避免修改生成的代码。保障每次<strong>schema</strong>变更后都可以重新生成。</li>
<li>如果存在需要修改生成代码的场景，通过<strong>配置</strong>方式跳过相关<strong>Java源文件</strong>生成。</li>
</ol>
<h2 id="3-Maven-Plugin"><a href="#3-Maven-Plugin" class="headerlink" title="3. Maven Plugin"></a>3. Maven Plugin</h2><p>生成逻辑通过上述定义完成后，如何触发生成的动作？<strong>Maven插件</strong>是一个不错的选择。<br>只需要继承<code>AbstractMojo</code>在<code>Override execute()</code>中调用相关生成方法即可。这里暂不展开<strong>如何开发Maven插件</strong>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mojo(name = &quot;generate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorMojo</span> <span class="keyword">extends</span> <span class="title">AbstractMojo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter(defaultValue = &quot;$&#123;project&#125;&quot;, readonly = true, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> MavenProject project;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter(defaultValue = &quot;$&#123;basedir&#125;/src/main/resources/arc-generator.json&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> File configJson;</span><br><span class="line">    <span class="meta">@Parameter(defaultValue = &quot;$&#123;basedir&#125;/src/main/resources/graphql/schema.graphqls&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> File schemaPath;</span><br><span class="line">    <span class="meta">@Parameter(property = &quot;target&quot;, defaultValue = &quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TARGET_ALL = <span class="string">&quot;all&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TARGET_JAVA = <span class="string">&quot;java&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TARGET_DGRAPH = <span class="string">&quot;dgraph&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> MojoExecutionException, MojoFailureException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> CodeGenConfig config = getConfig();</span><br><span class="line">        <span class="keyword">if</span> (TARGET_ALL.equalsIgnoreCase(target) || TARGET_JAVA.equalsIgnoreCase(target)) &#123;</span><br><span class="line">            generateJava(config);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (TARGET_ALL.equalsIgnoreCase(target) || TARGET_DGRAPH.equalsIgnoreCase(target)) &#123;</span><br><span class="line">            generateDgraph(config);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再命令行执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn arc:generate</span><br></pre></td></tr></table></figure>
<p>即可按照配置及规则生成相关代码。也可以通过参数决定只生成<strong>java代码</strong>，不生成 <code>Dgraph Schema</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn arc:generate -Dtarget=java</span><br></pre></td></tr></table></figure>

<h2 id="4-效果"><a href="#4-效果" class="headerlink" title="4. 效果"></a>4. 效果</h2><h3 id="4-0-添加Maven插件依赖"><a href="#4-0-添加Maven插件依赖" class="headerlink" title="4.0 添加Maven插件依赖"></a>4.0 添加Maven插件依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.yituhealthcare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>arc-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-创建schema-默认路径为-resources-graphql-schema-graphqls"><a href="#4-1-创建schema-默认路径为-resources-graphql-schema-graphqls" class="headerlink" title="4.1 创建schema. 默认路径为 resources:graphql/schema.graphqls"></a>4.1 创建schema. 默认路径为 resources:graphql/schema.graphqls</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scalar DateTime</span><br><span class="line"></span><br><span class="line">schema&#123;</span><br><span class="line">    query: Query,</span><br><span class="line">    mutation: Mutation</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Query&#123;</span><br><span class="line">    project(</span><br><span class="line">        id: String</span><br><span class="line">    ): Project</span><br><span class="line">    users: [User]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Mutation&#123;</span><br><span class="line">    createProject(</span><br><span class="line">        payload: ProjectInput</span><br><span class="line">    ): Project</span><br><span class="line">    createMilestone(</span><br><span class="line">        payload: MilestoneInput</span><br><span class="line">    ): Milestone</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">项目分类</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">enum ProjectCategory &#123;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    示例项目</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    DEMO</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    生产项目</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    PRODUCTION</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">名称</span><br><span class="line">为了达到某个产品迭代、产品模块开发、或者科研调研等目的所做的工作.</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">type Project&#123;</span><br><span class="line">    id: String!</span><br><span class="line">    name: String!</span><br><span class="line">    description: String!</span><br><span class="line">    category: ProjectCategory</span><br><span class="line">    createTime: DateTime!</span><br><span class="line">    milestones(</span><br><span class="line">        status: MilestoneStatus</span><br><span class="line">    ): [Milestone]</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">里程碑</span><br><span class="line">表述一个Project的某个时间阶段及阶段性目标. 一个Project可以同时拥有多个处于相同或者不同阶段的Milestone.</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">type Milestone&#123;</span><br><span class="line">    id: String!</span><br><span class="line">    name: String!</span><br><span class="line">    status: MilestoneStatus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type User &#123;</span><br><span class="line">    name: String!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">里程碑状态</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">enum MilestoneStatus&#123;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    未开始</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    NOT_STARTED,</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    进行中</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    DOING,</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    发布</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    RELEASE,</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    关闭</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    CLOSE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">input ProjectInput&#123;</span><br><span class="line">    name: String!</span><br><span class="line">    description: String!</span><br><span class="line">    vendorBranches: [String!]!</span><br><span class="line">    category: ProjectCategory!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input MilestoneInput&#123;</span><br><span class="line">    projectId: String!</span><br><span class="line">    name: String!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-新建配置文件，-默认路径为-resources-arc-generator-json"><a href="#4-2-新建配置文件，-默认路径为-resources-arc-generator-json" class="headerlink" title="4.2 新建配置文件， 默认路径为 resources:arc-generator.json"></a>4.2 新建配置文件， 默认路径为 resources:arc-generator.json</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;basePackage&quot;</span>: <span class="string">&quot;com.github.yituhealthcare.arcgeneratorsample&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dropAll&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;genStrategies&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;codeGenOperation&quot;</span>: <span class="string">&quot;SKIP_IF_EXISTED&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;codeGenType&quot;</span>: <span class="string">&quot;REPO&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;codeGenOperation&quot;</span>: <span class="string">&quot;OVERRIDE&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;codeGenType&quot;</span>: <span class="string">&quot;API&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;ignoreJavaFileNames&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;User&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;dgraphPath&quot;</span>: <span class="string">&quot;dgraph/schema.dgraph&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-执行命令行"><a href="#4-3-执行命令行" class="headerlink" title="4.3 执行命令行"></a>4.3 执行命令行</h3><p><img src="media/15988734258249/16084659052797.jpg" alt="-w688"></p>
<h3 id="4-4-代码生成"><a href="#4-4-代码生成" class="headerlink" title="4.4 代码生成"></a>4.4 代码生成</h3><p><img src="media/15988734258249/16084660229221.jpg" alt="-w942"></p>
<p>在聊清楚schema后，只需要执行一行命令，然后编写一个实现类即可完成接口服务的开发。在schema修改后，重复执行这个过程。</p>
<h2 id="5-缺陷"><a href="#5-缺陷" class="headerlink" title="5. 缺陷"></a>5. 缺陷</h2><h3 id="5-1-GraphQL描述力不够。只描述来数据结构与类型，没有描述数据存储可能会用到的主键、索引、缓存等信息，以及DDD中的限界上下文-BoundedContext-、聚合根-AggregateRoot-等概念"><a href="#5-1-GraphQL描述力不够。只描述来数据结构与类型，没有描述数据存储可能会用到的主键、索引、缓存等信息，以及DDD中的限界上下文-BoundedContext-、聚合根-AggregateRoot-等概念" class="headerlink" title="5.1 GraphQL描述力不够。只描述来数据结构与类型，没有描述数据存储可能会用到的主键、索引、缓存等信息，以及DDD中的限界上下文(BoundedContext)、聚合根(AggregateRoot)等概念"></a>5.1 GraphQL描述力不够。只描述来数据结构与类型，没有描述数据存储可能会用到的主键、索引、缓存等信息，以及DDD中的限界上下文(BoundedContext)、聚合根(AggregateRoot)等概念</h3><p>可以通过自定义directive实现相关扩展定义，比如: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scalar DateTime</span><br><span class="line">directive @Cache on FIELD_DEFINITION</span><br><span class="line">directive @Alloftext on FIELD_DEFINITION</span><br><span class="line">directive @AggregateRoot on OBJECT</span><br><span class="line"></span><br><span class="line">type Project @AggregateRoot &#123;</span><br><span class="line">    id: String!</span><br><span class="line">    name: String! @Cache @Alloftext</span><br><span class="line">    description: String!</span><br><span class="line">    createTime: DateTime!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这个时候<code>QL</code>已经变成了<code>DSL</code>，需要考虑额外的学习、推广成本</p>
<h3 id="5-2-生成的代码和实现代码混合，如何进行code-review？"><a href="#5-2-生成的代码和实现代码混合，如何进行code-review？" class="headerlink" title="5.2 生成的代码和实现代码混合，如何进行code review？"></a>5.2 生成的代码和实现代码混合，如何进行code review？</h3><p>schema和生成的代码先提交一次PR，对schema进行review。之后的实现代码再单独提交PR</p>
<h3 id="5-3-Dgraph更新时数据如何处理？"><a href="#5-3-Dgraph更新时数据如何处理？" class="headerlink" title="5.3 Dgraph更新时数据如何处理？"></a>5.3 Dgraph更新时数据如何处理？</h3><p>已经上线后无法自动迭代。数据版本迁移不应属于开发过程</p>
<h3 id="5-4-仍需编写实现类-生成的代码是否允许编辑？"><a href="#5-4-仍需编写实现类-生成的代码是否允许编辑？" class="headerlink" title="5.4 仍需编写实现类(生成的代码是否允许编辑？)"></a>5.4 仍需编写实现类(生成的代码是否允许编辑？)</h3><p>理想情况是完全通过代码生成完成相关实现。但是实际业务并不是简单的crud，如果通过schema描述复杂业务，就会发现本质上是通过schema来编写另一种java代码。所以只生成interface，需要开发者补全相关实现。让schema专注于描述DDD。不排除提供生成简单crud实现的功能，在修改了相关实现类后，再通过配置<code>SKIP_IF_EXISTED</code>跳过相关实现</p>
<h3 id="5-5-自动化生成后发现无事可做，不可替代性如何保障？"><a href="#5-5-自动化生成后发现无事可做，不可替代性如何保障？" class="headerlink" title="5.5 自动化生成后发现无事可做，不可替代性如何保障？"></a>5.5 自动化生成后发现无事可做，不可替代性如何保障？</h3><p>-_-#</p>
]]></content>
      <categories>
        <category>ddd</category>
      </categories>
      <tags>
        <tag>ddd</tag>
        <tag>GraphQL</tag>
        <tag>Arc</tag>
      </tags>
  </entry>
  <entry>
    <title>DDD探险——基于GraphQL+Dgraph实践</title>
    <url>/2020/08/09/ddd-graphql-dgraph/</url>
    <content><![CDATA[<p>DDD还可以这么搞？！！</p>
<p>代码已开源： <a href="https://github.com/YituHealthcare/Arc">https://github.com/YituHealthcare/Arc</a></p>
<span id="more"></span>

<h2 id="1-DDD"><a href="#1-DDD" class="headerlink" title="1. DDD"></a>1. DDD</h2><p>《DDD从入门到放弃》 只需要一张脑图</p>
<p><img src="https://img.yuheng.wang/mweb/15966371401996.jpg" alt="00"></p>
<p>一个很奇怪的现象，介绍DDD的文章基本往往只聊思想和概念，不聊落地和代码。<br>“思想，意会就好”，或者说是不是DDD只负责前期的设计。</p>
<p>因为不像设计模式一样有直观的代码用例，又拥有大量生涩难懂的概念，往往在落地时遇到了困境。本文基于笔者对DDD的理解、记录技术选型过程及激进的代码讲解，槽点过多，欢迎沟通。</p>
<h3 id="1-1-DDD-是什么"><a href="#1-1-DDD-是什么" class="headerlink" title="1.1 DDD 是什么"></a>1.1 DDD 是什么</h3><p>DDD (Domain-Driven Design) 领域驱动设计。指对软件所涉及到的领域进行建模，以应对系统规模过大时引起的软件复杂性的问题。</p>
<p><img src="https://img.yuheng.wang/mweb/15965531978029.jpg" alt="01"></p>
<h3 id="1-1-1-DDD-简单示例"><a href="#1-1-1-DDD-简单示例" class="headerlink" title="1.1.1 DDD 简单示例"></a>1.1.1 DDD 简单示例</h3><p>尝试通过一个简单的示例来说明</p>
<p>如果我希望提供 <strong>更新用户密码or用户姓名or年龄</strong> 的功能，基于面向数据的角度，我会有一张user的表，上述操作都是对user表的更新，我可以设计为 <code>UserService.save(user)</code> 来实现，并通过键值约束实现一些重复限制。但是后续迭代时只看到这个方法，不了解被外部如何使用，这个方法很快就无法继续迭代。</p>
<p>我们尝试<strong>不要专注在实体和值对象</strong>，通过语义明确的API来实现。所以我可以提供N个方法</p>
<ul>
<li><code>UserService.updatePassword(password, userId);</code></li>
<li><code>UserService.updateName(name, userId);</code></li>
<li><code>UserService.updateAge(age, userId);</code></li>
</ul>
<p>这种代码已经很符合基于Spring+贫血模型的风格</p>
<p>我们再重新审视一下最原始的需求，<strong>更新用户密码or用户姓名or年龄</strong>，这个操作是否应该由User来完成？ 比如</p>
<ul>
<li><code>User.updatePassword(password);</code></li>
<li><code>User.updateName(name);</code></li>
<li><code>User.updateAge(age);</code></li>
</ul>
<p>这就是DDD风格的代码，按照最贴合业务及正向思维的逻辑来编写。如果我们不考虑数据持久化、如何配合Spring使用这些必须解决的问题的话，会更完美一些。当然，如果我们拥有一台内存无限、永不宕机的服务器，也可以实现。</p>
<h3 id="1-1-2-DDD-不是什么"><a href="#1-1-2-DDD-不是什么" class="headerlink" title="1.1.2 DDD 不是什么"></a>1.1.2 DDD 不是什么</h3><p><strong>DDD不是银弹</strong>。</p>
<p>如果是银弹，或者说适用于大部分场景，那么DDD应该早就变成主流了(另一方面的原因是对工程人员的要求较高)。<br>但是在某些特定场景下，DDD是很合适的一套方案。 </p>
<h3 id="1-2-为什么要用DDD"><a href="#1-2-为什么要用DDD" class="headerlink" title="1.2 为什么要用DDD"></a>1.2 为什么要用DDD</h3><p>在一个创新探索领域、或者行业门槛较高的领域，只从工程角度太片面，需要引入领域专家一同工作。</p>
<p>这时有几个问题</p>
<ol>
<li>不同职业，使用不同工具，说着不同术语的人如何协同工作？如何确认彼此的想法已对齐？</li>
<li>如何加深业务理解和更准确的定义，以便实现业务深耕和探索？</li>
<li>建模知识如何沉淀？除了业务专家口口相传这种10bit/s的数据量传播方式外，是否有更通用高效的方法？</li>
<li>在业务探索期，如何降低频繁变更的成本？不需要在业务建模、架构设计与编码之间相互翻译？</li>
</ol>
<p>也许通过DDD可以解决上述问题。</p>
<p>​思考：如果一个行业相对成熟稳定，已经有知名的产品，是不是直接把对方的解决方案“借鉴”过来更好一些？</p>
<h3 id="1-3-怎么用DDD"><a href="#1-3-怎么用DDD" class="headerlink" title="1.3 怎么用DDD"></a>1.3 怎么用DDD</h3><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxMzBweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjE3MnB4O2hlaWdodDoxMzBweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNzIgMTMwIiB3aWR0aD0iMTcycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZyBpZD0iZWxlbV9BIj48ZWxsaXBzZSBjeD0iMzcuMjg0MyIgY3k9IjIwLjUyMzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSIzMS4yODQzIiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjIzLjI4NDMiIHk9IjIzLjM3MDMiPiYjMzU3NTI7JiMzNTc3MDs8L3RleHQ+PC9nPjxnIGlkPSJlbGVtX0IiPjxlbGxpcHNlIGN4PSIxMzUuMjg0MyIgY3k9IjIwLjUyMzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSIzMS4yODQzIiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjEyMS4yODQzIiB5PSIyMy4zNzAzIj4mIzM1Nzc0OyYjMzU3NDU7PC90ZXh0PjwvZz48ZyBpZD0iZWxlbV9DIj48ZWxsaXBzZSBjeD0iMTM1LjI4NDMiIGN5PSIxMDkuNTIzNiIgZmlsbD0iI0YxRjFGMSIgcng9IjMxLjI4NDMiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iMTIxLjI4NDMiIHk9IjExMi4zNzAzIj4mIzIzNDU0OyYjMzYzNDE7PC90ZXh0PjwvZz48ZyBpZD0iZWxlbV9EIj48ZWxsaXBzZSBjeD0iMzcuMjg0MyIgY3k9IjEwOS41MjM2IiBmaWxsPSIjRjFGMUYxIiByeD0iMzEuMjg0MyIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSIyMy4yODQzIiB5PSIxMTIuMzcwMyI+JiMyNTUxMjsmIzMyNzYzOzwvdGV4dD48L2c+PCEtLWxpbmsgQSB0byBCLS0+PGcgaWQ9ImxpbmtfQV9CIj48cGF0aCBkPSJNNjkuMjczNCwyMC41IEM4MC44Mjg2LDIwLjUgODYuMzgzNywyMC41IDk3LjkzODksMjAuNSAiIGZpbGw9Im5vbmUiIGlkPSJBLXRvLUIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTAzLjkzODksMjAuNSw5NC45Mzg5LDE2LjUsOTguOTM4OSwyMC41LDk0LjkzODksMjQuNSwxMDMuOTM4OSwyMC41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgQiB0byBDLS0+PGcgaWQ9ImxpbmtfQl9DIj48cGF0aCBkPSJNMTM1LjUsMzUuMDkzOCBDMTM1LjUsNTEuMzQyNSAxMzUuNSw3Mi4zODE1IDEzNS41LDg4LjcxNDYgIiBmaWxsPSJub25lIiBpZD0iQi10by1DIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNS41LDk0LjcxNDYsMTM5LjUsODUuNzE0NiwxMzUuNSw4OS43MTQ2LDEzMS41LDg1LjcxNDYsMTM1LjUsOTQuNzE0NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgRCB0byBDLS0+PGcgaWQ9ImxpbmtfRF9DIj48cGF0aCBkPSJNNzUuMjczNCwxMDkuNSBDODYuODI4NiwxMDkuNSA5Mi4zODM3LDEwOS41IDEwMy45Mzg5LDEwOS41ICIgZmlsbD0ibm9uZSIgaWQ9IkQtYmFja3RvLUMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjkuMjczNCwxMDkuNSw3OC4yNzM0LDExMy41LDc0LjI3MzQsMTA5LjUsNzguMjczNCwxMDUuNSw2OS4yNzM0LDEwOS41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBBIHRvIEQtLT48ZyBpZD0ibGlua19BX0QiPjxwYXRoIGQ9Ik0zNy41LDQxLjA5MzggQzM3LjUsNTcuMzQyNSAzNy41LDc4LjM4MTUgMzcuNSw5NC43MTQ2ICIgZmlsbD0ibm9uZSIgaWQ9IkEtYmFja3RvLUQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzcuNSwzNS4wOTM4LDMzLjUsNDQuMDkzOCwzNy41LDQwLjA5MzgsNDEuNSw0NC4wOTM4LDM3LjUsMzUuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1TUkM9W0FvckVKS3VpSmJMR1VoNWtuT2pya3ZHSzRlaUw3QmJBNFFCeE5nblIyMVByR2VXLU5KVmxuVlFqTzU1ZFhFWXBsWE5Gei15Nll4Zm1TSmFndzFQYmZjVUt3RGUxVEplZndBUmFiLVMxc1N2U3BXZ3dFUWJmODc0TkJYUzV0VDgyOENpSDAwMDBdLS0+PC9nPjwvc3ZnPg=='>

<ol>
<li>通过用户故事，每个人按照自己的理解定义相关”领域实践”、”行为操作”及”用户角色”，结构格式为<ol>
<li><code>actor-&gt;command-&gt;event</code>，即:某人做了某个操作，产生了某个事件</li>
</ol>
</li>
<li>定义通用语言(团队自己创建的公用语言)，基于上述定义，通过归纳总结，明确常识及概念，并给出定义，最终输出业务词典表。后续通过常识名沟通讨论<ol>
<li>通用语言需要明确限界上下文(Bounded Context)，这个常识名只在对应的上下文内代表相应的含义。同一个概念在不同上下文内，代表着不同的含义，拥有不同的属性及行为</li>
<li>对齐过程中包括但不限于<ul>
<li>讨论</li>
<li>参考资料</li>
<li>引用标准</li>
<li>查阅词典</li>
</ul>
</li>
<li>示例<ol>
<li>Project: 为了达到某个产品迭代、产品模块开发等目的所做的工作. </li>
<li>Milestone: 表述一个Project的某个时间阶段及阶段性目标. 一个Project可以同时拥有多个处于相同或者不同阶段的Milestone.</li>
</ol>
</li>
</ol>
</li>
<li>通过<strong>EventStorming</strong>将用户故事抽象为”贴纸领域图”，并按照聚合根进行聚合<ol>
<li>此过程和通用语言定义可同时进行，在讨论时明确定义</li>
<li><strong>EventStorming</strong>详情可以通过 <a href="https://www.eventstorming.com/">https://www.eventstorming.com</a> 了解，不再详细展开</li>
</ol>
</li>
</ol>
<p><img src="https://img.yuheng.wang/mweb/15965553653110.jpg" alt="02"></p>
<p>上述过程相对通用，在我的实践过程中，又增加了一步</p>
<ol>
<li>按照聚合后的”贴纸领域图”编写<code>GraphQL Schema</code></li>
</ol>
<h2 id="2-GraphQL"><a href="#2-GraphQL" class="headerlink" title="2. GraphQL"></a>2. GraphQL</h2><h3 id="2-1-GraphQL-是什么"><a href="#2-1-GraphQL-是什么" class="headerlink" title="2.1 GraphQL 是什么"></a>2.1 GraphQL 是什么</h3><p><a href="https://graphql.org/">https://graphql.org/</a></p>
<blockquote>
<p>一种用于 API 的查询语言<br>GraphQL 既是一种用于 API 的查询语言也是一个满足你数据查询的运行时。 GraphQL 对你的 API 中的数据提供了一套易于理解的完整描述，使得客户端能够准确地获得它需要的数据，而且没有任何冗余，也让 API 更容易地随着时间推移而演进，还能用于构建强大的开发者工具</p>
</blockquote>
<h3 id="2-2-为什么要用GraphQL"><a href="#2-2-为什么要用GraphQL" class="headerlink" title="2.2 为什么要用GraphQL"></a>2.2 为什么要用GraphQL</h3><p>如何保障领域模型和实践之间同时变动？</p>
<p>​前文调侃说”如果我们拥有一台内存无限、永不宕机的机器”，我们可以很方便的开发出符合DDD的代码，而这就是我们代码的领域层。但是实际工作中，我们不仅没有这台机器，而且不得不和各方进行交互，比如说我们要和UI交互，提供相关数据。这时根据六边形orCA架构，我们拓展其中的一条边。</p>
<p><img src="https://img.yuheng.wang/mweb/15965561430703.jpg" alt="03"></p>
<p><img src="https://img.yuheng.wang/mweb/15965558298434.jpg" alt="04"></p>
<p>此时问题出现了。当我们画了实体、连了各种关系线之后，还要再去拉平，做各种转换(从领域层到API交互层，前端也会做同样的各种<code>xxObject</code>的转换，但我们明明是在同一套共同创建的领域模型下进行开发)。这个过程叫做api定义。</p>
<p>如果前端能通过领域模型进行数据操作，是不是可以省略这一过程？那么在2者之间找到一个平衡点，就是通过<code>GraphQL Schema</code>描述领域模型，同时也描述了接口。</p>
<h3 id="2-3-怎么用GraphQL"><a href="#2-3-怎么用GraphQL" class="headerlink" title="2.3 怎么用GraphQL"></a>2.3 怎么用GraphQL</h3><p>网上的例子大多是内存中的数据，而没有使用数据库的demo，无论是关系型数据库还是nosql。因为实现起来不优雅，拉低了GraphQL的使用体验</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphQLDataFetchers</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Map&lt;String, String&gt;&gt; authors = Arrays.asList(</span><br><span class="line">            ImmutableMap.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;author-1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;Joanne&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;Rowling&quot;</span>),</span><br><span class="line">            ImmutableMap.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;author-2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;Herman&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;Melville&quot;</span>),</span><br><span class="line">            ImmutableMap.of(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;author-3&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;Anne&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;Rice&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataFetcher <span class="title">getAuthorDataFetcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataFetchingEnvironment -&gt; &#123;</span><br><span class="line">            Map&lt;String,String&gt; book = dataFetchingEnvironment.getSource();</span><br><span class="line">            String authorId = book.get(<span class="string">&quot;authorId&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> authors</span><br><span class="line">                    .stream()</span><br><span class="line">                    .filter(author -&gt; author.get(<span class="string">&quot;id&quot;</span>).equals(authorId))</span><br><span class="line">                    .findFirst()</span><br><span class="line">                    .orElse(<span class="keyword">null</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于前面的推理，我们已经用schema描述了领域模型和api，那么能否再向下拓展一层，用来描述持久化信息呢？</p>
<h2 id="3-Dgraph"><a href="#3-Dgraph" class="headerlink" title="3. Dgraph"></a>3. Dgraph</h2><h3 id="3-1-GraphQL-是什么"><a href="#3-1-GraphQL-是什么" class="headerlink" title="3.1 GraphQL 是什么"></a>3.1 GraphQL 是什么</h3><blockquote>
<p>Dgraph is an open-source, scalable, distributed, highly available and fast graph database, designed from the ground up to be run in production.</p>
</blockquote>
<h3 id="3-2-为什么要用Dgraph"><a href="#3-2-为什么要用Dgraph" class="headerlink" title="3.2 为什么要用Dgraph"></a>3.2 为什么要用Dgraph</h3><ol>
<li>图数据库更直观，符合领域设计的过程，比如项目中添加用户，其实只是在项目和用户之间连接一条<code>belong</code>的线</li>
<li>支持GraphQL</li>
</ol>
<h3 id="3-3-怎么用Dgraph"><a href="#3-3-怎么用Dgraph" class="headerlink" title="3.3 怎么用Dgraph"></a>3.3 怎么用Dgraph</h3><ul>
<li><a href="https://github.com/dgraph-io/dgraph4j">https://github.com/dgraph-io/dgraph4j</a></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Query</span></span><br><span class="line">String query = </span><br><span class="line"><span class="string">&quot;query all($a: string)&#123;\n&quot;</span> +</span><br><span class="line"><span class="string">&quot;  all(func: eq(name, $a)) &#123;\n&quot;</span> +</span><br><span class="line"><span class="string">&quot;    name\n&quot;</span> +</span><br><span class="line"> <span class="string">&quot;&#125;\n&quot;</span> +</span><br><span class="line"><span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">Map&lt;String, String&gt; vars = Collections.singletonMap(<span class="string">&quot;$a&quot;</span>, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line"></span><br><span class="line">AsyncTransaction txn = dgraphAsyncClient.newTransaction();</span><br><span class="line">txn.query(query).thenAccept(response -&gt; &#123;</span><br><span class="line">    <span class="comment">// Deserialize</span></span><br><span class="line">    People ppl = gson.fromJson(res.getJson().toStringUtf8(), People.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Print results</span></span><br><span class="line">    System.out.printf(<span class="string">&quot;people found: %d\n&quot;</span>, ppl.all.size());</span><br><span class="line">    ppl.all.forEach(person -&gt; System.out.println(person.name));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>我觉得官方示例唯一的作用是说明java不适合，快来学Go吧。。</p>
<h2 id="4-领域事件"><a href="#4-领域事件" class="headerlink" title="4. 领域事件"></a>4. 领域事件</h2><p>通过消息队列订阅领域事件，进行异步交互即可。</p>
<h2 id="5-Arc"><a href="#5-Arc" class="headerlink" title="5. Arc"></a>5. Arc</h2><p>上面吐槽和挖坑了这么多，是因为希望用一套框架解决问题，让DDD的落地实操更顺滑。</p>
<p>Arc集成&amp;实现了很多功能</p>
<p>整体</p>
<ul>
<li>集成zipkin链路追踪</li>
<li>接入Spring，通过配置+Annotation的方式简化操作</li>
</ul>
<p>GraphQL 层面</p>
<ul>
<li>内嵌了playground &amp; voyager 方便调试及梳理领域关系</li>
<li>自定义异常处理</li>
<li>intercept自定义拦截器</li>
<li>提供graphqlClient用于服务端之间GraphQL调用</li>
<li>自动解析schema定义的type、union type 及interface类型</li>
<li>封装controller层，扫描并解析@DataFetcherService及@GraphqlMutation、@GraphqlQuery方法</li>
</ul>
<p>Dgraph 层面</p>
<ul>
<li>intercept自定义拦截器</li>
<li>通过 properties 配置数据库信息</li>
<li>自动扫描xxxDgraph.xml， 支持编写复杂语句，并提供静态、动态变量处理</li>
<li>提供RDF处理工具</li>
<li>SimpleRepository提供save、getOne、getAll、relationship、upsert等基本操作</li>
</ul>
<p>mq </p>
<ul>
<li>基于VM轻量级消息队列</li>
<li>拦截并基于订阅发送领域消息</li>
</ul>
<h3 id="5-1-开发流程"><a href="#5-1-开发流程" class="headerlink" title="5.1 开发流程"></a>5.1 开发流程</h3><p>通过maven添加Arc框架后的整体开发流程:</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0NzRweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQwOHB4O2hlaWdodDo0NzRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0MDggNDc0IiB3aWR0aD0iNDA4cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZWxsaXBzZSBjeD0iMjA0IiBjeT0iMjAiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjczIiB4PSI2Ny41IiB5PSI1MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0OSIgeD0iODEuNSIgeT0iNzEuMTM4NyI+Y3JlYXRlIGdyYXBocWwuc2NoZW1hICZhbXA7IGRncmFwaC5zY2hlbWE8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI3NS44NzUiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUzIiB4PSIxMjcuNSIgeT0iMTAzLjk2ODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUiIHg9IjE0MS41IiB5PSIxMjUuMTA3NCI+Y3JlYXRlIGphdmFCZWFuIHdpdGg8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYiIHg9IjE0MS41IiB5PSIxMzkuMDc2MiI+QERncmFwaFR5cGU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjEiIHg9IjE0MS41IiB5PSIxNTMuMDQ0OSI+QFVpZEZpZWxkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMyIgeD0iMTQxLjUiIHk9IjE2Ny4wMTM3Ij5AUmVsYXRpb25zaGlwRmllbGQ8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjM4NiIgeD0iMTEiIHk9IjE5OS44NDM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzYyIiB4PSIyNSIgeT0iMjIwLjk4MjQiPmNyZWF0ZSBAUmVwb3NpdG9yeSBjbGFzcyBleHRlbmRzIFNpbXBsZURncmFwaFJlcG9zaXRvcnk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjMzMCIgeD0iMzkiIHk9IjI1My44MTI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzA2IiB4PSI1MyIgeT0iMjc0Ljk1MTIiPmFkZCB4eERncmFwaC54bWwgZm9yIGNvbXBsZXggcGVyc2lzdGVuY2UgaGFuZGxlPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNjEuOTA2MyIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyODQiIHg9IjYyIiB5PSIzMDcuNzgxMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1NiIgeD0iNzYiIHk9IjMyOC45MTk5Ij5jcmVhdGUgQERhdGFGZXRjaGVyU2VydmljZSBjbGFzcyBpbmNsdWRlPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2IiB4PSI3NiIgeT0iMzQyLjg4ODciPkBHcmFwaHFsUXVlcnk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5IiB4PSI3NiIgeT0iMzU2Ljg1NzQiPkBHcmFwaHFsTXV0YXRpb248L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjM1NSIgeD0iMjYuNSIgeT0iMzg5LjY4NzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMzEiIHg9IjQwLjUiIHk9IjQxMC44MjYyIj5icm93c2VyIGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9wbGF5Z3JvdW5kIGZvciBkZWJ1ZzwvdGV4dD48ZWxsaXBzZSBjeD0iMjA0IiBjeT0iNDUzLjY1NjMiIGZpbGw9Im5vbmUiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjIuNTsiIHgxPSIxOTcuODEyOCIgeDI9IjIxMC4xODcyIiB5MT0iNDQ3LjQ2OTEiIHkyPSI0NTkuODQzNCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6Mi41OyIgeDE9IjIxMC4xODcyIiB4Mj0iMTk3LjgxMjgiIHkxPSI0NDcuNDY5MSIgeTI9IjQ1OS44NDM0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjA0IiB4Mj0iMjA0IiB5MT0iMzAiIHkyPSI1MCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjAwLDQwLDIwNCw1MCwyMDgsNDAsMjA0LDQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMDQiIHgyPSIyMDQiIHkxPSI4My45Njg4IiB5Mj0iMTAzLjk2ODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwMCw5My45Njg4LDIwNCwxMDMuOTY4OCwyMDgsOTMuOTY4OCwyMDQsOTcuOTY4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjA0IiB4Mj0iMjA0IiB5MT0iMTc5Ljg0MzgiIHkyPSIxOTkuODQzOCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjAwLDE4OS44NDM4LDIwNCwxOTkuODQzOCwyMDgsMTg5Ljg0MzgsMjA0LDE5My44NDM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMDQiIHgyPSIyMDQiIHkxPSIyMzMuODEyNSIgeTI9IjI1My44MTI1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDAsMjQzLjgxMjUsMjA0LDI1My44MTI1LDIwOCwyNDMuODEyNSwyMDQsMjQ3LjgxMjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIwNCIgeDI9IjIwNCIgeTE9IjI4Ny43ODEzIiB5Mj0iMzA3Ljc4MTMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwMCwyOTcuNzgxMywyMDQsMzA3Ljc4MTMsMjA4LDI5Ny43ODEzLDIwNCwzMDEuNzgxMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjA0IiB4Mj0iMjA0IiB5MT0iMzY5LjY4NzUiIHkyPSIzODkuNjg3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjAwLDM3OS42ODc1LDIwNCwzODkuNjg3NSwyMDgsMzc5LjY4NzUsMjA0LDM4My42ODc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMDQiIHgyPSIyMDQiIHkxPSI0MjMuNjU2MyIgeTI9IjQ0My42NTYzIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDAsNDMzLjY1NjMsMjA0LDQ0My42NTYzLDIwOCw0MzMuNjU2MywyMDQsNDM3LjY1NjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1TUkM9W0pMMm5KaUdtM0R0eDVIdUd1dE5sQkdZVFplYTEzWk9NTnNBUTgzUzlaZGxOMmw3bGYyZElUTnBGcHlfbEVJa0FEYXE3SFdZTGUxVEN4Zmp0c0pXUTRFeDFMa09WeHNfMkJ4cFc4czYwZ3JTNzdtNFUzYk52RFlVZ3lEdFJlb1VzNVJtSWVfZU9pbEVmaVhrZENhbW5VdXFvV3M3QzZNWEkyWlIzb0ctOVFWTXpZUFBMajFRY1FQdGlmZTdYQ21nT2tDV2RJMkpQdnM5WDIxbTZveEl6VGEzNThzZGY4b1VJWW8tWXpRZUZYYVV4WGR6UXRfMG9LV2NyOFB2N2hKcU1teEY0UW9PMWZ2Z3dqa0xlYTV0Q3NqdHpmMlp3c29SNmtQU3UxYmxaTUpnRl9SdmZJaEtfXS0tPjwvZz48L3N2Zz4='>

<ol>
<li>定义领域模型，产生graphql.schema及dgraph.schema文件。</li>
<li>创建javaBean并指定@DgraphType、@UidField、@RelationshipField</li>
<li>创建 SimpleDgraphRepository 的子类声明为@Repository</li>
<li>编写xxDgraph.xml实现query方法实现复杂DB操作</li>
<li>创建 @DataFetcherService类及@GraphqlQuery、@GraphqlMutation 方法</li>
<li>通过 <a href="http://localhost:${port}/playground">http://localhost:${port}/playground</a> 进行调试</li>
</ol>
<h3 id="5-2-Sample"><a href="#5-2-Sample" class="headerlink" title="5.2 Sample"></a>5.2 Sample</h3><p>graphql schema</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scalar DateTime</span><br><span class="line"></span><br><span class="line">schema&#123;</span><br><span class="line">    query: Query,</span><br><span class="line">    mutation: Mutation</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Query&#123;</span><br><span class="line">    project(</span><br><span class="line">        id: String</span><br><span class="line">    ): Project</span><br><span class="line">    users: [User]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Mutation&#123;</span><br><span class="line">    createProject(</span><br><span class="line">        payload: ProjectInput</span><br><span class="line">    ): Project</span><br><span class="line">    createMilestone(</span><br><span class="line">        payload: MilestoneInput</span><br><span class="line">    ): Milestone</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">项目分类</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">enum ProjectCategory &#123;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    示例项目</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    DEMO</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    生产项目</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    PRODUCTION</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">名称</span><br><span class="line">为了达到某个产品迭代、产品模块开发、或者科研调研等目的所做的工作.</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">type Project&#123;</span><br><span class="line">    id: String!</span><br><span class="line">    name: String!</span><br><span class="line">    description: String!</span><br><span class="line">    category: ProjectCategory</span><br><span class="line">    createTime: DateTime!</span><br><span class="line">    milestones(</span><br><span class="line">        status: MilestoneStatus</span><br><span class="line">    ): [Milestone]</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">里程碑</span><br><span class="line">表述一个Project的某个时间阶段及阶段性目标. 一个Project可以同时拥有多个处于相同或者不同阶段的Milestone.</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">type Milestone&#123;</span><br><span class="line">    id: String!</span><br><span class="line">    name: String!</span><br><span class="line">    status: MilestoneStatus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type User &#123;</span><br><span class="line">    name: String!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">里程碑状态</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">enum MilestoneStatus&#123;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    未开始</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    NOT_STARTED,</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    进行中</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    DOING,</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    发布</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    RELEASE,</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    关闭</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    CLOSE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">input ProjectInput&#123;</span><br><span class="line">    name: String!</span><br><span class="line">    description: String!</span><br><span class="line">    vendorBranches: [String!]!</span><br><span class="line">    category: ProjectCategory!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input MilestoneInput&#123;</span><br><span class="line">    projectId: String!</span><br><span class="line">    name: String!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>java 领域</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@DataFetcherService</span></span><br><span class="line"><span class="meta">@DgraphType(&quot;PROJECT&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Project</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String RELATIONSHIP_HAS = <span class="string">&quot;has&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter(AccessLevel.NONE)</span></span><br><span class="line">    <span class="meta">@Setter(AccessLevel.NONE)</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectRepository projectRepository;</span><br><span class="line">    <span class="meta">@Getter(AccessLevel.NONE)</span></span><br><span class="line">    <span class="meta">@Setter(AccessLevel.NONE)</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MilestoneRepository milestoneRepository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@UidField</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> ProjectCategory category;</span><br><span class="line">    <span class="keyword">private</span> OffsetDateTime createTime;</span><br><span class="line">    <span class="meta">@RelationshipField(RELATIONSHIP_HAS)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Milestone&gt; milestoneList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GraphqlMutation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataFetcher&lt;Project&gt; <span class="title">createProject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataFetchingEnvironment -&gt; &#123;</span><br><span class="line">            ProjectInput input = GraphqlPayloadUtil.resolveArguments(dataFetchingEnvironment.getArguments(), ProjectInput.class);</span><br><span class="line">            OffsetDateTime now = OffsetDateTime.now();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.name = input.getName();</span><br><span class="line">            <span class="keyword">this</span>.description = input.getDescription();</span><br><span class="line">            <span class="keyword">this</span>.category = input.getCategory();</span><br><span class="line">            <span class="keyword">this</span>.createTime = now;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.id = projectRepository.save(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GraphqlMutation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataFetcher&lt;Milestone&gt; <span class="title">createMilestone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataFetchingEnvironment -&gt; &#123;</span><br><span class="line">            MilestoneInput input = GraphqlPayloadUtil.resolveArguments(dataFetchingEnvironment.getArguments(), MilestoneInput.class);</span><br><span class="line"><span class="comment">//可以正向通过project创建milestone，也可以先创建milestone，再关联project</span></span><br><span class="line"><span class="comment">//            this.id = input.getProjectId();</span></span><br><span class="line"><span class="comment">//            this.milestoneList = Collections.singletonList(new Milestone(input.getName()));</span></span><br><span class="line"><span class="comment">//            this.id = projectRepository.save(this);</span></span><br><span class="line"></span><br><span class="line">            Milestone milestone = <span class="keyword">new</span> Milestone(input.getName());</span><br><span class="line">            milestone.setStatus(MilestoneStatus.NOT_STARTED);</span><br><span class="line">            String milestoneId = milestoneRepository.save(milestone);</span><br><span class="line">            milestone.setId(milestoneId);</span><br><span class="line"></span><br><span class="line">            milestoneRepository.createRelationship(RelationshipInformation.builder()</span><br><span class="line">                    .sourceList(Collections.singletonList(input.getProjectId()))</span><br><span class="line">                    .relationship(RELATIONSHIP_HAS)</span><br><span class="line">                    .targetList(Collections.singletonList(milestoneId))</span><br><span class="line">                    .build());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> milestone;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GraphqlQuery</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataFetcher&lt;Project&gt; <span class="title">project</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataFetchingEnvironment -&gt; &#123;</span><br><span class="line">            String id = dataFetchingEnvironment.getArgument(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> projectRepository.getOne(id)</span><br><span class="line">                    .orElse(<span class="keyword">null</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GraphqlQuery(type = &quot;Project&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataFetcher&lt;List&lt;Milestone&gt;&gt; milestones() &#123;</span><br><span class="line">        <span class="keyword">return</span> dataFetchingEnvironment -&gt; &#123;</span><br><span class="line">            Project project = dataFetchingEnvironment.getSource();</span><br><span class="line">            List&lt;Milestone&gt; milestones = milestoneRepository.listByProjectId(project.id);</span><br><span class="line">            String status = dataFetchingEnvironment.getArgument(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(status)) &#123;</span><br><span class="line">                <span class="keyword">return</span> milestones;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                MilestoneStatus milestoneStatus = MilestoneStatus.valueOf(status);</span><br><span class="line">                <span class="keyword">return</span> milestones.stream()</span><br><span class="line">                        .filter(m -&gt; m.getStatus().equals(milestoneStatus))</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只是为了展示合并请求</span></span><br><span class="line">    <span class="meta">@GraphqlQuery</span></span><br><span class="line">    <span class="keyword">public</span> DataFetcher&lt;List&lt;User&gt;&gt; users() &#123;</span><br><span class="line">        <span class="keyword">return</span> dataFetchingEnvironment -&gt; Arrays.asList(</span><br><span class="line">                User.builder().name(<span class="string">&quot;u1&quot;</span>).build(),</span><br><span class="line">                User.builder().name(<span class="string">&quot;u2&quot;</span>).build(),</span><br><span class="line">                User.builder().name(<span class="string">&quot;u3&quot;</span>).build()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Consumer(topic = &quot;users&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">usersListener</span><span class="params">(Message&lt;DomainEvent&gt; record)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;listen users event: &#123;&#125;&quot;</span>, record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>repository </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MilestoneRepository</span> <span class="keyword">extends</span> <span class="title">SimpleDgraphRepository</span>&lt;<span class="title">Milestone</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Milestone&gt; <span class="title">listByProjectId</span><span class="params">(String projectId)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; vars = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        vars.put(<span class="string">&quot;projectId&quot;</span>, projectId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.queryForList(<span class="string">&quot;milestone.listByProjectId&quot;</span>, vars);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MilestoneDgraph.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dgraph</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">var</span> <span class="attr">id</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span><br><span class="line">        MILESTONE</span><br><span class="line">    <span class="tag">&lt;/<span class="name">var</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">var</span> <span class="attr">id</span>=<span class="string">&quot;common&quot;</span>&gt;</span></span><br><span class="line">        uid</span><br><span class="line">        expand(MILESTONE)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">var</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query</span> <span class="attr">id</span>=<span class="string">&quot;listByProjectId&quot;</span>&gt;</span></span><br><span class="line">        query listByProjectId($projectId: string) &#123;</span><br><span class="line">            var(func:uid($projectId)) &#123;</span><br><span class="line">                has &#123;</span><br><span class="line">                    var mids as uid</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            listByProjectId(func:uid(mids)) &#123;</span><br><span class="line">                uid</span><br><span class="line">                expand(_all_)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">query</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mutation</span> <span class="attr">id</span>=<span class="string">&quot;updateStatus&quot;</span>&gt;</span></span><br><span class="line">        &lt;![CDATA[</span><br><span class="line">            &lt;$id&gt; &lt;MILESTONE.status&gt; &quot;$status&quot; .</span><br><span class="line">        ]]&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">mutation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dgraph</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-效果"><a href="#5-3-效果" class="headerlink" title="5.3 效果"></a>5.3 效果</h3><p>localhost:8080/playground</p>
<p><img src="https://img.yuheng.wang/mweb/15966354288629.jpg" alt="05"></p>
<p><img src="https://img.yuheng.wang/mweb/15966354471616.jpg" alt="06"></p>
<p><img src="https://img.yuheng.wang/mweb/15966356171597.jpg" alt="07"></p>
<p><img src="https://img.yuheng.wang/mweb/15966358843813.jpg" alt="08"></p>
<h3 id="5-4-后续计划"><a href="#5-4-后续计划" class="headerlink" title="5.4 后续计划"></a>5.4 后续计划</h3><ol>
<li>通过schema自动生成相关代码</li>
<li>解析GraphQL，动态生成Dgraph查询</li>
</ol>
<h2 id="6-弊端"><a href="#6-弊端" class="headerlink" title="6. 弊端"></a>6. 弊端</h2><ol>
<li>领域间的交互必须通过GraphQL，client封装不够优雅</li>
<li>Dgraph不擅长统计计算，比如统计类通过基于AOP+MQ通过mysql存储相关指标</li>
<li>前后端技术体系同时变更</li>
</ol>
<h2 id="7-相关工具推荐"><a href="#7-相关工具推荐" class="headerlink" title="7. 相关工具推荐"></a>7. 相关工具推荐</h2><h3 id="7-1-工具"><a href="#7-1-工具" class="headerlink" title="7.1 工具"></a>7.1 工具</h3><p>好用的工具已经集成到Arc中，而在schema确定时候的实现成本又很低，导致编写Mock的意义不大。但仍列出部分开源代码，以作参考</p>
<ol>
<li><strong>API Mock</strong> <ol>
<li><a href="https://github.com/APIs-guru/graphql-faker">graphql-faker</a></li>
<li><a href="https://www.graphql-tools.com/">graphql-tools</a></li>
</ol>
</li>
<li><strong>SDL</strong><ol>
<li><a href="https://github.com/graphql-editor/graphql-editor">graphql-editor</a></li>
<li><a href="https://apis.guru/graphql-voyager">voyager</a></li>
</ol>
</li>
<li><strong>IDE</strong><ol>
<li><a href="https://github.com/prisma-labs/graphql-playground/releases">graphql-playground</a></li>
<li><a href="https://graphiql-test.netlify.app/cdn/">graphiql</a></li>
<li><a href="https://github.com/hasura/graphqurl">graphqurl</a></li>
</ol>
</li>
</ol>
<h3 id="7-2-最佳实践"><a href="#7-2-最佳实践" class="headerlink" title="7.2 最佳实践"></a>7.2 最佳实践</h3><ol>
<li>规范 <a href="https://spec.graphql.org/">https://spec.graphql.org/</a></li>
<li>教程 <a href="https://www.howtographql.com/">https://www.howtographql.com/</a></li>
<li>开放api示例 <a href="https://github.com/APIs-guru/graphql-apis">https://github.com/APIs-guru/graphql-apis</a></li>
<li><a href="https://dgraph.io/tour">https://dgraph.io/tour</a></li>
</ol>
]]></content>
      <categories>
        <category>ddd</category>
      </categories>
      <tags>
        <tag>ddd</tag>
        <tag>GraphQL</tag>
        <tag>Arc</tag>
      </tags>
  </entry>
  <entry>
    <title>抽象思维实践——ddl2plantuml开发记录</title>
    <url>/2019/12/09/ddl2plantuml-ddd/</url>
    <content><![CDATA[<p>项目源码地址: <a href="https://github.com/wangyuheng/ddl2plantuml">github</a></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>利用<code>plantuml</code>绘制架构评审图时，发现数据库ER图手写字段信息成本太大，需要一个把DB表结构转换为<code>plantuml</code>格式的工具。<br>搜索了一番，没有发现支持工具，所以准备手撸一个，并记录下设计及编码实现的过程。</p>
<span id="more"></span>

<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p><strong>一句话需求：</strong> 读取数据库表结构，转换为plantuml格式的ER图。</p>
<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>根据需求抽象出下列概念</p>
<h3 id="基础元素-一个输入一个输出"><a href="#基础元素-一个输入一个输出" class="headerlink" title="基础元素(一个输入一个输出)"></a>基础元素(一个输入一个输出)</h3><ol>
<li><code>ER</code> -&gt; <code>plantuml</code>格式<code>er</code>图 </li>
<li><code>db_schema</code> -&gt; 数据库结构，ddl语句是其中一种实现形式</li>
</ol>
<h3 id="扩展概念"><a href="#扩展概念" class="headerlink" title="扩展概念"></a>扩展概念</h3><ol>
<li><code>table</code> -&gt; 表结构信息</li>
<li><code>template</code> -&gt; 模板，定义<code>er</code>图输出格式</li>
</ol>
<h3 id="操作行为"><a href="#操作行为" class="headerlink" title="操作行为"></a>操作行为</h3><ol>
<li><code>reader</code> -&gt; 读取数据库结构，识别 <code>table</code></li>
<li><code>parser</code> -&gt; 根据 <code>table</code> 和 <code>template</code> 转换为<code>ER</code>图</li>
<li><code>writer</code> -&gt; 输出<code>ER</code>图文件</li>
</ol>
<h3 id="整体交互"><a href="#整体交互" class="headerlink" title="整体交互"></a>整体交互</h3><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0MjhweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjM3M3B4O2hlaWdodDo0MjhweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzNzMgNDI4IiB3aWR0aD0iMzczcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciBDb250ZXh0LS0+PGcgaWQ9ImNsdXN0ZXJfQ29udGV4dCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI0MTUiIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIzNjAiIHg9IjciIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjQiIHg9IjE1NSIgeT0iMjYuOTk1MSI+Q29udGV4dDwvdGV4dD48L2c+PCEtLWVudGl0eSBkZGwtLT48ZyBpZD0iZWxlbV9kZGwiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNTMsNTIsNjMsNDIsMTE1LDQyLDExNSw3OC4yOTY5LDEwNSw4OC4yOTY5LDUzLDg4LjI5NjksNTMsNTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEwNSIgeDI9IjExNSIgeTE9IjUyIiB5Mj0iNDIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1MyIgeDI9IjEwNSIgeTE9IjUyIiB5Mj0iNTIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMDUiIHgyPSIxMDUiIHkxPSI1MiIgeTI9Ijg4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMiIgeD0iNjgiIHk9Ijc0Ljk5NTEiPmRkbDwvdGV4dD48L2c+PCEtLWVudGl0eSBkYl9zY2hlbWEtLT48ZyBpZD0iZWxlbV9kYl9zY2hlbWEiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjMuNSwxNTgsMzMuNSwxNDgsMTQ0LjUsMTQ4LDE0NC41LDE4NC4yOTY5LDEzNC41LDE5NC4yOTY5LDIzLjUsMTk0LjI5NjksMjMuNSwxNTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEzNC41IiB4Mj0iMTQ0LjUiIHkxPSIxNTgiIHkyPSIxNDgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMy41IiB4Mj0iMTM0LjUiIHkxPSIxNTgiIHkyPSIxNTgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMzQuNSIgeDI9IjEzNC41IiB5MT0iMTU4IiB5Mj0iMTk0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MSIgeD0iMzguNSIgeT0iMTgwLjk5NTEiPmRiX3NjaGVtYTwvdGV4dD48L2c+PCEtLWVudGl0eSBFUi0tPjxnIGlkPSJlbGVtX0VSIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjI5MS41LDM3MCwzMDEuNSwzNjAsMzUwLjUsMzYwLDM1MC41LDM5Ni4yOTY5LDM0MC41LDQwNi4yOTY5LDI5MS41LDQwNi4yOTY5LDI5MS41LDM3MCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzQwLjUiIHgyPSIzNTAuNSIgeTE9IjM3MCIgeTI9IjM2MCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI5MS41IiB4Mj0iMzQwLjUiIHkxPSIzNzAiIHkyPSIzNzAiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNDAuNSIgeDI9IjM0MC41IiB5MT0iMzcwIiB5Mj0iNDA2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOSIgeD0iMzA2LjUiIHk9IjM5Mi45OTUxIj5FUjwvdGV4dD48L2c+PCEtLWVudGl0eSB0ZW1wbGF0ZS0tPjxnIGlkPSJlbGVtX3RlbXBsYXRlIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjI0MywxNTgsMjUzLDE0OCwzNTEsMTQ4LDM1MSwxODQuMjk2OSwzNDEsMTk0LjI5NjksMjQzLDE5NC4yOTY5LDI0MywxNTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM0MSIgeDI9IjM1MSIgeTE9IjE1OCIgeTI9IjE0OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI0MyIgeDI9IjM0MSIgeTE9IjE1OCIgeTI9IjE1OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM0MSIgeDI9IjM0MSIgeTE9IjE1OCIgeTI9IjE5NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjgiIHg9IjI1OCIgeT0iMTgwLjk5NTEiPnRlbXBsYXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IHRhYmxlLS0+PGcgaWQ9ImVsZW1fdGFibGUiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTQ4LDI2NCwxNTgsMjU0LDIyNiwyNTQsMjI2LDI5MC4yOTY5LDIxNiwzMDAuMjk2OSwxNDgsMzAwLjI5NjksMTQ4LDI2NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjE2IiB4Mj0iMjI2IiB5MT0iMjY0IiB5Mj0iMjU0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTQ4IiB4Mj0iMjE2IiB5MT0iMjY0IiB5Mj0iMjY0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjE2IiB4Mj0iMjE2IiB5MT0iMjY0IiB5Mj0iMzAwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOCIgeD0iMTYzIiB5PSIyODYuOTk1MSI+dGFibGU8L3RleHQ+PC9nPjxnIGlkPSJlbGVtX3BhcnNlciI+PGVsbGlwc2UgY3g9IjMwNS44OTEzIiBjeT0iMjc3LjEzMDIiIGZpbGw9IiNGMUYxRjEiIHJ4PSI0NC4zOTEzIiByeT0iMTQuNjMwMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDYiIHg9IjI3OS44OTEzIiB5PSIyODAuODc3NyI+cGFyc2VyPC90ZXh0PjwvZz48ZyBpZD0iZWxlbV9yZWFkZXIiPjxlbGxpcHNlIGN4PSI2OC4xMzc0IiBjeT0iMjc3LjEzOTEiIGZpbGw9IiNGMUYxRjEiIHJ4PSI0NS4xMzc0IiByeT0iMTQuNjM5MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDciIHg9IjQxLjYzNzQiIHk9IjI4MC44ODY3Ij5yZWFkZXI8L3RleHQ+PC9nPjxnIGlkPSJlbGVtX3dyaXRlciI+PGVsbGlwc2UgY3g9IjIxNC4xNTMxIiBjeT0iMzgzLjEwMTMiIGZpbGw9IiNGMUYxRjEiIHJ4PSI0Mi4xNTMxIiByeT0iMTQuNjAxMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjE4OS42NTMxIiB5PSIzODYuODQ4OSI+d3JpdGVyPC90ZXh0PjwvZz48IS0tbGluayBkZGwgdG8gZGJfc2NoZW1hLS0+PGcgaWQ9ImxpbmtfZGRsX2RiX3NjaGVtYSI+PHBhdGggZD0iTTg0LDg4LjA1NiBDODQsMTA1LjcwNSA4NCwxMTIuMzM1IDg0LDEyOS45NzYgIiBmaWxsPSJub25lIiBpZD0iZGRsLXRvLWRiX3NjaGVtYSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSI4NCwxNDcuOTc2LDkwLDEyOS45NzYsNzgsMTI5Ljk3Niw4NCwxNDcuOTc2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZGJfc2NoZW1hIHRvIHJlYWRlci0tPjxnIGlkPSJsaW5rX2RiX3NjaGVtYV9yZWFkZXIiPjxwYXRoIGQ9Ik04MC42MDY4LDE5NC4wNTYgQzc3LjQzMjksMjE0LjY4NiA3My43MDM3LDIzOC45MjU4IDcxLjAyNzcsMjU2LjMxOTggIiBmaWxsPSJub25lIiBpZD0iZGJfc2NoZW1hLXRvLXJlYWRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3MC4xMTU0LDI2Mi4yNSw3NS40Mzc0LDI1My45NjI5LDcwLjg3NTcsMjU3LjMwODEsNjcuNTMwNCwyNTIuNzQ2NCw3MC4xMTU0LDI2Mi4yNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHJlYWRlciB0byB0YWJsZS0tPjxnIGlkPSJsaW5rX3JlYWRlcl90YWJsZSI+PHBhdGggZD0iTTExMy4wOSwyNzcgQzEyNC42MzgsMjc3IDEzMC4xODcsMjc3IDE0MS43MzUsMjc3ICIgZmlsbD0ibm9uZSIgaWQ9InJlYWRlci10by10YWJsZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDcuNzM1LDI3NywxMzguNzM1LDI3MywxNDIuNzM1LDI3NywxMzguNzM1LDI4MSwxNDcuNzM1LDI3NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHRhYmxlIHRvIHBhcnNlci0tPjxnIGlkPSJsaW5rX3RhYmxlX3BhcnNlciI+PHBhdGggZD0iTTIyNi4wNDcsMjc3IEMyMzcuODExLDI3NyAyNDMuNTc1LDI3NyAyNTUuMzM5LDI3NyAiIGZpbGw9Im5vbmUiIGlkPSJ0YWJsZS10by1wYXJzZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjYxLjMzOSwyNzcsMjUyLjMzOSwyNzMsMjU2LjMzOSwyNzcsMjUyLjMzOSwyODEsMjYxLjMzOSwyNzciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayB0ZW1wbGF0ZSB0byBwYXJzZXItLT48ZyBpZD0ibGlua190ZW1wbGF0ZV9wYXJzZXIiPjxwYXRoIGQ9Ik0yOTguOTA5LDE5NC4wNTYgQzMwMC42OTQsMjE0LjY4NiAzMDIuNzg3OCwyMzguODc4MyAzMDQuMjkyOCwyNTYuMjcyMyAiIGZpbGw9Im5vbmUiIGlkPSJ0ZW1wbGF0ZS10by1wYXJzZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA0LjgxLDI2Mi4yNSwzMDguMDE5MywyNTIuOTM4NywzMDQuMzc5LDI1Ny4yNjg2LDMwMC4wNDkxLDI1My42MjgzLDMwNC44MSwyNjIuMjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBwYXJzZXIgdG8gd3JpdGVyLS0+PGcgaWQ9ImxpbmtfcGFyc2VyX3dyaXRlciI+PHBhdGggZD0iTTI5NC4zNDgsMjkxLjE3MiBDMjc2LjY1MiwzMTEuMTc3IDI0Ny4xNzM1LDM0NC41MDAyIDIyOS41MzI1LDM2NC40NDE0ICIgZmlsbD0ibm9uZSIgaWQ9InBhcnNlci10by13cml0ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjI1LjU1NywzNjguOTM1MywyMzQuNTE2MiwzNjQuODQ0OCwyMjguODY5OSwzNjUuMTkwNCwyMjguNTI0NCwzNTkuNTQ0MSwyMjUuNTU3LDM2OC45MzUzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgd3JpdGVyIHRvIEVSLS0+PGcgaWQ9Imxpbmtfd3JpdGVyX0VSIj48cGF0aCBkPSJNMjU2LjIxNSwzODMgQzI2Ny45NCwzODMgMjczLjY2NiwzODMgMjg1LjM5MSwzODMgIiBmaWxsPSJub25lIiBpZD0id3JpdGVyLXRvLUVSIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI5MS4zOTEsMzgzLDI4Mi4zOTEsMzc5LDI4Ni4zOTEsMzgzLDI4Mi4zOTEsMzg3LDI5MS4zOTEsMzgzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLVNSQz1bTk92SDNpOFczOFJWVHVmY3h6cDB4Q05pMGhrMHdUUDZKSFdHdzM4SnRUcmJtV0piZU5fX1p4SF9XcllGTHVSc1I4dG1HcmZ1RFgyVmlTSDBmMmlwTmk5cXVuYUJ3ZVZJMnl6RWV0MTVTREo5QmU0ZDMwbUVWTTNfV3BtWl9RN0x0b01ZaE9kbmVDWWtIaHN3QWx4UnZTX2tNOTg0OGFaSGR4aFJkOWk0SmNmbmdqb1J3UjRoZm9WUFhfbFgzRzAwXS0tPjwvZz48L3N2Zz4='>

<p><img src="https://img.yuheng.wang/mweb/15758158152825.jpg" alt="design"></p>
<h2 id="选型"><a href="#选型" class="headerlink" title="选型"></a>选型</h2><p>都是基本的文件及String操作，通过 <a href="https://github.com/alibaba/druid">druid</a> 进行sql解析</p>
<h2 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h2><h3 id="Reader"><a href="#Reader" class="headerlink" title="Reader"></a>Reader</h3><p>读取<strong>ddl.sql</strong>文件，解析成 <code>table</code></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Reader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">read</span><span class="params">(dbType: <span class="type">String</span>? = DEFAULT_DB_TYPE)</span></span>: Iterable&lt;Table&gt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">extract</span><span class="params">(dbType: <span class="type">String</span>, sql: <span class="type">String</span>)</span></span>: Table &#123;</span><br><span class="line">    ...    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileReader</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> path: String) : Reader &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">read</span><span class="params">(dbType: <span class="type">String</span>?)</span></span>: Iterable&lt;Table&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> Files.readAllLines(Paths.<span class="keyword">get</span>(path))</span><br><span class="line">                .filter &#123; !it.startsWith(<span class="string">&quot;#&quot;</span>) &#125;</span><br><span class="line">                .joinToString(<span class="string">&quot;&quot;</span>)</span><br><span class="line">                .split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">                .filter &#123; it.isNotBlank() &#125;</span><br><span class="line">                .map &#123; extract(dbType?: DEFAULT_DB_TYPE, it) &#125;</span><br><span class="line">                .toList()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Writer"><a href="#Writer" class="headerlink" title="Writer"></a>Writer</h3><p><code>template</code>通过resource文件管理，接收<code>table</code>输出plantuml格式<code>ER</code>图</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Writer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">write</span><span class="params">(tables: <span class="type">Iterable</span>&lt;<span class="type">Table</span>&gt;)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">parse</span><span class="params">(tables: <span class="type">Iterable</span>&lt;<span class="type">Table</span>&gt;)</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">val</span> template = Thread.currentThread().contextClassLoader.getResource(<span class="string">&quot;dot.template&quot;</span>)!!.readText()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> content = tables.joinToString(<span class="string">&quot;&quot;</span>) &#123; table -&gt;</span><br><span class="line">            <span class="keyword">val</span> columns = table.columnList.joinToString(<span class="string">&quot;\n&quot;</span>) &#123; <span class="string">&quot;<span class="subst">$&#123;it.notNullNameWrapper()&#125;</span> <span class="subst">$&#123;it.type&#125;</span> <span class="subst">$&#123;it.defaultValue&#125;</span> <span class="subst">$&#123;it.comment&#125;</span>&quot;</span> &#125;</span><br><span class="line">            <span class="string">&quot;Table(<span class="subst">$&#123;table.name&#125;</span>, \&quot;<span class="subst">$&#123;table.name&#125;</span>\\n(<span class="subst">$&#123;table.comment&#125;</span>)\&quot;)&#123; \n <span class="variable">$columns</span> + \n &#125; \n&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template.replace(<span class="string">&quot;__content__&quot;</span>, content)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> Column.<span class="title">notNullNameWrapper</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (<span class="keyword">this</span>.notNull) &#123;</span><br><span class="line">            <span class="string">&quot;not_null(<span class="subst">$&#123;this.name&#125;</span>)&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileWriter</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> path: String) : Writer &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">write</span><span class="params">(tables: <span class="type">Iterable</span>&lt;<span class="type">Table</span>&gt;)</span></span> &#123;</span><br><span class="line">        Files.write(Paths.<span class="keyword">get</span>(path), parse(tables).toByteArray())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> inPath = args[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">val</span> outPath = args[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">val</span> dbType = args.getOrNull(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    FileReader(inPath).read(dbType)</span><br><span class="line">            .apply &#123; FileWriter(outPath).write(<span class="keyword">this</span>) &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar ddl2plantuml.jar ddl.sql er.puml</span><br></pre></td></tr></table></figure>

<p>程序会读取当前目录下的<strong>ddl.sql</strong>文件，并转换生成<strong>er.puml</strong>文件。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0NTJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjgyOXB4O2hlaWdodDo0NTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA4MjkgNDUyIiB3aWR0aD0iODI5cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2xhc3MgdGFibGVfMS0tPjxnIGlkPSJlbGVtX3RhYmxlXzEiPjxyZWN0IGNvZGVMaW5lPSI3IiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIxMy41NjI1IiBpZD0idGFibGVfMSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMzQ1IiB4PSIzNyIgeT0iNyIvPjxlbGxpcHNlIGN4PSIxNTAuNzUiIGN5PSIyOC4yOTY5IiBmaWxsPSIjRkZBQUFBIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTE1MS4xODc1LDI1LjgyODEgTDE1My4wMzEzLDI1LjgyODEgTDE1My4wMzEzLDI3LjQyMTkgQzE1My4wMzEzLDI3LjgxMjUgMTUzLjA2MjUsMjcuOTg0NCAxNTMuMTU2MywyOC4xMjUgQzE1My4zMTI1LDI4LjM3NSAxNTMuNTkzOCwyOC41MzEzIDE1My44OTA2LDI4LjUzMTMgQzE1NC4xNTYzLDI4LjUzMTMgMTU0LjQwNjMsMjguNDA2MyAxNTQuNTc4MSwyOC4xODc1IEMxNTQuNzE4OCwyOC4wMTU2IDE1NC43MzQ0LDI3Ljg5MDYgMTU0LjczNDQsMjcuNDIxOSBMMTU0LjczNDQsMjQuMTQwNiBMMTQ1Ljk2ODgsMjQuMTQwNiBMMTQ1Ljk2ODgsMjcuNDIxOSBDMTQ1Ljk2ODgsMjcuODEyNSAxNDYsMjcuOTg0NCAxNDYuMDc4MSwyOC4xMjUgQzE0Ni4yMzQ0LDI4LjM5MDYgMTQ2LjUzMTMsMjguNTMxMyAxNDYuODEyNSwyOC41MzEzIEMxNDcuMDkzOCwyOC41MzEzIDE0Ny4zNDM4LDI4LjQwNjMgMTQ3LjUxNTYsMjguMTg3NSBDMTQ3LjYyNSwyOC4wMTU2IDE0Ny42NTYzLDI3Ljg3NSAxNDcuNjU2MywyNy40MjE5IEwxNDcuNjU2MywyNS44MjgxIEwxNDkuNDg0NCwyNS44MjgxIEwxNDkuNDg0NCwzMi4zNDM4IEwxNDguMzc1LDMyLjM0MzggQzE0Ny45Mzc1LDMyLjM0MzggMTQ3LjgxMjUsMzIuMzU5NCAxNDcuNjU2MywzMi40Njg4IEMxNDcuNDA2MywzMi42MjUgMTQ3LjI1LDMyLjkwNjMgMTQ3LjI1LDMzLjIwMzEgQzE0Ny4yNSwzMy40NTMxIDE0Ny4zOTA2LDMzLjcxODggMTQ3LjYwOTQsMzMuODc1IEMxNDcuNzY1NiwzNCAxNDcuOTg0NCwzNC4wNDY5IDE0OC4zNzUsMzQuMDQ2OSBMMTUyLjMxMjUsMzQuMDQ2OSBDMTUyLjY0MDYsMzQuMDQ2OSAxNTIuOTA2MywzNCAxNTMuMDE1NiwzMy45MjE5IEMxNTMuMjgxMywzMy43ODEzIDE1My40MjE5LDMzLjQ4NDQgMTUzLjQyMTksMzMuMjAzMSBDMTUzLjQyMTksMzIuOTIxOSAxNTMuMjk2OSwzMi42NzE5IDE1My4wNjI1LDMyLjUgQzE1Mi45MDYzLDMyLjM3NSAxNTIuNzY1NiwzMi4zNDM4IDE1Mi4zMTI1LDMyLjM0MzggTDE1MS4xODc1LDMyLjM0MzggTDE1MS4xODc1LDI1LjgyODEgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMTk4Ljc1IiB5PSIyNC45OTUxIj50YWJsZV8xPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOSIgeD0iMTcxLjI1IiB5PSI0MS4yOTIiPihUaGlzIGlzIHRhYmxlIDEpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM4IiB4Mj0iMzgxIiB5MT0iNDkuNTkzOCIgeTI9IjQ5LjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iMTMiIHg9IjQzIiB5PSI2Ni41ODg5Ij5pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkiIHg9IjYwIiB5PSI2Ni41ODg5Ij5iaWdpbnQgIGNvbHVtbl8xPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI4MSIgeD0iNDMiIHk9IjgyLjg4NTciPnByb2RfbmFtZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjgiIHg9IjEyOCIgeT0iODIuODg1NyI+dmFyY2hhciAgY29sdW1uXzI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijc1IiB4PSI0MyIgeT0iOTkuMTgyNiI+cHJvZF90eXBlPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzMyIgeD0iMTIyIiB5PSI5OS4xODI2Ij50aW55aW50ICcwJyBjb2x1bW5fMyAwOiYjMjc5NjM7JiMyNjM5OTsgMTomIzIzNDUwOyYjMjYzOTk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI3NiIgeD0iNDMiIHk9IjExNS40Nzk1Ij5zdGFydF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1NCIgeD0iMTIzIiB5PSIxMTUuNDc5NSI+dGltZSAgJiMyMDU3MjsmIzI3NDkwOyYjMjAxMzI7JiMyNjEzMTsmIzI0MzIwOyYjMjI5ODc7JiMyNjEwMjsmIzM4Mzg4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNjgiIHg9IjQzIiB5PSIxMzEuNzc2NCI+ZW5kX3RpbWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU0IiB4PSIxMTUiIHk9IjEzMS43NzY0Ij50aW1lICAmIzIwNTcyOyYjMjc0OTA7JiMyMDEzMjsmIzI2MTMxOyYjMzI0Njc7JiMyNjQ2MzsmIzI2MTAyOyYjMzgzODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI4NSIgeD0iNDMiIHk9IjE0OC4wNzMyIj5vbmxpbmVfdHlwZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzUiIHg9IjEzMiIgeT0iMTQ4LjA3MzIiPnRpbnlpbnQgJzAnIDA6JiMxOTk3ODsmIzMyNDQ3OyAxOiYjMjY0MTA7JiMxOTk3ODsmIzMyNDQ3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNjkiIHg9IjQzIiB5PSIxNjQuMzcwMSI+cHJvZF9pbmZvPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNSIgeD0iMTE2IiB5PSIxNjQuMzcwMSI+dmFyY2hhciAnJyAmIzIwMTM1OyYjMjE2OTc7JiMyMDE3MTsmIzMyNDYxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNzIiIHg9IjQzIiB5PSIxODAuNjY3Ij5vdmVyX2xpbWl0PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzNSIgeD0iMTE5IiB5PSIxODAuNjY3Ij50aW55aW50ICcwJyAmIzM2MjI5OyYjMzkwNjk7JiMzODQ4MDsmIzIxMDQ2OyAwOiYjMzg0ODA7JiMyMTA0NjsgMTomIzE5OTgxOyYjMzg0ODA7JiMyMTA0Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijk3IiB4PSI0MyIgeT0iMTk2Ljk2MzkiPmNyZWF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjgiIHg9IjE0NCIgeT0iMTk2Ljk2MzkiPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMDEiIHg9IjQzIiB5PSIyMTMuMjYwNyI+dXBkYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyOCIgeD0iMTQ4IiB5PSIyMTMuMjYwNyI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVA8L3RleHQ+PC9nPjwhLS1jbGFzcyB0YWJsZV8yLS0+PGcgaWQ9ImVsZW1fdGFibGVfMiI+PHJlY3QgY29kZUxpbmU9IjIwIiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE2NC42NzE5IiBpZD0idGFibGVfMiIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDA1IiB4PSI0MTciIHk9IjMxLjUiLz48ZWxsaXBzZSBjeD0iNTYxLjI1IiBjeT0iNTIuNzk2OSIgZmlsbD0iI0ZGQUFBQSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik01NjEuNjg3NSw1MC4zMjgxIEw1NjMuNTMxMyw1MC4zMjgxIEw1NjMuNTMxMyw1MS45MjE5IEM1NjMuNTMxMyw1Mi4zMTI1IDU2My41NjI1LDUyLjQ4NDQgNTYzLjY1NjMsNTIuNjI1IEM1NjMuODEyNSw1Mi44NzUgNTY0LjA5MzgsNTMuMDMxMyA1NjQuMzkwNiw1My4wMzEzIEM1NjQuNjU2Myw1My4wMzEzIDU2NC45MDYzLDUyLjkwNjMgNTY1LjA3ODEsNTIuNjg3NSBDNTY1LjIxODgsNTIuNTE1NiA1NjUuMjM0NCw1Mi4zOTA2IDU2NS4yMzQ0LDUxLjkyMTkgTDU2NS4yMzQ0LDQ4LjY0MDYgTDU1Ni40Njg4LDQ4LjY0MDYgTDU1Ni40Njg4LDUxLjkyMTkgQzU1Ni40Njg4LDUyLjMxMjUgNTU2LjUsNTIuNDg0NCA1NTYuNTc4MSw1Mi42MjUgQzU1Ni43MzQ0LDUyLjg5MDYgNTU3LjAzMTMsNTMuMDMxMyA1NTcuMzEyNSw1My4wMzEzIEM1NTcuNTkzOCw1My4wMzEzIDU1Ny44NDM4LDUyLjkwNjMgNTU4LjAxNTYsNTIuNjg3NSBDNTU4LjEyNSw1Mi41MTU2IDU1OC4xNTYzLDUyLjM3NSA1NTguMTU2Myw1MS45MjE5IEw1NTguMTU2Myw1MC4zMjgxIEw1NTkuOTg0NCw1MC4zMjgxIEw1NTkuOTg0NCw1Ni44NDM4IEw1NTguODc1LDU2Ljg0MzggQzU1OC40Mzc1LDU2Ljg0MzggNTU4LjMxMjUsNTYuODU5NCA1NTguMTU2Myw1Ni45Njg4IEM1NTcuOTA2Myw1Ny4xMjUgNTU3Ljc1LDU3LjQwNjMgNTU3Ljc1LDU3LjcwMzEgQzU1Ny43NSw1Ny45NTMxIDU1Ny44OTA2LDU4LjIxODggNTU4LjEwOTQsNTguMzc1IEM1NTguMjY1Niw1OC41IDU1OC40ODQ0LDU4LjU0NjkgNTU4Ljg3NSw1OC41NDY5IEw1NjIuODEyNSw1OC41NDY5IEM1NjMuMTQwNiw1OC41NDY5IDU2My40MDYzLDU4LjUgNTYzLjUxNTYsNTguNDIxOSBDNTYzLjc4MTMsNTguMjgxMyA1NjMuOTIxOSw1Ny45ODQ0IDU2My45MjE5LDU3LjcwMzEgQzU2My45MjE5LDU3LjQyMTkgNTYzLjc5NjksNTcuMTcxOSA1NjMuNTYyNSw1NyBDNTYzLjQwNjMsNTYuODc1IDU2My4yNjU2LDU2Ljg0MzggNTYyLjgxMjUsNTYuODQzOCBMNTYxLjY4NzUsNTYuODQzOCBMNTYxLjY4NzUsNTAuMzI4MSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzIiB4PSI2MDkuMjUiIHk9IjQ5LjQ5NTEiPnRhYmxlXzI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4IiB4PSI1ODEuNzUiIHk9IjY1Ljc5MiI+KFRoaXMgaXMgdGFibGUgMik8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDE4IiB4Mj0iODIxIiB5MT0iNzQuMDkzOCIgeTI9Ijc0LjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iMTMiIHg9IjQyMyIgeT0iOTEuMDg4OSI+aWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjQ0MCIgeT0iOTEuMDg4OSI+YmlnaW50PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1MCIgeD0iNDIzIiB5PSIxMDcuMzg1NyI+dXNlcl9pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MiIgeD0iNDc3IiB5PSIxMDcuMzg1NyI+YmlnaW50ICAmIzI5OTkyOyYjMjUxNDM7aWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijc3IiB4PSI0MjMiIHk9IjEyMy42ODI2Ij51c2VyX25hbWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3IiB4PSI1MDQiIHk9IjEyMy42ODI2Ij52YXJjaGFyICAmIzI5OTkyOyYjMjUxNDM7JiMyMTUxNzsmIzMxMjE2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNTQiIHg9IjQyMyIgeT0iMTM5Ljk3OTUiPnByb2RfaWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTIiIHg9IjQ4MSIgeT0iMTM5Ljk3OTUiPmJpZ2ludCAgJiMyMDEzNTsmIzIxNjk3O2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNiIgeD0iNDIzIiB5PSIxNTYuMjc2NCI+aW50ZXJlc3RfZGF0ZSBkYXRlTlVMTCYjMzU3NDU7JiMyNDY4NzsmIzI2MDg1OyYjMjYzOTk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI5NyIgeD0iNDIzIiB5PSIxNzIuNTczMiI+Y3JlYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iNTI0IiB5PSIxNzIuNTczMiI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyMTAxOTsmIzI0MzE0OyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjEwMSIgeD0iNDIzIiB5PSIxODguODcwMSI+dXBkYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iNTI4IiB5PSIxODguODcwMSI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyNjM1NjsmIzI2MDMyOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PC9nPjwhLS1jbGFzcyB0YWJsZV8zLS0+PGcgaWQ9ImVsZW1fdGFibGVfMyI+PHJlY3QgY29kZUxpbmU9IjMxIiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE2NC42NzE5IiBpZD0idGFibGVfMyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDA1IiB4PSI3IiB5PSIyODEiLz48ZWxsaXBzZSBjeD0iMTUwLjc1IiBjeT0iMzAyLjI5NjkiIGZpbGw9IiNGRkFBQUEiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMTUxLjE4NzUsMjk5LjgyODEgTDE1My4wMzEzLDI5OS44MjgxIEwxNTMuMDMxMywzMDEuNDIxOSBDMTUzLjAzMTMsMzAxLjgxMjUgMTUzLjA2MjUsMzAxLjk4NDQgMTUzLjE1NjMsMzAyLjEyNSBDMTUzLjMxMjUsMzAyLjM3NSAxNTMuNTkzOCwzMDIuNTMxMyAxNTMuODkwNiwzMDIuNTMxMyBDMTU0LjE1NjMsMzAyLjUzMTMgMTU0LjQwNjMsMzAyLjQwNjMgMTU0LjU3ODEsMzAyLjE4NzUgQzE1NC43MTg4LDMwMi4wMTU2IDE1NC43MzQ0LDMwMS44OTA2IDE1NC43MzQ0LDMwMS40MjE5IEwxNTQuNzM0NCwyOTguMTQwNiBMMTQ1Ljk2ODgsMjk4LjE0MDYgTDE0NS45Njg4LDMwMS40MjE5IEMxNDUuOTY4OCwzMDEuODEyNSAxNDYsMzAxLjk4NDQgMTQ2LjA3ODEsMzAyLjEyNSBDMTQ2LjIzNDQsMzAyLjM5MDYgMTQ2LjUzMTMsMzAyLjUzMTMgMTQ2LjgxMjUsMzAyLjUzMTMgQzE0Ny4wOTM4LDMwMi41MzEzIDE0Ny4zNDM4LDMwMi40MDYzIDE0Ny41MTU2LDMwMi4xODc1IEMxNDcuNjI1LDMwMi4wMTU2IDE0Ny42NTYzLDMwMS44NzUgMTQ3LjY1NjMsMzAxLjQyMTkgTDE0Ny42NTYzLDI5OS44MjgxIEwxNDkuNDg0NCwyOTkuODI4MSBMMTQ5LjQ4NDQsMzA2LjM0MzggTDE0OC4zNzUsMzA2LjM0MzggQzE0Ny45Mzc1LDMwNi4zNDM4IDE0Ny44MTI1LDMwNi4zNTk0IDE0Ny42NTYzLDMwNi40Njg4IEMxNDcuNDA2MywzMDYuNjI1IDE0Ny4yNSwzMDYuOTA2MyAxNDcuMjUsMzA3LjIwMzEgQzE0Ny4yNSwzMDcuNDUzMSAxNDcuMzkwNiwzMDcuNzE4OCAxNDcuNjA5NCwzMDcuODc1IEMxNDcuNzY1NiwzMDggMTQ3Ljk4NDQsMzA4LjA0NjkgMTQ4LjM3NSwzMDguMDQ2OSBMMTUyLjMxMjUsMzA4LjA0NjkgQzE1Mi42NDA2LDMwOC4wNDY5IDE1Mi45MDYzLDMwOCAxNTMuMDE1NiwzMDcuOTIxOSBDMTUzLjI4MTMsMzA3Ljc4MTMgMTUzLjQyMTksMzA3LjQ4NDQgMTUzLjQyMTksMzA3LjIwMzEgQzE1My40MjE5LDMwNi45MjE5IDE1My4yOTY5LDMwNi42NzE5IDE1My4wNjI1LDMwNi41IEMxNTIuOTA2MywzMDYuMzc1IDE1Mi43NjU2LDMwNi4zNDM4IDE1Mi4zMTI1LDMwNi4zNDM4IEwxNTEuMTg3NSwzMDYuMzQzOCBMMTUxLjE4NzUsMjk5LjgyODEgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMTk4Ljc1IiB5PSIyOTguOTk1MSI+dGFibGVfMzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkiIHg9IjE3MS4yNSIgeT0iMzE1LjI5MiI+KFRoaXMgaXMgdGFibGUgMyk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjQxMSIgeTE9IjMyMy41OTM4IiB5Mj0iMzIzLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iMTMiIHg9IjEzIiB5PSIzNDAuNTg4OSI+aWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjMwIiB5PSIzNDAuNTg4OSI+YmlnaW50PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1MCIgeD0iMTMiIHk9IjM1Ni44ODU3Ij51c2VyX2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSI2NyIgeT0iMzU2Ljg4NTciPmJpZ2ludCAgJiMyOTk5MjsmIzI1MTQzO2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI3NyIgeD0iMTMiIHk9IjM3My4xODI2Ij51c2VyX25hbWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3IiB4PSI5NCIgeT0iMzczLjE4MjYiPnZhcmNoYXIgICYjMjk5OTI7JiMyNTE0MzsmIzIxNTE3OyYjMzEyMTY7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMTMiIHk9IjM4OS40Nzk1Ij5wcm9kX2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSI3MSIgeT0iMzg5LjQ3OTUiPmJpZ2ludCAgJiMyMDEzNTsmIzIxNjk3O2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNiIgeD0iMTMiIHk9IjQwNS43NzY0Ij5pbnRlcmVzdF9kYXRlIGRhdGVOVUxMJiMzNTc0NTsmIzI0Njg3OyYjMjYwODU7JiMyNjM5OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijk3IiB4PSIxMyIgeT0iNDIyLjA3MzIiPmNyZWF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyODgiIHg9IjExNCIgeT0iNDIyLjA3MzIiPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QICYjMjEwMTk7JiMyNDMxNDsmIzI2MTAyOyYjMzgzODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMDEiIHg9IjEzIiB5PSI0MzguMzcwMSI+dXBkYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iMTE4IiB5PSI0MzguMzcwMSI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyNjM1NjsmIzI2MDMyOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PC9nPjwhLS1TUkM9W3hMRFRRekRHNkJ4bGh0WE5CemYwT1ZzdUFvNG1QMERYNnBBcEVvNmFvVGJ3QzNjZjlvVFpIR0h4OEhIN09UMVhyTktDWHI4SGRCaWVMTGgxRnpFU2hsXzJheEhocXFRYlU2cXUyVXl2VVB4dHV5Y0pESENUTzg5MHJLaU1JWEZUSFhhSmtPTzRYZ014QldHN2VCa0czMHdKOENrR0xaRnRqaE9zbjJNMWVZSk1mbG1BblJQRWd6ZUpMNHFWSW8wUlprTkc4YU1jOGZVS090Y3pmQ1podVRjU3VYN3lyNENIejI1NVkwSlc5STFuYzRPeW9tZ1hOVzNtYjRHUGNtWGluQ2dFd0t1c0JhQ0tFUW5RR012WUNXdUJkYmVrMHliZno5WWFySjlzR1FwbTE3OUlLZGU2WUxhNVI0ZkdtZVVPQzAzSFhNU0pCR1U5VUdTTHdmWFE4OGU0SHBlcm9aZ1R1VjhuTkQyQTEwb0pRZjBsYkt0VEdHa0dCVkJrV0JTbDhMVnFoenk1R09KaUNmcW9aTTR4UDhpRjA3d2pwUnpTM1ZpVi05a2NfLUU1dHBkWGhUd3VyT3NvNDM3X28xYURjbHBZQ2l2blkySzRfYXNac1VCbS13akhfd1ZlWnhTX0otRmItSjB2U0VPd2Y1OG14N1Z5UGNxdUUxYUQ2V2piWlgzTEI2blpqYlpiamxUb1Y3S25WZGxncnRrWXYzSjhZVGdEUUhuOU9iMmFDdEd0ZW9kWVNDeHgtdGp4Y3hrZ2ZaeE9zTm9hUmtteVgyWjlndldoYXZ3Qk13b2VUVjhwdy1IWnJpZF9uSmVCQlJYWS1FWkJxVGFkTmwtNnBIWGVvTFNKZDdfUTY3TGt1amY3NGF2YTNuRUFsVlc5TkFPNWV1UnB4a3ZsUnp6VWwtVXJoeHByU1NiZUFxbGdyeV96R0pfa2R2TmJ2VVRUX2xmY2JhMTg3VEV3Q0RFdzRERXd5NV9oVnpWdzVtMDBdLS0+PC9nPjwvc3ZnPg=='>

<p><img src="https://img.yuheng.wang/mweb/15758175805875.jpg" alt="result"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>ddd</tag>
      </tags>
  </entry>
  <entry>
    <title>DDL转plantuml格式ER图</title>
    <url>/2018/06/28/ddl2plantuml/</url>
    <content><![CDATA[<p>项目源码地址: <a href="https://github.com/wangyuheng/ddl2plantuml">github</a></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>通过plantuml绘制数据库ER图，手写字段信息成本太大。需要一套DDL转换plantuml的工具。</p>
<h2 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h2><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyMTJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjg0MnB4O2hlaWdodDoyMTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA4NDIgMjEyIiB3aWR0aD0iODQycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZyBpZD0iY2x1c3Rlcl8jIzQiPjxwYXRoIGQ9Ik0zNzIuMzEzOSwxNS4xMjg1IEMzNzUuNDk3Miw5LjY0NTUgMzgxLjk3NjgsOC41MzAxIDM4NS41MDgsMTQuNzM1NyBDMzg3LjgwNzUsOS4xODEzIDM5My41NDM1LDguOTIzMiAzOTcuMDU1OCwxMy4zMjk2IEMzOTkuNzk2NSw2LjgxNTEgNDAzLjg3ODcsNi4yODk5IDQwOC4yMjc3LDExLjg0MDQgQzQxMS44ODgzLDYuMTk0NSA0MTcuMjE2Niw3LjYxODIgNDIwLjEyNDYsMTIuNjc2OCBDNDI0LjUzMDEsNiA0MjkuODE0Nyw2Ljk0MjIgNDMzLjMwMTIsMTMuNTg1OCBDNDM3LjQ4MjYsNy44MjY2IDQ0Mi4yMTY2LDkuMDk2NCA0NDUuNzA1MiwxNC4zNjUxIEM0NTUuMTE2MSwxOS4wODE2IDQ1NS42MjEzLDIzLjk4MzcgNDQ3LjM0NTYsMzAuNDk4NiBDNDU1LjM3NzgsMzQuMjUzNSA0NTcuMTk2Myw0MC43MDA2IDQ1MS4xNjkxLDQ3LjU5OTEgQzQ1Ni42NDQ0LDUzLjg5ODcgNDU2LjM4MTgsNTkuMDU4OCA0NDcuNTk0OSw2MS43NTgxIEM0NTMuOTU4NSw2OC40NjY2IDQ1NC44NzA4LDc0LjM3MjMgNDQ0Ljk2NjMsNzguNTMxNCBDNDQyLjE1NDIsODMuODQ1MiA0MzcuNzI3Nyw4My43MjIzIDQzNC4wMzk5LDc5LjUzODkgQzQzMS4xNjk1LDg1Ljc4MDcgNDI2LjQxMTcsODYuOTk3MyA0MjEuOTkyNiw4MS4wNzIzIEM0MTguNzcwNyw4OC4yMDI0IDQxNC40NTMsODkuOTgzOCA0MDguNDA1OSw4My45OTkyIEM0MDQuMTM0OCw4OC4xMzA1IDQwMC41NTAxLDg4Ljg0ODkgMzk3LjU5NDksODIuNjI1NCBDMzkyLjE3MTQsODguMzI1NyAzODguMTkwNyw4Ni4wNzYzIDM4NS40OTcsNzkuODU1MiBDMzgxLjExMzUsODYuMzczMiAzNzYuNzk4Miw4NC44ODM3IDM3Mi42MTkyLDc5LjYzMTUgQzM2NC40OTc4LDc0Ljk3ODYgMzYzLjQ0MDMsNjguNTEwNyAzNzEuMDIzMiw2Mi40MDMgQzM2My4wMzM3LDU4LjgzMyAzNjMuNzg0Miw1MS4zNzA4IDM2OS45MzAyLDQ2LjgwOTkgQzM2Mi4zNDIxLDQxLjE0MzYgMzYxLjk5MjIsMzMuNTA3MiAzNzEuODI2NCwyOS43ODA5IEMzNjQuMTk4NCwyNS4zODI2IDM2NS45OTMzLDE5LjA2MjYgMzcyLjMxMzksMTUuMTI4NSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48ZyBpZD0iY2x1c3Rlcl8jIzciPjxwYXRoIGQ9Ik04LjUsMTI3LjYwNjMgTDIxMC43NSwxMjcuNjA2MyBBMy43NSwzLjc1IDAgMCAxIDIxMy4yNSwxMzAuMTA2MyBMMjIwLjI1LDEzNy42MDYzIEw4MzIuNSwxMzcuNjA2MyBBMi41LDIuNSAwIDAgMSA4MzUsMTQwLjEwNjMgTDgzNSwyMDMuMTA2MyBBMi41LDIuNSAwIDAgMSA4MzIuNSwyMDUuNjA2MyBMOC41LDIwNS42MDYzIEEyLjUsMi41IDAgMCAxIDYsMjAzLjEwNjMgTDYsMTMwLjEwNjMgQTIuNSwyLjUgMCAwIDEgOC41LDEyNy42MDYzICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjIyMC4yNSIgeTE9IjEzNy42MDYzIiB5Mj0iMTM3LjYwNjMiLz48L2c+PCEtLWVudGl0eSBjb252ZXJ0LS0+PGcgaWQ9ImVsZW1fY29udmVydCI+PGVsbGlwc2UgY3g9IjQwOCIgY3k9IjM3LjYwNjMiIGZpbGw9IiMwMDgwMDAiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwNCwyNS42MDYzLDQxMCwyMC42MDYzLDQwOCwyNS42MDYzLDQxMCwzMC42MDYzLDQwNCwyNS42MDYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iMzgwIiB5PSI2Ni42MDE0Ij5jb252ZXJ0PC90ZXh0PjwvZz48IS0tZW50aXR5IHN0ZXAxLS0+PGcgaWQ9ImVsZW1fc3RlcDEiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjIsMTUzLjYwNjMsMzIsMTQzLjYwNjMsMTIwLDE0My42MDYzLDEyMCwxNzkuOTAzMSwxMTAsMTg5LjkwMzEsMjIsMTg5LjkwMzEsMjIsMTUzLjYwNjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjExMCIgeDI9IjEyMCIgeTE9IjE1My42MDYzIiB5Mj0iMTQzLjYwNjMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMiIgeDI9IjExMCIgeTE9IjE1My42MDYzIiB5Mj0iMTUzLjYwNjMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTAiIHgyPSIxMTAiIHkxPSIxNTMuNjA2MyIgeTI9IjE4OS45MDMxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTgiIHg9IjM3IiB5PSIxNzYuNjAxNCI+cmVhZCBkZGw8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3RlcDItLT48ZyBpZD0iZWxlbV9zdGVwMiI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIxNTUuNSwxNTMuNjA2MywxNjUuNSwxNDMuNjA2MywzMjIuNSwxNDMuNjA2MywzMjIuNSwxNzkuOTAzMSwzMTIuNSwxODkuOTAzMSwxNTUuNSwxODkuOTAzMSwxNTUuNSwxNTMuNjA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzEyLjUiIHgyPSIzMjIuNSIgeTE9IjE1My42MDYzIiB5Mj0iMTQzLjYwNjMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNTUuNSIgeDI9IjMxMi41IiB5MT0iMTUzLjYwNjMiIHkyPSIxNTMuNjA2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMxMi41IiB4Mj0iMzEyLjUiIHkxPSIxNTMuNjA2MyIgeTI9IjE4OS45MDMxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3IiB4PSIxNzAuNSIgeT0iMTc2LjYwMTQiPmV4dHJhY3QgdGFibGUgaW5mbzwvdGV4dD48L2c+PCEtLWVudGl0eSBzdGVwMy0tPjxnIGlkPSJlbGVtX3N0ZXAzIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjM1Ny41LDE1My42MDYzLDM2Ny41LDE0My42MDYzLDYzOC41LDE0My42MDYzLDYzOC41LDE3OS45MDMxLDYyOC41LDE4OS45MDMxLDM1Ny41LDE4OS45MDMxLDM1Ny41LDE1My42MDYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MjguNSIgeDI9IjYzOC41IiB5MT0iMTUzLjYwNjMiIHkyPSIxNDMuNjA2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM1Ny41IiB4Mj0iNjI4LjUiIHkxPSIxNTMuNjA2MyIgeTI9IjE1My42MDYzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjI4LjUiIHgyPSI2MjguNSIgeTE9IjE1My42MDYzIiB5Mj0iMTg5LjkwMzEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDEiIHg9IjM3Mi41IiB5PSIxNzYuNjAxNCI+cmVwbGFjZSBieSB0ZW1wbGF0ZSBmb3IgcGxhbnR1bWw8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3RlcDQtLT48ZyBpZD0iZWxlbV9zdGVwNCI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI2NzMuNSwxNTMuNjA2Myw2ODMuNSwxNDMuNjA2Myw4MTguNSwxNDMuNjA2Myw4MTguNSwxNzkuOTAzMSw4MDguNSwxODkuOTAzMSw2NzMuNSwxODkuOTAzMSw2NzMuNSwxNTMuNjA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iODA4LjUiIHgyPSI4MTguNSIgeTE9IjE1My42MDYzIiB5Mj0iMTQzLjYwNjMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2NzMuNSIgeDI9IjgwOC41IiB5MT0iMTUzLjYwNjMiIHkyPSIxNTMuNjA2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgwOC41IiB4Mj0iODA4LjUiIHkxPSIxNTMuNjA2MyIgeTI9IjE4OS45MDMxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA1IiB4PSI2ODguNSIgeT0iMTc2LjYwMTQiPndyaXRlIHBsYW50dW1sPC90ZXh0PjwvZz48IS0tZW50aXR5IERETC0tPjxnIGlkPSJlbGVtX0RETCI+PGVsbGlwc2UgY3g9IjMzMCIgY3k9IjE2LjEwNjMiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTMzMCwyNC4xMDYzIEwzMzAsNTEuMTA2MyBNMzE3LDMyLjEwNjMgTDM0MywzMi4xMDYzIE0zMzAsNTEuMTA2MyBMMzE3LDY2LjEwNjMgTTMzMCw1MS4xMDYzIEwzNDMsNjYuMTA2MyAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMwIiB4PSIzMTUiIHk9IjgwLjYwMTQiPkRETDwvdGV4dD48L2c+PCEtLWVudGl0eSBwbGFudFVtbC0tPjxnIGlkPSJlbGVtX3BsYW50VW1sIj48ZWxsaXBzZSBjeD0iNTA0IiBjeT0iMTYuMTA2MyIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTA0LDI0LjEwNjMgTDUwNCw1MS4xMDYzIE00OTEsMzIuMTA2MyBMNTE3LDMyLjEwNjMgTTUwNCw1MS4xMDYzIEw0OTEsNjYuMTA2MyBNNTA0LDUxLjEwNjMgTDUxNyw2Ni4xMDYzICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUiIHg9IjQ3MS41IiB5PSI4MC42MDE0Ij5wbGFudFVtbDwvdGV4dD48L2c+PCEtLWxpbmsgRERMIHRvIGNvbnZlcnQtLT48ZyBpZD0ibGlua19ERExfY29udmVydCI+PHBhdGggZD0iTTM0NS4yMzQsNDUuNjA2MyBDMzU2LjY3Niw0NS42MDYzIDM2Mi4xMTgsNDUuNjA2MyAzNzMuNTU5LDQ1LjYwNjMgIiBmaWxsPSJub25lIiBpZD0iRERMLXRvLWNvbnZlcnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzc5LjU1OSw0NS42MDYzLDM3MC41NTksNDEuNjA2MywzNzQuNTU5LDQ1LjYwNjMsMzcwLjU1OSw0OS42MDYzLDM3OS41NTksNDUuNjA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGNvbnZlcnQgdG8gcGxhbnRVbWwtLT48ZyBpZD0ibGlua19jb252ZXJ0X3BsYW50VW1sIj48cGF0aCBkPSJNNDM2LjEyNSw0NS42MDYzIEM0NDcuODc5LDQ1LjYwNjMgNDUzLjYzNCw0NS42MDYzIDQ2NS4zODgsNDUuNjA2MyAiIGZpbGw9Im5vbmUiIGlkPSJjb252ZXJ0LXRvLXBsYW50VW1sIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ3MS4zODgsNDUuNjA2Myw0NjIuMzg4LDQxLjYwNjMsNDY2LjM4OCw0NS42MDYzLDQ2Mi4zODgsNDkuNjA2Myw0NzEuMzg4LDQ1LjYwNjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBjb252ZXJ0IHRvIHN0ZXAxLS0+PGcgaWQ9ImxpbmtfY29udmVydF9zdGVwMSI+PHBhdGggZD0iTTM5MS42NDQsNjkuNjM2MyBDMzg0LjAwMiw3OC42MjIzIDM3NC4xMjksODguMDc3MyAzNjMsOTMuNjA2MyBDMjcyLjg0NywxMzguMzk0OCAyMzIuMjcxLDg0LjMwMDMgMTM4LDExOS42MDYzIEMxMjMuMjAxLDEyNS4xNDg4IDExMy4zMTUsMTMxLjAzMDQgMTAxLjQ4OSwxMzkuOTYxNCAiIGZpbGw9Im5vbmUiIGlkPSJjb252ZXJ0LXRvLXN0ZXAxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk2LjcwMSwxNDMuNTc3MywxMDYuMjkzNiwxNDEuMzQ1NCwxMDAuNjkxLDE0MC41NjQsMTAxLjQ3MjQsMTM0Ljk2MTQsOTYuNzAxLDE0My41NzczIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgc3RlcDEgdG8gc3RlcDItLT48ZyBpZD0ibGlua19zdGVwMV9zdGVwMiI+PHBhdGggZD0iTTEyMC4yMTksMTY2LjYwNjMgQzEzMS45NzMsMTY2LjYwNjMgMTM3LjcyOCwxNjYuNjA2MyAxNDkuNDgyLDE2Ni42MDYzICIgZmlsbD0ibm9uZSIgaWQ9InN0ZXAxLXRvLXN0ZXAyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE1NS40ODIsMTY2LjYwNjMsMTQ2LjQ4MiwxNjIuNjA2MywxNTAuNDgyLDE2Ni42MDYzLDE0Ni40ODIsMTcwLjYwNjMsMTU1LjQ4MiwxNjYuNjA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHN0ZXAyIHRvIHN0ZXAzLS0+PGcgaWQ9Imxpbmtfc3RlcDJfc3RlcDMiPjxwYXRoIGQ9Ik0zMjIuNzIsMTY2LjYwNjMgQzMzNC4yNDUsMTY2LjYwNjMgMzM5Ljc3MSwxNjYuNjA2MyAzNTEuMjk2LDE2Ni42MDYzICIgZmlsbD0ibm9uZSIgaWQ9InN0ZXAyLXRvLXN0ZXAzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM1Ny4yOTYsMTY2LjYwNjMsMzQ4LjI5NiwxNjIuNjA2MywzNTIuMjk2LDE2Ni42MDYzLDM0OC4yOTYsMTcwLjYwNjMsMzU3LjI5NiwxNjYuNjA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHN0ZXAzIHRvIHN0ZXA0LS0+PGcgaWQ9Imxpbmtfc3RlcDNfc3RlcDQiPjxwYXRoIGQ9Ik02MzguOTUzLDE2Ni42MDYzIEM2NTAuMzgzLDE2Ni42MDYzIDY1NS44MTIsMTY2LjYwNjMgNjY3LjI0MiwxNjYuNjA2MyAiIGZpbGw9Im5vbmUiIGlkPSJzdGVwMy10by1zdGVwNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NzMuMjQyLDE2Ni42MDYzLDY2NC4yNDIsMTYyLjYwNjMsNjY4LjI0MiwxNjYuNjA2Myw2NjQuMjQyLDE3MC42MDYzLDY3My4yNDIsMTY2LjYwNjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIGNvbnZlcnQgdG8gc3RlcDQtLT48ZyBpZD0ibGlua19jb252ZXJ0X3N0ZXA0Ij48cGF0aCBkPSJNNDI5LjI0MzcsNzQuNTYwNyBDNDM3LjAxNTcsODMuMzg4NyA0NDIuOTYyLDg4LjEwOTMgNDU0LDkzLjYwNjMgQzUzNS4wMjUsMTMzLjk2MDQgNTY5LjUzMSw5Mi44MzQzIDY1NiwxMTkuNjA2MyBDNjc0LjYwNiwxMjUuMzY3MSA2OTMuOTk4LDEzNC43ODA0IDcwOS45OTYsMTQzLjU5NTcgIiBmaWxsPSJub25lIiBpZD0iY29udmVydC1iYWNrdG8tc3RlcDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDI1LjI3OSw3MC4wNTczLDQyOC4yMjM4LDc5LjQ1NTYsNDI4LjU4MjksNzMuODEwMSw0MzQuMjI4NCw3NC4xNjkzLDQyNS4yNzksNzAuMDU3MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1TUkM9W1BLXzEzZThtM0J0dEFuZXpTcjB1Y3ZYbXo2UnlXQjRMOTh3RHAyOFF1eHl4WGkyOEZSSkRVc19UVXFBb1RQWmQ5bjFYUXhLbVY2YXFXRElzS19XNnoyTWpPTVZyQzFfYTZCVUw4cEJtME1ZNWw4Y0FWWmZaNVU3NmFMMmViRHhXeU9udGZkT05hVkhhdnh6MjVlS2NoNHJmUHpiLVRTQ3hhT0o1MnZhUWxwRFhFVmRoY2tMczZadGdOVXJiVnY5aUNFZVpPa0Jnd2loOU9TZTFLdndQWUU5RmJCQXp5U29POF9INTdibVpaNkU1Zlc1Q3JzME1tMG1KSk1MYXVtaTBdLS0+PC9nPjwvc3ZnPg=='>

<ol>
<li>读取同目录下<strong>ddl.sql</strong>文件</li>
<li>基于 <code>;</code> 分割建表语句</li>
<li>依赖 <a href="https://github.com/alibaba/druid">druid</a> 进行sql解析</li>
<li>定义plantuml模版</li>
<li><code>replaceAll</code>替换模版内容</li>
</ol>
<span id="more"></span>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar ddl2plantuml-1.0.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>程序会读取同目录的<strong>ddl.sql</strong>文件，并转换生成<strong>er.puml</strong>文件。</p>
<h3 id="ER图效果"><a href="#ER图效果" class="headerlink" title="ER图效果"></a>ER图效果</h3><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0NTJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjg1OXB4O2hlaWdodDo0NTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA4NTkgNDUyIiB3aWR0aD0iODU5cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2xhc3MgdGFibGVfMS0tPjxnIGlkPSJlbGVtX3RhYmxlXzEiPjxyZWN0IGNvZGVMaW5lPSI3IiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIxMy41NjI1IiBpZD0idGFibGVfMSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMzQ1IiB4PSIyNTciIHk9IjciLz48ZWxsaXBzZSBjeD0iMzcwLjc1IiBjeT0iMjguMjk2OSIgZmlsbD0iI0ZGQUFBQSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik0zNzEuMTg3NSwyNS44MjgxIEwzNzMuMDMxMywyNS44MjgxIEwzNzMuMDMxMywyNy40MjE5IEMzNzMuMDMxMywyNy44MTI1IDM3My4wNjI1LDI3Ljk4NDQgMzczLjE1NjMsMjguMTI1IEMzNzMuMzEyNSwyOC4zNzUgMzczLjU5MzgsMjguNTMxMyAzNzMuODkwNiwyOC41MzEzIEMzNzQuMTU2MywyOC41MzEzIDM3NC40MDYzLDI4LjQwNjMgMzc0LjU3ODEsMjguMTg3NSBDMzc0LjcxODgsMjguMDE1NiAzNzQuNzM0NCwyNy44OTA2IDM3NC43MzQ0LDI3LjQyMTkgTDM3NC43MzQ0LDI0LjE0MDYgTDM2NS45Njg4LDI0LjE0MDYgTDM2NS45Njg4LDI3LjQyMTkgQzM2NS45Njg4LDI3LjgxMjUgMzY2LDI3Ljk4NDQgMzY2LjA3ODEsMjguMTI1IEMzNjYuMjM0NCwyOC4zOTA2IDM2Ni41MzEzLDI4LjUzMTMgMzY2LjgxMjUsMjguNTMxMyBDMzY3LjA5MzgsMjguNTMxMyAzNjcuMzQzOCwyOC40MDYzIDM2Ny41MTU2LDI4LjE4NzUgQzM2Ny42MjUsMjguMDE1NiAzNjcuNjU2MywyNy44NzUgMzY3LjY1NjMsMjcuNDIxOSBMMzY3LjY1NjMsMjUuODI4MSBMMzY5LjQ4NDQsMjUuODI4MSBMMzY5LjQ4NDQsMzIuMzQzOCBMMzY4LjM3NSwzMi4zNDM4IEMzNjcuOTM3NSwzMi4zNDM4IDM2Ny44MTI1LDMyLjM1OTQgMzY3LjY1NjMsMzIuNDY4OCBDMzY3LjQwNjMsMzIuNjI1IDM2Ny4yNSwzMi45MDYzIDM2Ny4yNSwzMy4yMDMxIEMzNjcuMjUsMzMuNDUzMSAzNjcuMzkwNiwzMy43MTg4IDM2Ny42MDk0LDMzLjg3NSBDMzY3Ljc2NTYsMzQgMzY3Ljk4NDQsMzQuMDQ2OSAzNjguMzc1LDM0LjA0NjkgTDM3Mi4zMTI1LDM0LjA0NjkgQzM3Mi42NDA2LDM0LjA0NjkgMzcyLjkwNjMsMzQgMzczLjAxNTYsMzMuOTIxOSBDMzczLjI4MTMsMzMuNzgxMyAzNzMuNDIxOSwzMy40ODQ0IDM3My40MjE5LDMzLjIwMzEgQzM3My40MjE5LDMyLjkyMTkgMzczLjI5NjksMzIuNjcxOSAzNzMuMDYyNSwzMi41IEMzNzIuOTA2MywzMi4zNzUgMzcyLjc2NTYsMzIuMzQzOCAzNzIuMzEyNSwzMi4zNDM4IEwzNzEuMTg3NSwzMi4zNDM4IEwzNzEuMTg3NSwyNS44MjgxIFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQiIHg9IjQxOC43NSIgeT0iMjQuOTk1MSI+dGFibGVfMTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkiIHg9IjM5MS4yNSIgeT0iNDEuMjkyIj4oVGhpcyBpcyB0YWJsZSAxKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNTgiIHgyPSI2MDEiIHkxPSI0OS41OTM4IiB5Mj0iNDkuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMyIgeD0iMjYzIiB5PSI2Ni41ODg5Ij5pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkiIHg9IjI4MCIgeT0iNjYuNTg4OSI+YmlnaW50ICBjb2x1bW5fMTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iODEiIHg9IjI2MyIgeT0iODIuODg1NyI+cHJvZF9uYW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyOCIgeD0iMzQ4IiB5PSI4Mi44ODU3Ij52YXJjaGFyICBjb2x1bW5fMjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNzUiIHg9IjI2MyIgeT0iOTkuMTgyNiI+cHJvZF90eXBlPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzMyIgeD0iMzQyIiB5PSI5OS4xODI2Ij50aW55aW50ICcwJyBjb2x1bW5fMyAwOiYjMjc5NjM7JiMyNjM5OTsgMTomIzIzNDUwOyYjMjYzOTk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI3NiIgeD0iMjYzIiB5PSIxMTUuNDc5NSI+c3RhcnRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTQiIHg9IjM0MyIgeT0iMTE1LjQ3OTUiPnRpbWUgICYjMjA1NzI7JiMyNzQ5MDsmIzIwMTMyOyYjMjYxMzE7JiMyNDMyMDsmIzIyOTg3OyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjY4IiB4PSIyNjMiIHk9IjEzMS43NzY0Ij5lbmRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTQiIHg9IjMzNSIgeT0iMTMxLjc3NjQiPnRpbWUgICYjMjA1NzI7JiMyNzQ5MDsmIzIwMTMyOyYjMjYxMzE7JiMzMjQ2NzsmIzI2NDYzOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijg1IiB4PSIyNjMiIHk9IjE0OC4wNzMyIj5vbmxpbmVfdHlwZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzUiIHg9IjM1MiIgeT0iMTQ4LjA3MzIiPnRpbnlpbnQgJzAnIDA6JiMxOTk3ODsmIzMyNDQ3OyAxOiYjMjY0MTA7JiMxOTk3ODsmIzMyNDQ3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNjkiIHg9IjI2MyIgeT0iMTY0LjM3MDEiPnByb2RfaW5mbzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUiIHg9IjMzNiIgeT0iMTY0LjM3MDEiPnZhcmNoYXIgJycgJiMyMDEzNTsmIzIxNjk3OyYjMjAxNzE7JiMzMjQ2MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjcyIiB4PSIyNjMiIHk9IjE4MC42NjciPm92ZXJfbGltaXQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjM1IiB4PSIzMzkiIHk9IjE4MC42NjciPnRpbnlpbnQgJzAnICYjMzYyMjk7JiMzOTA2OTsmIzM4NDgwOyYjMjEwNDY7IDA6JiMzODQ4MDsmIzIxMDQ2OyAxOiYjMTk5ODE7JiMzODQ4MDsmIzIxMDQ2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iOTciIHg9IjI2MyIgeT0iMTk2Ljk2MzkiPmNyZWF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjgiIHg9IjM2NCIgeT0iMTk2Ljk2MzkiPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMDEiIHg9IjI2MyIgeT0iMjEzLjI2MDciPnVwZGF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjgiIHg9IjM2OCIgeT0iMjEzLjI2MDciPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QPC90ZXh0PjwvZz48IS0tY2xhc3MgdGFibGVfMi0tPjxnIGlkPSJlbGVtX3RhYmxlXzIiPjxyZWN0IGNvZGVMaW5lPSIyMCIgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxNjQuNjcxOSIgaWQ9InRhYmxlXzIiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQwNSIgeD0iNDQ3IiB5PSIyODEiLz48ZWxsaXBzZSBjeD0iNTkxLjI1IiBjeT0iMzAyLjI5NjkiIGZpbGw9IiNGRkFBQUEiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNTkxLjY4NzUsMjk5LjgyODEgTDU5My41MzEzLDI5OS44MjgxIEw1OTMuNTMxMywzMDEuNDIxOSBDNTkzLjUzMTMsMzAxLjgxMjUgNTkzLjU2MjUsMzAxLjk4NDQgNTkzLjY1NjMsMzAyLjEyNSBDNTkzLjgxMjUsMzAyLjM3NSA1OTQuMDkzOCwzMDIuNTMxMyA1OTQuMzkwNiwzMDIuNTMxMyBDNTk0LjY1NjMsMzAyLjUzMTMgNTk0LjkwNjMsMzAyLjQwNjMgNTk1LjA3ODEsMzAyLjE4NzUgQzU5NS4yMTg4LDMwMi4wMTU2IDU5NS4yMzQ0LDMwMS44OTA2IDU5NS4yMzQ0LDMwMS40MjE5IEw1OTUuMjM0NCwyOTguMTQwNiBMNTg2LjQ2ODgsMjk4LjE0MDYgTDU4Ni40Njg4LDMwMS40MjE5IEM1ODYuNDY4OCwzMDEuODEyNSA1ODYuNSwzMDEuOTg0NCA1ODYuNTc4MSwzMDIuMTI1IEM1ODYuNzM0NCwzMDIuMzkwNiA1ODcuMDMxMywzMDIuNTMxMyA1ODcuMzEyNSwzMDIuNTMxMyBDNTg3LjU5MzgsMzAyLjUzMTMgNTg3Ljg0MzgsMzAyLjQwNjMgNTg4LjAxNTYsMzAyLjE4NzUgQzU4OC4xMjUsMzAyLjAxNTYgNTg4LjE1NjMsMzAxLjg3NSA1ODguMTU2MywzMDEuNDIxOSBMNTg4LjE1NjMsMjk5LjgyODEgTDU4OS45ODQ0LDI5OS44MjgxIEw1ODkuOTg0NCwzMDYuMzQzOCBMNTg4Ljg3NSwzMDYuMzQzOCBDNTg4LjQzNzUsMzA2LjM0MzggNTg4LjMxMjUsMzA2LjM1OTQgNTg4LjE1NjMsMzA2LjQ2ODggQzU4Ny45MDYzLDMwNi42MjUgNTg3Ljc1LDMwNi45MDYzIDU4Ny43NSwzMDcuMjAzMSBDNTg3Ljc1LDMwNy40NTMxIDU4Ny44OTA2LDMwNy43MTg4IDU4OC4xMDk0LDMwNy44NzUgQzU4OC4yNjU2LDMwOCA1ODguNDg0NCwzMDguMDQ2OSA1ODguODc1LDMwOC4wNDY5IEw1OTIuODEyNSwzMDguMDQ2OSBDNTkzLjE0MDYsMzA4LjA0NjkgNTkzLjQwNjMsMzA4IDU5My41MTU2LDMwNy45MjE5IEM1OTMuNzgxMywzMDcuNzgxMyA1OTMuOTIxOSwzMDcuNDg0NCA1OTMuOTIxOSwzMDcuMjAzMSBDNTkzLjkyMTksMzA2LjkyMTkgNTkzLjc5NjksMzA2LjY3MTkgNTkzLjU2MjUsMzA2LjUgQzU5My40MDYzLDMwNi4zNzUgNTkzLjI2NTYsMzA2LjM0MzggNTkyLjgxMjUsMzA2LjM0MzggTDU5MS42ODc1LDMwNi4zNDM4IEw1OTEuNjg3NSwyOTkuODI4MSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzIiB4PSI2MzkuMjUiIHk9IjI5OC45OTUxIj50YWJsZV8yPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOCIgeD0iNjExLjc1IiB5PSIzMTUuMjkyIj4oVGhpcyBpcyB0YWJsZSAyKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NDgiIHgyPSI4NTEiIHkxPSIzMjMuNTkzOCIgeTI9IjMyMy41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjEzIiB4PSI0NTMiIHk9IjM0MC41ODg5Ij5pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MyIgeD0iNDcwIiB5PSIzNDAuNTg4OSI+YmlnaW50PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1MCIgeD0iNDUzIiB5PSIzNTYuODg1NyI+dXNlcl9pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MiIgeD0iNTA3IiB5PSIzNTYuODg1NyI+YmlnaW50ICAmIzI5OTkyOyYjMjUxNDM7aWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijc3IiB4PSI0NTMiIHk9IjM3My4xODI2Ij51c2VyX25hbWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3IiB4PSI1MzQiIHk9IjM3My4xODI2Ij52YXJjaGFyICAmIzI5OTkyOyYjMjUxNDM7JiMyMTUxNzsmIzMxMjE2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNTQiIHg9IjQ1MyIgeT0iMzg5LjQ3OTUiPnByb2RfaWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTIiIHg9IjUxMSIgeT0iMzg5LjQ3OTUiPmJpZ2ludCAgJiMyMDEzNTsmIzIxNjk3O2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNiIgeD0iNDUzIiB5PSI0MDUuNzc2NCI+aW50ZXJlc3RfZGF0ZSBkYXRlTlVMTCYjMzU3NDU7JiMyNDY4NzsmIzI2MDg1OyYjMjYzOTk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI5NyIgeD0iNDUzIiB5PSI0MjIuMDczMiI+Y3JlYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iNTU0IiB5PSI0MjIuMDczMiI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyMTAxOTsmIzI0MzE0OyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjEwMSIgeD0iNDUzIiB5PSI0MzguMzcwMSI+dXBkYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iNTU4IiB5PSI0MzguMzcwMSI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyNjM1NjsmIzI2MDMyOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PC9nPjwhLS1jbGFzcyB0YWJsZV8zLS0+PGcgaWQ9ImVsZW1fdGFibGVfMyI+PHJlY3QgY29kZUxpbmU9IjMxIiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE2NC42NzE5IiBpZD0idGFibGVfMyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDA1IiB4PSI3IiB5PSIyODEiLz48ZWxsaXBzZSBjeD0iMTUwLjc1IiBjeT0iMzAyLjI5NjkiIGZpbGw9IiNGRkFBQUEiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMTUxLjE4NzUsMjk5LjgyODEgTDE1My4wMzEzLDI5OS44MjgxIEwxNTMuMDMxMywzMDEuNDIxOSBDMTUzLjAzMTMsMzAxLjgxMjUgMTUzLjA2MjUsMzAxLjk4NDQgMTUzLjE1NjMsMzAyLjEyNSBDMTUzLjMxMjUsMzAyLjM3NSAxNTMuNTkzOCwzMDIuNTMxMyAxNTMuODkwNiwzMDIuNTMxMyBDMTU0LjE1NjMsMzAyLjUzMTMgMTU0LjQwNjMsMzAyLjQwNjMgMTU0LjU3ODEsMzAyLjE4NzUgQzE1NC43MTg4LDMwMi4wMTU2IDE1NC43MzQ0LDMwMS44OTA2IDE1NC43MzQ0LDMwMS40MjE5IEwxNTQuNzM0NCwyOTguMTQwNiBMMTQ1Ljk2ODgsMjk4LjE0MDYgTDE0NS45Njg4LDMwMS40MjE5IEMxNDUuOTY4OCwzMDEuODEyNSAxNDYsMzAxLjk4NDQgMTQ2LjA3ODEsMzAyLjEyNSBDMTQ2LjIzNDQsMzAyLjM5MDYgMTQ2LjUzMTMsMzAyLjUzMTMgMTQ2LjgxMjUsMzAyLjUzMTMgQzE0Ny4wOTM4LDMwMi41MzEzIDE0Ny4zNDM4LDMwMi40MDYzIDE0Ny41MTU2LDMwMi4xODc1IEMxNDcuNjI1LDMwMi4wMTU2IDE0Ny42NTYzLDMwMS44NzUgMTQ3LjY1NjMsMzAxLjQyMTkgTDE0Ny42NTYzLDI5OS44MjgxIEwxNDkuNDg0NCwyOTkuODI4MSBMMTQ5LjQ4NDQsMzA2LjM0MzggTDE0OC4zNzUsMzA2LjM0MzggQzE0Ny45Mzc1LDMwNi4zNDM4IDE0Ny44MTI1LDMwNi4zNTk0IDE0Ny42NTYzLDMwNi40Njg4IEMxNDcuNDA2MywzMDYuNjI1IDE0Ny4yNSwzMDYuOTA2MyAxNDcuMjUsMzA3LjIwMzEgQzE0Ny4yNSwzMDcuNDUzMSAxNDcuMzkwNiwzMDcuNzE4OCAxNDcuNjA5NCwzMDcuODc1IEMxNDcuNzY1NiwzMDggMTQ3Ljk4NDQsMzA4LjA0NjkgMTQ4LjM3NSwzMDguMDQ2OSBMMTUyLjMxMjUsMzA4LjA0NjkgQzE1Mi42NDA2LDMwOC4wNDY5IDE1Mi45MDYzLDMwOCAxNTMuMDE1NiwzMDcuOTIxOSBDMTUzLjI4MTMsMzA3Ljc4MTMgMTUzLjQyMTksMzA3LjQ4NDQgMTUzLjQyMTksMzA3LjIwMzEgQzE1My40MjE5LDMwNi45MjE5IDE1My4yOTY5LDMwNi42NzE5IDE1My4wNjI1LDMwNi41IEMxNTIuOTA2MywzMDYuMzc1IDE1Mi43NjU2LDMwNi4zNDM4IDE1Mi4zMTI1LDMwNi4zNDM4IEwxNTEuMTg3NSwzMDYuMzQzOCBMMTUxLjE4NzUsMjk5LjgyODEgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMTk4Ljc1IiB5PSIyOTguOTk1MSI+dGFibGVfMzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkiIHg9IjE3MS4yNSIgeT0iMzE1LjI5MiI+KFRoaXMgaXMgdGFibGUgMyk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjQxMSIgeTE9IjMyMy41OTM4IiB5Mj0iMzIzLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iMTMiIHg9IjEzIiB5PSIzNDAuNTg4OSI+aWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjMwIiB5PSIzNDAuNTg4OSI+YmlnaW50PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1MCIgeD0iMTMiIHk9IjM1Ni44ODU3Ij51c2VyX2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSI2NyIgeT0iMzU2Ljg4NTciPmJpZ2ludCAgJiMyOTk5MjsmIzI1MTQzO2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI3NyIgeD0iMTMiIHk9IjM3My4xODI2Ij51c2VyX25hbWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3IiB4PSI5NCIgeT0iMzczLjE4MjYiPnZhcmNoYXIgICYjMjk5OTI7JiMyNTE0MzsmIzIxNTE3OyYjMzEyMTY7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMTMiIHk9IjM4OS40Nzk1Ij5wcm9kX2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSI3MSIgeT0iMzg5LjQ3OTUiPmJpZ2ludCAgJiMyMDEzNTsmIzIxNjk3O2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNiIgeD0iMTMiIHk9IjQwNS43NzY0Ij5pbnRlcmVzdF9kYXRlIGRhdGVOVUxMJiMzNTc0NTsmIzI0Njg3OyYjMjYwODU7JiMyNjM5OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijk3IiB4PSIxMyIgeT0iNDIyLjA3MzIiPmNyZWF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyODgiIHg9IjExNCIgeT0iNDIyLjA3MzIiPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QICYjMjEwMTk7JiMyNDMxNDsmIzI2MTAyOyYjMzgzODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMDEiIHg9IjEzIiB5PSI0MzguMzcwMSI+dXBkYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iMTE4IiB5PSI0MzguMzcwMSI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyNjM1NjsmIzI2MDMyOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PC9nPjwhLS1saW5rIHRhYmxlXzEgdG8gdGFibGVfMi0tPjxnIGlkPSJsaW5rX3RhYmxlXzFfdGFibGVfMiI+PHBhdGggY29kZUxpbmU9IjQxIiBkPSJNNTIzLjc1NywyMjEuMDM5IEM1NDEuNjAxLDI0MS4xMTMgNTU2LjAyMjksMjU3LjMzNzUgNTczLjA2MzksMjc2LjUwOTUgIiBmaWxsPSJub25lIiBpZD0idGFibGVfMS10by10YWJsZV8yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Ny4wNSwyODAuOTk0LDU3NC4wNjA2LDI3MS42MDk4LDU3My43MjgzLDI3Ny4yNTY5LDU2OC4wODEyLDI3Ni45MjQ2LDU3Ny4wNSwyODAuOTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4IiB4PSI1MjEuNTM5MSIgeT0iMjQwLjQ2MTgiPjE8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjUiIHg9IjU0NC40ODQxIiB5PSIyNzAuMDY1MyI+MC4uTjwvdGV4dD48L2c+PCEtLWxpbmsgdGFibGVfMSB0byB0YWJsZV8zLS0+PGcgaWQ9ImxpbmtfdGFibGVfMV90YWJsZV8zIj48cGF0aCBjb2RlTGluZT0iNDIiIGQ9Ik0zMzUuMjQzLDIyMS4wMzkgQzMxNy4zOTksMjQxLjExMyAzMDIuOTc3MSwyNTcuMzM3NSAyODUuOTM2MSwyNzYuNTA5NSAiIGZpbGw9Im5vbmUiIGlkPSJ0YWJsZV8xLXRvLXRhYmxlXzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjgxLjk1LDI4MC45OTQsMjkwLjkxODgsMjc2LjkyNDYsMjg1LjI3MTcsMjc3LjI1NjksMjg0LjkzOTQsMjcxLjYwOTgsMjgxLjk1LDI4MC45OTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgiIHg9IjMyMC45NDg0IiB5PSIyNDAuNDYxOCI+MTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNSIgeD0iMjYyLjI4OTMiIHk9IjI3MC4wNjUzIj4wLi5OPC90ZXh0PjwvZz48IS0tbGluayB0YWJsZV8zIHRvIHRhYmxlXzItLT48ZyBpZD0ibGlua190YWJsZV8zX3RhYmxlXzIiPjxwYXRoIGNvZGVMaW5lPSI0MyIgZD0iTTQxOC4zMTIsMzYzLjUgQzQyOS43NCwzNjMuNSA0MjkuMTY3LDM2My41IDQ0MC41OTQsMzYzLjUgIiBmaWxsPSJub25lIiBpZD0idGFibGVfMy10YWJsZV8yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQxMi4zMTIsMzYzLjUsNDIxLjMxMiwzNjcuNSw0MTcuMzEyLDM2My41LDQyMS4zMTIsMzU5LjUsNDEyLjMxMiwzNjMuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NDYuNTk0LDM2My41LDQzNy41OTQsMzU5LjUsNDQxLjU5NCwzNjMuNSw0MzcuNTk0LDM2Ny41LDQ0Ni41OTQsMzYzLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgiIHg9IjQxOS43NDQzIiB5PSIzNjAuMzA1NiI+MTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4IiB4PSI0MzEuMTU4MyIgeT0iMzYwLjMwNTYiPjE8L3RleHQ+PC9nPjwhLS1TUkM9W3hMSlZRemZHNTd4dGhwWkQ3WklXaFQ0dDJPNG9NWFlxQ1poeERXWkhORWpib09yQlJhZmIzRVIzZUFtODFTVlNMYWpQc04wQ3JsTDF0RDMxX1hhSnd0LW5jdlo2UUJPWXg3Tlg5Zm54cF9VVDdyekVpZ1FZQVlPOElhZlBHb2NZdzJZajhnbDJHcUxKQjBreTByMGl1Qm4zM2FHSEtnTnFsVXRqSk5Sbjg0YzlqTzFWRHg2a2MwdHYyTWdhWmRXR0F1UGNjMEtKZ1A5T2JleDRaUjhhUmxYZFN1ZkR5NUNSSFQwNzlhQjQwb3kxWUs1Yk9ja1EzeEt6VzJxYlFiWDVlMkRRQ3JIaGpoNGVDZjUxNnRMYTlNUmpLRXlmMnNkVzBraW5JUExnczBBc18xQ0dVOHZfMWVhbTByUHZBRUMzSjJXMGd5Qk1ZSW4wT2J2MXRKSEtzSEU1WHFGNWhER0tDeUpiT1pZbDUxdWU5V3FsTlpBUmw4TmM4TGptLW9FdFVtNTJtUmJ3eG5hSGlhS0xheWVLd3B3UmxHMW1jYnR0dy1MdS1ENXpzdFAtbGQxdzlzdmRDRXRxZW9uNHJCem85Z0VzVXR1SHZuWDRPbUJfZVQxaU9WcFpyTUp1WXpOZFRoeTR6ZDlfYzVJRGtHeDk5OG83RlFWVDc4ekU5Z0ZNR2ZmM1BDZVFyWjVUcDc4cFUzY3pGOS0gLUV0TUUxb25iTzBXaVRva204cTRnOWI4ZWtrckhQUlJWdl90emxSc2pPYWFrRlRaVFViSlF0N3E4S1A5VExyU2NGTVN0TXo3SG9PTVphdWtESmt3RXFMYWVtTUJESHZzSnJ2X1R1LXpPWk82TXZjZzZTcXZSYXp2ck5GajhtOWRpVmEyc1BuLTFITU1sTFJfVnVseEVwaXRMMXhWdnBVcnlNWGdxYklMclppLVNxSjAtRm9sQnd2eHJ0SlZOT0cwY1RLcGhWQVhyRmdQcl9oX01fd0hyeUZpM0prMG82T2RCaGd5TkVHVzYtb3ZkRmQzY0ZBVU9xTDJMQ2VHR2tkeTNdLS0+PC9nPjwvc3ZnPg=='>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>er</tag>
        <tag>plantuml</tag>
      </tags>
  </entry>
  <entry>
    <title>docker单点kafka扩容</title>
    <url>/2018/06/28/docker-kafka-broker/</url>
    <content><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>公司为了快速上线，几个月前通过docker镜像 <a href="https://hub.docker.com/r/wurstmeister/kafka/">kafka</a> 部署了一台kafka-borker。Dockerfile如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM wurstmeister&#x2F;kafka:latest</span><br><span class="line"></span><br><span class="line">ENV KAFKA_MESSAGE_MAX_BYTES&#x3D;21474836</span><br><span class="line">ENV KAFKA_AUTO_CREATE_TOPICS_ENABLE&#x3D;true</span><br><span class="line">ENV KAFKA_CREATE_TOPICS&#x3D;test:1:1</span><br><span class="line">ENV KAFKA_ZOOKEEPER_CONNECT&#x3D;zk1:2181</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;&#x2F;kafka&quot;]</span><br></pre></td></tr></table></figure>

<p>随着业务的增长，单节点的kafka-broker已经成为一个潜在的可靠性隐患。所以借着N年难得一遇的停机维护，决定把kafka-broker扩容为主备集群模式，提升稳定性，并为日后的分区扩容提供可能(不停服)。</p>
<span id="more"></span>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>除了单节点问题，docker的镜像配置也存在几个问题。</p>
<h4 id="未指定broker-id"><a href="#未指定broker-id" class="headerlink" title="未指定broker.id"></a>未指定broker.id</h4><p>broker.id是kafka-broker的唯一标识，选举、服务查找等操作都是基于此标识。如果没有显式的指定，kafka-broker会由zk生成并下发一个大于1000的id，如:(1001)，并保存在kafka-broker本地的meta.properties文件中。如果手动指定broker.id是无法指定大于1000的值。测试环境每次会执行rm -rf操作，但是zk不会同时操作。所以每次重启的brokerId都会+1。为了方便后续管理，需要指定brokerId。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">KafkaServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (brokerIdSet.size &gt; <span class="number">1</span>)</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">InconsistentBrokerIdException</span>(</span><br><span class="line">            <span class="string">s&quot;Failed to match broker.id across log.dirs. This could happen if multiple brokers shared a log directory (log.dirs) &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;or partial data was manually copied from another broker. Found <span class="subst">$brokerIdSet</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (brokerId &gt;= <span class="number">0</span> &amp;&amp; brokerIdSet.size == <span class="number">1</span> &amp;&amp; brokerIdSet.last != brokerId)</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">InconsistentBrokerIdException</span>(</span><br><span class="line">            <span class="string">s&quot;Configured broker.id <span class="subst">$brokerId</span> doesn&#x27;t match stored broker.id <span class="subst">$&#123;brokerIdSet.last&#125;</span> in meta.properties. &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;If you moved your data, make sure your configured broker.id matches. &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;If you intend to create a new broker, you should remove all data in your data directories (log.dirs).&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (brokerIdSet.isEmpty &amp;&amp; brokerId &lt; <span class="number">0</span> &amp;&amp; config.brokerIdGenerationEnable) <span class="comment">// generate a new brokerId from Zookeeper</span></span><br><span class="line">          brokerId = generateBrokerId</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (brokerIdSet.size == <span class="number">1</span>) <span class="comment">// pick broker.id from meta.properties</span></span><br><span class="line">          brokerId = brokerIdSet.last</span><br><span class="line">      </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Return a sequence id generated by updating the broker sequence id path in ZK.</span></span><br><span class="line"><span class="comment">    * Users can provide brokerId in the config. To avoid conflicts between ZK generated</span></span><br><span class="line"><span class="comment">    * sequence id and configured brokerId, we increment the generated sequence id by KafkaConfig.MaxReservedBrokerId.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">generateBrokerId</span></span>: <span class="type">Int</span> = &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      zkClient.generateBrokerSequenceId() + config.maxReservedBrokerId</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt;</span><br><span class="line">        error(<span class="string">&quot;Failed to generate broker.id due to &quot;</span>, e)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">GenerateBrokerIdException</span>(<span class="string">&quot;Failed to generate broker.id&quot;</span>, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="开启自动创建topic"><a href="#开启自动创建topic" class="headerlink" title="开启自动创建topic"></a>开启自动创建topic</h4><p>通过<code>KAFKA_AUTO_CREATE_TOPICS_ENABLE</code>开启自动创建topic，会在producer发送消息时创建topic，但是不会指定partition和replica。需要关闭此配置，统一由运维人员审核创建。</p>
<h4 id="镜像采用了latest标签"><a href="#镜像采用了latest标签" class="headerlink" title="镜像采用了latest标签"></a>镜像采用了latest标签</h4><p>开发环境可以使用到最近的镜像，但是生产环境使用此tag，容易造成版本不一致。本次升级过程中遇到的问题，就是基于此，后面会详细介绍。</p>
<h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h3><ol>
<li>制作Dockerfile，修改环境变量。</li>
<li>停止producer应用</li>
<li>观察consumer应用消费完成</li>
<li>部署broker2</li>
<li>修改测试topic的replica并同步数据</li>
<li>观察测试topic在broker2中的数据及zk节点元数据</li>
<li>测试producer及consumer</li>
<li>批量执行replica脚本</li>
<li>删除broker1数据并重新部署</li>
<li>启动应用</li>
</ol>
<h4 id="制作Dockerfile，修改环境变量。"><a href="#制作Dockerfile，修改环境变量。" class="headerlink" title="制作Dockerfile，修改环境变量。"></a>制作Dockerfile，修改环境变量。</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM wurstmeister&#x2F;kafka:latest</span><br><span class="line"></span><br><span class="line">BROKER_ID_COMMAND&#x3D;&quot;echo 2&quot;</span><br><span class="line">ENV KAFKA_MESSAGE_MAX_BYTES&#x3D;21474836</span><br><span class="line">ENV KAFKA_AUTO_CREATE_TOPICS_ENABLE&#x3D;false</span><br><span class="line">ENV KAFKA_ZOOKEEPER_CONNECT&#x3D;zk1:2181,zk2:2181,zk3:2181</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;&#x2F;kafka&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="停止producer应用-amp-观察consumer应用消费完成"><a href="#停止producer应用-amp-观察consumer应用消费完成" class="headerlink" title="停止producer应用 &amp; 观察consumer应用消费完成"></a>停止producer应用 &amp; 观察consumer应用消费完成</h4><p>进入broker docker容器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker exec -it kafka-broker1 bash</span><br></pre></td></tr></table></figure>

<p>查看group列表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list</span><br></pre></td></tr></table></figure>

<p>查看group的消费情况</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092  --group group_name --describe</span><br></pre></td></tr></table></figure>

<p>可以看到 </p>
<table>
<thead>
<tr>
<th>TOPIC</th>
<th>PARTITION</th>
<th>CURRENT-OFFSET</th>
<th>LOG-END-OFFSET</th>
<th>LAG</th>
<th>CONSUMER-ID</th>
<th>HOST</th>
<th>CLIENT-ID</th>
</tr>
</thead>
<tbody><tr>
<td>test</td>
<td>0</td>
<td>6901</td>
<td>6901</td>
<td>0</td>
<td>consumer-1-80496f05-3be9-49c3-8b84-45c26f07a4aa /172.20.0.1</td>
<td>consumer-1</td>
<td>consumer-1</td>
</tr>
</tbody></table>
<p><code>LAG = LOG-END-OFFSET - CURRENT-OFFSET</code>，如果LAG=0，则表示消息已经消费完成。</p>
<h4 id="部署broker2"><a href="#部署broker2" class="headerlink" title="部署broker2"></a>部署broker2</h4><p>可以将<code>BROKER_ID_COMMAND</code>等环境变量信息，通过 <code>docker run -e</code>的形式执行，本次通过Dockerfile设置，每个broker对应一个Dockerfile。</p>
<h4 id="修改测试topic的replica并同步数据"><a href="#修改测试topic的replica并同步数据" class="headerlink" title="修改测试topic的replica并同步数据"></a>修改测试topic的replica并同步数据</h4><p>通过kafka-reassign-partitions.sh脚本进行replica重分配，分配规则以json文件保存。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">    &quot;version&quot;:1,</span><br><span class="line">    &quot;partitions&quot;:</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;topic&quot;</span>: <span class="string">&quot;test.topic.1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;partition&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;replicas&quot;</span>: [<span class="number">1001</span>,<span class="number">2</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;topic&quot;</span>: <span class="string">&quot;test.topic.1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;partition&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;replicas&quot;</span>: [<span class="number">1001</span>,<span class="number">2</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/opt/kafka/bin/kafka-reassign-partitions.sh  --zookeeper  zk1:2181,zk2:2181,zk3:2181 </span><br><span class="line">\ --reassignment-json-file test.topic.1.json </span><br><span class="line">\ --execute</span><br></pre></td></tr></table></figure>

<p>此时出现了故障，因为Dockerfile使用了lastest标签<code>FROM wurstmeister/kafka:latest</code>导致获取到的版本高于生产环境的broker版本，此时日志提示版本问题，无法同步，且<code>kafka-reassign-partitions</code>一直处于<code>pending</code>状态，无法再次执行。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">There is an existing assignment running.</span><br></pre></td></tr></table></figure>

<p>解决方案</p>
<h5 id="查找kafka-reassign-partitions强制终止命令"><a href="#查找kafka-reassign-partitions强制终止命令" class="headerlink" title="查找kafka-reassign-partitions强制终止命令"></a>查找kafka-reassign-partitions强制终止命令</h5><p>查看源码<code>ReassignPartitionsCommand</code>，只找到<code>verify</code>，没有关闭操作。</p>
<h5 id="删除zk对应节点"><a href="#删除zk对应节点" class="headerlink" title="删除zk对应节点"></a>删除zk对应节点</h5><p><code>kafka-reassign-partitions</code>指定了zk地址，查找在zk中保存的元数据信息，并删除。</p>
<p><code>kafka/core/src/main/scala/kafka/zk/ZkData.scala</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">object ReassignPartitionsZNode &#123;</span><br><span class="line">  def path &#x3D; s&quot;$&#123;AdminZNode.path&#125;&#x2F;reassign_partitions&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>zk命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">delete /admin/reassign_partitions</span><br></pre></td></tr></table></figure>

<h5 id="修改dockerfile版本后重新执行kafka-reassign-partitions"><a href="#修改dockerfile版本后重新执行kafka-reassign-partitions" class="headerlink" title="修改dockerfile版本后重新执行kafka-reassign-partitions"></a>修改dockerfile版本后重新执行kafka-reassign-partitions</h5><p>再次执行<code>kafka-reassign-partitions</code>，很快执行完成，并在broker2中观察到对应数据。</p>
<h4 id="批量执行replica脚本"><a href="#批量执行replica脚本" class="headerlink" title="批量执行replica脚本"></a>批量执行replica脚本</h4><p>批量脚本内容如下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">KFK_CMD=&#x27;/opt/kafka/bin/kafka-reassign-partitions.sh  </span><br><span class="line">\ --zookeeper zk1:2181,zk2:2181,zk3:2181 </span><br><span class="line">\ --reassignment-json-file&#x27;</span><br><span class="line">CHK_CMD=&#x27;/opt/kafka/bin/kafka-topics.sh </span><br><span class="line">\ --describe </span><br><span class="line">\ --zookeeper zk1:2181,zk2:2181,zk3:2181 </span><br><span class="line">\ --topic &#x27;</span><br><span class="line"></span><br><span class="line">topic_list=&#x27;</span><br><span class="line">test.topic.1</span><br><span class="line">test.topic.2</span><br><span class="line">test.topic.3</span><br><span class="line">test.topic.4</span><br><span class="line">test.topic.5</span><br><span class="line">__consumer_offsets</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">for i in $topic_list</span><br><span class="line">do</span><br><span class="line">    $KFK_CMD $i.json --execute</span><br><span class="line">    sleep 2</span><br><span class="line">    $CHK_CMD i</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>需要提前准备好分配json，并已topic命名，如 <strong>__consumer_offsets.json</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;partitions&quot;</span>:</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;topic&quot;</span>: <span class="string">&quot;__consumer_offsets&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;partition&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;replicas&quot;</span>: [<span class="number">1001</span>,<span class="number">2</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;topic&quot;</span>: <span class="string">&quot;__consumer_offsets&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;partition&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;replicas&quot;</span>: [<span class="number">1001</span>,<span class="number">2</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除broker1数据并重新部署"><a href="#删除broker1数据并重新部署" class="headerlink" title="删除broker1数据并重新部署"></a>删除broker1数据并重新部署</h4><p>删除broker1镜像数据并重新制作Dockerfile升级。一定要删除镜像数据，否者会优先读取本地的meta.properties，环境变量不会生效。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>至此，docker下单节点kafka扩容有惊无险的完成了。</p>
]]></content>
      <categories>
        <category>devops</category>
      </categories>
      <tags>
        <tag>kafka</tag>
        <tag>docker</tag>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring 嵌入式轻量消息队列</title>
    <url>/2020/05/05/embedded-spring-mq/</url>
    <content><![CDATA[<p>为Spring-boot提供消息队列能力的starter, 并提供了VM线程的轻量级实现。<br>项目地址: <a href="https://github.com/wangyuheng/embedded-mq-spring-boot-starter">https://github.com/wangyuheng/embedded-mq-spring-boot-starter</a></p>
<h2 id="什么是消息队列"><a href="#什么是消息队列" class="headerlink" title="什么是消息队列"></a>什么是消息队列</h2><p>消息队列是用于存放消息的容器，可供消费者取出消息进行消费。</p>
<span id="more"></span>

<h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><blockquote>
<p>观察者（Observer）模式的定义：指多个对象间存在一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。这种模式有时又称作发布-订阅模式、模型-视图模式，它是对象行为型模式。</p>
</blockquote>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0MTNweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjc4OHB4O2hlaWdodDo0MTNweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA3ODggNDEzIiB3aWR0aD0iNzg4cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciBPYnNlcnZlcig/Pz8/PyktLT48ZyBpZD0iY2x1c3Rlcl9PYnNlcnZlcigmIzM1MjY2OyYjMjM1MTk7JiMzMjc3MzsmIzI3MTY5OyYjMjQzMzU7KSI+PHBhdGggZD0iTTguNSw2IEwxNjkuNSw2IEEzLjc1LDMuNzUgMCAwIDEgMTcyLDguNSBMMTc5LDI4LjI5NjkgTDc3OC41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgNzgxLDMwLjc5NjkgTDc4MSw0MDMuNSBBMi41LDIuNSAwIDAgMSA3NzguNSw0MDYgTDguNSw0MDYgQTIuNSwyLjUgMCAwIDEgNiw0MDMuNSBMNiw4LjUgQTIuNSwyLjUgMCAwIDEgOC41LDYgIiBmaWxsPSIjREREREREIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2IiB4Mj0iMTc5IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYwIiB4PSIxMCIgeT0iMjAuOTk1MSI+T2JzZXJ2ZXIoJiMzNTI2NjsmIzIzNTE5OyYjMzI3NzM7JiMyNzE2OTsmIzI0MzM1Oyk8L3RleHQ+PC9nPjwhLS1jbGFzcyBTdWJqZWN0LS0+PGcgaWQ9ImVsZW1fU3ViamVjdCI+PHJlY3QgY29kZUxpbmU9IjIiIGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTM3Ljc1IiBpZD0iU3ViamVjdCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTYyIiB4PSIxMzEiIHk9IjQxIi8+PGVsbGlwc2UgY3g9IjE3Ny43NSIgY3k9IjYxLjEzMjgiIGZpbGw9IiNGRjc3MDAiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMTc5LjgyODEsNjIuOTQ1MyBMMTgwLjIxODgsNjMuOTI5NyBMMTc5LjgyODEsNjMuOTI5NyBDMTc5LjM3NSw2My45Mjk3IDE3OS4yNjU2LDYzLjk0NTMgMTc5LjEwOTQsNjQuMDU0NyBDMTc4Ljg1OTQsNjQuMjEwOSAxNzguNzAzMSw2NC40OTIyIDE3OC43MDMxLDY0Ljc4OTEgQzE3OC43MDMxLDY1LjA1NDcgMTc4Ljg0MzgsNjUuMzA0NyAxNzkuMDYyNSw2NS40NjA5IEMxNzkuMjAzMSw2NS41ODU5IDE3OS40MDYzLDY1LjYzMjggMTc5LjgyODEsNjUuNjMyOCBMMTgyLjE4NzUsNjUuNjMyOCBDMTgyLjU0NjksNjUuNjMyOCAxODIuNzY1Niw2NS42MDE2IDE4Mi45MDYzLDY1LjUwNzggQzE4My4xNTYzLDY1LjM2NzIgMTgzLjMxMjUsNjUuMDcwMyAxODMuMzEyNSw2NC43ODkxIEMxODMuMzEyNSw2NC41MDc4IDE4My4xNzE5LDY0LjI1NzggMTgyLjk1MzEsNjQuMTAxNiBDMTgyLjc4MTMsNjMuOTYwOSAxODIuNjI1LDYzLjkyOTcgMTgyLjE1NjMsNjMuOTI5NyBMMTc4Ljc2NTYsNTUuNzI2NiBMMTc1LjA5MzgsNTUuNzI2NiBDMTc0LjY0MDYsNTUuNzI2NiAxNzQuNTE1Niw1NS43NDIyIDE3NC4zNTk0LDU1LjgzNTkgQzE3NC4xMDk0LDU2LjAwNzggMTczLjk1MzEsNTYuMjg5MSAxNzMuOTUzMSw1Ni41NzAzIEMxNzMuOTUzMSw1Ni44NTE2IDE3NC4wOTM4LDU3LjEwMTYgMTc0LjMxMjUsNTcuMjczNCBDMTc0LjQ4NDQsNTcuMzgyOCAxNzQuNjU2Myw1Ny40MTQxIDE3NS4wOTM4LDU3LjQxNDEgTDE3Ni4xNzE5LDU3LjQxNDEgTDE3My41MzEzLDYzLjkyOTcgQzE3My4xMDk0LDYzLjkyOTcgMTcyLjk1MzEsNjMuOTQ1MyAxNzIuNzk2OSw2NC4wNTQ3IEMxNzIuNTQ2OSw2NC4yMTA5IDE3Mi4zOTA2LDY0LjQ5MjIgMTcyLjM5MDYsNjQuNzg5MSBDMTcyLjM5MDYsNjUuMzUxNiAxNzIuNzY1Niw2NS42MzI4IDE3My41MTU2LDY1LjYzMjggTDE3NS43ODEzLDY1LjYzMjggQzE3Ni4xNDA2LDY1LjYzMjggMTc2LjM1OTQsNjUuNjAxNiAxNzYuNDg0NCw2NS41MDc4IEMxNzYuNzUsNjUuMzY3MiAxNzYuODkwNiw2NS4wNzAzIDE3Ni44OTA2LDY0Ljc4OTEgQzE3Ni44OTA2LDY0LjUwNzggMTc2Ljc2NTYsNjQuMjU3OCAxNzYuNTQ2OSw2NC4wODU5IEMxNzYuMzc1LDYzLjk2MDkgMTc2LjIzNDQsNjMuOTI5NyAxNzUuNzgxMyw2My45Mjk3IEwxNzUuMzkwNiw2My45Mjk3IEwxNzUuNzgxMyw2Mi45NDUzIEwxNzkuODI4MSw2Mi45NDUzIFogTTE3OS4xMjUsNjEuMjQyMiBMMTc2LjQ1MzEsNjEuMjQyMiBMMTc3Ljc5NjksNTcuOTc2NiBMMTc5LjEyNSw2MS4yNDIyIFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NCIgeD0iMTk2LjI1IiB5PSI1Ny4xMzg3Ij4mIzE3MTthYnN0cmFjdCYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NSIgeD0iMjAwLjc1IiB5PSI3Mi45NjM5Ij5TdWJqZWN0PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEzMiIgeDI9IjI5MiIgeTE9IjgxLjI2NTYiIHkyPSI4MS4yNjU2Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSI2IiB4PSIxMzkiIHk9IjkxLjkxNDEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MSIgeD0iMTUxIiB5PSI5OC4yNjA3Ij5vYnNlcnZlcnM8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTMyIiB4Mj0iMjkyIiB5MT0iMTA1LjU2MjUiIHkyPSIxMDUuNTYyNSIvPjxlbGxpcHNlIGN4PSIxNDIiIGN5PSIxMTkuMjEwOSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDIiIHg9IjE1MSIgeT0iMTIyLjU1NzYiPmFkZE9ic2VydmVyKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE0MiIgY3k9IjEzNS41MDc4IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMyIgeD0iMTUxIiB5PSIxMzguODU0NSI+ZGVsZXRlT2JzZXJ2ZXIoKTwvdGV4dD48ZWxsaXBzZSBjeD0iMTQyIiBjeT0iMTUxLjgwNDciIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE5IiB4PSIxNTEiIHk9IjE1NS4xNTE0Ij5ub3RpZnlPYnNlcnZlcigpPC90ZXh0PjxlbGxpcHNlIGN4PSIxNDIiIGN5PSIxNjguMTAxNiIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzYiIHg9IjE1MSIgeT0iMTcxLjQ0ODIiPmdldFN1YmplY3RTdGF0dXMoKTwvdGV4dD48L2c+PGcgaWQ9ImVsZW1fR01ONCI+PHBhdGggZD0iTTIyLjUsOTcuNSBMMjIuNSwxMjIuNjMyOCBBMCwwIDAgMCAwIDIyLjUsMTIyLjYzMjggTDk1LjUsMTIyLjYzMjggQTAsMCAwIDAgMCA5NS41LDEyMi42MzI4IEw5NS41LDExNS41IEwxMzAuNzIsMTEwIEw5NS41LDEwNy41IEw5NS41LDEwNy41IEw4NS41LDk3LjUgTDIyLjUsOTcuNSBBMCwwIDAgMCAwIDIyLjUsOTcuNSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik04NS41LDk3LjUgTDg1LjUsMTA3LjUgTDk1LjUsMTA3LjUgTDg1LjUsOTcuNSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyIiB4PSIyOC41IiB5PSIxMTQuNTY2OSI+JiMyNTI3NzsmIzM1OTM3OyYjMjAwMjc7JiMzOTA2NDs8L3RleHQ+PC9nPjwhLS1jbGFzcyBDb25jcmV0ZVN1YmplY3QtLT48ZyBpZD0iZWxlbV9Db25jcmV0ZVN1YmplY3QiPjxyZWN0IGNvZGVMaW5lPSIxMiIgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI2NC4yOTY5IiBpZD0iQ29uY3JldGVTdWJqZWN0IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjIiIHg9IjEzMSIgeT0iMjQwIi8+PGVsbGlwc2UgY3g9IjE0OS42IiBjeT0iMjU2IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTE1MS45NDM4LDI1MS42NzE5IEMxNTEuMDA2MywyNTEuMjM0NCAxNTAuNDEyNSwyNTEuMDkzOCAxNDkuNTM3NSwyNTEuMDkzOCBDMTQ2LjkxMjUsMjUxLjA5MzggMTQ0LjkxMjUsMjUzLjE3MTkgMTQ0LjkxMjUsMjU1Ljg5MDYgTDE0NC45MTI1LDI1Ny4wMTU2IEMxNDQuOTEyNSwyNTkuNTkzOCAxNDcuMDIxOSwyNjEuNDg0NCAxNDkuOTEyNSwyNjEuNDg0NCBDMTUxLjEzMTMsMjYxLjQ4NDQgMTUyLjI4NzUsMjYxLjE4NzUgMTUzLjAzNzUsMjYwLjY0MDYgQzE1My42MTU2LDI2MC4yMzQ0IDE1My45NDM4LDI1OS43ODEzIDE1My45NDM4LDI1OS4zOTA2IEMxNTMuOTQzOCwyNTguOTM3NSAxNTMuNTUzMSwyNTguNTQ2OSAxNTMuMDg0NCwyNTguNTQ2OSBDMTUyLjg2NTYsMjU4LjU0NjkgMTUyLjY2MjUsMjU4LjYyNSAxNTIuNDc1LDI1OC44MTI1IEMxNTIuMDIxOSwyNTkuMjk2OSAxNTIuMDIxOSwyNTkuMjk2OSAxNTEuODM0NCwyNTkuMzkwNiBDMTUxLjQxMjUsMjU5LjY1NjMgMTUwLjcyNSwyNTkuNzgxMyAxNDkuOTU5NCwyNTkuNzgxMyBDMTQ3LjkxMjUsMjU5Ljc4MTMgMTQ2LjYxNTYsMjU4LjY4NzUgMTQ2LjYxNTYsMjU2Ljk4NDQgTDE0Ni42MTU2LDI1NS44OTA2IEMxNDYuNjE1NiwyNTQuMTA5NCAxNDcuODY1NiwyNTIuNzk2OSAxNDkuNiwyNTIuNzk2OSBDMTUwLjE3ODEsMjUyLjc5NjkgMTUwLjc4NzUsMjUyLjk1MzEgMTUxLjI1NjMsMjUzLjIwMzEgQzE1MS43NDA2LDI1My40ODQ0IDE1MS45MTI1LDI1My43MDMxIDE1Mi4wMDYzLDI1NC4xMDk0IEMxNTIuMDY4OCwyNTQuNTE1NiAxNTIuMSwyNTQuNjQwNiAxNTIuMjQwNiwyNTQuNzY1NiBDMTUyLjM4MTMsMjU0LjkwNjMgMTUyLjYxNTYsMjU1LjAxNTYgMTUyLjgzNDQsMjU1LjAxNTYgQzE1My4xLDI1NS4wMTU2IDE1My4zNjU2LDI1NC44NzUgMTUzLjUzNzUsMjU0LjY1NjMgQzE1My42NDY5LDI1NC41IDE1My42NzgxLDI1NC4zMTI1IDE1My42NzgxLDI1My44OTA2IEwxNTMuNjc4MSwyNTIuNDY4OCBDMTUzLjY3ODEsMjUyLjAzMTMgMTUzLjY2MjUsMjUxLjkwNjMgMTUzLjU2ODgsMjUxLjc1IEMxNTMuNDEyNSwyNTEuNDg0NCAxNTMuMTMxMywyNTEuMzQzOCAxNTIuODM0NCwyNTEuMzQzOCBDMTUyLjUzNzUsMjUxLjM0MzggMTUyLjMzNDQsMjUxLjQzNzUgMTUyLjExNTYsMjUxLjc1IEwxNTEuOTQzOCwyNTEuNjcxOSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMiIgeD0iMTY0LjQiIHk9IjI2MC44NDY3Ij5Db25jcmV0ZVN1YmplY3Q8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTMyIiB4Mj0iMjkyIiB5MT0iMjcyIiB5Mj0iMjcyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTMyIiB4Mj0iMjkyIiB5MT0iMjgwIiB5Mj0iMjgwIi8+PGVsbGlwc2UgY3g9IjE0MiIgY3k9IjI5My42NDg0IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNiIgeD0iMTUxIiB5PSIyOTYuOTk1MSI+Z2V0U3ViamVjdFN0YXR1cygpPC90ZXh0PjwvZz48ZyBpZD0iZWxlbV9HTU44Ij48cGF0aCBkPSJNMTc1LjUsMzY1IEwxNzUuNSwzOTAuMTMyOCBBMCwwIDAgMCAwIDE3NS41LDM5MC4xMzI4IEwyNDguNSwzOTAuMTMyOCBBMCwwIDAgMCAwIDI0OC41LDM5MC4xMzI4IEwyNDguNSwzNzUgTDIzOC41LDM2NSBMMjE2LDM2NSBMMjEyLDMwNC4wNTMgTDIwOCwzNjUgTDE3NS41LDM2NSBBMCwwIDAgMCAwIDE3NS41LDM2NSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yMzguNSwzNjUgTDIzOC41LDM3NSBMMjQ4LjUsMzc1IEwyMzguNSwzNjUgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MiIgeD0iMTgxLjUiIHk9IjM4Mi4wNjY5Ij4mIzIwODU1OyYjMjAzMDc7JiMyMDAyNzsmIzM5MDY0OzwvdGV4dD48L2c+PCEtLWNsYXNzIE9ic2VydmVyLS0+PGcgaWQ9ImVsZW1fT2JzZXJ2ZXIiPjxyZWN0IGNvZGVMaW5lPSIxOCIgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI3Mi41NjI1IiBpZD0iT2JzZXJ2ZXIiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI2NiIgeD0iMzc4IiB5PSI3My41Ii8+PGVsbGlwc2UgY3g9IjQ3My43NSIgY3k9IjkzLjYzMjgiIGZpbGw9IiNGRjc3MDAiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNDc0LjcwMzEsOTAuNDE0MSBMNDc2LjQyMTksOTAuNDE0MSBDNDc2LjgxMjUsOTAuNDE0MSA0NzcsOTAuMzgyOCA0NzcuMTI1LDkwLjMwNDcgQzQ3Ny4zOTA2LDkwLjE0ODQgNDc3LjUzMTMsODkuODY3MiA0NzcuNTMxMyw4OS41NzAzIEM0NzcuNTMxMyw4OS4zMDQ3IDQ3Ny40MjE5LDg5LjAzOTEgNDc3LjE4NzUsODguODY3MiBDNDc3LjAxNTYsODguNzU3OCA0NzYuODc1LDg4LjcyNjYgNDc2LjQyMTksODguNzI2NiBMNDcxLjI4MTMsODguNzI2NiBDNDcwLjg0MzgsODguNzI2NiA0NzAuNzE4OCw4OC43NDIyIDQ3MC41NjI1LDg4LjgzNTkgQzQ3MC4zMTI1LDg4Ljk5MjIgNDcwLjE1NjMsODkuMjg5MSA0NzAuMTU2Myw4OS41NzAzIEM0NzAuMTU2Myw4OS44NTE2IDQ3MC4yOTY5LDkwLjEwMTYgNDcwLjUxNTYsOTAuMjczNCBDNDcwLjY3MTksOTAuMzgyOCA0NzAuODU5NCw5MC40MTQxIDQ3MS4yODEzLDkwLjQxNDEgTDQ3Myw5MC40MTQxIEw0NzMsOTYuOTI5NyBMNDcxLjI4MTMsOTYuOTI5NyBDNDcwLjg0MzgsOTYuOTI5NyA0NzAuNzE4OCw5Ni45NDUzIDQ3MC41NjI1LDk3LjA1NDcgQzQ3MC4zMTI1LDk3LjIxMDkgNDcwLjE1NjMsOTcuNDkyMiA0NzAuMTU2Myw5Ny43ODkxIEM0NzAuMTU2Myw5OC4wMzkxIDQ3MC4yOTY5LDk4LjMwNDcgNDcwLjUxNTYsOTguNDYwOSBDNDcwLjY3MTksOTguNTg1OSA0NzAuODc1LDk4LjYzMjggNDcxLjI4MTMsOTguNjMyOCBMNDc2LjQyMTksOTguNjMyOCBDNDc3LjE3MTksOTguNjMyOCA0NzcuNTMxMyw5OC4zNTE2IDQ3Ny41MzEzLDk3Ljc4OTEgQzQ3Ny41MzEzLDk3LjUwNzggNDc3LjQyMTksOTcuMjU3OCA0NzcuMTg3NSw5Ny4wODU5IEM0NzcuMDE1Niw5Ni45NjA5IDQ3Ni44NzUsOTYuOTI5NyA0NzYuNDIxOSw5Ni45Mjk3IEw0NzQuNzAzMSw5Ni45Mjk3IEw0NzQuNzAzMSw5MC40MTQxIFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NyIgeD0iNDkzLjc1IiB5PSI4OS42Mzg3Ij4mIzE3MTtpbnRlcmZhY2UmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjYiIHg9IjQ5NC4yNSIgeT0iMTA1LjQ2MzkiPk9ic2VydmVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM3OSIgeDI9IjY0MyIgeTE9IjExMy43NjU2IiB5Mj0iMTEzLjc2NTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNzkiIHgyPSI2NDMiIHkxPSIxMjEuNzY1NiIgeTI9IjEyMS43NjU2Ii8+PGVsbGlwc2UgY3g9IjM4OSIgY3k9IjEzNS40MTQxIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0MCIgeD0iMzk4IiB5PSIxMzguNzYwNyI+dXBkYXRlKE9ic2VydmFibGUgbywgT2JqZWN0IGFyZyk8L3RleHQ+PC9nPjxnIGlkPSJlbGVtX0dNTjEyIj48cGF0aCBkPSJNNjc5LDk3LjUgTDY3OSwxMDYgTDY0NC4xMTEsMTEwIEw2NzksMTE0IEw2NzksMTIyLjYzMjggQTAsMCAwIDAgMCA2NzksMTIyLjYzMjggTDc2NSwxMjIuNjMyOCBBMCwwIDAgMCAwIDc2NSwxMjIuNjMyOCBMNzY1LDEwNy41IEw3NTUsOTcuNSBMNjc5LDk3LjUgQTAsMCAwIDAgMCA2NzksOTcuNSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03NTUsOTcuNSBMNzU1LDEwNy41IEw3NjUsMTA3LjUgTDc1NSw5Ny41ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUiIHg9IjY4NSIgeT0iMTE0LjU2NjkiPiYjMjUyNzc7JiMzNTkzNzsmIzM1MjY2OyYjMjM1MTk7JiMzMjc3Mzs8L3RleHQ+PC9nPjwhLS1jbGFzcyBDb25jcmV0ZU9ic2VydmVyLS0+PGcgaWQ9ImVsZW1fQ29uY3JldGVPYnNlcnZlciI+PHJlY3QgY29kZUxpbmU9IjI0IiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjY0LjI5NjkiIGlkPSJDb25jcmV0ZU9ic2VydmVyIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjUiIHg9IjQyOC41IiB5PSIyNDAiLz48ZWxsaXBzZSBjeD0iNDQzLjUiIGN5PSIyNTYiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNDQ1Ljg0MzgsMjUxLjY3MTkgQzQ0NC45MDYzLDI1MS4yMzQ0IDQ0NC4zMTI1LDI1MS4wOTM4IDQ0My40Mzc1LDI1MS4wOTM4IEM0NDAuODEyNSwyNTEuMDkzOCA0MzguODEyNSwyNTMuMTcxOSA0MzguODEyNSwyNTUuODkwNiBMNDM4LjgxMjUsMjU3LjAxNTYgQzQzOC44MTI1LDI1OS41OTM4IDQ0MC45MjE5LDI2MS40ODQ0IDQ0My44MTI1LDI2MS40ODQ0IEM0NDUuMDMxMywyNjEuNDg0NCA0NDYuMTg3NSwyNjEuMTg3NSA0NDYuOTM3NSwyNjAuNjQwNiBDNDQ3LjUxNTYsMjYwLjIzNDQgNDQ3Ljg0MzgsMjU5Ljc4MTMgNDQ3Ljg0MzgsMjU5LjM5MDYgQzQ0Ny44NDM4LDI1OC45Mzc1IDQ0Ny40NTMxLDI1OC41NDY5IDQ0Ni45ODQ0LDI1OC41NDY5IEM0NDYuNzY1NiwyNTguNTQ2OSA0NDYuNTYyNSwyNTguNjI1IDQ0Ni4zNzUsMjU4LjgxMjUgQzQ0NS45MjE5LDI1OS4yOTY5IDQ0NS45MjE5LDI1OS4yOTY5IDQ0NS43MzQ0LDI1OS4zOTA2IEM0NDUuMzEyNSwyNTkuNjU2MyA0NDQuNjI1LDI1OS43ODEzIDQ0My44NTk0LDI1OS43ODEzIEM0NDEuODEyNSwyNTkuNzgxMyA0NDAuNTE1NiwyNTguNjg3NSA0NDAuNTE1NiwyNTYuOTg0NCBMNDQwLjUxNTYsMjU1Ljg5MDYgQzQ0MC41MTU2LDI1NC4xMDk0IDQ0MS43NjU2LDI1Mi43OTY5IDQ0My41LDI1Mi43OTY5IEM0NDQuMDc4MSwyNTIuNzk2OSA0NDQuNjg3NSwyNTIuOTUzMSA0NDUuMTU2MywyNTMuMjAzMSBDNDQ1LjY0MDYsMjUzLjQ4NDQgNDQ1LjgxMjUsMjUzLjcwMzEgNDQ1LjkwNjMsMjU0LjEwOTQgQzQ0NS45Njg4LDI1NC41MTU2IDQ0NiwyNTQuNjQwNiA0NDYuMTQwNiwyNTQuNzY1NiBDNDQ2LjI4MTMsMjU0LjkwNjMgNDQ2LjUxNTYsMjU1LjAxNTYgNDQ2LjczNDQsMjU1LjAxNTYgQzQ0NywyNTUuMDE1NiA0NDcuMjY1NiwyNTQuODc1IDQ0Ny40Mzc1LDI1NC42NTYzIEM0NDcuNTQ2OSwyNTQuNSA0NDcuNTc4MSwyNTQuMzEyNSA0NDcuNTc4MSwyNTMuODkwNiBMNDQ3LjU3ODEsMjUyLjQ2ODggQzQ0Ny41NzgxLDI1Mi4wMzEzIDQ0Ny41NjI1LDI1MS45MDYzIDQ0Ny40Njg4LDI1MS43NSBDNDQ3LjMxMjUsMjUxLjQ4NDQgNDQ3LjAzMTMsMjUxLjM0MzggNDQ2LjczNDQsMjUxLjM0MzggQzQ0Ni40Mzc1LDI1MS4zNDM4IDQ0Ni4yMzQ0LDI1MS40Mzc1IDQ0Ni4wMTU2LDI1MS43NSBMNDQ1Ljg0MzgsMjUxLjY3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMiIHg9IjQ1Ny41IiB5PSIyNjAuODQ2NyI+Q29uY3JldGVPYnNlcnZlcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MjkuNSIgeDI9IjU5Mi41IiB5MT0iMjcyIiB5Mj0iMjcyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDI5LjUiIHgyPSI1OTIuNSIgeTE9IjI4MCIgeTI9IjI4MCIvPjxlbGxpcHNlIGN4PSI0MzkuNSIgY3k9IjI5My42NDg0IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMCIgeD0iNDQ4LjUiIHk9IjI5Ni45OTUxIj51cGRhdGUoT2JqZWN0KTwvdGV4dD48L2c+PGcgaWQ9ImVsZW1fR01OMTYiPjxwYXRoIGQ9Ik00NjgsMzY1IEw0NjgsMzkwLjEzMjggQTAsMCAwIDAgMCA0NjgsMzkwLjEzMjggTDU1NCwzOTAuMTMyOCBBMCwwIDAgMCAwIDU1NCwzOTAuMTMyOCBMNTU0LDM3NSBMNTQ0LDM2NSBMNTE1LDM2NSBMNTExLDMwNC4wNTMgTDUwNywzNjUgTDQ2OCwzNjUgQTAsMCAwIDAgMCA0NjgsMzY1ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTU0NCwzNjUgTDU0NCwzNzUgTDU1NCwzNzUgTDU0NCwzNjUgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NSIgeD0iNDc0IiB5PSIzODIuMDY2OSI+JiMyMDg1NTsmIzIwMzA3OyYjMzUyNjY7JiMyMzUxOTsmIzMyNzczOzwvdGV4dD48L2c+PCEtLXJldmVyc2UgbGluayBTdWJqZWN0IHRvIENvbmNyZXRlU3ViamVjdC0tPjxnIGlkPSJsaW5rX1N1YmplY3RfQ29uY3JldGVTdWJqZWN0Ij48cGF0aCBjb2RlTGluZT0iMzAiIGQ9Ik0yMTIsMTk3LjMxOSBDMjEyLDIxOC4zODMgMjEyLDIyMi41NTEgMjEyLDIzOS44MTIgIiBmaWxsPSJub25lIiBpZD0iU3ViamVjdC1iYWNrdG8tQ29uY3JldGVTdWJqZWN0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9IjIxMiwxNzkuMzE5LDIwNiwxOTcuMzE5LDIxOCwxOTcuMzE5LDIxMiwxNzkuMzE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBTdWJqZWN0IHRvIE9ic2VydmVyLS0+PGcgaWQ9ImxpbmtfU3ViamVjdF9PYnNlcnZlciI+PHBhdGggY29kZUxpbmU9IjMxIiBkPSJNMzA1LjMwOCwxMTAgQzMzMS40MiwxMTAgMzQ5LjA2NSwxMTAgMzc3Ljg4OCwxMTAgIiBmaWxsPSJub25lIiBpZD0iU3ViamVjdC1iYWNrdG8tT2JzZXJ2ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMjkzLjMwOCwxMTAsMjk5LjMwOCwxMTQsMzA1LjMwOCwxMTAsMjk5LjMwOCwxMDYsMjkzLjMwOCwxMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4IiB4PSIzMTEuNSIgeT0iMTAzLjA2NjkiPk5vdGlmaWVzPC90ZXh0PjwvZz48IS0tcmV2ZXJzZSBsaW5rIE9ic2VydmVyIHRvIENvbmNyZXRlT2JzZXJ2ZXItLT48ZyBpZD0ibGlua19PYnNlcnZlcl9Db25jcmV0ZU9ic2VydmVyIj48cGF0aCBjb2RlTGluZT0iMzIiIGQ9Ik01MTEsMTY0LjUwOSBDNTExLDE5Mi40OTcgNTExLDIxMy4xMzcgNTExLDIzOS45MTMgIiBmaWxsPSJub25lIiBpZD0iT2JzZXJ2ZXItYmFja3RvLUNvbmNyZXRlT2JzZXJ2ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Ny4wLDcuMDsiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9IjUxMSwxNDYuNTA5LDUwNSwxNjQuNTA5LDUxNywxNjQuNTA5LDUxMSwxNDYuNTA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLVNSQz1bQXFYQ3BhdkNKckxHeWF5Z0pZcWdJb3RJVUI2eXdVZHctSXlRTWYtak1GWHFKeC1jYWVBbzJuV2VMN0NmMDQ1b0pjOW5pSzltUUw5TVFkQTlaT3MyWGdFRWlma1JrUmMxV1FQMk9iOW5JTDVZU2VjVDdMV2ZIOERrRmpKZU9aMU5FcDRiMU13UDlhR2U5SktkaklHTE5KR2xsb0dwaEg5VEQzc3IxNmZ2UzRiWUlNYW5MQm1NSjBBcmYyaGFmQVFMTTJheXd6aHhPa0YyOXBqc2xybXEwb283djdoZF9CcGE4ZzJESzhFRzc0azR5S2R2OUlOdmtMT0FKcmt0RnpheDZSaTVDNFUzbWlTSjRKd1BVSU1mSE1jOW9RYWUwUUhUTWYySU05QWcwVDZLYzlJSmdmMmwwcEcydjBZNW5BOXEzMVNLUFFQZG03cThab3lrQjF3NGtHRWhSSTNwMlZXRXBOMWVvMlpPckVaZ09XcjRjODl5TlIwUlRVNDFPUU5XMXVoRHA1SDg4ZTA5MHF0SXF5RHFSSXEwXS0tPjwvZz48L3N2Zz4='>

<p><code>Observer</code>本来的意思是<strong>观察者</strong>，但具体的实现中并不是主动去观察，而是被动的接收来自<code>Subject</code>的通知，所以更合适的名字应该是”消息投递”。<br>而且通知的模式还存在一个<strong>弊端</strong>: 通知及多个<code>ConcreteObserver</code>的消费程序仍在一个同步线程内，所以只是代码结构层面的解耦，底层还是一个事务内。<br>为了解决这个<strong>弊端</strong>，将消息的发送及N个消费程序拆分为N+1个事务，所以引入消息队列用于存储<code>Subject</code>。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyMTJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjMwNXB4O2hlaWdodDoyMTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzMDUgMjEyIiB3aWR0aD0iMzA1cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjQ2LjI2NTYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE4NyIgeD0iMTAiIHk9IjUzLjI5NjkiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjQ2LjI2NTYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIwMCIgeD0iOTkuNSIgeT0iMTEzLjU2MjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iNTkiIHgyPSI1OSIgeTE9IjM2LjI5NjkiIHkyPSIxNzYuODI4MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIxMzUuNSIgeDI9IjEzNS41IiB5MT0iMzYuMjk2OSIgeTI9IjE3Ni44MjgxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjIxMy41IiB4Mj0iMjEzLjUiIHkxPSIzNi4yOTY5IiB5Mj0iMTc2LjgyODEiLz48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc5IiB4PSIyMCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSIyNyIgeT0iMjQuOTk1MSI+cHJvZHVjZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3OSIgeD0iMjAiIHk9IjE3NS44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUiIHg9IjI3IiB5PSIxOTUuODIzMiI+cHJvZHVjZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1MiIgeD0iMTA5LjUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOCIgeD0iMTE2LjUiIHk9IjI0Ljk5NTEiPnN0b3JlPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTIiIHg9IjEwOS41IiB5PSIxNzUuODI4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM4IiB4PSIxMTYuNSIgeT0iMTk1LjgyMzIiPnN0b3JlPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODQiIHg9IjE3MS41IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAiIHg9IjE3OC41IiB5PSIyNC45OTUxIj5jb25zdW1lcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0IiB4PSIxNzEuNSIgeT0iMTc1LjgyODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MCIgeD0iMTc4LjUiIHk9IjE5NS44MjMyIj5jb25zdW1lcjwvdGV4dD48cGF0aCBkPSJNMTAsNTMuMjk2OSBMNzYsNTMuMjk2OSBMNzYsNjAuNDI5NyBMNjYsNzAuNDI5NyBMMTAsNzAuNDI5NyBMMTAsNTMuMjk2OSAiIGZpbGw9IiNFRUVFRUUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNDYuMjY1NiIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTg3IiB4PSIxMCIgeT0iNTMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMSIgeD0iMjUiIHk9IjY2LjM2MzgiPmFsdDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAxIiB4PSI5MSIgeT0iNjUuNTA3MyI+W3RyYW5zYWN0aW9uIDFdPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTIzLjUsODcuNTYyNSwxMzMuNSw5MS41NjI1LDEyMy41LDk1LjU2MjUsMTI3LjUsOTEuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTkuNSIgeDI9IjEyOS41IiB5MT0iOTEuNTYyNSIgeTI9IjkxLjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MiIgeD0iNjYuNSIgeT0iODYuNDk2NiI+JiMyMTQ1NzsmIzM2ODY1OyYjMjU5Njg7JiMyNTQ1NDs8L3RleHQ+PHBhdGggZD0iTTk5LjUsMTEzLjU2MjUgTDE3Ny41LDExMy41NjI1IEwxNzcuNSwxMjAuNjk1MyBMMTY3LjUsMTMwLjY5NTMgTDk5LjUsMTMwLjY5NTMgTDk5LjUsMTEzLjU2MjUgIiBmaWxsPSIjRUVFRUVFIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjQ2LjI2NTYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIwMCIgeD0iOTkuNSIgeT0iMTEzLjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMiIHg9IjExNC41IiB5PSIxMjYuNjI5NCI+bG9vcDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyIiB4PSIxOTIuNSIgeT0iMTI1Ljc3MjkiPlt0cmFuc2FjdGlvbiBOXTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0Ni41LDE0Ny44MjgxLDEzNi41LDE1MS44MjgxLDE0Ni41LDE1NS44MjgxLDE0Mi41LDE1MS44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNDAuNSIgeDI9IjIxMi41IiB5MT0iMTUxLjgyODEiIHkyPSIxNTEuODI4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4IiB4PSIxNTIuNSIgeT0iMTQ2Ljc2MjIiPnB1bGwmIzI1OTY4OyYjMjU0NTQ7PC90ZXh0PjwhLS1TUkM9W0l5bWZLSVdmSWltaEphbWtvU3BGS3AzYUtXMjJXZ0J5YkRCYXIyODVOSms1dWZCeWViSWhmX3FKTnBPcUZma3d1TGRsRWd4S2wxSWtkRnB5MFhJVFZjMlRPREtBRGhlQW9WYnZuUU12Z0tMTTJXTWJFSmE4WkcwMF0tLT48L2c+PC9zdmc+'>

<h2 id="领域模型设计"><a href="#领域模型设计" class="headerlink" title="领域模型设计"></a>领域模型设计</h2><ul>
<li>罗列领域概念</li>
</ul>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyMTZweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQwOXB4O2hlaWdodDoyMTZweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0MDkgMjE2IiB3aWR0aD0iNDA5cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciBDb250ZXh0LS0+PGcgaWQ9ImNsdXN0ZXJfQ29udGV4dCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyMDMiIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIzOTYiIHg9IjciIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjQiIHg9IjE3MyIgeT0iMjYuOTk1MSI+Q29udGV4dDwvdGV4dD48L2c+PCEtLWVudGl0eSBjb25zdW1lci0tPjxnIGlkPSJlbGVtX2NvbnN1bWVyIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjIzLDUyLDMzLDQyLDEzMyw0MiwxMzMsNzguMjk2OSwxMjMsODguMjk2OSwyMyw4OC4yOTY5LDIzLDUyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjMiIHgyPSIxMzMiIHkxPSI1MiIgeTI9IjQyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjMiIHgyPSIxMjMiIHkxPSI1MiIgeTI9IjUyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTIzIiB4Mj0iMTIzIiB5MT0iNTIiIHkyPSI4OC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAiIHg9IjM4IiB5PSI3NC45OTUxIj5jb25zdW1lcjwvdGV4dD48L2c+PCEtLWVudGl0eSBwcm9kdWNlci0tPjxnIGlkPSJlbGVtX3Byb2R1Y2VyIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjE2OC41LDUyLDE3OC41LDQyLDI3My41LDQyLDI3My41LDc4LjI5NjksMjYzLjUsODguMjk2OSwxNjguNSw4OC4yOTY5LDE2OC41LDUyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNjMuNSIgeDI9IjI3My41IiB5MT0iNTIiIHkyPSI0MiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE2OC41IiB4Mj0iMjYzLjUiIHkxPSI1MiIgeTI9IjUyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjYzLjUiIHgyPSIyNjMuNSIgeTE9IjUyIiB5Mj0iODguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSIxODMuNSIgeT0iNzQuOTk1MSI+cHJvZHVjZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3RvcmUtLT48ZyBpZD0iZWxlbV9zdG9yZSI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIzMDksNTIsMzE5LDQyLDM4Nyw0MiwzODcsNzguMjk2OSwzNzcsODguMjk2OSwzMDksODguMjk2OSwzMDksNTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM3NyIgeDI9IjM4NyIgeTE9IjUyIiB5Mj0iNDIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzMDkiIHgyPSIzNzciIHkxPSI1MiIgeTI9IjUyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzc3IiB4Mj0iMzc3IiB5MT0iNTIiIHkyPSI4OC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzgiIHg9IjMyNCIgeT0iNzQuOTk1MSI+c3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdG9waWMtLT48ZyBpZD0iZWxlbV90b3BpYyI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIyNiwxNTgsMzYsMTQ4LDEwNCwxNDgsMTA0LDE4NC4yOTY5LDk0LDE5NC4yOTY5LDI2LDE5NC4yOTY5LDI2LDE1OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTQiIHgyPSIxMDQiIHkxPSIxNTgiIHkyPSIxNDgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNiIgeDI9Ijk0IiB5MT0iMTU4IiB5Mj0iMTU4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTQiIHgyPSI5NCIgeTE9IjE1OCIgeTI9IjE5NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzgiIHg9IjQxIiB5PSIxODAuOTk1MSI+dG9waWM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdHJhbnNwb3J0LS0+PGcgaWQ9ImVsZW1fdHJhbnNwb3J0Ij48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjEzOS41LDE1OCwxNDkuNSwxNDgsMjQ4LjUsMTQ4LDI0OC41LDE4NC4yOTY5LDIzOC41LDE5NC4yOTY5LDEzOS41LDE5NC4yOTY5LDEzOS41LDE1OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjM4LjUiIHgyPSIyNDguNSIgeTE9IjE1OCIgeTI9IjE0OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEzOS41IiB4Mj0iMjM4LjUiIHkxPSIxNTgiIHkyPSIxNTgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMzguNSIgeDI9IjIzOC41IiB5MT0iMTU4IiB5Mj0iMTk0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OSIgeD0iMTU0LjUiIHk9IjE4MC45OTUxIj50cmFuc3BvcnQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbWVzc2FnZS0tPjxnIGlkPSJlbGVtX21lc3NhZ2UiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjgzLjUsMTU4LDI5My41LDE0OCwzODYuNSwxNDgsMzg2LjUsMTg0LjI5NjksMzc2LjUsMTk0LjI5NjksMjgzLjUsMTk0LjI5NjksMjgzLjUsMTU4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNzYuNSIgeDI9IjM4Ni41IiB5MT0iMTU4IiB5Mj0iMTQ4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjgzLjUiIHgyPSIzNzYuNSIgeTE9IjE1OCIgeTI9IjE1OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM3Ni41IiB4Mj0iMzc2LjUiIHkxPSIxNTgiIHkyPSIxOTQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYzIiB4PSIyOTguNSIgeT0iMTgwLjk5NTEiPm1lc3NhZ2U8L3RleHQ+PC9nPjwhLS1TUkM9W0pPcjEyaTBXMzBKbGxZQnViUnY0RDlHVXA0ZUlHSVp6VXh0NWxTcVNQaXNYdk1SQTV5SHZVUU90cVB3V0NMTThwU3VRUFlaUWhBVW43VTEwbnRaZ1dMaDQxakgzVEpSUlotZHgwRzAwXS0tPjwvZz48L3N2Zz4='>

<ul>
<li>梳理交互关系</li>
</ul>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzNDFweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjI5NnB4O2hlaWdodDozNDFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyOTYgMzQxIiB3aWR0aD0iMjk2cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciBDb250ZXh0LS0+PGcgaWQ9ImNsdXN0ZXJfQ29udGV4dCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIzMjgiIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIyODMiIHg9IjciIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjQiIHg9IjExNi41IiB5PSIyNi45OTUxIj5Db250ZXh0PC90ZXh0PjwvZz48IS0tZW50aXR5IGNvbnN1bWVyLS0+PGcgaWQ9ImVsZW1fY29uc3VtZXIiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTY0LDUyLDE3NCw0MiwyNzQsNDIsMjc0LDc4LjI5NjksMjY0LDg4LjI5NjksMTY0LDg4LjI5NjksMTY0LDUyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNjQiIHgyPSIyNzQiIHkxPSI1MiIgeTI9IjQyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTY0IiB4Mj0iMjY0IiB5MT0iNTIiIHkyPSI1MiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI2NCIgeDI9IjI2NCIgeTE9IjUyIiB5Mj0iODguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwIiB4PSIxNzkiIHk9Ijc0Ljk5NTEiPmNvbnN1bWVyPC90ZXh0PjwvZz48IS0tZW50aXR5IHByb2R1Y2VyLS0+PGcgaWQ9ImVsZW1fcHJvZHVjZXIiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjMuNSw1MiwzMy41LDQyLDEyOC41LDQyLDEyOC41LDc4LjI5NjksMTE4LjUsODguMjk2OSwyMy41LDg4LjI5NjksMjMuNSw1MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTE4LjUiIHgyPSIxMjguNSIgeTE9IjUyIiB5Mj0iNDIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMy41IiB4Mj0iMTE4LjUiIHkxPSI1MiIgeTI9IjUyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTE4LjUiIHgyPSIxMTguNSIgeTE9IjUyIiB5Mj0iODguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSIzOC41IiB5PSI3NC45OTUxIj5wcm9kdWNlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBzdG9yZS0tPjxnIGlkPSJlbGVtX3N0b3JlIj48cGF0aCBkPSJNOTgsMjg0IEM5OCwyNzQgMTI3LDI3NCAxMjcsMjc0IEMxMjcsMjc0IDE1NiwyNzQgMTU2LDI4NCBMMTU2LDMwOS4yOTY5IEMxNTYsMzE5LjI5NjkgMTI3LDMxOS4yOTY5IDEyNywzMTkuMjk2OSBDMTI3LDMxOS4yOTY5IDk4LDMxOS4yOTY5IDk4LDMwOS4yOTY5IEw5OCwyODQgIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNOTgsMjg0IEM5OCwyOTQgMTI3LDI5NCAxMjcsMjk0IEMxMjcsMjk0IDE1NiwyOTQgMTU2LDI4NCAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM4IiB4PSIxMDgiIHk9IjMxMC45OTUxIj5zdG9yZTwvdGV4dD48L2c+PCEtLWVudGl0eSB0cmFuc3BvcnQtLT48ZyBpZD0iZWxlbV90cmFuc3BvcnQiPjxlbGxpcHNlIGN4PSIxMjciIGN5PSIxODEiIGZpbGw9IiNGMUYxRjEiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMywxNjksMTI5LDE2NCwxMjcsMTY5LDEyOSwxNzQsMTIzLDE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkiIHg9IjkyLjUiIHk9IjIwOS45OTUxIj50cmFuc3BvcnQ8L3RleHQ+PC9nPjwhLS1saW5rIHByb2R1Y2VyIHRvIHRyYW5zcG9ydC0tPjxnIGlkPSJsaW5rX3Byb2R1Y2VyX3RyYW5zcG9ydCI+PHBhdGggZD0iTTYxLjQzNjQsODguMjEgQzU0LjI1MzUsMTAyLjEyNyA0OC41NjQ4LDEyMC4xNzIgNTYsMTM1IEM2My43MjE5LDE1MC40IDczLjE4ODcsMTU5LjI5MDUgODcuMTE5NywxNjcuOTk1NSAiIGZpbGw9Im5vbmUiIGlkPSJwcm9kdWNlci10by10cmFuc3BvcnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTIuMjA4LDE3MS4xNzUsODYuNjk1MiwxNjMuMDEzNSw4Ny45Njc4LDE2OC41MjU0LDgyLjQ1NTksMTY5Ljc5NzksOTIuMjA4LDE3MS4xNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk0IiB4PSI1NyIgeT0iMTMxLjA2NjkiPnNlbmQgbWVzc2FnZTwvdGV4dD48L2c+PCEtLWxpbmsgdHJhbnNwb3J0IHRvIHN0b3JlLS0+PGcgaWQ9ImxpbmtfdHJhbnNwb3J0X3N0b3JlIj48cGF0aCBkPSJNMTE2LjIzNSwyMTMuMTUyIEMxMTMuNTEzLDIzMS4yMjggMTEyLjYyNzUsMjUwLjIzNjMgMTE1LjUwNDUsMjY3LjkxOSAiIGZpbGw9Im5vbmUiIGlkPSJ0cmFuc3BvcnQtdG8tc3RvcmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTE2LjQ2OCwyNzMuODQxMSwxMTguOTcwOCwyNjQuMzE1NSwxMTUuNjY1MSwyNjguOTA2LDExMS4wNzQ2LDI2NS42MDAzLDExNi40NjgsMjczLjg0MTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIHRyYW5zcG9ydCB0byBzdG9yZS0tPjxnIGlkPSJsaW5rX3RyYW5zcG9ydF9zdG9yZSI+PHBhdGggZD0iTTEzOS4zNDM3LDIxOS4wNzcyIEMxNDIuMjI1NywyMzcuMTUzMiAxNDEuMTk4LDI1Ni4xNTg0IDEzOC4xNTEsMjczLjg0MTEgIiBmaWxsPSJub25lIiBpZD0idHJhbnNwb3J0LWJhY2t0by1zdG9yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzguMzk5LDIxMy4xNTIsMTM1Ljg2NTksMjIyLjY2OTUsMTM5LjE4NjIsMjE4LjA4OTYsMTQzLjc2NjIsMjIxLjQwOTksMTM4LjM5OSwyMTMuMTUyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBjb25zdW1lciB0byB0cmFuc3BvcnQtLT48ZyBpZD0ibGlua19jb25zdW1lcl90cmFuc3BvcnQiPjxwYXRoIGQ9Ik0xOTguNzI2Niw5Mi44ODM3IEMxODIuMzY0NiwxMTQuNTgyNyAxNjEuMTEzLDE0Mi43NjMgMTQ0LjQ3NSwxNjQuODI2ICIgZmlsbD0ibm9uZSIgaWQ9ImNvbnN1bWVyLWJhY2t0by10cmFuc3BvcnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjAyLjMzOSw4OC4wOTMsMTkzLjcyNjYsOTIuODcwOCwxOTkuMzI4Nyw5Mi4wODUyLDIwMC4xMTQyLDk3LjY4NzMsMjAyLjMzOSw4OC4wOTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc3IiB4PSIxODAiIHk9IjEzMS4wNjY5Ij5wdWxsIGJ5IHRvcGljPC90ZXh0PjwvZz48IS0tU1JDPVtOS3l4MmlDbTNEcnpZYVRzTm8xM2J2eDRpS0tmOTlRblBEZklVbFNRYVNJYk1ZSlVKdjhlcnQwWko1VkVJYS1UeTdSZWJKYUg4Y1RmNnpNMWJDZ2ZuSHI5R1NDSVgyMHpYMHBnM2dzeUdjbDhLaFlnZU8ycm1tb1YtOTd6UFFYYzJFTTRaS0p3Q0lPLWtMQ3pqalc0dHlmbG5oX0JzRUUzNlFNakF2T05iQ2l6RWxWdjBXMDBdLS0+PC9nPjwvc3ZnPg=='>

<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><ol>
<li><code>LinkedBlockingQueue</code> 作为存储Message的容器。</li>
<li>Store用于存储消息。为了兼容多个<code>Consumer</code>，每个<code>Consumer</code>指定一个唯一标识作为<code>Partition Key</code>，对应唯一的一个<code>LinkedBlockingQueue</code>。 e.g. <code>Map&lt;Partition, LinkedBlockingQueue&lt;Message&gt;&gt; messageQueueMap = new ConcurrentHashMap&lt;&gt;();</code></li>
<li><code>Producer</code> 通过 <code>Transport</code> 将消息发送只多个<code>Partition Key</code>的<code>LinkedBlockingQueue</code>队列中</li>
<li>每个<code>Consumer</code>开启一个线程，通过轮询方式从<code>LinkedBlockingQueue</code>队列中消费消息。</li>
</ol>
<h3 id="代码片段"><a href="#代码片段" class="headerlink" title="代码片段"></a>代码片段</h3><ul>
<li>VmStore</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Map&lt;Partition, LinkedBlockingQueue&lt;Message&gt;&gt; messageQueueMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">append</span><span class="params">(Message message, Partition partition)</span> </span>&#123;</span><br><span class="line">    initQueue(partition);</span><br><span class="line">    messageQueueMap.get(partition).add(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LinkedBlockingQueue&lt;Message&gt; <span class="title">findByPartition</span><span class="params">(Partition partition)</span> </span>&#123;</span><br><span class="line">    initQueue(partition);</span><br><span class="line">    <span class="keyword">return</span> messageQueueMap.get(partition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initQueue</span><span class="params">(Partition partition)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!messageQueueMap.containsKey(partition)) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!messageQueueMap.containsKey(partition)) &#123;</span><br><span class="line">                messageQueueMap.put(partition, <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Transport</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String topic = message.getTopic();</span><br><span class="line">    topicClientIdMap.get(topic).forEach(clientId -&gt; &#123;</span><br><span class="line">        Partition partition = <span class="keyword">new</span> Partition(clientId, topic);</span><br><span class="line">        store.append(message, partition);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ConsumerCluster</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开启消费线程</span></span><br><span class="line"><span class="comment"> *  只能开启一次</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(Store store)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!initialized.get()) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            SimpleAsyncTaskExecutor taskExecutor = <span class="keyword">new</span> SimpleAsyncTaskExecutor();</span><br><span class="line">            taskExecutor.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">            taskExecutor.execute(<span class="keyword">new</span> ConsumerListener(<span class="keyword">this</span>.getMessageHandler(), store.findByPartition(<span class="keyword">this</span>.generatePartition())));</span><br><span class="line">            initialized.set(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关闭消费线程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    liveToggle.set(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 暂停消费</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    runToggle.set(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重启暂停的消费线程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    runToggle.set(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConsumerListener</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MessageHandler handler;</span><br><span class="line">    <span class="keyword">private</span> LinkedBlockingQueue&lt;Message&gt; queue;</span><br><span class="line"></span><br><span class="line">    ConsumerListener(MessageHandler handler, LinkedBlockingQueue&lt;Message&gt; queue) &#123;</span><br><span class="line">        <span class="keyword">this</span>.handler = handler;</span><br><span class="line">        <span class="keyword">this</span>.queue = queue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!liveToggle.get()) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (runToggle.get()) &#123;</span><br><span class="line">                    Message message = queue.poll();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">null</span> == message) &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        handler.handle(message);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>LinkedBlockingQueue</code>却未使用<code>take</code>方法的原因是为了灵活控制消费线程的启停。</p>
<h2 id="spring集成"><a href="#spring集成" class="headerlink" title="spring集成"></a>spring集成</h2><p>为了方便使用，通过<code>annotation</code>的形式与spring框架进行集成。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li>Consumer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Consumer(topic = CONSUMER_TOPIC, id = CUSTOM_CONSUMER_ID)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumerMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">    consumerRecordMap.get(CUSTOM_CONSUMER_ID).add(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Producer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DefaultProducer&lt;String&gt; producer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">    producer.send(<span class="keyword">new</span> Message&lt;&gt;(CUSTOM_TOPIC, <span class="string">&quot;This is a message!&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注册消费者bean</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Consumer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> MessageHandler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Store</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerBeanDefinitionRegistryPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span>, <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConfigurableApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = (ConfigurableApplicationContext) applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        Class&lt;?&gt; targetClass = AopProxyUtils.ultimateTargetClass(bean);</span><br><span class="line">        Method[] methods = ReflectionUtils.getAllDeclaredMethods(targetClass);</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            <span class="keyword">if</span> (AnnotatedElementUtils.hasAnnotation(method, Consumer.class)) &#123;</span><br><span class="line">                <span class="keyword">final</span> String topic = method.getAnnotation(Consumer.class).topic();</span><br><span class="line">                <span class="keyword">final</span> String id = StringUtils.isEmpty(method.getAnnotation(Consumer.class).id()) ? beanName + method.getName() : method.getAnnotation(Consumer.class).id();</span><br><span class="line">                <span class="keyword">final</span> BeanFactory beanFactory = applicationContext.getBeanFactory();</span><br><span class="line">                <span class="keyword">final</span> Store store = beanFactory.getBean(Store.class);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> MessageHandler messageHandler = message -&gt; ReflectionUtils.invokeMethod(method, bean, message);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> BeanDefinitionBuilder beanDefinitionBuilder = BeanDefinitionBuilder.genericBeanDefinition(ConsumerCluster.class, () -&gt; &#123;</span><br><span class="line">                    ConsumerCluster consumerCluster = <span class="keyword">new</span> ConsumerCluster();</span><br><span class="line">                    consumerCluster.setId(id);</span><br><span class="line">                    consumerCluster.setTopic(topic);</span><br><span class="line">                    consumerCluster.setMessageHandler(messageHandler);</span><br><span class="line">                    consumerCluster.start(store);</span><br><span class="line">                    <span class="keyword">return</span> consumerCluster;</span><br><span class="line">                &#125;);</span><br><span class="line">                BeanDefinition beanDefinition = beanDefinitionBuilder.getRawBeanDefinition();</span><br><span class="line">                ((DefaultListableBeanFactory) beanFactory).registerBeanDefinition(beanName + method.getName() + <span class="string">&quot;Listener&quot;</span>, beanDefinition);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>如何跨应用消费？通过Mysql、Redis等公共存储替换Store及Transport实现。Mysql需要考虑行锁。</li>
</ol>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>springboot</tag>
        <tag>starter</tag>
      </tags>
  </entry>
  <entry>
    <title>Java训练一个手写数字识别的DeepLearning模型</title>
    <url>/2021/03/24/first/</url>
    <content><![CDATA[<p>情景: 听说AI很火，DeepLearning很厉害，想来了解一下。于是满怀热情地打开一片文章。。。5分钟后，很快啊，就被各种概念、数学公式劝退了。想尝试运行一下代码，又被各种python、C++折磨。</p>
<span id="more"></span>

<p>工程思维习惯先跑起来再慢慢调试了解。为了顺利迈出第一步，接下来尝试用java &amp; 小学概念来训练一个手写数字识别的DeepLearning模型。</p>
<p>完整代码: <a href="https://github.com/wangyuheng/my-first-deep-learning-model-by-java">https://github.com/wangyuheng/my-first-deep-learning-model-by-java</a></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>程序开发过程，其实是对现实的一种抽象，并翻译成电脑可以理解的语言，让电脑运行。<br>但是有些事物并不是那么确定且容易描述的，比如：如何向电脑描述图片中的数字？</p>
<p><img src="https://img.yuheng.wang/mweb/first_00.png" alt="first_00"></p>
<p>我们可以一眼就识别出这个数字，但是没办法反推并描述这个过程。走一步算一步吧，先把代码写起来。<br>从程序开发角度，我们会定义一个接口函数，明确这个函数的输入、输出。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Integer <span class="title">recognition</span><span class="params">(Image img)</span></span>;</span><br></pre></td></tr></table></figure>

<p>但是在实现函数时，感觉无从下手。这时就需要DeepLearning来帮助我们完成这个函数。可以认为模型就是这个函数的实现，而训练模型的过程就是编写(or 发现)这个函数。</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>训练模型的过程是让DeepLearning去发现一个函数，我们需要描述这个函数长什么样。</p>
<h3 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h3><p>首先，我们会定义这个模型的输入和输出。<br>图像大小为28x28，因为是灰度图，每个像素点只有黑白两种状态。用一个标识来描述处于某种状态，则模型的输入为一个大小为28x28的一维数组。预期的输出为数字识别，所以结果为0-9共10个数字，可以认为输出是一个大小为10的一维数组。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[<span class="number">10</span>] recognition(<span class="keyword">byte</span>[<span class="number">28</span>*<span class="number">28</span>] img);</span><br></pre></td></tr></table></figure>

<p><img src="https://img.yuheng.wang/mweb/first_01.png" alt="first_01"></p>
<p>因为不知道如何描述这个映射关系，所以我们采用了另一种方式: 并不定义实现，而是拿一些已有数据，让模型自己总结其中的规律。</p>
<p>比如，输入一个数字6的图片，告诉模型这张图片最终会映射为6。也就是说我们的输入包括两部分图像本身(Data)和表示的内容6(Label)。</p>
<p>在模型训练的过程中需要使用大量的数据(Data+Label)，这一批数据称之为数据集(Dataset)。而数据集因为作用不同，又会被划分为</p>
<ol>
<li>训练集</li>
<li>验证集</li>
<li>测试集</li>
</ol>
<p>这3个概念非常符合我们的学习过程</p>
<ol>
<li>训练集: 课堂教学。老师上课时为了描述1+1=2时，举的例子1个苹果+一个苹果，最终拿到2个苹果。</li>
<li>验证集: 课后作业。看一下学生的掌握情况，决定下一步的教学。同时为了避免学生过分背题(这还有一个高大上的名字叫做”过拟合”)，导致只知道苹果+苹果，而不知道香蕉+香蕉。</li>
<li>测试集: 期末考试。为判断学生是否真正掌握了知识，用上课时未出现的题目进行测试。</li>
</ol>
<h3 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h3><p>模型自己总结映射关系，可以认为是学习的概念，那深度的概念如何体现呢？经过实验发现，如果在输入、输出之间增加一些层(layer)进行映射，会得到更好的效果。增加的这些层被称为Hidden Layers，深度也就是指Hidden Layers的层数。</p>
<p><img src="https://img.yuheng.wang/mweb/first_02.png" alt="first_02"></p>
<p>那么多少层会得到最好的效果呢？随缘吧。<br>并没有公式可以指导我们建立多少层，只能通过实验结果反证在什么样的layer可以获得好的效果。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>通过djl来帮助我们完成模型训练及使用</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ai.djl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;djl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h3><p>在数据制备阶段，通过图像Data的名称来描述Label，并放到相关文件目录下。</p>
<p><img src="https://img.yuheng.wang/mweb/first_03.png" alt="first_03"></p>
<p>扫描文件目录进行加载，并提供Data+Label的获取方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MnistDataset</span> <span class="keyword">extends</span> <span class="title">RandomAccessDataset</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(Progress progress)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (prepared) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (Stream&lt;Path&gt; paths = Files.walk(path)) &#123;</span><br><span class="line">            items = paths.map(p -&gt; p.toFile().getName())</span><br><span class="line">                    .filter(n -&gt; n.endsWith(<span class="string">&quot;.png&quot;</span>))</span><br><span class="line">                    .distinct()</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">        prepared = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">availableSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Record <span class="title">get</span><span class="params">(NDManager manager, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        String item = items.get(Math.toIntExact(index));</span><br><span class="line">        Path imagePath = Paths.get(path.toString(), item);</span><br><span class="line">        NDArray imageArray = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            imageArray = ImageFactory.getInstance()</span><br><span class="line">                    .fromFile(imagePath)</span><br><span class="line">                    .toNDArray(manager, Image.Flag.GRAYSCALE);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        NDList data = <span class="keyword">new</span> NDList(imageArray);</span><br><span class="line">        NDList labels = <span class="keyword">new</span> NDList(<span class="number">1</span>);</span><br><span class="line">        labels.add(manager.create(Integer.parseInt(item.split(<span class="string">&quot;_&quot;</span>)[<span class="number">0</span>])));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Record(data, labels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Train"><a href="#Train" class="headerlink" title="Train"></a>Train</h3><p>按照输入输出，并设置2层hidden layers构成Block，将数据集以每次一张图片(Shape)的方式进行计算。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TrainingResult <span class="title">train</span><span class="params">(Arguments arguments)</span> <span class="keyword">throws</span> IOException, TranslateException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (arguments == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Construct neural network</span></span><br><span class="line">    Block block = <span class="keyword">new</span> Mlp(<span class="number">28</span> * <span class="number">28</span>, <span class="number">10</span>, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">128</span>, <span class="number">64</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> (Model model = Model.newInstance(<span class="string">&quot;first&quot;</span>)) &#123;</span><br><span class="line">        model.setBlock(block);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get training and validation dataset</span></span><br><span class="line">        RandomAccessDataset trainingSet = getDataset(Dataset.Usage.TRAIN, arguments);</span><br><span class="line">        RandomAccessDataset validateSet = getDataset(Dataset.Usage.TEST, arguments);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// setup training configuration</span></span><br><span class="line">        DefaultTrainingConfig config = setupTrainingConfig(arguments);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (Trainer trainer = model.newTrainer(config)) &#123;</span><br><span class="line">            trainer.setMetrics(<span class="keyword">new</span> Metrics());</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * MNIST is 28x28 grayscale image and pre processed into 28 * 28 NDArray.</span></span><br><span class="line"><span class="comment">             * 1st axis is batch axis, we can use 1 for initialization.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            Shape inputShape = <span class="keyword">new</span> Shape(<span class="number">1</span>, Mnist.IMAGE_HEIGHT * Mnist.IMAGE_WIDTH);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// initialize trainer with proper input shape</span></span><br><span class="line">            trainer.initialize(inputShape);</span><br><span class="line"></span><br><span class="line">            EasyTrain.fit(trainer, arguments.getEpoch(), trainingSet, validateSet);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> trainer.getTrainingResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> DefaultTrainingConfig <span class="title">setupTrainingConfig</span><span class="params">(Arguments arguments)</span> </span>&#123;</span><br><span class="line">    String outputDir = arguments.getOutputDir();</span><br><span class="line">    SaveModelTrainingListener listener = <span class="keyword">new</span> SaveModelTrainingListener(outputDir);</span><br><span class="line">    listener.setSaveModelCallback(</span><br><span class="line">            trainer -&gt; &#123;</span><br><span class="line">                TrainingResult result = trainer.getTrainingResult();</span><br><span class="line">                Model model = trainer.getModel();</span><br><span class="line">                <span class="keyword">float</span> accuracy = result.getValidateEvaluation(<span class="string">&quot;Accuracy&quot;</span>);</span><br><span class="line">                model.setProperty(<span class="string">&quot;Accuracy&quot;</span>, String.format(<span class="string">&quot;%.5f&quot;</span>, accuracy));</span><br><span class="line">                model.setProperty(<span class="string">&quot;Loss&quot;</span>, String.format(<span class="string">&quot;%.5f&quot;</span>, result.getValidateLoss()));</span><br><span class="line">            &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultTrainingConfig(Loss.softmaxCrossEntropyLoss())</span><br><span class="line">            .addEvaluator(<span class="keyword">new</span> Accuracy())</span><br><span class="line">            .optDevices(Device.getDevices(arguments.getMaxGpus()))</span><br><span class="line">            .addTrainingListeners(TrainingListener.Defaults.logging(outputDir))</span><br><span class="line">            .addTrainingListeners(listener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img.yuheng.wang/mweb/first_06.png" alt="first_06"></p>
<p>在性能检测中有一个Accuracy指标，表示的意思是 正确的数量/总数量 ， 但是不能只依赖这个指标作为模型性能的判断。比如，我训练一个模型预测北京一年内某天是否会沙尘暴，如果这一年只有一天沙尘暴，而我的模型预测每一天都不会沙尘暴，那模型的Accuracy为364/365&gt;99% 但显然这个模型是失败的。</p>
<p><img src="https://img.yuheng.wang/mweb/first_07.png" alt="first_07"></p>
<h3 id="inference"><a href="#inference" class="headerlink" title="inference"></a>inference</h3><p>使用模型时，需要设定同样的Block，图像经过映射后会得到一个结果，但是并不会得到唯一解，而是获取多个结果及可能性比例。可以选择获取best</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">recognition</span><span class="params">(Image img)</span> <span class="keyword">throws</span> IOException, TranslateException, MalformedModelException </span>&#123;</span><br><span class="line">    Model model = Model.newInstance(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">    Path modelDir = Paths.get(<span class="string">&quot;build/model&quot;</span>);</span><br><span class="line">    Predictor&lt;Image, Classifications&gt; predictor = <span class="keyword">null</span>;</span><br><span class="line">    Block block = <span class="keyword">new</span> Mlp(<span class="number">28</span> * <span class="number">28</span>, <span class="number">10</span>, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">128</span>, <span class="number">64</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        model.setBlock(block);</span><br><span class="line">        model.load(modelDir);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; classes = IntStream.range(<span class="number">0</span>, <span class="number">10</span>).mapToObj(String::valueOf).collect(Collectors.toList());</span><br><span class="line">        Pipeline pipeline = <span class="keyword">new</span> Pipeline();</span><br><span class="line">        pipeline.add(<span class="keyword">new</span> Resize(<span class="number">28</span>, <span class="number">28</span>))</span><br><span class="line">                .add(<span class="keyword">new</span> ToTensor());</span><br><span class="line"></span><br><span class="line">        Translator&lt;Image, Classifications&gt; translator =</span><br><span class="line">                ImageClassificationTranslator.builder()</span><br><span class="line">                        .setPipeline(pipeline)</span><br><span class="line">                        .optSynset(classes)</span><br><span class="line">                        .build();</span><br><span class="line">        predictor = model.newPredictor(translator);</span><br><span class="line">        Classifications classifications = predictor.predict(img);</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(classifications.best().getClassName());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MalformedModelException e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;model inference error! image:&#123;&#125;&quot;</span>, img, e);</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (TranslateException e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;translate error! image:&#123;&#125;&quot;</span>, img, e);</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        model.close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != predictor) &#123;</span><br><span class="line">            predictor.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img.yuheng.wang/mweb/first_09.png" alt="first_09"></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>模型学习的是知识，data和label之间要具备因果关系。比如：名字和是否能上清华之间存在关系吗？显然不，你不能训练一个模型来预测某个名字的人能否上清华。你还要加入生辰八字。。等等，我好像已经发现了一条致富之路，不说了，我要带着模型去摆摊了</p>
]]></content>
      <categories>
        <category>AI</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>DeepLearning</tag>
      </tags>
  </entry>
  <entry>
    <title>奔三路上的决心 Time For Change</title>
    <url>/2016/05/27/forward-30/</url>
    <content><![CDATA[<p>26了。<br>正在为了年初的TODO LIST努力， 虽然有些事已经没法努力了。<br>努力去做吧，为了表明奔三的决心，为了抡圆了活。</p>
<p>首马达成，果然是在大连，虽然只是个半马。<br>觉得生活充满了阳光。<br>很匆忙的一天，设错了闹钟，急匆匆出门，搭上邻居的顺风车；进错了地铁，被lan方的大哥，带着我这个小兄弟一起，打不到车，又没零钱，大哥给我20元，去后面换零钱，车就开走了；去后面遇到了大姐，给了我1元硬币；下车之后，又遇到了大哥，把20元还给了他。<br>跑步时，一直跟着浦老师，速度很舒服，天气也很舒服，觉得这座城市真的很美好。一路上一直是我们几个，聚在一起，互相鼓励、加油。路上很多人，大声喊着加油；志愿者们提供着水和毛巾，一次次击掌真的给了我很大的能量。<br>觉得人很奇怪，对陌生人可能有更多的耐心和友好。<br>喜欢这种感觉，感恩这种生活。<br>在18公里之后，脱离队伍独自向前，但是连续的几个坡度，让我的双腿越来越沉，好在路人给了我极大的鼓舞，终于坚持到了终点。<br>2小时6分，遗憾的没有进入2小时，不过觉得很成功了。<br>路上有人昏倒，希望没事吧。<br>发了朋友圈，应该收到了最多的一次赞和评论。<br>喜欢这种阳光的生活，是第二次提到阳光这个词吧。<br>完赛后，漫步在这座好像很熟悉，其实又很陌生的城市，没有目的，慢慢的走着，感觉很美好。<br>追求生活的意义，现在又多了一点，要追求阳光。<br>提升一些自信和美好。<br>终于在今年快过去一半的时候，完成了一项计划，算不算厚积而薄发？<br>为了遇见更好的自己，努力！<br>Time For Change！</p>
<p><img src="http://img.yuheng.wang/forward-30-0.png" alt="forward-30-0"></p>
]]></content>
      <categories>
        <category>diary</category>
      </categories>
      <tags>
        <tag>diary</tag>
        <tag>30</tag>
      </tags>
  </entry>
  <entry>
    <title>函数式编程</title>
    <url>/2023/08/06/fp/</url>
    <content><![CDATA[<h1 id="一、-什么是函数式编程"><a href="#一、-什么是函数式编程" class="headerlink" title="一、 什么是函数式编程"></a>一、 什么是函数式编程</h1><blockquote>
<p>函数式编程是一种编程范式，它将计算视为数学函数的求值过程。在函数式编程中，函数是一等公民，可以像其他值一样被传递、组合和操作。函数式编程强调不可变性和无副作用，即函数的执行不会改变程序状态或外部环境。这使得函数式编程更容易进行推理和测试，并且可以更好地支持并发和并行计算。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-1-编程范式"><a href="#1-1-编程范式" class="headerlink" title="1.1 编程范式"></a>1.1 编程范式</h2><p>编程范式是一种编程思想或方法，它定义了如何组织和结构化计算机程序。不同的编程范式有不同的方法和规则，以解决不同类型的问题。<br>同一门语言，同一个问题，来看一下不同的范式，会写出什么样的代码</p>
<blockquote>
<p>问题：计算一个整数数组中所有元素的平均值。</p>
</blockquote>
<h3 id="1-1-1-命令式编程-Imperative-Programming-范式"><a href="#1-1-1-命令式编程-Imperative-Programming-范式" class="headerlink" title="1.1.1 命令式编程(Imperative Programming)范式"></a>1.1.1 命令式编程(Imperative Programming)范式</h3><p>命令式编程范式是一种基于语句的编程范式，它通过一系列指令来改变程序状态。在命令式编程中，程序员需要指定每个步骤的操作，以便计算出所需的结果。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令式编程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">average</span>(<span class="params">numbers</span>):</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers:</span><br><span class="line">        total += number</span><br><span class="line">    <span class="keyword">return</span> total / <span class="built_in">len</span>(numbers)</span><br></pre></td></tr></table></figure>

<h3 id="1-1-2-声明式编程-Declarative-Programming-范式"><a href="#1-1-2-声明式编程-Declarative-Programming-范式" class="headerlink" title="1.1.2 声明式编程(Declarative Programming)范式"></a>1.1.2 声明式编程(Declarative Programming)范式</h3><p>声明式编程范式是一种基于表达式的编程范式，它通过表达式来描述计算机程序的行为。在声明式编程中，程序员只需要描述所需的结果，而不需要指定每个步骤的操作。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 声明式编程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">average</span>(<span class="params">numbers</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(numbers) / <span class="built_in">len</span>(numbers)</span><br></pre></td></tr></table></figure>

<h3 id="1-1-3-函数式编程-Functional-Programming-范式"><a href="#1-1-3-函数式编程-Functional-Programming-范式" class="headerlink" title="1.1.3 函数式编程(Functional Programming)范式"></a>1.1.3 函数式编程(Functional Programming)范式</h3><p>函数式编程范式是一种基于函数的编程范式，它将计算机程序视为一系列函数的组合。在函数式编程中，程序员只需要定义函数的输入和输出，而不需要指定每个步骤的操作。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 函数式编程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">average</span>(<span class="params">numbers</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x + y, numbers) / <span class="built_in">len</span>(numbers)</span><br></pre></td></tr></table></figure>

<h3 id="1-1-4-面向对象编程-Object-Oriented-Programming-范式"><a href="#1-1-4-面向对象编程-Object-Oriented-Programming-范式" class="headerlink" title="1.1.4 面向对象编程(Object-Oriented Programming)范式"></a>1.1.4 面向对象编程(Object-Oriented Programming)范式</h3><p>面向对象编程范式是一种基于对象的编程范式，它将计算机程序视为一组相互作用的对象。在面向对象编程中，程序员定义对象的属性和方法，并使用这些对象来执行计算机程序的操作。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 面向对象编程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Average</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, numbers</span>):</span></span><br><span class="line">        self.numbers = numbers</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculate</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.numbers) / <span class="built_in">len</span>(self.numbers)</span><br><span class="line"></span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">average = Average(numbers)</span><br><span class="line">print(average.calculate())</span><br></pre></td></tr></table></figure>

<h3 id="1-1-5-元编程-Metaprogramming-范式"><a href="#1-1-5-元编程-Metaprogramming-范式" class="headerlink" title="1.1.5 元编程(Metaprogramming)范式"></a>1.1.5 元编程(Metaprogramming)范式</h3><p>元编程范式是一种编程范式，它允许程序员在运行时创建、修改和操作程序的结构和行为。元编程范式的目的是使程序更加灵活和可扩展，因为它允许程序在运行时自我修改和适应。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AverageFunction</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, name, bases, attrs</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">average</span>(<span class="params">nums</span>):</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">sum</span>(nums) / <span class="built_in">len</span>(nums)</span><br><span class="line">        attrs[<span class="string">&#x27;average&#x27;</span>] = <span class="built_in">staticmethod</span>(average)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__new__(cls, name, bases, attrs)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMath</span>(<span class="params">metaclass=AverageFunction</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">print(MyMath.average(nums)) </span><br></pre></td></tr></table></figure>

<h2 id="1-2-数学函数"><a href="#1-2-数学函数" class="headerlink" title="1.2 数学函数"></a>1.2 数学函数</h2><p>假设有一个数学函数 f(x) = x^2，它将一个数 x 映射到它的平方。在函数式编程中，我们可以定义一个函数 square(x)，它也将一个数 x 映射到它的平方。这个函数可以用如下的方式定义：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x * x</span><br></pre></td></tr></table></figure>

<p>这个函数与数学中的函数 f(x) = x^2 有很多相似之处。它们都将一个输入映射到一个输出，而且输出只取决于输入，不会受到外部状态的影响。在函数式编程中，我们也可以将这个函数作为另一个函数的参数，或者将它的输出作为另一个函数的输入，这也是函数式编程中常见的操作。</p>
<p>另外，函数式编程中的函数也具有不可变性和纯函数性质。这意味着函数的输出只取决于输入，不会受到外部状态的影响。例如，如果我们调用 square(2) 函数，它的输出始终为 4，不会受到任何外部状态的影响。这与数学中的函数也有很多相似之处，因为数学中的函数的输出也只取决于输入，不会受到外部环境的影响。</p>
<h2 id="1-3-函数是一等公民（Functions-are-first-class-citizens）"><a href="#1-3-函数是一等公民（Functions-are-first-class-citizens）" class="headerlink" title="1.3 函数是一等公民（Functions are first-class citizens）"></a>1.3 函数是一等公民（Functions are first-class citizens）</h2><p>是指在编程语言中，函数可以像其他数据类型一样被传递、赋值、作为参数和返回值使用。<br>具体来说，函数作为一等公民具有以下特点：</p>
<h3 id="1-3-1-函数可以被赋值给变量或者数据结构中的元素"><a href="#1-3-1-函数可以被赋值给变量或者数据结构中的元素" class="headerlink" title="1.3.1 函数可以被赋值给变量或者数据结构中的元素"></a>1.3.1 函数可以被赋值给变量或者数据结构中的元素</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 将函数赋值给变量</span></span><br><span class="line"><span class="built_in">sum</span> = add</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用变量所指向的函数</span></span><br><span class="line">result = <span class="built_in">sum</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">print(result) <span class="comment"># 输出 3</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-函数可以作为参数传递给其他函数"><a href="#1-3-2-函数可以作为参数传递给其他函数" class="headerlink" title="1.3.2 函数可以作为参数传递给其他函数"></a>1.3.2 函数可以作为参数传递给其他函数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收两个参数和一个函数作为参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate</span>(<span class="params">a, b, operation</span>):</span></span><br><span class="line">    <span class="keyword">return</span> operation(a, b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 calculate 函数，并将 add 函数作为参数传递</span></span><br><span class="line">result = calculate(<span class="number">2</span>, <span class="number">3</span>, add)</span><br><span class="line">print(result) <span class="comment"># 输出 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 calculate 函数，并将 multiply 函数作为参数传递</span></span><br><span class="line">result = calculate(<span class="number">2</span>, <span class="number">3</span>, multiply)</span><br><span class="line">print(result) <span class="comment"># 输出 6</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-3-函数可以作为其他函数的返回值"><a href="#1-3-3-函数可以作为其他函数的返回值" class="headerlink" title="1.3.3 函数可以作为其他函数的返回值"></a>1.3.3 函数可以作为其他函数的返回值</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_operation</span>(<span class="params">operation</span>):</span></span><br><span class="line">    <span class="keyword">if</span> operation == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">            <span class="keyword">return</span> a + b</span><br><span class="line">        <span class="keyword">return</span> add</span><br><span class="line">    <span class="keyword">elif</span> operation == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">a, b</span>):</span></span><br><span class="line">            <span class="keyword">return</span> a * b</span><br><span class="line">        <span class="keyword">return</span> multiply</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 get_operation 函数，并将返回的函数赋值给变量</span></span><br><span class="line">operation = get_operation(<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用返回的函数</span></span><br><span class="line">result = operation(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">print(result) <span class="comment"># 输出 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 get_operation 函数，并将返回的函数赋值给变量</span></span><br><span class="line">operation = get_operation(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用返回的函数</span></span><br><span class="line">result = operation(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">print(result) <span class="comment"># 输出 6</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-4-函数可以在运行时动态创建和定义"><a href="#1-3-4-函数可以在运行时动态创建和定义" class="headerlink" title="1.3.4 函数可以在运行时动态创建和定义"></a>1.3.4 函数可以在运行时动态创建和定义</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义一个函数，返回一个新的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_add_function</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> x + n</span><br><span class="line">    <span class="keyword">return</span> add</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 create_add_function 函数，并将返回的函数赋值给变量</span></span><br><span class="line">add_3 = create_add_function(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用返回的函数</span></span><br><span class="line">result = add_3(<span class="number">2</span>)</span><br><span class="line">print(result) <span class="comment"># 输出 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 create_add_function 函数，并将返回的函数赋值给变量</span></span><br><span class="line">add_5 = create_add_function(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用返回的函数</span></span><br><span class="line">result = add_5(<span class="number">2</span>)</span><br><span class="line">print(result) <span class="comment"># 输出 7</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-不可变性-immutability-和无副作用"><a href="#1-4-不可变性-immutability-和无副作用" class="headerlink" title="1.4 不可变性(immutability)和无副作用"></a>1.4 不可变性(immutability)和无副作用</h2><p>不可变性是指在程序执行过程中，某个对象的状态不会发生改变。在函数式编程中，不可变性是一个重要的概念，因为它可以避免副作用和竞态条件等问题。在不可变性的约束下，函数的执行结果只取决于输入参数，而不会受到外部环境的影响。这使得函数更容易进行推理和测试，并且可以更好地支持并发和并行计算。在实现不可变性时，可以使用一些技术，例如使用不可变数据结构、避免共享可变状态、使用纯函数等。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">sum_of_numbers = reduce(<span class="keyword">lambda</span> x, y: x + y, numbers)  <span class="comment"># 使用reduce函数计算数字的和</span></span><br><span class="line">average = sum_of_numbers / <span class="built_in">len</span>(numbers)  <span class="comment"># 计算平均值</span></span><br><span class="line">print(average)  <span class="comment"># 输出3.0</span></span><br></pre></td></tr></table></figure>

<p>反之</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用可变性计算平均值</span></span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">sum_of_numbers = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers:</span><br><span class="line">    sum_of_numbers += number  <span class="comment"># 直接修改sum_of_numbers变量的值</span></span><br><span class="line">average = sum_of_numbers / <span class="built_in">len</span>(numbers)  <span class="comment"># 计算平均值</span></span><br><span class="line">print(average)  <span class="comment"># 输出3.0</span></span><br></pre></td></tr></table></figure>

<p>带来的问题</p>
<ol>
<li>副作用：在使用可变性的情况下，我们直接修改了sum_of_numbers变量的值，这可能会导致副作用。副作用是指函数或程序对外部环境产生的影响，例如修改全局变量、打印输出等。副作用可能会使程序更难以理解和调试，因为它们使程序的行为不可预测。</li>
<li>竞态条件：如果在计算平均值的过程中，有其他线程或进程也在修改sum_of_numbers变量的值，那么可能会导致计算结果不正确。竞态条件是指多个线程或进程同时访问共享资源时，由于访问顺序不确定，导致程序的行为不可预测。</li>
<li>可读性和可维护性：如果我们在程序的其他地方也使用了sum_of_numbers变量，那么可能会导致代码的可读性和可维护性下降。因为我们不知道sum_of_numbers变量的值是在哪里修改的，也不知道它的值是否正确。</li>
</ol>
<p>因此，使用可变性来计算平均值可能会带来一些问题。相比之下，使用不可变性可以避免这些问题，使程序更容易理解和调试。</p>
<h1 id="二、函数式编程的基础"><a href="#二、函数式编程的基础" class="headerlink" title="二、函数式编程的基础"></a>二、函数式编程的基础</h1><h2 id="2-1-纯函数-pure-function"><a href="#2-1-纯函数-pure-function" class="headerlink" title="2.1 纯函数(pure function)"></a>2.1 纯函数(pure function)</h2><p>纯函数是指在相同的输入下，总是返回相同的输出，并且没有任何副作用的函数。具体来说，纯函数满足以下两个条件：</p>
<ol>
<li>相同的输入总是返回相同的输出。</li>
<li>函数执行过程中没有对外部环境产生任何影响，也就是没有副作用。</li>
</ol>
<p>纯函数的好处在于它们更容易进行测试和调试，因为它们的行为是可预测的。此外，纯函数还可以更容易地进行并行化和优化，因为它们不依赖于外部状态。<br>例如，下面是一个纯函数的例子：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个函数总是返回相同的输出，而且没有任何副作用。无论何时调用它，它都只是简单地将两个数字相加并返回结果。</p>
<p><strong>Question</strong><br>这是一个纯函数吗</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isBeforeNow</span><span class="params">(inputTime time.Time)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    now := time.Now()</span><br><span class="line">    <span class="keyword">return</span> inputTime.Before(now)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-闭包-closure"><a href="#2-2-闭包-closure" class="headerlink" title="2.2 闭包(closure)"></a>2.2 闭包(closure)</h2><p>闭包是指一个函数和它所引用的外部变量的组合。在函数式编程中，闭包通常用于创建高阶函数，这些函数可以接受其他函数作为参数或返回函数作为结果。<br>闭包可以捕获外部变量的状态，并在函数调用之间保留它。这使得闭包可以实现一些有趣的功能，如记忆化和延迟计算。<br>例如，以下代码创建了一个闭包，它返回一个函数，该函数可以访问外部变量x：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createAdder</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    add5 := createAdder(<span class="number">5</span>)</span><br><span class="line">    fmt.Println(add5(<span class="number">3</span>)) <span class="comment">// 输出 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，createAdder函数返回一个函数，该函数可以访问外部变量x。我们可以使用createAdder(5)创建一个新的函数add5，它将5添加到它的参数中。由于add5是一个闭包，它可以记住x的值，并在每次调用时使用它。</p>
<h2 id="2-3-Lambda"><a href="#2-3-Lambda" class="headerlink" title="2.3 Lambda"></a>2.3 Lambda</h2><p>Lambda是一种匿名函数，它可以在需要时被创建和调用，而不需要给它们命名。在JavaScript中，Lambda函数可以使用箭头函数语法来定义。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用Lambda函数来计算两个数字的和</span></span><br><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用Lambda函数</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 输出 5</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-高阶函数"><a href="#2-4-高阶函数" class="headerlink" title="2.4 高阶函数"></a>2.4 高阶函数</h2><p>高阶函数是指能够接收一个或多个函数作为参数，并且/或者返回一个新函数的函数。函数是一等公民，因此函数可以像其他值一样被传递和操作。高阶函数是利用这种特性来实现更加灵活和抽象的编程方式。<br>以下是一些JavaScript中的高阶函数示例：</p>
<ol>
<li><code>Array.prototype.map()</code>：接收一个函数作为参数，该函数将应用于数组中的每个元素，并返回一个新数组，其中包含每个元素应用该函数的结果。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> doubledNumbers = numbers.map(<span class="function"><span class="params">num</span> =&gt;</span> num * <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(doubledNumbers); <span class="comment">// [2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>Array.prototype.filter()</code>：接收一个函数作为参数，该函数将应用于数组中的每个元素，并返回一个新数组，其中包含满足该函数条件的元素。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> evenNumbers = numbers.filter(<span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> === <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(evenNumbers); <span class="comment">// [2, 4]</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>Array.prototype.reduce()</code>：接收一个函数作为参数，该函数将应用于数组中的每个元素，并返回一个累加器的值。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> sum = numbers.reduce(<span class="function">(<span class="params">acc, num</span>) =&gt;</span> acc + num, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(sum); <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>使用多个函数作为参数</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculate</span>(<span class="params">num, func1, func2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result1 = func1(num);</span><br><span class="line">  <span class="keyword">const</span> result2 = func2(result1);</span><br><span class="line">  <span class="keyword">return</span> result2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">double</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addFive</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num + <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> finalResult = calculate(num, double, addFive);</span><br><span class="line"><span class="built_in">console</span>.log(finalResult); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>

<p>go版本</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">(num <span class="keyword">int</span>, func1 <span class="keyword">func</span>(<span class="keyword">int</span>)</span> <span class="title">int</span>, <span class="title">func2</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">    result1 := func1(num)</span><br><span class="line">    result2 := func2(result1)</span><br><span class="line">    <span class="keyword">return</span> result2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">double</span><span class="params">(num <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addFive</span><span class="params">(num <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num + <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    num := <span class="number">10</span></span><br><span class="line">    finalResult := calculate(num, double, addFive)</span><br><span class="line">    fmt.Println(finalResult) <span class="comment">// 25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-5-偏函数-Partial"><a href="#2-5-偏函数-Partial" class="headerlink" title="2.5 偏函数(Partial)"></a>2.5 偏函数(Partial)</h2><p>偏函数是指将一个多参数函数转化为一个只有部分参数的函数，即固定函数的一些参数，使得这个新函数只需要传入剩余的参数即可完成调用。这样做的好处是可以简化函数的调用，减少重复代码的编写，提高代码的可读性和可维护性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y, z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add5 = add.bind(<span class="literal">null</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(add5(<span class="number">1</span>, <span class="number">2</span>)); <span class="comment">// 输出 8</span></span><br></pre></td></tr></table></figure>

<p>go版本</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y, z <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    add5 := <span class="function"><span class="keyword">func</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> add(x, y, <span class="number">5</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(add5(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// 输出 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-6-柯里化-Currying"><a href="#2-6-柯里化-Currying" class="headerlink" title="2.6 柯里化(Currying)"></a>2.6 柯里化(Currying)</h2><p>柯里化是一种函数式编程技术，它将一个接受多个参数的函数转换为一系列只接受单个参数的函数。这些单参数函数可以被组合在一起，以便在后续的计算中使用。<br>例如，假设有一个接受两个参数的函数 add(x, y)，我们可以使用柯里化将其转换为一系列只接受一个参数的函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，我们可以使用这些单参数函数来进行计算：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> add_1 = add(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> add_2 = add(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(add_1(<span class="number">3</span>));  <span class="comment">// 输出 4</span></span><br><span class="line"><span class="built_in">console</span>.log(add_2(<span class="number">3</span>));  <span class="comment">// 输出 5</span></span><br></pre></td></tr></table></figure>

<p>这里，我们首先使用 add(1) 创建了一个新的函数 add_1，它只接受一个参数 y，并将其与 1 相加。然后，我们使用 add(2) 创建了另一个新的函数 add_2，它也只接受一个参数 y，并将其与 2 相加。最后，我们使用这些新函数来计算 add_1(3) 和 add_2(3)，得到了正确的结果。<br>柯里化可以使代码更加简洁和可读，同时也可以提高代码的复用性和灵活性。<br>柯里化转换<br>下面是一个使用 JavaScript 实现柯里化的函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">curried</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (args.length &gt;= fn.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.apply(<span class="built_in">this</span>, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args2</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> curried.apply(<span class="built_in">this</span>, args.concat(args2));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>go版本</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">curry</span><span class="params">(fn <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    fnValue := reflect.ValueOf(fn)</span><br><span class="line">    fnType := fnValue.Type()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> fnType.Kind() != reflect.Func &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;curry: fn is not a function&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> curried <span class="function"><span class="keyword">func</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125;</span><br><span class="line">    curried = <span class="function"><span class="keyword">func</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(args) &gt;= fnType.NumIn() &#123;</span><br><span class="line">            in := <span class="built_in">make</span>([]reflect.Value, <span class="built_in">len</span>(args))</span><br><span class="line">            <span class="keyword">for</span> i, arg := <span class="keyword">range</span> args &#123;</span><br><span class="line">                in[i] = reflect.ValueOf(arg)</span><br><span class="line">            &#125;</span><br><span class="line">            out := fnValue.Call(in)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(out) == <span class="number">1</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> out[<span class="number">0</span>].Interface()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> out</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(arg <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">                <span class="keyword">return</span> curried(<span class="built_in">append</span>(args, arg)...)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> curried</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个函数接受一个函数 fn 作为参数，并返回一个新的函数 curried，这个新函数可以接受任意数量的参数，并将它们逐步累积起来，直到收集到足够的参数后再调用原始函数 fn。<br>具体来说，当 curried 函数接收到的参数数量大于或等于 fn 函数的参数数量时，它会直接调用 fn 函数，并将收集到的参数传递给它。否则，它会返回一个新的函数，这个新函数可以接受更多的参数，并将它们与之前收集到的参数合并起来，然后递归调用 curried 函数，直到收集到足够的参数后再调用 fn 函数。<br>下面是一个使用 curry 函数实现柯里化的例子：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y, z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curriedAdd = curry(add);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(curriedAdd(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>));  <span class="comment">// 输出 6</span></span><br><span class="line"><span class="built_in">console</span>.log(curriedAdd(<span class="number">1</span>, <span class="number">2</span>)(<span class="number">3</span>));  <span class="comment">// 输出 6</span></span><br><span class="line"><span class="built_in">console</span>.log(curriedAdd(<span class="number">1</span>)(<span class="number">2</span>, <span class="number">3</span>));  <span class="comment">// 输出 6</span></span><br><span class="line"><span class="built_in">console</span>.log(curriedAdd(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));  <span class="comment">// 输出 6</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们定义了一个接受三个参数的函数 add(x, y, z)，然后使用 curry 函数将它转换为一个柯里化函数 curriedAdd。最后，我们使用 curriedAdd 函数来计算 add(1, 2, 3)，add(1, 2, 3)，add(1, 2, 3) 和 add(1, 2, 3)，得到了正确的结果。<br><strong>优势</strong></p>
<ol>
<li>延迟执行：柯里化可以将一个函数的执行延迟到后续的计算中，这样可以避免不必要的计算和资源浪费。例如，在上面的例子中，我们可以先使用 add(1) 和 add(2) 创建两个新函数，然后在需要计算时再传递参数，这样可以避免重复计算和资源浪费。</li>
<li>函数组合：柯里化可以将多个函数组合在一起，以便在后续的计算中使用。例如，我们可以将多个只接受单个参数的函数组合在一起，形成一个新的函数，这个新函数可以接受多个参数，并将它们依次传递给这些单参数函数，从而得到最终的结果。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function"><span class="params">x</span> =&gt;</span> x * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compose = <span class="function">(<span class="params">...functions</span>) =&gt;</span> <span class="function"><span class="params">x</span> =&gt;</span></span><br><span class="line">  functions.reduce(<span class="function">(<span class="params">acc, f</span>) =&gt;</span> f(acc), x);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addThenMultiply = compose(add, multiply);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(addThenMultiply(<span class="number">5</span>)); <span class="comment">// 输出 12</span></span><br></pre></td></tr></table></figure>

<p>go版本</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compose</span><span class="params">(functions ...<span class="keyword">func</span>(<span class="keyword">int</span>)</span> <span class="title">int</span>) <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> _, f := <span class="keyword">range</span> functions &#123;</span><br><span class="line">            x = f(x)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    addThenMultiply := compose(add, multiply)</span><br><span class="line">    fmt.Println(addThenMultiply(<span class="number">5</span>)) <span class="comment">// 输出 12</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>柯里化和偏函数的区别</strong></p>
<p>柯里化是将一个接受多个参数的函数转换为一系列只接受单个参数的函数，这些单参数函数可以被组合在一起，以便在后续的计算中使用。柯里化的目的是为了提高代码的复用性和灵活性，使得代码更加简洁、可读和灵活。<br>偏函数是将一个接受多个参数的函数转换为一个接受部分参数的函数，这个部分参数是在转换时就已经确定的。偏函数的目的是为了简化函数调用，避免重复传递相同的参数，提高代码的可读性和可维护性。</p>
<h1 id="三、函数式编程的进阶"><a href="#三、函数式编程的进阶" class="headerlink" title="三、函数式编程的进阶"></a>三、函数式编程的进阶</h1><h2 id="3-1-函数组合-composition"><a href="#3-1-函数组合-composition" class="headerlink" title="3.1 函数组合(composition)"></a>3.1 函数组合(composition)</h2><p>函数组合是一种将多个函数组合在一起以形成新函数的技术，可以帮助我们更好地组织和重用代码。<br>在函数组合中，我们将一个函数的输出作为另一个函数的输入，以此类推，直到我们得到最终的输出。这种方法可以让我们将多个简单的函数组合成一个更复杂的函数，从而使代码更加模块化和可读性更高。<br>例如，假设我们有两个函数 f(x) 和 g(x)，我们可以将它们组合成一个新函数 h(x) = f(g(x))。这个新函数 h(x) 将先应用 g(x)，然后将其结果传递给 f(x)。<br>函数组合还可以用于构建管道，其中每个函数都是前一个函数的输出。这种方法可以让我们轻松地将多个函数链接在一起，以便在数据流中进行转换和处理。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义两个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOne</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">double</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用函数组合将它们组合成一个新函数</span></span><br><span class="line"><span class="keyword">const</span> addOneAndDouble = <span class="function">(<span class="params">x</span>) =&gt;</span> double(addOne(x));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试新函数</span></span><br><span class="line"><span class="built_in">console</span>.log(addOneAndDouble(<span class="number">2</span>)); <span class="comment">// 输出 6</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-Pipeline"><a href="#3-2-Pipeline" class="headerlink" title="3.2 Pipeline"></a>3.2 Pipeline</h2><p>pipeline 是一种将多个函数组合在一起，形成一个数据处理流程的编程模式。它的核心思想是将数据从一个函数传递到另一个函数，每个函数都对数据进行一些操作，最终得到最终结果。<br>在函数式编程 pipeline 中，通常会使用一些高阶函数，如 map、filter、reduce 等，来对数据进行处理。这些函数可以接受一个函数作为参数，并将其应用于数据中的每个元素。<br>下面是一个简单的函数式编程 pipeline 的示例：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> double = (x) =&gt; x * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> square = (x) =&gt; x * x;</span><br><span class="line"><span class="keyword">const</span> sum = (accumulator, currentValue) =&gt; accumulator + currentValue;</span><br><span class="line"><span class="keyword">const</span> result = numbers</span><br><span class="line">  .<span class="keyword">map</span>(double)</span><br><span class="line">  .<span class="keyword">map</span>(square)</span><br><span class="line">  .reduce(sum, <span class="number">0</span>);</span><br><span class="line">console.log(result); </span><br></pre></td></tr></table></figure>

<h2 id="3-3-PointFree"><a href="#3-3-PointFree" class="headerlink" title="3.3 PointFree"></a>3.3 PointFree</h2><p>函数式编程中的 pointfree 是一种编程风格，它的核心思想是尽可能地避免使用命名参数，而是通过组合函数来实现代码的复用和简化。<br>在 pointfree 风格中，函数的定义不会显式地引用它的参数，而是通过组合其他函数来实现其功能。这种风格的优点在于可以使代码更加简洁、可读性更高，并且可以更容易地进行代码重构和测试。</p>
<p><strong>JavaScript</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 非 Pointfree 风格</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculate</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> add(x, multiply(x, y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Pointfree 风格</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function"><span class="params">x</span> =&gt;</span> <span class="function"><span class="params">y</span> =&gt;</span> x + y;</span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function"><span class="params">x</span> =&gt;</span> <span class="function"><span class="params">y</span> =&gt;</span> x * y;</span><br><span class="line"><span class="keyword">const</span> calculate = <span class="function"><span class="params">x</span> =&gt;</span> <span class="function"><span class="params">y</span> =&gt;</span> add(x)(multiply(x)(y));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 非 Pointfree 风格</span></span><br><span class="line">def add(x: Int, <span class="attr">y</span>: Int): Int = x + y</span><br><span class="line"></span><br><span class="line">def multiply(x: Int, <span class="attr">y</span>: Int): Int = x * y</span><br><span class="line"></span><br><span class="line">def calculate(x: Int, <span class="attr">y</span>: Int): Int = add(x, multiply(x, y))</span><br></pre></td></tr></table></figure>
<p><strong>Scala</strong></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Pointfree 风格</span></span><br><span class="line"><span class="keyword">val</span> add: <span class="type">Int</span> =&gt; <span class="type">Int</span> =&gt; <span class="type">Int</span> = x =&gt; y =&gt; x + y</span><br><span class="line"><span class="keyword">val</span> multiply: <span class="type">Int</span> =&gt; <span class="type">Int</span> =&gt; <span class="type">Int</span> = x =&gt; y =&gt; x * y</span><br><span class="line"><span class="keyword">val</span> calculate: <span class="type">Int</span> =&gt; <span class="type">Int</span> =&gt; <span class="type">Int</span> = x =&gt; y =&gt; add(x)(multiply(x)(y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 非 Pointfree 风格</span></span><br><span class="line">func add(x, y int) int &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func multiply(x, y int) int &#123;</span><br><span class="line">    <span class="keyword">return</span> x * y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func calculate(x, y int) int &#123;</span><br><span class="line">    <span class="keyword">return</span> add(x, multiply(x, y))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Go</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Pointfree 风格</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x * y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> add(x)(multiply(x)(y))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-4-惰性求值-Lazy-evaluation"><a href="#3-4-惰性求值-Lazy-evaluation" class="headerlink" title="3.4 惰性求值(Lazy evaluation)"></a>3.4 惰性求值(Lazy evaluation)</h2><p>惰性求值是一种计算策略，它只在需要时才计算表达式的值。这意味着，如果一个表达式的值从未被使用，那么它将永远不会被计算。相反，它只有在需要时才会被计算，这可以节省计算资源和提高程序的效率。<br>在函数式编程语言中，函数可以作为参数传递给其他函数，也可以从其他函数中返回。惰性求值可以使这些函数更加灵活和高效。只在需要时才计算表达式的值，可以提高程序的效率和灵活性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lazyAdd</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add = lazyAdd(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 不会立即计算 2 + 3</span></span><br><span class="line"><span class="built_in">console</span>.log(add()); <span class="comment">// 现在才会计算 2 + 3，并输出 5</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，lazyAdd 函数返回一个函数，这个函数会在需要时才计算 a + b 的值。当我们调用 lazyAdd(2, 3) 时，它并不会立即计算 2 + 3 的值，而是返回一个函数。当我们调用这个函数时，它才会计算 2 + 3 的值并返回。<br>这种方式可以避免不必要的计算，提高程序的效率。例如，如果我们有一个很大的数组，我们可以使用惰性求值来避免不必要的遍历：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lazyFilter</span>(<span class="params">arr, predicate</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (predicate(arr[i])) &#123;</span><br><span class="line">        <span class="keyword">yield</span> arr[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filtered = lazyFilter(arr, <span class="function"><span class="params">x</span> =&gt;</span> x % <span class="number">2</span> === <span class="number">0</span>); <span class="comment">// 不会立即遍历数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> x <span class="keyword">of</span> filtered()) &#123; <span class="comment">// 在需要时才遍历数组</span></span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，lazyFilter 函数返回一个生成器函数，这个函数会在需要时才遍历数组并返回符合条件的元素。当我们调用 lazyFilter(arr, x =&gt; x % 2 === 0) 时，它并不会立即遍历数组，而是返回一个生成器函数。当我们使用 for…of 循环遍历这个生成器函数时，它才会遍历数组并返回符合条件的元素。这种方式可以避免不必要的遍历，提高程序的效率。</p>
<h2 id="3-5-尾递归-Tail-recursion"><a href="#3-5-尾递归-Tail-recursion" class="headerlink" title="3.5 尾递归(Tail recursion)"></a>3.5 尾递归(Tail recursion)</h2><p><strong>递归</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(factorial(<span class="number">5</span>)); <span class="comment">// 输出 120</span></span><br></pre></td></tr></table></figure>

<p>在这个实现中，递归调用发生在函数的中间，每次递归调用都需要等待下一层递归的返回值才能继续执行。这种形式的递归可能会导致栈溢出等问题，因为每次递归调用都会在栈中创建一个新的帧，如果递归层数太多，就会导致栈溢出。<br><strong>尾递归</strong><br>指一个函数在调用自身之后，不再有其他操作需要执行，直接返回结果。这种形式的递归可以被优化为迭代，从而避免栈溢出等问题。<br>在尾递归中，递归调用发生在函数的最后一步，而且递归调用的返回值直接被当前函数返回，不再进行其他操作。这种形式的递归可以被编译器或解释器优化为迭代，从而避免栈溢出等问题。<br>例如，下面是一个阶乘函数的尾递归实现：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n, acc = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> acc;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factorial(n - <span class="number">1</span>, acc * n);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(factorial(<span class="number">5</span>)); <span class="comment">// 输出 120</span></span><br></pre></td></tr></table></figure>

<p>在这个实现中，递归调用发生在函数的最后一步，而且递归调用的返回值直接被当前函数返回，不再进行其他操作。这种形式的递归可以被优化为迭代，从而避免栈溢出等问题。</p>
<h2 id="3-6-MapReduce"><a href="#3-6-MapReduce" class="headerlink" title="3.6 MapReduce"></a>3.6 MapReduce</h2><p>在函数式编程中，Map和Reduce是两个常用的高阶函数。Map函数接受一个函数和一个列表作为输入，将该函数应用于列表中的每个元素，并返回一个新的列表。Reduce函数接受一个函数和一个列表作为输入，将该函数应用于列表中的每个元素，并返回一个单一的值。<br>在MapReduce中，Map函数将数据集分成小块，并将每个块映射到一个键值对。Reduce函数将相同键的所有值组合在一起，并将它们合并成一个单一的值。这个过程可以在分布式计算环境中并行执行，从而加快处理速度。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> numbers = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Map操作：将每个数字乘以2</span></span><br><span class="line"><span class="keyword">val</span> mappedNumbers = numbers.map(_ * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reduce操作：将所有数字相加</span></span><br><span class="line"><span class="keyword">val</span> reducedNumbers = mappedNumbers.reduce(_ + _)</span><br><span class="line"></span><br><span class="line">println(reducedNumbers) <span class="comment">// 输出55</span></span><br></pre></td></tr></table></figure>
<p>go版本</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">        <span class="string">&quot;fmt&quot;</span></span><br><span class="line">        <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个列表</span></span><br><span class="line"><span class="keyword">var</span> numbers = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义Map函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapFunction</span><span class="params">(number <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> number * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义Reduce函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reduceFunction</span><span class="params">(accumulator <span class="keyword">int</span>, number <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accumulator + number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用MapReduce将所有元素相加</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 使用Map函数将列表中的每个元素乘以2</span></span><br><span class="line">        mappedNumbers := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(numbers))</span><br><span class="line">        <span class="keyword">for</span> i, number := <span class="keyword">range</span> numbers &#123;</span><br><span class="line">                mappedNumbers[i] = mapFunction(number)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Reduce函数将所有元素相加</span></span><br><span class="line">        reducedNumber := <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> _, number := <span class="keyword">range</span> mappedNumbers &#123;</span><br><span class="line">                reducedNumber = reduceFunction(reducedNumber, number)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出结果</span></span><br><span class="line">        fmt.Println(reducedNumber) <span class="comment">// 110</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-6-1-多线程"><a href="#3-6-1-多线程" class="headerlink" title="3.6.1 多线程"></a>3.6.1 多线程</h3><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.concurrent.<span class="type">Future</span></span><br><span class="line"><span class="keyword">import</span> scala.concurrent.<span class="type">ExecutionContext</span>.<span class="type">Implicits</span>.global</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> numbers = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Map操作：将每个数字乘以2</span></span><br><span class="line"><span class="keyword">val</span> mappedNumbers = numbers.map &#123; n =&gt;</span><br><span class="line">  <span class="type">Future</span> &#123;</span><br><span class="line">    n * <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reduce操作：将所有数字相加</span></span><br><span class="line"><span class="keyword">val</span> reducedNumbers = <span class="type">Future</span>.sequence(mappedNumbers).map(_.reduce(_ + _))</span><br><span class="line"></span><br><span class="line">reducedNumbers.foreach(println) <span class="comment">// 输出55</span></span><br></pre></td></tr></table></figure>
<p>go版本</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Map函数将输入的字符串切分成单词，并返回一个键值对切片</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Map</span><span class="params">(input <span class="keyword">string</span>)</span> []<span class="title">KeyValue</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> kvs []KeyValue</span><br><span class="line">    words := strings.Fields(input)</span><br><span class="line">    <span class="keyword">for</span> _, w := <span class="keyword">range</span> words &#123;</span><br><span class="line">        kvs = <span class="built_in">append</span>(kvs, KeyValue&#123;w, <span class="string">&quot;1&quot;</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> kvs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reduce函数将相同键的值相加，并返回一个键值对</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Reduce</span><span class="params">(key <span class="keyword">string</span>, values []<span class="keyword">string</span>)</span> <span class="title">KeyValue</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sum <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> values &#123;</span><br><span class="line">        i, _ := strconv.Atoi(v)</span><br><span class="line">        sum += i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> KeyValue&#123;key, strconv.Itoa(sum)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// KeyValue结构体表示键值对</span></span><br><span class="line"><span class="keyword">type</span> KeyValue <span class="keyword">struct</span> &#123;</span><br><span class="line">    Key   <span class="keyword">string</span></span><br><span class="line">    Value <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MapReduce函数实现MapReduce过程</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MapReduce</span><span class="params">(inputs []<span class="keyword">string</span>, mapper <span class="keyword">func</span>(<span class="keyword">string</span>)</span> []<span class="title">KeyValue</span>, <span class="title">reducer</span> <span class="title">func</span><span class="params">(<span class="keyword">string</span>, []<span class="keyword">string</span>)</span> <span class="title">KeyValue</span>) <span class="title">map</span>[<span class="title">string</span>]<span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    <span class="keyword">var</span> mu sync.Mutex</span><br><span class="line">    intermediate := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">string</span>)</span><br><span class="line">    result := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Map阶段</span></span><br><span class="line">    <span class="keyword">for</span> _, input := <span class="keyword">range</span> inputs &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(input <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            kvs := mapper(input)</span><br><span class="line">            <span class="keyword">for</span> _, kv := <span class="keyword">range</span> kvs &#123;</span><br><span class="line">                mu.Lock()</span><br><span class="line">                intermediate[kv.Key] = <span class="built_in">append</span>(intermediate[kv.Key], kv.Value)</span><br><span class="line">                mu.Unlock()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(input)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reduce阶段</span></span><br><span class="line">    <span class="keyword">for</span> key, values := <span class="keyword">range</span> intermediate &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(key <span class="keyword">string</span>, values []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            kv := reducer(key, values)</span><br><span class="line">            mu.Lock()</span><br><span class="line">            result[kv.Key] = kv.Value</span><br><span class="line">            mu.Unlock()</span><br><span class="line">        &#125;(key, values)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    inputs := []<span class="keyword">string</span>&#123;</span><br><span class="line">        <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hello go&quot;</span>,</span><br><span class="line">        <span class="string">&quot;go mapreduce&quot;</span>,</span><br><span class="line">        <span class="string">&quot;go concurrency&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result := MapReduce(inputs, Map, Reduce)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> result &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%s: %s\n&quot;</span>, k, v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h1><h2 id="4-1-优缺点"><a href="#4-1-优缺点" class="headerlink" title="4.1 优缺点"></a>4.1 优缺点</h2><h3 id="4-1-1-优点"><a href="#4-1-1-优点" class="headerlink" title="4.1.1 优点"></a>4.1.1 优点</h3><ol>
<li>简洁性：函数式编程通常比命令式编程更简洁，因为它们不需要维护状态或副作用。这使得代码更容易理解和维护。</li>
<li>可读性：函数式编程通常更容易阅读，因为它们的代码更加模块化和组合化。这使得代码更容易理解和修改。</li>
<li>可扩展性：函数式编程通常更容易扩展，因为它们的代码更加模块化和组合化。这使得代码更容易重用和修改。</li>
<li>可靠性：函数式编程通常更可靠，因为它们不依赖于共享状态或副作用。这使得代码更容易测试和调试。</li>
<li>并行性：函数式编程通常更容易并行化，因为它们的代码不依赖于共享状态或副作用。这使得代码更容易利用多核处理器和分布式系统。</li>
</ol>
<h3 id="4-1-2-缺点"><a href="#4-1-2-缺点" class="headerlink" title="4.1.2 缺点"></a>4.1.2 缺点</h3><ol>
<li>性能：函数式编程通常比命令式编程更慢，因为它们需要更多的内存和计算资源来处理数据。这使得函数式编程不适合处理大规模数据或高性能应用程序。</li>
<li>学习曲线：函数式编程通常比命令式编程更难学习，因为它们需要更多的数学和抽象思维。这使得函数式编程不适合初学者或非技术人员。</li>
<li>可读性：函数式编程通常比命令式编程更难阅读，因为它们的代码更加抽象和符号化。这使得函数式编程不适合所有人，特别是那些不熟悉函数式编程的人。</li>
<li>可维护性：函数式编程通常比命令式编程更难维护，因为它们的代码更加抽象和符号化。这使得函数式编程不适合所有人，特别是那些不熟悉函数式编程的人。</li>
<li>工具支持：函数式编程通常比命令式编程缺乏工具支持，因为它们需要更多的数学和抽象思维。这使得函数式编程不适合所有人，特别是那些需要使用工具来提高生产力的人。</li>
</ol>
]]></content>
      <categories>
        <category>code</category>
      </categories>
      <tags>
        <tag>code</tag>
        <tag>fp</tag>
      </tags>
  </entry>
  <entry>
    <title>自定义Github个人首页</title>
    <url>/2020/10/17/github-profile-readme/</url>
    <content><![CDATA[<p>筛校招简历时学到的新姿势。现在的年轻人真会玩。</p>
<span id="more"></span>

<p>在GitHub上接触一个新项目时，如果有一个详实有效的<strong>README</strong>，可以极大降低学习成本， 提升用户体验。<br>上篇文章中也介绍了介绍了如何通过badge等方式，让你的<strong>README</strong>更直观。</p>
<p>但是另一个很重要的信息总是被忽略，那就是个人介绍。如果把个人也看成一个项目，如何让其他人快速了解你，并且与你合作？无论是获取、还是给予相关帮助。</p>
<p>其实GitHub提供了一个自定义个人首页的方式，只不过隐藏在了隐秘的角落，不为众人所知。</p>
<h2 id="Secret-Repository"><a href="#Secret-Repository" class="headerlink" title="Secret Repository"></a>Secret Repository</h2><blockquote>
<p>嘘 <strong>This is a secret!</strong></p>
</blockquote>
<p>这可是官方告诉我的</p>
<p><img src="https://img.yuheng.wang/mweb/16028819616164.jpg" alt="00-create-repository"></p>
<p>整个过程十分简单，只需要新建一个和GitHub 用户名匹配的项目即可。需要满足2个条件</p>
<ul>
<li>项目必须是Public <img src="https://img.yuheng.wang/mweb/16029061891894.jpg" alt="01-public-repository"></li>
<li>选择 Initialize this repository with a README <img src="https://img.yuheng.wang/mweb/16029061968726.jpg" alt="02-init-readme"></li>
</ul>
<p>新建后，即可在个人首页中看到多了一个个人首页窗口。</p>
<p><img src="https://img.yuheng.wang/mweb/16029065277582.jpg" alt="03-profile"></p>
<p>repository创建后，Github已经用模板预先填充了生成的README文件，按照官方推荐来介绍自己吧</p>
<p><img src="https://img.yuheng.wang/mweb/16029063813381.jpg" alt="04-readme"></p>
<p>高大上吗？这才刚刚开始</p>
<h2 id="Style"><a href="#Style" class="headerlink" title="Style"></a>Style</h2><p>虽然这是一个<code>.md</code>文件，但是支持HTML解析。可玩性是不是瞬间提高了？<br>但是觉得直男审美，或者技能受限？没关系，我们还可以直接使用前端大佬们最喜欢造的轮子</p>
<h3 id="github-readme-stats"><a href="#github-readme-stats" class="headerlink" title="github-readme-stats"></a>github-readme-stats</h3><blockquote>
<p>github-readme-stats: 在你的 README 中获取动态生成的 GitHub 统计信息！</p>
</blockquote>
<p><img src="https://img.yuheng.wang/mweb/16029161749468.jpg" alt="05-stats"></p>
<p>可以选择统计指标和自定义样式</p>
<p><img src="https://img.yuheng.wang/mweb/16029162619690.jpg" alt="06-stats-theme"></p>
<p>或者语言使用比例</p>
<p><img src="https://img.yuheng.wang/mweb/16029163301690.jpg" alt="07-language"></p>
<p>也可以把感兴趣或者参与的项目也贴进来</p>
<p><img src="https://img.yuheng.wang/mweb/16029165402374.jpg" alt="08-arc"></p>
<p>只需要一行引用即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[![Focus Repo](https:&#x2F;&#x2F;github-readme-stats.vercel.app&#x2F;api&#x2F;pin&#x2F;?username&#x3D;YituHealthcare&amp;repo&#x3D;Arc&amp;show_owner&#x3D;true)](https:&#x2F;&#x2F;github.com&#x2F;YituHealthcare&#x2F;Arc)</span><br></pre></td></tr></table></figure>

<h3 id="github-profile-trophy"><a href="#github-profile-trophy" class="headerlink" title="github-profile-trophy"></a>github-profile-trophy</h3><blockquote>
<p>Add dynamically generated GitHub Trophy on your readme</p>
</blockquote>
<p>不喜欢卡片，也可以给自己颁个奖杯</p>
<p><img src="https://img.yuheng.wang/mweb/16029169489432.jpg" alt="09-trophy"></p>
<h3 id="github-profile-views-counter"><a href="#github-profile-views-counter" class="headerlink" title="github-profile-views-counter"></a>github-profile-views-counter</h3><p>想统计有多少人访问过你的首页？又是一句话搞定</p>
<p><img src="https://img.yuheng.wang/mweb/16029170509758.jpg" alt="10-views"></p>
<h3 id="emoji"><a href="#emoji" class="headerlink" title="emoji"></a>emoji</h3><p>千言万语不如一个表情？ 来找找喜欢的Emoji吧</p>
<p><img src="https://img.yuheng.wang/mweb/16029174388898.jpg" alt="11-emoji"></p>
<h2 id="关闭个人首页"><a href="#关闭个人首页" class="headerlink" title="关闭个人首页"></a>关闭个人首页</h2><p>有一天自闭了，不想在首页向其他人介绍自己，有以下几种方式</p>
<ul>
<li>删除README.me文件。</li>
<li>仓库设置为私有。</li>
<li>仓库名称不再与Github用户名匹配。</li>
</ul>
<h2 id="那些眼前一亮的主页"><a href="#那些眼前一亮的主页" class="headerlink" title="那些眼前一亮的主页"></a>那些眼前一亮的主页</h2><p><img src="https://img.yuheng.wang/mweb/16029182616289.jpg" alt="12-readme-1"></p>
<p><img src="https://img.yuheng.wang/mweb/16029182384273.jpg" alt="12-readme-2"></p>
<p><img src="https://img.yuheng.wang/mweb/amchuz.gif" alt="12-readme-3"></p>
<p><img src="https://img.yuheng.wang/mweb/16029181695183.jpg" alt="12-readme-4"></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>心动不如行动，期待看到你的炫酷主页</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://github.com/coderjojo/creative-profile-readme">https://github.com/coderjojo/creative-profile-readme</a></li>
<li><a href="https://github.com/anuraghazra/github-readme-stats">https://github.com/anuraghazra/github-readme-stats</a></li>
<li><a href="https://github.com/TheDudeThatCode#shubhamdeep-jha">https://github.com/TheDudeThatCode#shubhamdeep-jha</a></li>
<li><a href="https://github.com/Amchuz/Amchuz/blob/master/README.md">https://github.com/Amchuz/Amchuz/blob/master/README.md</a></li>
<li><a href="https://github.com/RichardLitt/standard-readme#example-readmes">https://github.com/RichardLitt/standard-readme#example-readmes</a></li>
<li><a href="https://gist.github.com/rxaviers/7360908">https://gist.github.com/rxaviers/7360908</a></li>
<li><a href="https://github.com/ryo-ma/github-profile-trophy">https://github.com/ryo-ma/github-profile-trophy</a></li>
<li><a href="https://docs.github.com/en/github/setting-up-and-managing-your-github-profile/managing-your-profile-readme">https://docs.github.com/en/github/setting-up-and-managing-your-github-profile/managing-your-profile-readme</a></li>
<li><a href="https://github.com/antonkomarev/github-profile-views-counter">https://github.com/antonkomarev/github-profile-views-counter</a></li>
</ul>
]]></content>
      <categories>
        <category>github</category>
      </categories>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>基于Gitlab进行开发团队管理的尝试——00.通过issue管理需求</title>
    <url>/2019/11/18/gitlab-manager-00/</url>
    <content><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>产品经理、测试人员、开发人员统一在<strong>Gitlab</strong>中管理<strong>需求</strong>、<strong>bug</strong>。</p>
<h2 id="Why-gt-为什么通过Gitlab-issue管理，而不是Jira、Redmine等工具？"><a href="#Why-gt-为什么通过Gitlab-issue管理，而不是Jira、Redmine等工具？" class="headerlink" title="Why -&gt; 为什么通过Gitlab issue管理，而不是Jira、Redmine等工具？"></a>Why -&gt; 为什么通过Gitlab issue管理，而不是Jira、Redmine等工具？</h2><ol>
<li>开发团队最终交付物为项目代码，<strong>需求</strong>、<strong>bug</strong>最终都会转换为一行代码、一次<strong>MR</strong>。通过<strong>issue</strong>可以让每一步都可以溯源。</li>
<li><strong>Gitlab issue</strong>更轻量，<strong>markdown</strong>语法让<strong>issue</strong>更专注于内容本身</li>
</ol>
<span id="more"></span>

<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><ol>
<li>每组通过独立项目统一管理issue，在<strong>Readme</strong>中描述使用方式及定义</li>
<li>通过<strong>milestone</strong>管理项目版本，对齐目标。节奏很重要</li>
<li>通过<strong>label</strong>管理优先级(<code>P0</code>|<code>P-1</code>|<code>P-100</code>)、类型(<code>bug</code>|<code>feature</code>)</li>
<li>通过<strong>board</strong>查看<strong>issue</strong>进度状态，配合<code>To Do</code>、<code>Doing</code>、<code>Verify</code>等<strong>label</strong>，定义<strong>issue生命周期</strong></li>
<li>通过模板定义<strong>author</strong>需要提供的信息</li>
</ol>
<h3 id="项目Readme"><a href="#项目Readme" class="headerlink" title="项目Readme"></a>项目Readme</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 新建 Issue 相关细节</span><br><span class="line">- 模板：从以下 2 者中进行选择 </span><br><span class="line">    - feature </span><br><span class="line">    - bug </span><br><span class="line">- Assignee：开发负责人 </span><br><span class="line">- Label： </span><br><span class="line">    - 优先级 </span><br><span class="line">        - P-1：全线 block 工作，直接在群里汇报，不需要走 gitlab，例如： </span><br><span class="line">            - 网站无法使用 </span><br><span class="line">        - P0：block 个人工作 </span><br><span class="line">        - P1：暂时不 block 工作，但是周尺度需要解决 </span><br><span class="line">        - P2：暂时不 block 工作，周尺度外需要解决（配合 DDL-调整优先级） </span><br><span class="line">    - label(可选) </span><br><span class="line">        - BUG </span><br><span class="line">        - Feature </span><br><span class="line">    - 里程碑</span><br><span class="line">        - 需求提出月份</span><br><span class="line"> </span><br><span class="line"># 验收-After 工程已完成测试</span><br><span class="line"> </span><br><span class="line">- 工程会在完成 BUG Feature 后指定相关人员做验收，默认谁提 feature BUG 谁做验收（可能会存在特殊的指定）</span><br><span class="line">- 开发完成后会放入verify看板，验收通过后由author关闭issue</span><br></pre></td></tr></table></figure>

<h3 id="Gitlab-issue模板"><a href="#Gitlab-issue模板" class="headerlink" title="Gitlab issue模板"></a>Gitlab issue模板</h3><p>在项目 <code>.gitlab/issue_templates</code> 目录下的<strong>markdown</strong>文档，可以在新建<strong>issue</strong>时被选择。利用这个特性可以规范<strong>issue</strong>内容，督促<strong>author</strong>提供有效信息。如：</p>
<h4 id="feature-md"><a href="#feature-md" class="headerlink" title="feature.md"></a>feature.md</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 背景</span><br><span class="line"></span><br><span class="line">&gt; 回答为何要做：不做会有怎样的问题；做了会有怎样的收益；</span><br><span class="line"></span><br><span class="line"># 需求说明</span><br><span class="line"></span><br><span class="line">&gt; 回答要实现的目标是什么&#x3D;&#x3D;需求说明</span><br><span class="line"></span><br><span class="line"># 方案</span><br><span class="line"></span><br><span class="line">&gt; 回答如何去做, 提供参考思路或模型（可选-工程拍板）</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line"></span><br><span class="line">&gt; 回答何叫做到, 验证结果满足预期的标准有哪些, 是什么.（满足测试用例）</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="bug-md"><a href="#bug-md" class="headerlink" title="bug.md"></a>bug.md</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 步骤</span><br><span class="line"></span><br><span class="line">&gt; 本来想做的事情-描述</span><br><span class="line"></span><br><span class="line"># Bug行为</span><br><span class="line"></span><br><span class="line">&gt; 被 block 的点-描述</span><br><span class="line"></span><br><span class="line"># 期望行为</span><br><span class="line"></span><br><span class="line">&gt; 应该是什么样</span><br><span class="line"></span><br><span class="line"># 附件</span><br><span class="line"></span><br><span class="line">&gt; URL&#x2F;相关信息-id 号&#x2F;截图(整个界面的完整截图)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>管理</category>
      </categories>
      <tags>
        <tag>管理</tag>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>基于Gitlab进行开发团队管理的尝试——01.周报</title>
    <url>/2019/11/20/gitlab-manager-01/</url>
    <content><![CDATA[<blockquote>
<p>周报的目的在于团队间的沟通交流，总结每周的得失经验。不要流于形式，成为流水账。</p>
</blockquote>
<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>通过<strong>Gitlab issue</strong>管理周报，每周定时自动排版并发送周报邮件</p>
<span id="more"></span>

<h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><h3 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h3><ol>
<li>排版格式繁琐，outlook对程序员不算友好</li>
<li>不利于归档管理</li>
<li>督促团队写周报 -&gt; 当然这个主要原因在于leader。如果你写的周报没人关心，没人过问，那么为什么还要写？</li>
</ol>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ol>
<li><code>markdown</code>语法 + 统一管理主题、收件人等繁琐信息，让编写者专注于周报内容本事</li>
<li><strong>issue</strong>模板统一风格，提升周报质量&amp;价值</li>
<li>归档管理周报信息，通过<strong>issue</strong>本身的功能，可以进行人员索引、labels管理等</li>
<li>每周定时扫描并发送邮件。如果扫描时没有发现对应developer的<strong>周报issue</strong>，那么就广播一封remind邮件。</li>
</ol>
<blockquote>
<p>三体中逻辑通过摇篮系统，成为了执剑人(Damocleser)，建立黑暗森林威慑。</p>
</blockquote>
<p>整体流程如下:</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0NjNweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjczNHB4O2hlaWdodDo0NjNweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA3MzQgNDYzIiB3aWR0aD0iNzM0cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTcyIiB4PSIyMTguMjUiIHk9IjExIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUyIiB4PSIyMjguMjUiIHk9IjMyLjEzODciPmxpc3QgaXNzdWUgd2l0aCBsYWJlbCAiJiMyMTYwODsmIzI1MjUzOyI8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIyNTkuMjUsNjQuOTY4OCwzNDkuMjUsNjQuOTY4OCwzNjEuMjUsNzYuOTY4OCwzNDkuMjUsODguOTY4OCwyNTkuMjUsODguOTY4OCwyNDcuMjUsNzYuOTY4OCwyNTkuMjUsNjQuOTY4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTAiIHg9IjI1OS4yNSIgeT0iODAuNzc2OSI+aXNzdWVzIGlzIGVtcHR5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxIiB4PSIyMjYuMjUiIHk9Ijc0LjM3NDUiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNCIgeD0iMzYxLjI1IiB5PSI3NC4zNzQ1Ij5ubzwvdGV4dD48cGF0aCBkPSJNMTAsOTguOTY4OCBMMTAsMTI0LjEwMTYgQTAsMCAwIDAgMCAxMCwxMjQuMTAxNiBMMTA5LDEyNC4xMDE2IEEwLDAgMCAwIDAgMTA5LDEyNC4xMDE2IEwxMDksMTE2Ljk2ODggTDEyOSwxMTEuNTM1MiBMMTA5LDEwOC45Njg4IEwxMDksMTA4Ljk2ODggTDk5LDk4Ljk2ODggTDEwLDk4Ljk2ODggQTAsMCAwIDAgMCAxMCw5OC45Njg4ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTk5LDk4Ljk2ODggTDk5LDEwOC45Njg4IEwxMDksMTA4Ljk2ODggTDk5LDk4Ljk2ODggIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OCIgeD0iMTYiIHk9IjExNi4wMzU2Ij4mIzIxNDg3OyYjMzMwMjE7JiMyNjE1OTsmIzMzNDEwOyYjMjA1NTE7JiMyNjA4NTs8L3RleHQ+PGVsbGlwc2UgY3g9IjE0MCIgY3k9IjExMS41MzUyIiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjA7Ii8+PGVsbGlwc2UgY3g9IjE0MCIgY3k9IjExMS41MzUyIiBmaWxsPSIjMjIyMjIyIiByeD0iNiIgcnk9IjYiIHN0eWxlPSJzdHJva2U6IzExMTExMTtzdHJva2Utd2lkdGg6MS4wOyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDQiIHg9IjQzNi41IiB5PSI5OC45Njg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODQiIHg9IjQ0Ni41IiB5PSIxMjAuMTA3NCI+bGlzdCBkZXZlbG9wZXI8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIzOTksMTUyLjkzNzUsNTc4LDE1Mi45Mzc1LDU5MCwxNjQuOTM3NSw1NzgsMTc2LjkzNzUsMzk5LDE3Ni45Mzc1LDM4NywxNjQuOTM3NSwzOTksMTUyLjkzNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3OSIgeD0iMzk5IiB5PSIxNjguNzQ1NiI+Z2V0IHdlZWtseSBpc3N1ZSBieSBkZXZlbG9wZXI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjM2NiIgeT0iMTYyLjM0MzMiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNCIgeD0iNTkwIiB5PSIxNjIuMzQzMyI+bm88L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI0NiIgeD0iMjIwIiB5PSIxODYuOTM3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNiIgeD0iMjMwIiB5PSIyMDguMDc2MiI+cGFyc2UgbWFya2Rvd24gaXNzdWUgdG8gaHRtbCBmb3JtYXQ8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjM2NCIgeD0iMTYxIiB5PSIyNDAuOTA2MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0NCIgeD0iMTcxIiB5PSIyNjIuMDQ0OSI+YXJjaGl2ZSB3ZWVrbHkgaXNzdWUuKGVkaXQgbGFiZWwgZnJvbSAiJiMyMTYwODsmIzI1MjUzOyIgdG8gIiYjMjE2MDg7JiMyNTI1MzsmIzI0NDAyOyYjMjY3MjM7Iik8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3OCIgeD0iNTQ1IiB5PSIxODYuOTM3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OCIgeD0iNTU1IiB5PSIyMDguMDc2MiI+YXV0byB3cml0ZSBhIHJlbWluZCBlbWFpbCE8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI0ODguNSwyODAuODc1LDUwMC41LDI5Mi44NzUsNDg4LjUsMzA0Ljg3NSw0NzYuNSwyOTIuODc1LDQ4OC41LDI4MC44NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMTYiIHg9IjM4MC41IiB5PSIzMjQuODc1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk2IiB4PSIzOTAuNSIgeT0iMzQ2LjAxMzciPmZpbGwgc3ViamVjdChsYXN0IHdlZWsgTU9OflNVTik8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg2IiB4PSI0NDUuNSIgeT0iMzc4Ljg0MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NiIgeD0iNDU1LjUiIHk9IjM5OS45ODI0Ij5zZW5kIGVtYWlsPC90ZXh0PjxlbGxpcHNlIGN4PSI0ODguNSIgY3k9IjQ0Mi44MTI1IiBmaWxsPSJub25lIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoyLjU7IiB4MT0iNDgyLjMxMjgiIHgyPSI0OTQuNjg3MiIgeTE9IjQzNi42MjUzIiB5Mj0iNDQ4Ljk5OTciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjIuNTsiIHgxPSI0OTQuNjg3MiIgeDI9IjQ4Mi4zMTI4IiB5MT0iNDM2LjYyNTMiIHkyPSI0NDguOTk5NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM0MyIgeDI9IjM0MyIgeTE9IjIyMC45MDYzIiB5Mj0iMjQwLjkwNjMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMzOSwyMzAuOTA2MywzNDMsMjQwLjkwNjMsMzQ3LDIzMC45MDYzLDM0MywyMzQuOTA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzg3IiB4Mj0iMzQzIiB5MT0iMTY0LjkzNzUiIHkyPSIxNjQuOTM3NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM0MyIgeDI9IjM0MyIgeTE9IjE2NC45Mzc1IiB5Mj0iMTg2LjkzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMzOSwxNzYuOTM3NSwzNDMsMTg2LjkzNzUsMzQ3LDE3Ni45Mzc1LDM0MywxODAuOTM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTkwIiB4Mj0iNjM0IiB5MT0iMTY0LjkzNzUiIHkyPSIxNjQuOTM3NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjYzNCIgeDI9IjYzNCIgeTE9IjE2NC45Mzc1IiB5Mj0iMTg2LjkzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYzMCwxNzYuOTM3NSw2MzQsMTg2LjkzNzUsNjM4LDE3Ni45Mzc1LDYzNCwxODAuOTM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzQzIiB4Mj0iMzQzIiB5MT0iMjc0Ljg3NSIgeTI9IjI5Mi44NzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzNDMiIHgyPSI0NzYuNSIgeTE9IjI5Mi44NzUiIHkyPSIyOTIuODc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NjYuNSwyODguODc1LDQ3Ni41LDI5Mi44NzUsNDY2LjUsMjk2Ljg3NSw0NzAuNSwyOTIuODc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI2MzQiIHgyPSI2MzQiIHkxPSIyMjAuOTA2MyIgeTI9IjI5Mi44NzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI2MzQiIHgyPSI1MDAuNSIgeTE9IjI5Mi44NzUiIHkyPSIyOTIuODc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MTAuNSwyODguODc1LDUwMC41LDI5Mi44NzUsNTEwLjUsMjk2Ljg3NSw1MDYuNSwyOTIuODc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0ODguNSIgeDI9IjQ4OC41IiB5MT0iMTMyLjkzNzUiIHkyPSIxNTIuOTM3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDg0LjUsMTQyLjkzNzUsNDg4LjUsMTUyLjkzNzUsNDkyLjUsMTQyLjkzNzUsNDg4LjUsMTQ2LjkzNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQ4OC41IiB4Mj0iNDg4LjUiIHkxPSIzMDQuODc1IiB5Mj0iMzI0Ljg3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDg0LjUsMzE0Ljg3NSw0ODguNSwzMjQuODc1LDQ5Mi41LDMxNC44NzUsNDg4LjUsMzE4Ljg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDg4LjUiIHgyPSI0ODguNSIgeTE9IjM1OC44NDM4IiB5Mj0iMzc4Ljg0MzgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ4NC41LDM2OC44NDM4LDQ4OC41LDM3OC44NDM4LDQ5Mi41LDM2OC44NDM4LDQ4OC41LDM3Mi44NDM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0ODguNSIgeDI9IjQ4OC41IiB5MT0iNDEyLjgxMjUiIHkyPSI0MzIuODEyNSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDg0LjUsNDIyLjgxMjUsNDg4LjUsNDMyLjgxMjUsNDkyLjUsNDIyLjgxMjUsNDg4LjUsNDI2LjgxMjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI0Ny4yNSIgeDI9IjE0MCIgeTE9Ijc2Ljk2ODgiIHkyPSI3Ni45Njg4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTQwIiB4Mj0iMTQwIiB5MT0iNzYuOTY4OCIgeTI9IjEwMC41MzUyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzYsOTAuNTM1MiwxNDAsMTAwLjUzNTIsMTQ0LDkwLjUzNTIsMTQwLDk0LjUzNTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM2MS4yNSIgeDI9IjQ4OC41IiB5MT0iNzYuOTY4OCIgeTI9Ijc2Ljk2ODgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0ODguNSIgeDI9IjQ4OC41IiB5MT0iNzYuOTY4OCIgeTI9Ijk4Ljk2ODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ4NC41LDg4Ljk2ODgsNDg4LjUsOTguOTY4OCw0OTIuNSw4OC45Njg4LDQ4OC41LDkyLjk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjMwNC4yNSIgeDI9IjMwNC4yNSIgeTE9IjQ0Ljk2ODgiIHkyPSI2NC45Njg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMDAuMjUsNTQuOTY4OCwzMDQuMjUsNjQuOTY4OCwzMDguMjUsNTQuOTY4OCwzMDQuMjUsNTguOTY4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PCEtLVNSQz1bUFAxMUppQ200NE50RVNNR0xSQlgwQ2FQQTBsNDBQbmNKNHA3U01IRjZzTTMxMm9Ha2E2bVdJcjJiVFpyMTNyRWVYdTNycWNmQWhtUVV4eFZwRnlQQVNVV2Q1aVlqOGVoODU0V0dUb19fR3BoSlBuN0lhOElzaXdoMDdOM05HZlNPR3I5WG93RG0xXzdmV2I1UkhZMUs3QXUwVklsc190cFJsWlN4alRGX1VGQnlCNDkzUXBCODhzRzc0OUljbjZKWExyQU4yNlAxY3FVN1dfcHh2MlhITG5HRHNyUVQyVlBsc3EyZ1g3TWV4TW1ZekFxelZJRDNMSWkyUUluTWQxLUtXaXhoekdBcHVQUzliV2dkbEFHcmtZX0swd1NnVXZ0eHlGTlR2b0VoN0N4OHRkZm5RckxGWFMxNWhOb3JiNEJISFZ2Q0dlYkhfVEk0TzVSNWxTdXZ1STQ2cHQzclZOaXVVUHNEZXQ4NzF1OVVVSkJObTAwXS0tPjwvZz48L3N2Zz4='>

<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><p>对周报编写方来说，只需要在<strong>issue</strong>中选择<strong>周报</strong>模板并添加对应<strong>label</strong>即可。</p>
<h3 id="Gitlab-设置"><a href="#Gitlab-设置" class="headerlink" title="Gitlab 设置"></a>Gitlab 设置</h3><ol>
<li>添加<strong>label</strong>，命名为<code>周报</code></li>
<li>在项目 <code>.gitlab/issue_templates</code> 目录下新建<code>周报.md</code>作为模板，可以在新建<strong>issue</strong>时被选择。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## 上周最重要的“3”件事</span><br><span class="line"></span><br><span class="line">1. </span><br><span class="line"></span><br><span class="line">## 本周最重要的“3”个目标</span><br><span class="line"></span><br><span class="line">1. </span><br><span class="line"></span><br><span class="line">## 遇到的问题和感受</span><br><span class="line"></span><br><span class="line">1. </span><br></pre></td></tr></table></figure>

<h3 id="扫描job"><a href="#扫描job" class="headerlink" title="扫描job"></a>扫描job</h3><p>基于kotlin实现一版定时任务</p>
<p>dependents:</p>
<ol>
<li>h2 -&gt; 内存数据库，用于存储<strong>developer</strong>信息</li>
<li>commonmark -&gt; 用于<strong>markdown</strong>转换为<strong>html</strong>格式</li>
<li>okhttp &amp; fastjson -&gt; <strong>gitlab</strong> api调用及解析</li>
</ol>
<p>核心代码如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;\$&#123;weekly.cron&#125;&quot;)</span></span><br><span class="line"><span class="function">fun <span class="title">checkWeeklyIssue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;start weekly job ! weeklyProjectList:&#123;&#125;&quot;</span>, weeklyProjectList)</span><br><span class="line">    val nameMapWeeklyIssue = weeklyProjectList.flatMap &#123;</span><br><span class="line">        gitlabClient.listOpenProjectIssue(it)</span><br><span class="line">    &#125;.filter &#123; issue -&gt;</span><br><span class="line">        issue.getJSONArray(<span class="string">&quot;labels&quot;</span>).contains(WEEKLY_LABEL)</span><br><span class="line">    &#125;.filter &#123; issue -&gt;</span><br><span class="line">        !issue.getJSONArray(<span class="string">&quot;labels&quot;</span>).contains(WEEKLY_ARCHIVE_LABEL)</span><br><span class="line">    &#125;.map &#123; issue -&gt;</span><br><span class="line">        val name = issue.getJSONObject(<span class="string">&quot;author&quot;</span>).getString(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        <span class="function">name to <span class="title">WeeklyIssue</span><span class="params">(issue.getIntValue(<span class="string">&quot;project_id&quot;</span>)</span>, issue.<span class="title">getIntValue</span><span class="params">(<span class="string">&quot;iid&quot;</span>)</span>, name, issue.<span class="title">getString</span><span class="params">(<span class="string">&quot;description&quot;</span>)</span>)</span></span><br><span class="line"><span class="function">    &#125;.<span class="title">toMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    log.<span class="title">info</span><span class="params">(<span class="string">&quot;map gitlab issue data! nameMapWeeklyIssue:&#123;&#125;&quot;</span>, nameMapWeeklyIssue)</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 如果一个记录也没有，可能是节假日导致。此时不发生提醒</span></span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="params">(nameMapWeeklyIssue.isNotEmpty()</span>) </span>&#123;</span><br><span class="line">        developerRepository.findAll().forEach &#123;</span><br><span class="line">            val weeklyIssue = nameMapWeeklyIssue[it.name]</span><br><span class="line">            <span class="keyword">this</span>.sendEmail(weeklyIssue, it)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">sendEmail</span><span class="params">(weeklyIssue: WeeklyIssue?, developer: Developer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (weeklyIssue == <span class="keyword">null</span>) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;send a remind email! name:&#123;&#125;&quot;</span>, developer.name)</span><br><span class="line">        emailClient.send(fillSubject(developer.name), <span class="string">&quot;I am $&#123;developer.name&#125;. I do not write a weekly! Please remind me when you see me!&quot;</span>, developer.receivers)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;send a weekly email! name:&#123;&#125;&quot;</span>, developer.name)</span><br><span class="line">        val content = renderer.render(parser.parse(weeklyIssue.description))</span><br><span class="line">        emailClient.send(fillSubject(developer.name), content, developer.receivers)</span><br><span class="line">        gitlabClient.editIssueLabels(weeklyIssue.projectId, weeklyIssue.issueId, WEEKLY_ARCHIVE_LABEL, <span class="keyword">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">fillSubject</span><span class="params">(name: String)</span>: String </span>&#123;</span><br><span class="line">    val lastWeek = LocalDate.now().minusWeeks(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;[周报][XX工程][$name][$&#123;lastWeek.with(DayOfWeek.MONDAY)&#125;~$&#123;lastWeek.with(DayOfWeek.SUNDAY)&#125;]&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>节假日如何处理？ 如果一包含<strong>周报</strong>label的issue都没有，认为是节假日，跳过后续处理。非周一发送，由Leader手动触发</li>
<li>SLA？不保障，手动触发即可</li>
</ol>
]]></content>
      <categories>
        <category>管理</category>
      </categories>
      <tags>
        <tag>管理</tag>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>基于Gitlab进行开发团队管理的尝试——02.成员负载可视化</title>
    <url>/2019/11/28/gitlab-manager-02/</url>
    <content><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>通过图表直观展示团队成员工作负载、贡献、以及项目进度等信息<br>核心目的: 细化工作量, 通过可量化、可追踪的方式, 把控项目进度</p>
<p>效果如下:</p>
<p><img src="http://img.yuheng.wang/mweb/00.png" alt="00"></p>
<p>高价值指标包括: </p>
<ol>
<li>成员当前issue数量</li>
<li>当前版本项目issue进度及分布</li>
<li>成员参与issue数量</li>
<li>bug数量趋势</li>
</ol>
<span id="more"></span>

<h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><ol>
<li>通过燃尽图追踪项目进度及任务pipeline分布, 实时掌握项目进度, 降低延期风险</li>
<li>展示成员负载, 方便<strong>high-level</strong>协调调度开发资源</li>
<li>量化成员工作贡献</li>
<li>分析项目质量趋势及问题分布</li>
</ol>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxOTRweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjU2MnB4O2hlaWdodDoxOTRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1NjIgMTk0IiB3aWR0aD0iNTYycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tZW50aXR5IGdpdGxhYi0tPjxnIGlkPSJlbGVtX2dpdGxhYiI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIxNiwxOCwyNiw4LDk4LDgsOTgsNDQuMjk2OSw4OCw1NC4yOTY5LDE2LDU0LjI5NjksMTYsMTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijg4IiB4Mj0iOTgiIHkxPSIxOCIgeTI9IjgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNiIgeDI9Ijg4IiB5MT0iMTgiIHkyPSIxOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijg4IiB4Mj0iODgiIHkxPSIxOCIgeTI9IjU0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MiIgeD0iMzEiIHk9IjQwLjk5NTEiPmdpdGxhYjwvdGV4dD48L2c+PCEtLWVudGl0eSBrZWVwZXItLT48ZyBpZD0iZWxlbV9rZWVwZXIiPjxlbGxpcHNlIGN4PSIyNzUiIGN5PSIyMyIgZmlsbD0iI0YxRjFGMSIgcng9IjEyIiByeT0iMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjcxLDExLDI3Nyw2LDI3NSwxMSwyNzcsMTYsMjcxLDExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MiIgeD0iMjQ5IiB5PSI1MS45OTUxIj5rZWVwZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbWV0YWJhc2UtLT48ZyBpZD0iZWxlbV9tZXRhYmFzZSI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIzNjQsMTgsMzc0LDgsNDc2LDgsNDc2LDQ0LjI5NjksNDY2LDU0LjI5NjksMzY0LDU0LjI5NjksMzY0LDE4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NjYiIHgyPSI0NzYiIHkxPSIxOCIgeTI9IjgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNjQiIHgyPSI0NjYiIHkxPSIxOCIgeTI9IjE4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDY2IiB4Mj0iNDY2IiB5MT0iMTgiIHkyPSI1NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIiIHg9IjM3OSIgeT0iNDAuOTk1MSI+bWV0YWJhc2U8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZGItLT48ZyBpZD0iZWxlbV9kYiI+PHBhdGggZD0iTTMyNy41LDE0MiBDMzI3LjUsMTMyIDM0NywxMzIgMzQ3LDEzMiBDMzQ3LDEzMiAzNjYuNSwxMzIgMzY2LjUsMTQyIEwzNjYuNSwxNjcuMjk2OSBDMzY2LjUsMTc3LjI5NjkgMzQ3LDE3Ny4yOTY5IDM0NywxNzcuMjk2OSBDMzQ3LDE3Ny4yOTY5IDMyNy41LDE3Ny4yOTY5IDMyNy41LDE2Ny4yOTY5IEwzMjcuNSwxNDIgIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzI3LjUsMTQyIEMzMjcuNSwxNTIgMzQ3LDE1MiAzNDcsMTUyIEMzNDcsMTUyIDM2Ni41LDE1MiAzNjYuNSwxNDIgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOSIgeD0iMzM3LjUiIHk9IjE2OC45OTUxIj5kYjwvdGV4dD48L2c+PCEtLXJldmVyc2UgbGluayBnaXRsYWIgdG8ga2VlcGVyLS0+PGcgaWQ9ImxpbmtfZ2l0bGFiX2tlZXBlciI+PHBhdGggZD0iTTEwNC4wMDQxLDMxIEMxNDguMjgzLDMxIDIxMS40ODYsMzEgMjQ4Ljg5MiwzMSAiIGZpbGw9Im5vbmUiIGlkPSJnaXRsYWItYmFja3RvLWtlZXBlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5OC4wMDQxLDMxLDEwNy4wMDQxLDM1LDEwMy4wMDQxLDMxLDEwNy4wMDQxLDI3LDk4LjAwNDEsMzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNCIgeD0iMTE2LjUiIHk9IjI0LjA2NjkiPmxvb3AgZmluZEFsbCBpc3N1ZXM8L3RleHQ+PC9nPjwhLS1saW5rIGtlZXBlciB0byBkYi0tPjxnIGlkPSJsaW5rX2tlZXBlcl9kYiI+PHBhdGggZD0iTTI2OC4zNjksNTUuMDM2IEMyNjUuNTY4LDY5LjM1IDI2NC40NjQsODcuNjg0MiAyNzIsMTAyIEMyODMuNTUxLDEyMy45NDM3IDMwMy42NDA2LDEzNS45NDk1IDMyMS43MDU2LDE0My44MDQgIiBmaWxsPSJub25lIiBpZD0ia2VlcGVyLXRvLWRiIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMyNy4yMDgsMTQ2LjE5NjQsMzIwLjU0OTMsMTM4LjkzOTUsMzIyLjYyMjcsMTQ0LjIwMjcsMzE3LjM1OTUsMTQ2LjI3NjEsMzI3LjIwOCwxNDYuMTk2NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAzIiB4PSIyNzMiIHk9Ijk4LjA2NjkiPnJlZnJlc2ggaXNzdWUgZGI8L3RleHQ+PC9nPjwhLS1saW5rIG1ldGFiYXNlIHRvIGRiLS0+PGcgaWQ9ImxpbmtfbWV0YWJhc2VfZGIiPjxwYXRoIGQ9Ik00MDguMTI0LDU0LjMxMyBDNDAwLjYwNSw2OC4xODUgMzkwLjUzNCw4Ni4zMDU2IDM4MSwxMDIgQzM3NC45MzcsMTExLjk4MDYgMzcxLjIxMDQsMTE3LjgxMjQgMzY1LjA5NzQsMTI2Ljk0NTMgIiBmaWxsPSJub25lIiBpZD0ibWV0YWJhc2UtdG8tZGIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzYxLjc2LDEzMS45MzE0LDM3MC4wOTAyLDEyNi42NzcxLDM2NC41NDEyLDEyNy43NzYzLDM2My40NDIsMTIyLjIyNzIsMzYxLjc2LDEzMS45MzE0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjQiIHg9IjM5MCIgeT0iOTguMDY2OSI+cmVhZCBpc3N1ZSBpbmZvICZhbXA7IGFuYWx5c2lzPC90ZXh0PjwvZz48IS0tU1JDPVtOU3FuM1c5MTIwTkdkYkRHc1VxNUI0bXkyWUVDNFg0c21uWlp4SHNwdW5Qc3ZGLU5abVNCTmhLUjVSWTR6blE2VHY1TDZlOV9rdVRxQWZHMkpEazFOMTFXY2lNYXprS3E1dXZlNElqTVRKd1JlTU8tOU5WQXlWOTFVUjBjaktkVURaNEktN3R2S3lJSmdEVjAwdkFKbExGcDBtMDBdLS0+PC9nPjwvc3ZnPg=='>

<ol>
<li>定时轮询 <code>gitlab</code>相关项目的<code>issue</code>列表并持久化。<ol>
<li>为了减少工作量, 直接存储json字段, 查询时解析</li>
</ol>
</li>
<li>通过 <code>metabase</code> 展示数据指标图表</li>
</ol>
<h3 id="问题1-一个issue经过多人开发-前端-后端-工作量如何计算？"><a href="#问题1-一个issue经过多人开发-前端-后端-工作量如何计算？" class="headerlink" title="问题1: 一个issue经过多人开发(前端+后端), 工作量如何计算？"></a>问题1: 一个issue经过多人开发(前端+后端), 工作量如何计算？</h3><p>通过成员参与过的issue进行计算, 可以做到相对准确</p>
<h3 id="DB结构定义"><a href="#DB结构定义" class="headerlink" title="DB结构定义"></a>DB结构定义</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> if <span class="keyword">not</span> <span class="keyword">exists</span> `issue`</span><br><span class="line">(</span><br><span class="line">    `id`           <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;标识&#x27;</span>, </span><br><span class="line">    `issue_iid`    <span class="type">int</span>(<span class="number">10</span>)             <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;issue标识&#x27;</span>, </span><br><span class="line">    `group_id`     <span class="type">int</span>(<span class="number">10</span>)             <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组标识&#x27;</span>, </span><br><span class="line">    `group_name`   <span class="type">varchar</span>(<span class="number">128</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组名&#x27;</span>, </span><br><span class="line">    `project_id`   <span class="type">int</span>(<span class="number">10</span>)             <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;项目标识&#x27;</span>, </span><br><span class="line">    `project_name` <span class="type">varchar</span>(<span class="number">128</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;项目名&#x27;</span>, </span><br><span class="line">    `state`        <span class="type">varchar</span>(<span class="number">128</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>, </span><br><span class="line">    `title`        <span class="type">varchar</span>(<span class="number">256</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;标题&#x27;</span>, </span><br><span class="line">    `labels`       <span class="type">varchar</span>(<span class="number">128</span>) COMMENT <span class="string">&#x27;标签&#x27;</span>, </span><br><span class="line">    `description`  text COMMENT <span class="string">&#x27;描述&#x27;</span>, </span><br><span class="line">    `author`       json                <span class="keyword">not</span> <span class="keyword">null</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>, </span><br><span class="line">    `assignee`     json COMMENT <span class="string">&#x27;指派人&#x27;</span>, </span><br><span class="line">    `milestone`    json COMMENT <span class="string">&#x27;里程碑&#x27;</span>, </span><br><span class="line">    `due_date`     <span class="type">date</span> COMMENT <span class="string">&#x27;到期日&#x27;</span>, </span><br><span class="line">    `created_at`   datetime            <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>, </span><br><span class="line">    `updated_at`   datetime COMMENT <span class="string">&#x27;修改时间&#x27;</span>, </span><br><span class="line">    `closed_at`    datetime COMMENT <span class="string">&#x27;关闭时间&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8</span><br><span class="line">  ROW_FORMAT <span class="operator">=</span> <span class="keyword">DYNAMIC</span> COMMENT <span class="operator">=</span><span class="string">&#x27;任务&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> if <span class="keyword">not</span> <span class="keyword">exists</span> `participant`</span><br><span class="line">(</span><br><span class="line">    `id`           <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;标识&#x27;</span>, </span><br><span class="line">    `issue_iid`    <span class="type">int</span>(<span class="number">10</span>)             <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;issue标识&#x27;</span>, </span><br><span class="line">    `group_id`     <span class="type">int</span>(<span class="number">10</span>)             <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组标识&#x27;</span>, </span><br><span class="line">    `group_name`   <span class="type">varchar</span>(<span class="number">128</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组名&#x27;</span>, </span><br><span class="line">    `project_id`   <span class="type">int</span>(<span class="number">10</span>)             <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;项目标识&#x27;</span>, </span><br><span class="line">    `project_name` <span class="type">varchar</span>(<span class="number">128</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;项目名&#x27;</span>, </span><br><span class="line">    `title`        <span class="type">varchar</span>(<span class="number">256</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;标题&#x27;</span>, </span><br><span class="line">    `name`         <span class="type">varchar</span>(<span class="number">128</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>, </span><br><span class="line">    `username`     <span class="type">varchar</span>(<span class="number">128</span>)        <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8</span><br><span class="line">  ROW_FORMAT <span class="operator">=</span> <span class="keyword">DYNAMIC</span> COMMENT <span class="operator">=</span><span class="string">&#x27;参与者&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="参考指标SQL"><a href="#参考指标SQL" class="headerlink" title="参考指标SQL"></a>参考指标SQL</h3><ol>
<li>显示json字段中的中文, 需要通过 <code>-&gt;&gt;</code>, 如 <code>issue.assignee-&gt;&gt;&#39;$.name&#39;</code></li>
<li>metabase 可以通过 <code>&#123;&#123;param&#125;&#125;</code> 指定参数变量, 如 <code>milestone-&gt;&gt; &#39;$.title&#39;= &#123;&#123;milestone&#125;&#125;</code></li>
</ol>
<h4 id="1-成员参与工作量"><a href="#1-成员参与工作量" class="headerlink" title="1. 成员参与工作量"></a>1. 成员参与工作量</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `participant`.`name` <span class="keyword">AS</span> `name`, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">AS</span> `count`</span><br><span class="line"><span class="keyword">FROM</span> `participant`</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> `participant`.`name`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> `count` <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h4 id="2-成员当前工作量"><a href="#2-成员当前工作量" class="headerlink" title="2. 成员当前工作量"></a>2. 成员当前工作量</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `issue`.`assignee`<span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="string">&#x27;$.name&#x27;</span> <span class="keyword">as</span> `owner`, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">AS</span> `count`</span><br><span class="line"><span class="keyword">FROM</span> `issue`</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> `issue`.`assignee` </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> `count`</span><br></pre></td></tr></table></figure>

<h4 id="3-当前版本进度"><a href="#3-当前版本进度" class="headerlink" title="3. 当前版本进度"></a>3. 当前版本进度</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">case</span></span><br><span class="line"> <span class="keyword">when</span> `issue`.labels <span class="keyword">like</span> <span class="string">&#x27;%To Do%&#x27;</span> <span class="keyword">then</span> &quot;To Do&quot;</span><br><span class="line">    <span class="keyword">when</span> labels <span class="keyword">like</span> <span class="string">&#x27;%Doing%&#x27;</span> <span class="keyword">then</span> &quot;Doing&quot;</span><br><span class="line">    <span class="keyword">when</span> labels <span class="keyword">like</span> <span class="string">&#x27;%verify%&#x27;</span> <span class="keyword">then</span> &quot;Verify&quot;</span><br><span class="line">    <span class="keyword">ELSE</span> &quot;BACKLOG&quot;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">as</span> <span class="string">&#x27;progress&#x27;</span>, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">AS</span> `count`</span><br><span class="line"><span class="keyword">FROM</span> `issue`</span><br><span class="line">where state=&#x27;opened&#x27; and project_name=&#x27;keeper&#x27; and milestone-&gt;&gt; &#x27;$.title&#x27;= &#123;&#123;milestone&#125;&#125;</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> progress</span><br></pre></td></tr></table></figure>

<h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><ol>
<li>每个issue表示的工作量&lt;2天, 耗时尽量统一</li>
<li>通过 <strong>00.通过issue管理需求</strong> 中对board及label的操作, 定义issue生命周期</li>
<li>未加入<strong>milestone</strong>的issue可以通过<strong>创建时间</strong>管理, 也可以加入默认时间milestone中</li>
</ol>
]]></content>
      <categories>
        <category>管理</category>
      </categories>
      <tags>
        <tag>管理</tag>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>基于Gitlab进行开发团队管理的尝试——03.Dingding消息@人</title>
    <url>/2020/02/03/gitlab-manager-03/</url>
    <content><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>监听<code>Gitlab Hook</code>事件, 紧急消息通过<code>钉钉机器人</code>发送至钉钉群组, 并<code>@(提醒)</code>相关方. 同时自动流转issue的<code>pipeline</code>.</p>
<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p>新建紧要issue会在钉钉群内收到下列消息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xxx 创建了一个 [P0 issue] 给你，请尽快确认并处理 </span><br><span class="line"> Link -&gt; https:&#x2F;&#x2F;gitlab.com&#x2F;wangyuheng77&#x2F;integration&#x2F;issues&#x2F;1 </span><br><span class="line"> title -&gt; 提供issue变更钉钉消息通知 </span><br><span class="line">@wangyuheng</span><br></pre></td></tr></table></figure>

<p>已发布的issue会</p>
<ol>
<li>issue 自动从 <code>Doing</code> 变更为 <code>Verify</code></li>
<li>issue assignee 从开发者变更为author</li>
<li>钉钉群收到消息提醒 @author 进行验收工作</li>
</ol>
<span id="more"></span>

<h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><ol>
<li>紧急事项实时提醒到人</li>
<li>定制pipeline &amp; 自动流转</li>
</ol>
<h3 id="为什么不通过钉钉自带的gitlab机器人-或者-gitlab-notify-email？"><a href="#为什么不通过钉钉自带的gitlab机器人-或者-gitlab-notify-email？" class="headerlink" title="为什么不通过钉钉自带的gitlab机器人 或者 gitlab notify email？"></a>为什么不通过钉钉自带的gitlab机器人 或者 gitlab notify email？</h3><ol>
<li>发送的消息过多, 会忽略有意义的信息</li>
<li>不能 @ 到相关的人, 达不到提醒的作用</li>
</ol>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyODdweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQ5NXB4O2hlaWdodDoyODdweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0OTUgMjg3IiB3aWR0aD0iNDk1cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjExMC41MzEzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0NzkiIHg9IjEwIiB5PSIxMjQuNTYyNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIxMDYiIHgyPSIxMDYiIHkxPSIzNi4yOTY5IiB5Mj0iMjUyLjA5MzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMjM3IiB4Mj0iMjM3IiB5MT0iMzYuMjk2OSIgeTI9IjI1Mi4wOTM4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjQ0MCIgeDI9IjQ0MCIgeTE9IjM2LjI5NjkiIHkyPSIyNTIuMDkzOCIvPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTYiIHg9Ijc4IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9Ijg1IiB5PSIyNC45OTUxIj5naXRsYWI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NiIgeD0iNzgiIHk9IjI1MS4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9Ijg1IiB5PSIyNzEuMDg4OSI+Z2l0bGFiPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjYiIHg9IjIwNCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyIiB4PSIyMTEiIHk9IjI0Ljk5NTEiPmtlZXBlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY2IiB4PSIyMDQiIHk9IjI1MS4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIiIHg9IjIxMSIgeT0iMjcxLjA4ODkiPmtlZXBlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc4IiB4PSI0MDEiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NCIgeD0iNDA4IiB5PSIyNC45OTUxIj5EaW5nZGluZzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc4IiB4PSI0MDEiIHk9IjI1MS4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjQiIHg9IjQwOCIgeT0iMjcxLjA4ODkiPkRpbmdkaW5nPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjI1LDYzLjQyOTcsMjM1LDY3LjQyOTcsMjI1LDcxLjQyOTcsMjI5LDY3LjQyOTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEwNiIgeDI9IjIzMSIgeTE9IjY3LjQyOTciIHkyPSI2Ny40Mjk3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzUiIHg9IjExMyIgeT0iNjIuMzYzOCI+bGlzdGVuIGV2ZW50PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIzNyIgeDI9IjI3OSIgeTE9Ijk2LjU2MjUiIHkyPSI5Ni41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjc5IiB4Mj0iMjc5IiB5MT0iOTYuNTYyNSIgeTI9IjEwOS41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjM4IiB4Mj0iMjc5IiB5MT0iMTA5LjU2MjUiIHkyPSIxMDkuNTYyNSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjQ4LDEwNS41NjI1LDIzOCwxMDkuNTYyNSwyNDgsMTEzLjU2MjUsMjQ0LDEwOS41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAiIHg9IjI0NCIgeT0iOTEuNDk2NiI+cmVzb2x2ZSBldmVudCBtc2c8L3RleHQ+PHBhdGggZD0iTTEwLDEyNC41NjI1IEw3NiwxMjQuNTYyNSBMNzYsMTMxLjY5NTMgTDY2LDE0MS42OTUzIEwxMCwxNDEuNjk1MyBMMTAsMTI0LjU2MjUgIiBmaWxsPSIjRUVFRUVFIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjExMC41MzEzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0NzkiIHg9IjEwIiB5PSIxMjQuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMSIgeD0iMjUiIHk9IjEzNy42Mjk0Ij5hbHQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSI5MSIgeT0iMTM2Ljc3MjkiPltpc0VtZXJnZW5jeV08L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MjgsMTU4LjgyODEsNDM4LDE2Mi44MjgxLDQyOCwxNjYuODI4MSw0MzIsMTYyLjgyODEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIzNyIgeDI9IjQzNCIgeTE9IjE2Mi44MjgxIiB5Mj0iMTYyLjgyODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzkiIHg9IjI0NCIgeT0iMTU3Ljc2MjIiPnNlbmQgbXNnIHRvIGdyb3VwIGJ5IHJvYm90PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTE3LDE4Ny45NjA5LDEwNywxOTEuOTYwOSwxMTcsMTk1Ljk2MDksMTEzLDE5MS45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMTEiIHgyPSIyMzYiIHkxPSIxOTEuOTYwOSIgeTI9IjE5MS45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA3IiB4PSIxMjMiIHk9IjE4Ni44OTUiPnB1dCBuZXh0IHBpcGVsaW5lPC90ZXh0PjxwYXRoIGQ9Ik0yMCwyMDQuOTYwOSBMMjAsMjI5Ljk2MDkgTDIzMiwyMjkuOTYwOSBMMjMyLDIxNC45NjA5IEwyMjIsMjA0Ljk2MDkgTDIwLDIwNC45NjA5ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTIyMiwyMDQuOTYwOSBMMjIyLDIxNC45NjA5IEwyMzIsMjE0Ljk2MDkgTDIyMiwyMDQuOTYwOSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5MSIgeD0iMjYiIHk9IjIyMi4wMjc4Ij5jaGFuZ2UgYXNzaWduZWUgfCBjbG9zZSBpc3N1ZTwvdGV4dD48IS0tU1JDPVtOT3YxM2k4bTMwSmxVU0wtVzBfcW0wYVVhaFJSNDk0d0tVbk1MRUJuWDVPMlgyTFZsM2xvWDZaOXpwWVRTSVNCUXVTS3JJWldJWjV0NzdfWklpcmZ2UDVacmsxeUNhSXpwZ28xQ2NtRVJSeFM5S2VPc3RQR29sVzZPMWNYdmdNV3RyMXBkLXFGMlJqSlh4OE9YMHozWU9LZjJoNE5kTUdaNFlUM2RadlVteXJCOEJuZzM0QllZSTViUEpGSlhRd3pWVzQwXS0tPjwvZz48L3N2Zz4='>

<h3 id="gitlab-hook"><a href="#gitlab-hook" class="headerlink" title="gitlab hook"></a>gitlab hook</h3><p>在gitlab项目中配置hook地址并保存</p>
<p><img src="http://img.yuheng.wang/mweb/15807226521488.jpg"></p>
<h3 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h3><p>根据团队状况制定<code>pipeline</code>, 基于事件自动流转. 比如:</p>
<ol>
<li>新建<code>:WIP MR</code>时流转至doing</li>
<li>CICD流转至deploy</li>
<li>发布成功后流转至verify并修改assignee为author</li>
</ol>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxODlweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQwM3B4O2hlaWdodDoxODlweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0MDMgMTg5IiB3aWR0aD0iNDAzcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iNDAiIHgyPSI0MCIgeTE9IjM2LjI5NjkiIHkyPSIxNTQuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIxMTAiIHgyPSIxMTAiIHkxPSIzNi4yOTY5IiB5Mj0iMTU0LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMTcxIiB4Mj0iMTcxIiB5MT0iMzYuMjk2OSIgeTI9IjE1NC4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjIzOSIgeDI9IjIzOSIgeTE9IjM2LjI5NjkiIHkyPSIxNTQuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIzMDgiIHgyPSIzMDgiIHkxPSIzNi4yOTY5IiB5Mj0iMTU0LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMzcxIiB4Mj0iMzcxIiB5MT0iMzYuMjk2OSIgeTI9IjE1NC4yOTY5Ii8+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3MSIgeD0iNSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3IiB4PSIxMiIgeT0iMjQuOTk1MSI+YmFja2xvZzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjcxIiB4PSI1IiB5PSIxNTMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3IiB4PSIxMiIgeT0iMTczLjI5MiI+YmFja2xvZzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ4IiB4PSI4NiIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0IiB4PSI5MyIgeT0iMjQuOTk1MSI+dG9kbzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ4IiB4PSI4NiIgeT0iMTUzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNCIgeD0iOTMiIHk9IjE3My4yOTIiPnRvZG88L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NCIgeD0iMTQ0IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAiIHg9IjE1MSIgeT0iMjQuOTk1MSI+ZG9pbmc8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NCIgeD0iMTQ0IiB5PSIxNTMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwIiB4PSIxNTEiIHk9IjE3My4yOTIiPmRvaW5nPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjMiIHg9IjIwOCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5IiB4PSIyMTUiIHk9IjI0Ljk5NTEiPmRlcGxveTwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjYzIiB4PSIyMDgiIHk9IjE1My4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDkiIHg9IjIxNSIgeT0iMTczLjI5MiI+ZGVwbG95PC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTUiIHg9IjI4MSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxIiB4PSIyODgiIHk9IjI0Ljk5NTEiPnZlcmlmeTwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU1IiB4PSIyODEiIHk9IjE1My4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEiIHg9IjI4OCIgeT0iMTczLjI5MiI+dmVyaWZ5PC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTEiIHg9IjM0NiIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM3IiB4PSIzNTMiIHk9IjI0Ljk5NTEiPmNsb3NlPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTEiIHg9IjM0NiIgeT0iMTUzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNyIgeD0iMzUzIiB5PSIxNzMuMjkyIj5jbG9zZTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk4LDQ4LjI5NjksMTA4LDUyLjI5NjksOTgsNTYuMjk2OSwxMDIsNTIuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDAuNSIgeDI9IjEwNCIgeTE9IjUyLjI5NjkiIHkyPSI1Mi4yOTY5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTksNjIuMjk2OSwxNjksNjYuMjk2OSwxNTksNzAuMjk2OSwxNjMsNjYuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTEwIiB4Mj0iMTY1IiB5MT0iNjYuMjk2OSIgeTI9IjY2LjI5NjkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIyNy41LDc2LjI5NjksMjM3LjUsODAuMjk2OSwyMjcuNSw4NC4yOTY5LDIzMS41LDgwLjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE3MSIgeDI9IjIzMy41IiB5MT0iODAuMjk2OSIgeTI9IjgwLjI5NjkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE4Miw5MC4yOTY5LDE3Miw5NC4yOTY5LDE4Miw5OC4yOTY5LDE3OCw5NC4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjIuMDsiIHgxPSIyMjEuNSIgeDI9IjIzMS41IiB5MT0iODkuMjk2OSIgeTI9Ijk5LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjIuMDsiIHgxPSIyMjEuNSIgeDI9IjIzMS41IiB5MT0iOTkuMjk2OSIgeTI9Ijg5LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjIuMCwyLjA7IiB4MT0iMTc2IiB4Mj0iMjI2LjUiIHkxPSI5NC4yOTY5IiB5Mj0iOTQuMjk2OSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjk2LjUsMTA0LjI5NjksMzA2LjUsMTA4LjI5NjksMjk2LjUsMTEyLjI5NjksMzAwLjUsMTA4LjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIzOS41IiB4Mj0iMzAyLjUiIHkxPSIxMDguMjk2OSIgeTI9IjEwOC4yOTY5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxODIsMTE4LjI5NjksMTcyLDEyMi4yOTY5LDE4MiwxMjYuMjk2OSwxNzgsMTIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6Mi4wOyIgeDE9IjI5MC41IiB4Mj0iMzAwLjUiIHkxPSIxMTcuMjk2OSIgeTI9IjEyNy4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoyLjA7IiB4MT0iMjkwLjUiIHgyPSIzMDAuNSIgeTE9IjEyNy4yOTY5IiB5Mj0iMTE3LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjIuMCwyLjA7IiB4MT0iMTc2IiB4Mj0iMjk1LjUiIHkxPSIxMjIuMjk2OSIgeTI9IjEyMi4yOTY5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNTkuNSwxMzIuMjk2OSwzNjkuNSwxMzYuMjk2OSwzNTkuNSwxNDAuMjk2OSwzNjMuNSwxMzYuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzA4LjUiIHgyPSIzNjUuNSIgeTE9IjEzNi4yOTY5IiB5Mj0iMTM2LjI5NjkiLz48IS0tU1JDPVtJcWZDcGl4OUpyVkdqTENlb0tfOXZtOEg4NHZBVmNQVUVYVU8xN0RKMnRCb0F4YVdiNEE1QmE4NUgwSjhCcWlqb2FvaHY4OUdvNGdXOGExLVNhdi1TSWUwXS0tPjwvZz48L3N2Zz4='>

<h3 id="Emergency-issue"><a href="#Emergency-issue" class="headerlink" title="Emergency issue"></a>Emergency issue</h3><p>通过label判断是否为紧要消息, 比如 <code>Bug</code>、<code>P0</code>.</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0MzdweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQyNHB4O2hlaWdodDo0MzdweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0MjQgNDM3IiB3aWR0aD0iNDI0cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZWxsaXBzZSBjeD0iMjA2LjI1IiBjeT0iMjAiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTAwIiB4PSIxNTYuMjUiIHk9IjUwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODAiIHg9IjE2Ni4yNSIgeT0iNzEuMTM4NyI+cmVjZWl2ZSBob29rPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTUyLjI1LDE1Mi4zNzExLDI2MC4yNSwxNTIuMzcxMSwyNzIuMjUsMTY0LjM3MTEsMjYwLjI1LDE3Ni4zNzExLDE1Mi4yNSwxNzYuMzcxMSwxNDAuMjUsMTY0LjM3MTEsMTUyLjI1LDE1Mi4zNzExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDgiIHg9IjE1Mi4yNSIgeT0iMTY4LjE3OTIiPmNoYW5nZWRBc3NpZ25lZT88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjExOS4yNSIgeT0iMTYxLjc3NjkiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NyIgeD0iMjcyLjI1IiB5PSIxNjEuNzc2OSI+Y2hhbmdlZFRvVmVyaWZ5PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxODMiIHg9IjExIiB5PSIyMzQuNzczNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2MyIgeD0iMjEiIHk9IjI1NS45MTIxIj5zZW5kIGVtZXJnZW5jeSBtZXNzYWdlPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNjIuNSwxODYuMzcxMSwxNDIuNSwxODYuMzcxMSwxNTQuNSwxOTguMzcxMSwxNDIuNSwyMTAuMzcxMSw2Mi41LDIxMC4zNzExLDUwLjUsMTk4LjM3MTEsNjIuNSwxODYuMzcxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjEwNi41IiB5PSIyMjAuNTgxNSI+eWVzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgwIiB4PSI2Mi41IiB5PSIyMDIuMTc5MiI+aXNFbWVyZ2VuY3k/PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTAyLjUsMjg4Ljc0MjIsMTE0LjUsMzAwLjc0MjIsMTAyLjUsMzEyLjc0MjIsOTAuNSwzMDAuNzQyMiwxMDIuNSwyODguNzQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0OCIgeD0iMjM2IiB5PSIxODYuMzcxMSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyOCIgeD0iMjQ2IiB5PSIyMDcuNTA5OCI+c2VuZCB2ZXJpZnkgbWVzc2FnZTwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjIwNi4yNSwzMTguNzQyMiwyMTguMjUsMzMwLjc0MjIsMjA2LjI1LDM0Mi43NDIyLDE5NC4yNSwzMzAuNzQyMiwyMDYuMjUsMzE4Ljc0MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTg0Ljc1LDEwMy45Njg4LDIyNy43NSwxMDMuOTY4OCwyMzkuNzUsMTE1Ljk2ODgsMjI3Ljc1LDEyNy45Njg4LDE4NC43NSwxMjcuOTY4OCwxNzIuNzUsMTE1Ljk2ODgsMTg0Ljc1LDEwMy45Njg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMSIgeD0iMjEwLjI1IiB5PSIxMzguMTc5MiI+eWVzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQzIiB4PSIxODQuNzUiIHk9IjExOS43NzY5Ij5jbG9zZWQ/PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjA2LjI1LDM2Mi43NDIyLDIxOC4yNSwzNzQuNzQyMiwyMDYuMjUsMzg2Ljc0MjIsMTk0LjI1LDM3NC43NDIyLDIwNi4yNSwzNjIuNzQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGVsbGlwc2UgY3g9IjIwNi4yNSIgY3k9IjQxNi43NDIyIiBmaWxsPSJub25lIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoyLjU7IiB4MT0iMjAwLjA2MjgiIHgyPSIyMTIuNDM3MiIgeTE9IjQxMC41NTUiIHkyPSI0MjIuOTI5NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6Mi41OyIgeDE9IjIxMi40MzcyIiB4Mj0iMjAwLjA2MjgiIHkxPSI0MTAuNTU1IiB5Mj0iNDIyLjkyOTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMDYuMjUiIHgyPSIyMDYuMjUiIHkxPSIzMCIgeTI9IjUwIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDIuMjUsNDAsMjA2LjI1LDUwLDIxMC4yNSw0MCwyMDYuMjUsNDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEwMi41IiB4Mj0iMTAyLjUiIHkxPSIyMTAuMzcxMSIgeTI9IjIzNC43NzM0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5OC41LDIyNC43NzM0LDEwMi41LDIzNC43NzM0LDEwNi41LDIyNC43NzM0LDEwMi41LDIyOC43NzM0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNTQuNSIgeDI9IjIwNCIgeTE9IjE5OC4zNzExIiB5Mj0iMTk4LjM3MTEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwMCwyNDEuNzU3OCwyMDQsMjUxLjc1NzgsMjA4LDI0MS43NTc4LDIwNCwyNDUuNzU3OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjA0IiB4Mj0iMjA0IiB5MT0iMTk4LjM3MTEiIHkyPSIzMDAuNzQyMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIwNCIgeDI9IjExNC41IiB5MT0iMzAwLjc0MjIiIHkyPSIzMDAuNzQyMiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI0LjUsMjk2Ljc0MjIsMTE0LjUsMzAwLjc0MjIsMTI0LjUsMzA0Ljc0MjIsMTIwLjUsMzAwLjc0MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEwMi41IiB4Mj0iMTAyLjUiIHkxPSIyNjguNzQyMiIgeTI9IjI4OC43NDIyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5OC41LDI3OC43NDIyLDEwMi41LDI4OC43NDIyLDEwNi41LDI3OC43NDIyLDEwMi41LDI4Mi43NDIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNDAuMjUiIHgyPSIxMDIuNSIgeTE9IjE2NC4zNzExIiB5Mj0iMTY0LjM3MTEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMDIuNSIgeDI9IjEwMi41IiB5MT0iMTY0LjM3MTEiIHkyPSIxODYuMzcxMSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTguNSwxNzYuMzcxMSwxMDIuNSwxODYuMzcxMSwxMDYuNSwxNzYuMzcxMSwxMDIuNSwxODAuMzcxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjcyLjI1IiB4Mj0iMzEwIiB5MT0iMTY0LjM3MTEiIHkyPSIxNjQuMzcxMSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjMxMCIgeDI9IjMxMCIgeTE9IjE2NC4zNzExIiB5Mj0iMTg2LjM3MTEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMwNiwxNzYuMzcxMSwzMTAsMTg2LjM3MTEsMzE0LDE3Ni4zNzExLDMxMCwxODAuMzcxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTAyLjUiIHgyPSIxMDIuNSIgeTE9IjMxMi43NDIyIiB5Mj0iMzMwLjc0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMDIuNSIgeDI9IjE5NC4yNSIgeTE9IjMzMC43NDIyIiB5Mj0iMzMwLjc0MjIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE4NC4yNSwzMjYuNzQyMiwxOTQuMjUsMzMwLjc0MjIsMTg0LjI1LDMzNC43NDIyLDE4OC4yNSwzMzAuNzQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzEwIiB4Mj0iMzEwIiB5MT0iMjIwLjMzOTgiIHkyPSIzMzAuNzQyMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjMxMCIgeDI9IjIxOC4yNSIgeTE9IjMzMC43NDIyIiB5Mj0iMzMwLjc0MjIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIyOC4yNSwzMjYuNzQyMiwyMTguMjUsMzMwLjc0MjIsMjI4LjI1LDMzNC43NDIyLDIyNC4yNSwzMzAuNzQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjA2LjI1IiB4Mj0iMjA2LjI1IiB5MT0iMTI3Ljk2ODgiIHkyPSIxNTIuMzcxMSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjAyLjI1LDE0Mi4zNzExLDIwNi4yNSwxNTIuMzcxMSwyMTAuMjUsMTQyLjM3MTEsMjA2LjI1LDE0Ni4zNzExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMzkuNzUiIHgyPSIzOTgiIHkxPSIxMTUuOTY4OCIgeTI9IjExNS45Njg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzOTQsMjM5Ljc1NzgsMzk4LDI0OS43NTc4LDQwMiwyMzkuNzU3OCwzOTgsMjQzLjc1NzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM5OCIgeDI9IjM5OCIgeTE9IjExNS45Njg4IiB5Mj0iMzc0Ljc0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzOTgiIHgyPSIyMTguMjUiIHkxPSIzNzQuNzQyMiIgeTI9IjM3NC43NDIyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMjguMjUsMzcwLjc0MjIsMjE4LjI1LDM3NC43NDIyLDIyOC4yNSwzNzguNzQyMiwyMjQuMjUsMzc0Ljc0MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIwNi4yNSIgeDI9IjIwNi4yNSIgeTE9IjM0Mi43NDIyIiB5Mj0iMzYyLjc0MjIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwMi4yNSwzNTIuNzQyMiwyMDYuMjUsMzYyLjc0MjIsMjEwLjI1LDM1Mi43NDIyLDIwNi4yNSwzNTYuNzQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjA2LjI1IiB4Mj0iMjA2LjI1IiB5MT0iODMuOTY4OCIgeTI9IjEwMy45Njg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDIuMjUsOTMuOTY4OCwyMDYuMjUsMTAzLjk2ODgsMjEwLjI1LDkzLjk2ODgsMjA2LjI1LDk3Ljk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIwNi4yNSIgeDI9IjIwNi4yNSIgeTE9IjM4Ni43NDIyIiB5Mj0iNDA2Ljc0MjIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwMi4yNSwzOTYuNzQyMiwyMDYuMjUsNDA2Ljc0MjIsMjEwLjI1LDM5Ni43NDIyLDIwNi4yNSw0MDAuNzQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PCEtLVNSQz1bUk9yMTJpQ1c0NE50ZGNBTXlHaDllZEpINnZKa0hSeXdENTVtR2kzUkR4NTQyRXJWM0NweW5ualBKTGRMTTYzMTZvWmNfOXVLVW5oaWQwTmtmY2NESTNIS1k1UXFmdE5IZjAxdDUtNkdXNV9lMTVhVTJxZjBpbEtfVDZHSzk0U3VHTGVXT1dBYzNrcXIteFBYNWxKdHBfbjJPTHlyZ1FqZ1EtVWh2LWxleW1DMF0tLT48L2c+PC9zdmc+'>

<h3 id="core-code"><a href="#core-code" class="headerlink" title="core code"></a>core code</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">handlerIssue</span><span class="params">(body: <span class="type">JSONObject</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (GitlabHookBodyHelper.isClose(body)) &#123;</span><br><span class="line">        <span class="comment">//已关闭的issue不做处理</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> changedAssignee: GitlabHookBodyHelper.Assignee? = getChangedAssignee(body)</span><br><span class="line">    log.info(<span class="string">&quot;handler issue changedAssignee: <span class="variable">$changedAssignee</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> labelTitles: MutableSet&lt;String&gt; = GitlabHookBodyHelper.listLabelTitle(body)</span><br><span class="line">    log.info(<span class="string">&quot;handler issue labels: <span class="variable">$labelTitles</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// 是否变更assignee</span></span><br><span class="line">    <span class="keyword">if</span> (changedAssignee != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> developer = developerRepository.findByUsername(changedAssignee.username!!)</span><br><span class="line">        <span class="comment">// 为开发人员 &amp;&amp; label为todo且不在进行中</span></span><br><span class="line">        <span class="keyword">if</span> (developer != <span class="literal">null</span> &amp;&amp; labelTitles.isTodo() &amp;&amp; !labelTitles.isProcessing()) &#123;</span><br><span class="line">            <span class="keyword">when</span> &#123;</span><br><span class="line">                labelTitles.isBug() -&gt; sendBugMsg(body, developer.mobile)</span><br><span class="line">                labelTitles.isP0() -&gt; sendEmergencyMsg(body, developer.mobile)</span><br><span class="line">                <span class="keyword">else</span> -&gt; log.info(<span class="string">&quot;ignore issue change! labelTitles -&gt; <span class="variable">$labelTitles</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (GitlabHookBodyHelper.isFirstChangeToVerifyLabel(body)) &#123;</span><br><span class="line">            <span class="keyword">val</span> author = getAuthor(body)</span><br><span class="line">            <span class="keyword">val</span> assigneeUsername = editAssignee(body, author)</span><br><span class="line">            <span class="keyword">val</span> mobile = developerRepository.findByUsername(assigneeUsername)?.mobile</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != mobile) &#123;</span><br><span class="line">                sendVerifyMsg(body, author, mobile)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><h3 id="非内网部署gitlab如何开发调试"><a href="#非内网部署gitlab如何开发调试" class="headerlink" title="非内网部署gitlab如何开发调试"></a>非内网部署gitlab如何开发调试</h3><p>ngrok 实现内网穿透</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew cask install ngrok</span><br></pre></td></tr></table></figure>

<h3 id="验证阶段的issue关闭不及时"><a href="#验证阶段的issue关闭不及时" class="headerlink" title="验证阶段的issue关闭不及时"></a>验证阶段的issue关闭不及时</h3><p>先自动<code>close</code>issue, 并<code>dingding</code>提醒. 如果有问题可以<code>reopen</code>并自动流转至<code>Doing</code>. </p>
]]></content>
      <categories>
        <category>管理</category>
      </categories>
      <tags>
        <tag>管理</tag>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>基于Gitlab进行开发团队管理的尝试——04.CAS单点登录</title>
    <url>/2020/02/07/gitlab-manager-04/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>大部分公司内部有很多应用需要使用<code>CAS(Central Authentication Service,即:统一认证服务)</code>完成用户登录验证。如果每个应用单独接入域账号验证，除了浪费工作量，安全性也得不到保障。<br>通用解决方案为部署一套<code>CAS</code>服务实现登录验证以及<code>SSO(Single Sign On)</code>单点登录。<br>相较于臃肿的开源项目解决方案，或者自己造一个轮子，其实还有一套轻量级的解决方案 -&gt; <strong>通过gitlab的applications实现CAS</strong>。</p>
<span id="more"></span>

<h3 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h3><p>网上相关资料很多，这里只描述基本的交互流程</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyMTJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjM5M3B4O2hlaWdodDoyMTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzOTMgMjEyIiB3aWR0aD0iMzkzcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tZW50aXR5IGMtLT48ZyBpZD0iZWxlbV9jIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjMwOCwzNi41NjU5LDMxOCwyNi41NjU5LDM3NiwyNi41NjU5LDM3Niw2Mi44NjI4LDM2Niw3Mi44NjI4LDMwOCw3Mi44NjI4LDMwOCwzNi41NjU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNjYiIHgyPSIzNzYiIHkxPSIzNi41NjU5IiB5Mj0iMjYuNTY1OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMwOCIgeDI9IjM2NiIgeTE9IjM2LjU2NTkiIHkyPSIzNi41NjU5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzY2IiB4Mj0iMzY2IiB5MT0iMzYuNTY1OSIgeTI9IjcyLjg2MjgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iMzIzIiB5PSI1OS41NjEiPkFQUDwvdGV4dD48L2c+PCEtLWVudGl0eSBzLS0+PGcgaWQ9ImVsZW1fcyI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIxNiwzNi41NjU5LDI2LDI2LjU2NTksMTM2LDI2LjU2NTksMTM2LDYyLjg2MjgsMTI2LDcyLjg2MjgsMTYsNzIuODYyOCwxNiwzNi41NjU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjYiIHgyPSIxMzYiIHkxPSIzNi41NjU5IiB5Mj0iMjYuNTY1OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE2IiB4Mj0iMTI2IiB5MT0iMzYuNTY1OSIgeTI9IjM2LjU2NTkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjYiIHgyPSIxMjYiIHkxPSIzNi41NjU5IiB5Mj0iNzIuODYyOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgwIiB4PSIzMSIgeT0iNTkuNTYxIj5DQVMgU2VydmVyPC90ZXh0PjwvZz48IS0tZW50aXR5IGItLT48ZyBpZD0iZWxlbV9iIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjE0MC41LDE1OS41NjU5LDE1MC41LDE0OS41NjU5LDI3NS41LDE0OS41NjU5LDI3NS41LDE4NS44NjI4LDI2NS41LDE5NS44NjI4LDE0MC41LDE5NS44NjI4LDE0MC41LDE1OS41NjU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNjUuNSIgeDI9IjI3NS41IiB5MT0iMTU5LjU2NTkiIHkyPSIxNDkuNTY1OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE0MC41IiB4Mj0iMjY1LjUiIHkxPSIxNTkuNTY1OSIgeTI9IjE1OS41NjU5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjY1LjUiIHgyPSIyNjUuNSIgeTE9IjE1OS41NjU5IiB5Mj0iMTk1Ljg2MjgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NSIgeD0iMTU1LjUiIHk9IjE4Mi41NjEiPldlYiBCcm93c2VyPC90ZXh0PjwvZz48IS0tcmV2ZXJzZSBsaW5rIGMgdG8gYi0tPjxnIGlkPSJsaW5rX2NfYiI+PHBhdGggZD0iTTMxMi45Njg5LDc2Ljc4MDEgQzI4OC43OTA5LDk4LjYxMzEgMjU2LjU0NiwxMjcuNzI5OCAyMzIuNDIyLDE0OS41MTMzICIgZmlsbD0ibm9uZSIgaWQ9ImMtYmFja3RvLWIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzE3LjQyMiw3Mi43NTg5LDMwOC4wNjE2LDc1LjgyMiwzMTMuNzExMSw3Ni4xMDk5LDMxMy40MjMyLDgxLjc1OTQsMzE3LjQyMiw3Mi43NTg5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NSIgeD0iMjg1IiB5PSIxMTUuNjMyOCI+MS4gcmVxdWVzdDwvdGV4dD48L2c+PCEtLWxpbmsgYyB0byBzLS0+PGcgaWQ9ImxpbmtfY19zIj48cGF0aCBkPSJNMzA3LjgwNSw0OS41NjU5IEMyNjQuNDcsNDkuNTY1OSAxOTUuMDQ1LDQ5LjU2NTkgMTQyLjAyNyw0OS41NjU5ICIgZmlsbD0ibm9uZSIgaWQ9ImMtdG8tcyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzYuMDI3LDQ5LjU2NTksMTQ1LjAyNyw1My41NjU5LDE0MS4wMjcsNDkuNTY1OSwxNDUuMDI3LDQ1LjU2NTksMTM2LjAyNyw0OS41NjU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzUiIHg9IjE1NC41IiB5PSI0Mi42MzI4Ij4yLiByZWRpcmVjdCBsb2dpbiBwYWdlPC90ZXh0PjwvZz48IS0tbGluayBzIHRvIGMtLT48ZyBpZD0ibGlua19zX2MiPjxwYXRoIGQ9Ik0xMTkuMDQ2LDcyLjYyMTkgQzEzNi4yNSw4MC42MTE5IDE1Ni41NjUsODguNTY0OSAxNzYsOTIuNTY1OSBDMTk2LjAyNCw5Ni42ODg3IDI0OC4yNiw5Ny44ODQ5IDI2OCw5Mi41NjU5IEMyODIuOTIxLDg4LjU0NTkgMjkyLjg1MjUsODMuODkgMzA1LjQxNzUsNzUuOTg1ICIgZmlsbD0ibm9uZSIgaWQ9InMtdG8tYyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTAuNDk2LDcyLjc4OTksMzAwLjc0ODEsNzQuMTk2OCwzMDYuMjYzOSw3NS40NTI1LDMwNS4wMDgyLDgwLjk2ODIsMzEwLjQ5Niw3Mi43ODk5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MSIgeD0iMTk2LjUiIHk9Ijg4LjYzMjgiPjQuIHRpY2tldDwvdGV4dD48L2c+PCEtLWxpbmsgYyB0byBzLS0+PGcgaWQ9ImxpbmtfY19zIj48cGF0aCBkPSJNMzA3Ljc1LDYwLjg0MzkgQzI5NS4zNyw2NC4zNzk5IDI4MS4xOTIsNjcuODE0OSAyNjgsNjkuNTY1OSBDMjI3LjQ2Nyw3NC45NDY5IDIxNi42OSw3My41OTQ5IDE3Niw2OS41NjU5IEMxNjMuMDUsNjguMjgzOSAxNTUuMTg3NSw2Ny4yMDkyIDE0Mi4xNTQ1LDY0LjczMjIgIiBmaWxsPSJub25lIiBpZD0iYy10by1zLTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM2LjI2LDYzLjYxMTksMTQ0LjM1NDksNjkuMjIyLDE0MS4xNzIxLDY0LjU0NTUsMTQ1Ljg0ODYsNjEuMzYyNywxMzYuMjYsNjMuNjExOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTAiIHg9IjE3NyIgeT0iNjUuNjMyOCI+NS4gdmFsaWQgdG9ja2V0PC90ZXh0PjwvZz48IS0tbGluayBzIHRvIGMtLT48ZyBpZD0ibGlua19zX2MiPjxwYXRoIGQ9Ik0xMzYuMjE0LDMyLjQ1ODkgQzE0Mi4wMTksMzEuMjgzOSAxNDcuODQ4LDMwLjI4MzkgMTUzLjUsMjkuNTY1OSBDMTgzLjcwMiwyNS43MzE5IDI2MC41NzYsMjMuOTU5OSAyOTAuNSwyOS41NjU5IEMyOTYuMjUxLDMwLjY0MjkgMjk2LjUxMTksMzAuMzg5NSAzMDIuMjE1OSwzMi4zNTM1ICIgZmlsbD0ibm9uZSIgaWQ9InMtdG8tYy0xIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMwNy44ODksMzQuMzA2OSwzMDAuNjgxNiwyNy41OTQ4LDMwMy4xNjE0LDMyLjY3OTEsMjk4LjA3NzEsMzUuMTU4OSwzMDcuODg5LDM0LjMwNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcyIiB4PSIxODYiIHk9IjE5LjYzMjgiPjYuIHVzZXIgaW5mbzwvdGV4dD48L2c+PCEtLWxpbmsgcyB0byBiLS0+PGcgaWQ9Imxpbmtfc19iIj48cGF0aCBkPSJNMTA0LjYzMzcsNzYuODEzMyBDMTI4LjQ1MDksOTguNjQ2MyAxNTUuNzU2MSwxMjMuNjc1NSAxNzkuNTIwMSwxNDUuNDU5ICIgZmlsbD0ibm9uZSIgaWQ9InMtYiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDAuMjEwOCw3Mi43NTg5LDEwNC4xNDIyLDgxLjc4OTEsMTAzLjg5NjUsNzYuMTM3NiwxMDkuNTQ4LDc1Ljg5MTksMTAwLjIxMDgsNzIuNzU4OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxODMuOTQzLDE0OS41MTMzLDE4MC4wMTE1LDE0MC40ODMyLDE4MC4yNTcyLDE0Ni4xMzQ3LDE3NC42MDU3LDE0Ni4zODA0LDE4My45NDMsMTQ5LjUxMzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ2IiB4PSIxNTEiIHk9IjExNS42MzI4Ij4zLiBsb2dpbjwvdGV4dD48L2c+PCEtLVNSQz1bSE94QjJlQ201NEp0LU9oMWxPNC01cjhBc1h5R043SGphYmk5YlNKY09OLV9RTUJmUmt3dkN5Q09nbVhMc19TTHNXNkljTnBWYVh4OGhVR296WGstYXEzZHhEamxOMzBjS0NVYmxhOHNzNzR1VWFOb1dLYWF2MWxpbHFYZkhwOVdqZkNzTUNROUtrWElLaWJvdUVOM0Y0aERhSURlLVFIX291Ylo3TVVqNDZwY0YtVVA4d09mcUVQWEZtMDBdLS0+PC9nPjwvc3ZnPg=='>

<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>将Gitlab作为授权服务器，通过代码实现Gitlab Applications交互，并调用API获取用户信息。</p>
<h3 id="Gitlab-CAS"><a href="#Gitlab-CAS" class="headerlink" title="Gitlab CAS"></a>Gitlab CAS</h3><p>基本遵循CAS交互流程，部分字段命名不同。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI2OTFweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjczN3B4O2hlaWdodDo2OTFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA3MzcgNjkxIiB3aWR0aD0iNzM3cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjQyMy44NTk0IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3MjAuNSIgeD0iMTAiIHk9IjE2OS41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjM4IiB4Mj0iMzgiIHkxPSI4MS4yOTY5IiB5Mj0iNjEwLjQyMTkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMjQyLjUiIHgyPSIyNDIuNSIgeTE9IjgxLjI5NjkiIHkyPSI2MTAuNDIxOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSI1NDEuNSIgeDI9IjU0MS41IiB5MT0iODEuMjk2OSIgeTI9IjYxMC40MjE5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzEiIHg9IjIwIiB5PSI3Ny45OTUxIj5Vc2VyPC90ZXh0PjxlbGxpcHNlIGN4PSIzOC41IiBjeT0iMTMuNSIgZmlsbD0iI0UyRTJGMCIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzguNSwyMS41IEwzOC41LDQ4LjUgTTI1LjUsMjkuNSBMNTEuNSwyOS41IE0zOC41LDQ4LjUgTDI1LjUsNjMuNSBNMzguNSw0OC41IEw1MS41LDYzLjUgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMSIgeD0iMjAiIHk9IjYyMi40MTciPlVzZXI8L3RleHQ+PGVsbGlwc2UgY3g9IjM4LjUiIGN5PSI2MzQuMjE4OCIgZmlsbD0iI0UyRTJGMCIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzguNSw2NDIuMjE4OCBMMzguNSw2NjkuMjE4OCBNMjUuNSw2NTAuMjE4OCBMNTEuNSw2NTAuMjE4OCBNMzguNSw2NjkuMjE4OCBMMjUuNSw2ODQuMjE4OCBNMzguNSw2NjkuMjE4OCBMNTEuNSw2ODQuMjE4OCAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTgiIHg9IjIxMy41IiB5PSI1MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSIyMjAuNSIgeT0iNjkuOTk1MSI+R2l0bGFiPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTgiIHg9IjIxMy41IiB5PSI2MDkuNDIxOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSIyMjAuNSIgeT0iNjI5LjQxNyI+R2l0bGFiPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDIiIHg9IjUyMC41IiB5PSI1MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI1MjcuNSIgeT0iNjkuOTk1MSI+YXBwPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDIiIHg9IjUyMC41IiB5PSI2MDkuNDIxOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI1MjcuNSIgeT0iNjI5LjQxNyI+YXBwPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTI5LjUsMTA4LjQyOTcsNTM5LjUsMTEyLjQyOTcsNTI5LjUsMTE2LjQyOTcsNTMzLjUsMTEyLjQyOTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM4LjUiIHgyPSI1MzUuNSIgeTE9IjExMi40Mjk3IiB5Mj0iMTEyLjQyOTciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OSIgeD0iNDUuNSIgeT0iMTA3LjM2MzgiPnJlcXVlc3Q8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTQxLjUiIHgyPSI1ODMuNSIgeTE9IjE0MS41NjI1IiB5Mj0iMTQxLjU2MjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1ODMuNSIgeDI9IjU4My41IiB5MT0iMTQxLjU2MjUiIHkyPSIxNTQuNTYyNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjU0Mi41IiB4Mj0iNTgzLjUiIHkxPSIxNTQuNTYyNSIgeTI9IjE1NC41NjI1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NTIuNSwxNTAuNTYyNSw1NDIuNSwxNTQuNTYyNSw1NTIuNSwxNTguNTYyNSw1NDguNSwxNTQuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTcwIiB4PSI1NDguNSIgeT0iMTM2LjQ5NjYiPnZhbGlkIHNlc3Npb24gYXV0aG9yaXphdGlvbjwvdGV4dD48cGF0aCBkPSJNMTAsMTY5LjU2MjUgTDc2LDE2OS41NjI1IEw3NiwxNzYuNjk1MyBMNjYsMTg2LjY5NTMgTDEwLDE4Ni42OTUzIEwxMCwxNjkuNTYyNSAiIGZpbGw9IiNFRUVFRUUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNDIzLjg1OTQiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjcyMC41IiB4PSIxMCIgeT0iMTY5LjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjI1IiB5PSIxODIuNjI5NCI+YWx0PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDAiIHg9IjkxIiB5PSIxODEuNzcyOSI+W2F1dGhvcml6YXRpb24gbG9naW5dPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDkuNSwyMDMuODI4MSwzOS41LDIwNy44MjgxLDQ5LjUsMjExLjgyODEsNDUuNSwyMDcuODI4MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDMuNSIgeDI9IjU0MC41IiB5MT0iMjA3LjgyODEiIHkyPSIyMDcuODI4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMwIiB4PSI1NS41IiB5PSIyMDIuNzYyMiI+dmlldzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjIuMCwyLjA7IiB4MT0iMTAiIHgyPSI3MzAuNSIgeTE9IjIxNi44MjgxIiB5Mj0iMjE2LjgyODEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ5LjUsMjM0Ljk2MDksMzkuNSwyMzguOTYwOSw0OS41LDI0Mi45NjA5LDQ1LjUsMjM4Ljk2MDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQzLjUiIHgyPSI1NDAuNSIgeTE9IjIzOC45NjA5IiB5Mj0iMjM4Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkiIHg9IjU1LjUiIHk9IjIzMy44OTUiPnJlZGlyZWN0IGxvZ2luIHBhZ2U8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzAuNSwyNjQuMDkzOCwyNDAuNSwyNjguMDkzOCwyMzAuNSwyNzIuMDkzOCwyMzQuNSwyNjguMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzguNSIgeDI9IjIzNi41IiB5MT0iMjY4LjA5MzgiIHkyPSIyNjguMDkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMyIgeD0iNDUuNSIgeT0iMjYzLjAyNzgiPnN1Ym1pdCBsb2dpbiBmb3JtPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTI5LjUsMjkzLjIyNjYsNTM5LjUsMjk3LjIyNjYsNTI5LjUsMzAxLjIyNjYsNTMzLjUsMjk3LjIyNjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI0Mi41IiB4Mj0iNTM1LjUiIHkxPSIyOTcuMjI2NiIgeTI9IjI5Ny4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjc1IiB4PSIyNDkuNSIgeT0iMjkyLjE2MDYiPnJlZGlyZWN0IGNhbGxiYWNrVXJsIHdpdGggYXV0aG9yaXphdGlvbiBjb2RlPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjUzLjUsMzIyLjM1OTQsMjQzLjUsMzI2LjM1OTQsMjUzLjUsMzMwLjM1OTQsMjQ5LjUsMzI2LjM1OTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI0Ny41IiB4Mj0iNTQwLjUiIHkxPSIzMjYuMzU5NCIgeTI9IjMyNi4zNTk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjUyIiB4PSIyNTkuNSIgeT0iMzIxLjI5MzUiPmdldCBhY2Nlc3MgdG9rZW4gYnkgYXV0aG9yaXphdGlvbiBjb2RlPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTI5LjUsMzUxLjQ5MjIsNTM5LjUsMzU1LjQ5MjIsNTI5LjUsMzU5LjQ5MjIsNTMzLjUsMzU1LjQ5MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI0Mi41IiB4Mj0iNTM1LjUiIHkxPSIzNTUuNDkyMiIgeTI9IjM1NS40OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3IiB4PSIyNDkuNSIgeT0iMzUwLjQyNjMiPnJldHVybiBhY2Nlc3MgdG9rZW48L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNTMuNSwzODAuNjI1LDI0My41LDM4NC42MjUsMjUzLjUsMzg4LjYyNSwyNDkuNSwzODQuNjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNDcuNSIgeDI9IjU0MC41IiB5MT0iMzg0LjYyNSIgeTI9IjM4NC42MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MSIgeD0iMjU5LjUiIHk9IjM3OS41NTkxIj5nZXQgdXNlciBpbmZvPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTI5LjUsNDA5Ljc1NzgsNTM5LjUsNDEzLjc1NzgsNTI5LjUsNDE3Ljc1NzgsNTMzLjUsNDEzLjc1NzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI0Mi41IiB4Mj0iNTM1LjUiIHkxPSI0MTMuNzU3OCIgeTI9IjQxMy43NTc4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTkiIHg9IjI0OS41IiB5PSI0MDguNjkxOSI+cmV0dXJuIHVzZXIgaW5mbzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNDIuNSIgeDI9IjI4NC41IiB5MT0iNDQyLjg5MDYiIHkyPSI0NDIuODkwNiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI4NC41IiB4Mj0iMjg0LjUiIHkxPSI0NDIuODkwNiIgeTI9IjQ1NS44OTA2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjQzLjUiIHgyPSIyODQuNSIgeTE9IjQ1NS44OTA2IiB5Mj0iNDU1Ljg5MDYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1My41LDQ1MS44OTA2LDI0My41LDQ1NS44OTA2LDI1My41LDQ1OS44OTA2LDI0OS41LDQ1NS44OTA2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzkiIHg9IjI0OS41IiB5PSI0MzcuODI0NyI+c3RvcmUgdXNlciBpbmZvIHdpdGggYXV0aG9yaXphdGlvbiBrZXk8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OS41LDQ4MS4wMjM0LDM5LjUsNDg1LjAyMzQsNDkuNSw0ODkuMDIzNCw0NS41LDQ4NS4wMjM0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0My41IiB4Mj0iMjQxLjUiIHkxPSI0ODUuMDIzNCIgeTI9IjQ4NS4wMjM0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgwIiB4PSI1NS41IiB5PSI0NzkuOTU3NSI+c2V0IGNvb2tpZSBhdXRob3JpemF0aW9uIGtleTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUyOS41LDUxMC4xNTYzLDUzOS41LDUxNC4xNTYzLDUyOS41LDUxOC4xNTYzLDUzMy41LDUxNC4xNTYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzOC41IiB4Mj0iNTM1LjUiIHkxPSI1MTQuMTU2MyIgeTI9IjUxNC4xNTYzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3IiB4PSI0NS41IiB5PSI1MDkuMDkwMyI+cmVkaXJlY3QgcmVmZXJlciB1cmw8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTQxLjUiIHgyPSI1ODMuNSIgeTE9IjU0My4yODkxIiB5Mj0iNTQzLjI4OTEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1ODMuNSIgeDI9IjU4My41IiB5MT0iNTQzLjI4OTEiIHkyPSI1NTYuMjg5MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjU0Mi41IiB4Mj0iNTgzLjUiIHkxPSI1NTYuMjg5MSIgeTI9IjU1Ni4yODkxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NTIuNSw1NTIuMjg5MSw1NDIuNSw1NTYuMjg5MSw1NTIuNSw1NjAuMjg5MSw1NDguNSw1NTYuMjg5MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTcwIiB4PSI1NDguNSIgeT0iNTM4LjIyMzEiPnZhbGlkIHNlc3Npb24gYXV0aG9yaXphdGlvbjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ5LjUsNTgxLjQyMTksMzkuNSw1ODUuNDIxOSw0OS41LDU4OS40MjE5LDQ1LjUsNTg1LjQyMTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQzLjUiIHgyPSI1NDAuNSIgeTE9IjU4NS40MjE5IiB5Mj0iNTg1LjQyMTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMCIgeD0iNTUuNSIgeT0iNTgwLjM1NiI+dmlldzwvdGV4dD48IS0tU1JDPVtYTDVCU2lDVzNEcnAyYnNXNXlZWXN2dVcxdjJuSjNHY0c4TGU5WnJ6UEpTXzl0SkEzWnN6Wm9KcWNXTnNiR0ltR2RDNUhUYnBtUUptbUhmbk1FaDFETlh4MW9uYjFxQVZaUWcyaXotai04TUhId1hLQS1TNHNGSUdYUnpIeFVTbXdoTzJDR1RFM2tuVEQ5ZWZDOXFTbktobTEwWURCRUpyYm1LNTB3cVRRd0FtV3pnNjhyX0hBU2puSFNEM3RXbFZPdW0zLWRhbDRLd2lYd1RHRmV6UlJ6Q0VQRDZ6ang1MHlxbTlYZEU3ek1BZUpUQTZydjVqb3lldkpSZEZ4aTNCaDdPaWtjRXpDTU93dG9jc2xjZlVGa1VQd09fNnpoZWZlT2Q0RjloNG4tSl9OaGZ0cUpKLTAwMDBdLS0+PC9nPjwvc3ZnPg=='>

<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><ol>
<li><code>clientId</code> &amp; <code>Secret</code> 通过创建 <code>Gitlab applications</code> 获得</li>
<li>通过浏览器转换，所以 <code>callback</code> 地址可以配置为 <code>localhost</code></li>
<li>user信息可以store，也可以采用 <strong>JWT</strong> 方式</li>
<li>代码为示例代码，实际使用过程中可以按需求封装 <code>starter</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OauthController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oauth2.server.url:https://gitlab.com&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String gitlabServerUrl;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oauth2.client.id:xxx&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String clientId;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oauth2.client.secret:xxxx&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String clientSecret;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oauth2.client.callback.url:http://localhost:9000/callback&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String callbackUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CURRENT_USER = <span class="string">&quot;CurrentUser&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String AUTHORIZATION_KEY = <span class="string">&quot;Authorization&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, User&gt; userStore = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/main&quot;,&quot;/&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = (User) RequestContextHolder.getRequestAttributes().getAttribute(CURRENT_USER, RequestAttributes.SCOPE_SESSION);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;html&gt;&lt;body&gt;hi:&quot;</span> + user.username + <span class="string">&quot; This is Main&lt;/body&gt;&lt;/html&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 授权后redirect url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 用于获取accessToken，只能使用一次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/callback&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(<span class="meta">@RequestParam(value = &quot;code&quot;, required = false)</span> String code,</span></span></span><br><span class="line"><span class="function"><span class="params">                           RedirectAttributes redirectAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">                           HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        String referer = request.getParameter(<span class="string">&quot;referer&quot;</span>);</span><br><span class="line">        String accessToken = getAccessToken(code, buildCallbackUrl(referer));</span><br><span class="line">        User user = getUser(accessToken);</span><br><span class="line"></span><br><span class="line">        String uuid = UUID.randomUUID().toString();</span><br><span class="line">        userStore.put(uuid, user);</span><br><span class="line">        <span class="comment">//set cookie</span></span><br><span class="line">        response.addCookie(<span class="keyword">new</span> Cookie(AUTHORIZATION_KEY, uuid));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + referer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">buildCallbackUrl</span><span class="params">(String referer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callbackUrl + <span class="string">&quot;?referer=&quot;</span> + referer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> User <span class="title">getUser</span><span class="params">(String accessToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(gitlabServerUrl + <span class="string">&quot;/api/v4/user?access_token=&quot;</span> + accessToken, User.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过code去gitlab获取accessToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redirectUri 回调地址，必须与授权时参数一致</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getAccessToken</span><span class="params">(String code, String redirectUri)</span> </span>&#123;</span><br><span class="line">        HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);</span><br><span class="line"></span><br><span class="line">        MultiValueMap&lt;String, String&gt; params = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</span><br><span class="line">        params.add(<span class="string">&quot;grant_type&quot;</span>, <span class="string">&quot;authorization_code&quot;</span>);</span><br><span class="line">        params.add(<span class="string">&quot;client_id&quot;</span>, clientId);</span><br><span class="line">        params.add(<span class="string">&quot;client_secret&quot;</span>, clientSecret);</span><br><span class="line">        params.add(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        params.add(<span class="string">&quot;redirect_uri&quot;</span>, redirectUri);</span><br><span class="line"></span><br><span class="line">        HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; entity = <span class="keyword">new</span> HttpEntity&lt;&gt;(params, headers);</span><br><span class="line"></span><br><span class="line">        ResponseEntity&lt;JSONAccessTokenResponse&gt; response =</span><br><span class="line">                restTemplate.exchange(gitlabServerUrl + <span class="string">&quot;/oauth/token&quot;</span>,</span><br><span class="line">                        HttpMethod.POST,</span><br><span class="line">                        entity,</span><br><span class="line">                        JSONAccessTokenResponse.class);</span><br><span class="line">        <span class="keyword">return</span> Objects.requireNonNull(response.getBody()).access_token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">            registry.addInterceptor(</span><br><span class="line">                    <span class="keyword">new</span> HandlerInterceptorAdapter() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                            Optional&lt;String&gt; authorizationKeyOp = Arrays.stream(request.getCookies())</span><br><span class="line">                                    .filter(it-&gt;it.getName().equals(AUTHORIZATION_KEY))</span><br><span class="line">                                    .map(Cookie::getValue)</span><br><span class="line">                                    .findAny();</span><br><span class="line">                            <span class="keyword">if</span> (authorizationKeyOp.isPresent()) &#123;</span><br><span class="line">                                <span class="comment">// 授权信息存在，获取user信息放入session</span></span><br><span class="line">                                RequestContextHolder.getRequestAttributes().setAttribute(CURRENT_USER, userStore.get(authorizationKeyOp.get()), RequestAttributes.SCOPE_SESSION);</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="comment">// 授权信息不存在，去gitlab进行验证</span></span><br><span class="line">                                String referer = request.getRequestURL().toString();</span><br><span class="line">                                String redirectUri = URLEncoder.encode(buildCallbackUrl(referer), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                                String gitlabAuthUrl = gitlabServerUrl + <span class="string">&quot;/oauth/authorize?response_type=code&amp;redirect_uri=&quot;</span> + redirectUri + <span class="string">&quot;&amp;client_id=&quot;</span> + clientId;</span><br><span class="line">                                logger.info(<span class="string">&quot;gitlabAuthUrl:&#123;&#125;&quot;</span>, gitlabAuthUrl);</span><br><span class="line">                                response.sendRedirect(gitlabAuthUrl);</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .addPathPatterns(<span class="string">&quot;/main&quot;</span>, <span class="string">&quot;/test&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONAccessTokenResponse</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String access_token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line">        <span class="keyword">public</span> String username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新建-Gitlab-applications"><a href="#新建-Gitlab-applications" class="headerlink" title="新建 Gitlab applications"></a>新建 Gitlab applications</h3><ol>
<li>User Settings -&gt; Applications 中填写名称及Redirect URI, 只需要勾选Confidential <img src="https://img.yuheng.wang/mweb/15809706374188.jpg" alt="00"></li>
<li>点击保存并记录 ClientId及Secret <img src="https://img.yuheng.wang/mweb/15809928633364.jpg" alt="01"></li>
</ol>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><ol>
<li>浏览器访问 <a href="http://localhost:9000/main">http://localhost:9000/main</a></li>
<li>跳转至 <code>Gitlab</code> 登录页面 <img src="https://img.yuheng.wang/mweb/15809704643941.jpg" alt="02"></li>
<li>同意授权(此操作只需进行一次) <img src="https://img.yuheng.wang/mweb/15809707990397.jpg" alt="03"></li>
<li>自动跳转至 <a href="http://localhost:9000/main">http://localhost:9000/main</a> 并获取登录账号信息<img src="https://img.yuheng.wang/mweb/15809712828468.jpg" alt="04"></li>
<li>刷新页面为登陆状态，无需重新登陆。登录信息已在 <code>Cookie</code> 中，相同域名下无需重新登陆。</li>
<li>在 <code>Gitlab Applications</code> 中可以查看授权状态并取消授权 <img src="https://img.yuheng.wang/mweb/15809713444809.jpg" alt="05"></li>
</ol>
<h2 id="FAQs"><a href="#FAQs" class="headerlink" title="FAQs"></a>FAQs</h2><ol>
<li>Gitlab报错 <code>The redirect url included is not valid</code> -&gt; 确认传递的 <code>callback url</code> 的path及参数与 <code>applications</code> 中填写的一致</li>
</ol>
]]></content>
      <categories>
        <category>管理</category>
      </categories>
      <tags>
        <tag>管理</tag>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>翻新第一个私活 CMS 项目</title>
    <url>/2018/04/22/haro-cms/</url>
    <content><![CDATA[<h2 id="1-项目背景"><a href="#1-项目背景" class="headerlink" title="1. 项目背景"></a>1. 项目背景</h2><p>项目地址: <a href="https://github.com/wangyuheng/Haro-CMS">https://github.com/wangyuheng/Haro-CMS</a></p>
<p>最近因为换电脑整理资料的过程中，发现了自己之前写过的一些项目，现在准备拿出来升级一下，构建自己的技术体系。看着三个月前的代码，已经似曾相识了，那三年前的呢？<br>这个项目是用来做企业展示的简易CMS系统，后台管理员可以编辑展示内容，发布新闻；访问用户可以查看企业信息，并反馈建议。这个系统当时应该熬了几个通宵，因为5000大洋实在太吸引人。。而且还是三个人分。。。人的时间好像是越往后越值钱，现在看可能觉得不值，但还是很感谢熬夜编码的自己。<br>项目当时考虑了很多：分布式，前后端分离，甚至是saas化，希望根据用户反馈，或者再接到类似的项目，可以进一步完善，但是并没有什么后续。所以项目历史就是一个基于web.xml配置的spring单机应用。</p>
<h3 id="1-1-依赖项目"><a href="#1-1-依赖项目" class="headerlink" title="1.1 依赖项目"></a>1.1 依赖项目</h3><ol>
<li>spring-boot</li>
<li>h2</li>
<li>gson</li>
</ol>
<p>目前将其升级为spring-boot应用，并且为了开发演示方便，开发环境使用了H2数据库。一直觉得，项目不需要修改任何配置就能跑起来很重要。</p>
<h2 id="2-项目code"><a href="#2-项目code" class="headerlink" title="2. 项目code"></a>2. 项目code</h2><p>企业信息展示，分为3个module</p>
<ol>
<li><strong>admin</strong> 管理人员编辑展示内容</li>
<li><strong>view</strong> 展示企业信息及新闻</li>
<li><strong>core</strong> 业务数据层</li>
</ol>
<p><img src="https://img.hacpai.com/file/2018/04/cfa23976ccd54d3a8dbd95011cfc3e5d_haro_design.png" alt="haro_designpng"></p>
<p>新版spring boot已不推荐使用jsp，带来很多不便，如： 不能直接运行java， 需要使用maven spring boot 插件运行。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<p>admin 和 view 只负责业务渲染与鉴权，业务操作放在core中，方便后期进行前后端分离。<br>生产环境数据库使用mysql，为了方便演示，开发环境使用H2内嵌数据库。</p>
<h3 id="2-1-admin"><a href="#2-1-admin" class="headerlink" title="2.1 admin"></a>2.1 admin</h3><p><img src="https://img.hacpai.com/file/2018/04/93c438b9541c4ae58a739f11150fe1db_haro_admin.png" alt="haro_adminpng"></p>
<h3 id="2-2-view"><a href="#2-2-view" class="headerlink" title="2.2 view"></a>2.2 view</h3><p><img src="https://img.hacpai.com/file/2018/04/5cd50b4aff8d456aa1d2eb9bc6b31021_haro_view.png" alt="haro_viewpng"></p>
<h2 id="3-问题"><a href="#3-问题" class="headerlink" title="3 问题"></a>3 问题</h2><p>之前的项目基于spring开发，采用web.xml配置。spring-boot通过约定大于配置，极大的简化了这部分工作，但是有时候又会因为不熟悉带来迷茫。明明我没有这个配置，怎么就生效了。。而且jsp又不推荐使用，所以虽然大部分是在删代码，单还是遇到了很多问题。</p>
<h3 id="3-1-设置视图解析器InternalResourceViewResolver"><a href="#3-1-设置视图解析器InternalResourceViewResolver" class="headerlink" title="3.1 设置视图解析器InternalResourceViewResolver"></a>3.1 设置视图解析器InternalResourceViewResolver</h3><p>原项目在mvc-dispatcher-servlet.xml文件中配置 </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-boot提供了默认配置prefix = “spring.mvc”，详情可以参看org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties类， 并在org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration类中自动注入。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">		ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> InternalResourceViewResolver <span class="title">defaultViewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			InternalResourceViewResolver resolver = <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">			resolver.setPrefix(<span class="keyword">this</span>.mvcProperties.getView().getPrefix());</span><br><span class="line">			resolver.setSuffix(<span class="keyword">this</span>.mvcProperties.getView().getSuffix());</span><br><span class="line">			<span class="keyword">return</span> resolver;</span><br><span class="line">		&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以只需在application.properties中添加配置项</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.mvc.view.prefix</span>=<span class="string">/WEB-INF/pages/</span></span><br><span class="line"><span class="meta">spring.mvc.view.suffix</span>=<span class="string">.jsp</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-静态资源请求"><a href="#3-2-静态资源请求" class="headerlink" title="3.2 静态资源请求"></a>3.2 静态资源请求</h3><p>未实现前后端分离的项目，css、js等静态资源仍保存在项目中。spring-boot建议保存在resource/static目录下，并通过spring.resources.static-locations属性设置目录位置，并且需要制定mapping规则。</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.mvc.static-path-pattern</span>=<span class="string">/static/**</span></span><br><span class="line"><span class="meta">spring.resources.static-locations</span>=<span class="string">classpath:/static/</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-spring-boot-运行war项目"><a href="#3-3-spring-boot-运行war项目" class="headerlink" title="3.3 spring-boot 运行war项目"></a>3.3 spring-boot 运行war项目</h3><p>需要添加tomcat-embed依赖，并且设置servlet初始化。如果使用jsp标签，一般也需要添加jstl依赖。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Provided --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages=&#123;&quot;wang.crick.business.haro&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewAPP</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(ViewAPP.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ViewAPP.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要通过spring-boot maven插件运行。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<h3 id="3-4-自定义请求后缀匹配"><a href="#3-4-自定义请求后缀匹配" class="headerlink" title="3.4 自定义请求后缀匹配"></a>3.4 自定义请求后缀匹配</h3><p>旧项目中为了提高seo通过servlet-mapping指定请求路径为.html</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.html<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-boot在org.springframework.boot.autoconfigure.web.ServerProperties提供了servlet相关配置，可以通过application.properties配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.servlet.path</span>=<span class="string">*.html</span></span><br></pre></td></tr></table></figure>

<p>但是目前希望忽略后缀，即请求index和index.html都可以路由到对应的页面，此时可以通过设置pathmatch属性实现</p>
<blockquote>
<pre><code>   /**
     * Whether to use suffix pattern match (&quot;.*&quot;) when matching patterns to requests.
     * If enabled a method mapped to &quot;/users&quot; also matches to &quot;/users.*&quot;.
     */
</code></pre>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.mvc.pathmatch.use-suffix-pattern</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-使用内存数据库H2"><a href="#3-5-使用内存数据库H2" class="headerlink" title="3.5 使用内存数据库H2"></a>3.5 使用内存数据库H2</h3><p>为了让程序可以“无痛”运行，在代码中使用了基于内存的H2数据库，生产环境可以考虑mysql等关系型数据库，只需修改对应的配置即可。</p>
<p>需要添加H2依赖，引入驱动。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在配置文件application.properties中直接配置路径、驱动、以及账户信息</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:h2:mem:~/.h2/haro</span></span><br><span class="line"><span class="meta">spring.datasource.schema</span>=<span class="string">classpath:db/schema.sql</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">org.h2.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>

<p>db/schema.sql放置在resource目录下，保存了DDL以及开发环境所需数据。DDL支持情况为标准sql语句，部分工具导出的脚本需要简单修改。在程序启动过程中，会初始化执行，如果有异常，会在控制台中有详细提示。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>cms</tag>
      </tags>
  </entry>
  <entry>
    <title>在github上免费搭建hexo博客</title>
    <url>/2018/04/07/hexo/</url>
    <content><![CDATA[<h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h3><p>阅读本文需要你已掌握如下知识</p>
<ol>
<li>git</li>
<li>markdown</li>
</ol>
<p>现在写blog的人越来越少，但是在程序员这个群体中，还是很愿意分享自己的经验，也是对自己知识的一个积累。但是通过网站记录博客，定制化功能有限，不够灵活，也不希望给自己带来流量。而自己搭建一个博客平台的成本又比较大，这时可以考虑使用静态博客框架，同时兼顾了便捷性与功能性。hexo是其中的佼佼者，官方的定义如下</p>
<blockquote>
<p>A fast, simple &amp; powerful blog framework</p>
</blockquote>
<p>hexo是一款静态博客生成框架，拥有多套主题，可以通过github发布自己的博客，满足了程序员的geek特质。</p>
<span id="more"></span>

<h3 id="2-使用"><a href="#2-使用" class="headerlink" title="2 使用"></a>2 使用</h3><p><a href="https://hexo.io/">https://hexo.io</a></p>
<h4 id="2-1-安装hexo"><a href="#2-1-安装hexo" class="headerlink" title="2.1 安装hexo"></a>2.1 安装hexo</h4><p>通过npm安装hexo，需要sudo权限。</p>
<p>强烈推荐使用cnpm替换npm，提高下载速度。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>安装hexo命令行工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo cnpm install hexo-cli -g</span><br></pre></td></tr></table></figure>

<p>初始化blog</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo hexo init your_blog_dir</span><br></pre></td></tr></table></figure>

<p>安装node_modules依赖</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd your_blog_dir &amp; sudo cnpm install</span><br></pre></td></tr></table></figure>

<p>启动本地服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure>

<p>浏览器中访问 <a href="http://localhost:4000/">http://localhost:4000/</a> 可以看到博客已经运行成功</p>
<h4 id="2-2-第一篇博客"><a href="#2-2-第一篇博客" class="headerlink" title="2.2 第一篇博客"></a>2.2 第一篇博客</h4><p>先看一下hexo初始化的文件目录</p>
<ol>
<li>_config.yml 用于配置</li>
<li>scaffolds 脚手架目录，设置新建博客的内容模板</li>
<li>source &gt; _posts 用于保存博客文章</li>
<li>themes 主题</li>
</ol>
<p>通过命令行可以新建博客</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new &#x27;180407 hexo&#x27;</span><br></pre></td></tr></table></figure>

<p>可以在 source &gt; _posts 目录下看到生成了一个 180407-hexo.md 文件</p>
<p>也可以指定脚手架，设置新博文的模板</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new post &#x27;180407 post hexo&#x27;</span><br></pre></td></tr></table></figure>

<p>刷新 <a href="http://localhost:4000/">http://localhost:4000/</a> 即可看到博文已经出现在浏览器中。</p>
<h4 id="2-3-更换主题"><a href="#2-3-更换主题" class="headerlink" title="2.3 更换主题"></a>2.3 更换主题</h4><p>hexo的架构设计合理，方便三方提供样式模版。这里推荐两款使用过的主题，更多主题可以看 <a href="https://hexo.io/themes/">https://hexo.io/themes/</a> 根据自己喜好选择。</p>
<ol>
<li><a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/README.md">next</a> 目前正在使用的一款博客主题，外表美观、功能强大</li>
<li><a href="https://github.com/zthxxx/hexo-theme-Wikitten/blob/master/README_zh-CN.md">hexo-theme-Wikitten</a> 仿Wikitten样式，可以用于搭建自己的wiki库</li>
</ol>
<p>最简单的使用方式为，在themes目录下clone项目源码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<p>将_config.yml文件中的 <em>theme: landscape</em> 修改为 <em>theme: next</em>， 重启服务后访问<a href="http://localhost:4000/">http://localhost:4000/</a> 发现样式已经改变</p>
<h4 id="2-4-发布到github"><a href="#2-4-发布到github" class="headerlink" title="2.4 发布到github"></a>2.4 发布到github</h4><p>可以通过GitHub发布你的blog，好处是免费、便捷。</p>
<p>首先需要新建一个Github repository，并且在setting中设置<strong>Custom domain</strong>，这就是你的blog地址。</p>
<p>安装官方脚手架工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>在hexo的_config.yml文件中设置deploy属性，主要有type(发布类型)、repo(仓库地址)以及branch(分支)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/wangyuheng/wangyuheng.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>通过命令行执行 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<p>就会生成静态文件(html、css、JavaScript)，并且上传到github中。此时，可以通过<strong>Custom domain</strong>访问你的博客页面。如: <a href="http://wangyuheng.github.com/">http://wangyuheng.github.com/</a></p>
<p>注：本文认为你已经掌握了git技能，如果发布时候，有可能是因为权限问题，需要添加ssh-key或者指定git账号密码。</p>
<h4 id="2-5-发布到私有空间"><a href="#2-5-发布到私有空间" class="headerlink" title="2.5 发布到私有空间"></a>2.5 发布到私有空间</h4><p>使用GitHub托管博客，有几个缺陷：</p>
<ol>
<li>访问速度慢，容易被墙</li>
<li>SEO不友好，搜索引擎不可见</li>
<li>流量不属于自己</li>
</ol>
<p>此时可以先生成静态文件，再将静态文件发布到自己的web服务器。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure>

<p>可以看到public目录就是生成的静态文件目录。</p>
<h3 id="3-插件"><a href="#3-插件" class="headerlink" title="3. 插件"></a>3. 插件</h3><p>除了常规的功能内容外，hexo提供了强大的扩展功能。这里会记录一些插件，更多的乐趣还需要自己去探索。</p>
<h4 id="3-1-添加搜索功能"><a href="#3-1-添加搜索功能" class="headerlink" title="3.1 添加搜索功能"></a>3.1 添加搜索功能</h4><p>这里的搜索是指本地搜索，实现方式是自己编写一个search.html页面，并实现一个搜索脚本。。 脚手架会帮我们实现这一步，并且部分主题集成了搜索功能，以next为例：</p>
<p>先安装脚手架工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>

<p>在主题的_config.xml文件中启动本地搜索配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">local_search:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure>

<p>希望自己实现搜索功能的可以看一下<br>public/search.xml 和 public/js/script.js两个文件。</p>
<h3 id="4-进阶"><a href="#4-进阶" class="headerlink" title="4. 进阶"></a>4. 进阶</h3><p>一些略显高级的功能及优化</p>
<h4 id="4-1-替换jquery"><a href="#4-1-替换jquery" class="headerlink" title="4.1 替换jquery"></a>4.1 替换jquery</h4><p>默认主题的jquery是通过Google CDN获取的，导致经常不可用，可以替换为国内的CND</p>
<p>搜索jquery目录，如默认主题jquery文件所在位置为<strong>themes/landscape/layout/_partial/after-footer.ejs</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>替换为</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>360浏览器指定Webkit(chrome)内核</title>
    <url>/2015/12/29/html-360-webkit/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>很多web开发者对360浏览器都没有什么好感，拥有着庞大的用户量，但又因为种种特性导致网页兼容问题，尤其是360安全浏览器提供的双内核功能，总是将网站用IE内核去解析，而自己的网站 <a href="http://se.360.cn/">http://se.360.cn/</a> 却指定Webkit内核且不能切换。</p>
<p><img src="https://img.yuheng.wang/mweb/html-360-webkit-01.png" alt="html-360-webkit-01"></p>
<p><strong>但是，其实你们都错了，360是一家有着节操和普世情怀的良心企业</strong>，在官网中提供了通过meta指定内核的方法，并且希望通过推广，让更多的浏览器厂商认可这一标准</p>
<h1 id="指定内核"><a href="#指定内核" class="headerlink" title="指定内核"></a>指定内核</h1><p>360浏览器提供的方式非常简单，只需要在meta中指定希望浏览器解析网页的默认的内核即可</p>
<pre><code>&lt;meta name=&quot;renderer&quot; content=&quot;webkit|ie-comp|ie-stand&quot;&gt;
</code></pre>
<ul>
<li>webkit 使用Webkit内核，效果等同于chrome浏览器，别称chrome内核。</li>
<li>ie-comp 使用IE兼容内核，相当于IE6、7，这两个现在看来迷一样的浏览器。</li>
<li>ie-stand 使用IE标准内核，次模式下会调用用户安装的IE内核进行解析，如用户本地IE版本为IE9，则通过IE9内核进行解析。</li>
</ul>
<p>通过此方法，就可以让360安全浏览器以Webkit内核解析网页，以便达到对HTML5的良好支持。</p>
<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;meta name=&quot;renderer&quot; content=&quot;webkit&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>强大的360。附官网对此功能的详细介绍<a href="http://se.360.cn/v6/help/meta.html">http://se.360.cn/v6/help/meta.html</a></p>
]]></content>
      <categories>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>关于表单回车自动提交的种种</title>
    <url>/2015/12/21/html-auto-submit/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>业务场景为一个<em>type=text</em>的表单元素，通过ajax进行搜索。但是遇到一个bug，就是在输入之后按回车，就会自动提交表单。查找之后发现了浏览器的表单提交特性</p>
<p><strong>如果只有一个text表单元素，回车会自动提交表单！！</strong></p>
<p>为了避免这种bug，将表单回车后提交的场景都测试了一遍。</p>
<h1 id="场景一：只有一个type-text表单元素"><a href="#场景一：只有一个type-text表单元素" class="headerlink" title="场景一：只有一个type=text表单元素"></a>场景一：只有一个type=text表单元素</h1><pre><code>&lt;form action=&quot;http://blog.crick.wang&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>在此场景下，只要在input中按下回车键，就会自动提交表单。<br>为了避免自动提交，可以设置一个隐藏的text元素，如</p>
<pre><code>&lt;form action=&quot;http://blog.crick.wang&quot;&gt;
    &lt;input type=&quot;text&quot; style=&quot;display:none&quot; /&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;
&lt;/form&gt;
</code></pre>
<h1 id="场景二：有n个type-text和一个type-submit表单元素"><a href="#场景二：有n个type-text和一个type-submit表单元素" class="headerlink" title="场景二：有n个type=text和一个type=submit表单元素"></a>场景二：有n个type=text和一个type=submit表单元素</h1><pre><code>&lt;form action=&quot;http://blog.crick.wang&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;
    &lt;input type=&quot;text&quot; name=&quot;password&quot; /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Submit!&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>在此场景下，只要在input中按下回车键，就会自动提交表单。<br>为了避免自动提交，网上常见的例子是在form表单中监听<em>onkeydown</em>事件，如果是回车输入，则返回false，阻止表单提交。</p>
<pre><code>&lt;form action=&quot;http://blog.crick.wang&quot; onkeydown=&quot;if(event.keyCode==13)&#123;return false;&#125;&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;
    &lt;input type=&quot;text&quot; name=&quot;password&quot; /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Submit!&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>但是这种写法存在1个问题：<em>如果是textarea，可能会需要回车操作。</em></p>
<p>为了解决上述问题，需要增加针对textarea的判断条件，而且还要注意兼容ie。</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
document.onkeydown = function(event) &#123;
    event = event || window.event;
    var param = event.target || event.srcElement;
    // if (param.name==&quot;username&quot;)&#123;return true;&#125;
    if (event.keyCode == 13) &#123;
        if (&quot;INPUT&quot; == param.tagName) &#123;
            return false;
        &#125;
    &#125;
&#125;;
&lt;/script&gt;
&lt;form action=&quot;http://blog.crick.wang&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;
    &lt;input type=&quot;text&quot; name=&quot;password&quot; /&gt;
    &lt;textarea name=&quot;introduction&quot;&gt;&lt;/textarea&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Submit!&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>根据*if (param.name==”username”){return true;}*就可以自定义在某个表单元素中，点击回车键，就可以提交表单。</p>
<h1 id="场景三：有n个type-text，没有type-submit元素"><a href="#场景三：有n个type-text，没有type-submit元素" class="headerlink" title="场景三：有n个type=text，没有type=submit元素"></a>场景三：有n个type=text，没有type=submit元素</h1><p>此时点击回车键时，表单不会提交。可以通过监听onkeydown事件，利用submit()方法，根据keyCode和tagName或者表单元素的name来自定义提交规则</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
document.onkeydown = function(event) &#123;
    event = event || window.event;
    var param = event.target || event.srcElement;
    if (event.keyCode == 13 &amp;&amp; param.name==&quot;password&quot;)&#123;
        document.getElementById(&quot;entityForm&quot;).submit();
    &#125;
&#125;;
&lt;/script&gt;
&lt;form action=&quot;http://blog.crick.wang&quot; id=&quot;entityForm&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;
    &lt;input type=&quot;text&quot; name=&quot;password&quot; /&gt;
    &lt;textarea name=&quot;introduction&quot;&gt;&lt;/textarea&gt;
&lt;/form&gt;
</code></pre>
<h1 id="场景四：有n个type-text和一个button标签元素"><a href="#场景四：有n个type-text和一个button标签元素" class="headerlink" title="场景四：有n个type=text和一个button标签元素"></a>场景四：有n个type=text和一个button标签元素</h1><p>button标签，如果未指定type，则在ie6和ie7下为type=”button”， 在ie8及chrome和火狐下为type=”submit”，为了避免这种混乱，button标签一定要指定type。<br>如果指定为type=”button”，则和场景三的处理方式一致，<br>如果是type=”submit”，则同场景二。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>ie的特性让web开发者抓狂，本来很多浏览器自身属性可以方便解决的问题，都需要重新造一个轮子，达到浏览器兼容。<br>制造轮子和规则，为了规避约定或者隐藏特性带来的不可预知的麻烦。</p>
]]></content>
      <categories>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>HTML</tag>
        <tag>form</tag>
      </tags>
  </entry>
  <entry>
    <title>Http参数格式约定</title>
    <url>/2018/05/06/http-param/</url>
    <content><![CDATA[<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>微服务通过http协议进行内容传递，因为http协议自由且松散，所以有必要提供一套强有力的约定来限制接口。<br>服务内部实现，可以基于个人编程风格，但涉及到交互协作，必须提供风格一致的输入输出，减少开发与维护成本。</p>
<span id="more"></span>

<h2 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h2><h3 id="Request-疑问"><a href="#Request-疑问" class="headerlink" title="Request 疑问"></a>Request 疑问</h3><ol>
<li>接口不兼容升级，如何区分版本？ </li>
<li>如何使用request method？ include <code>GET</code>、<code>PUT</code>、<code>POST</code>、<code>PATCH</code>、<code>DELETE</code> and so on.</li>
<li>入参如何定义？ include <code>path</code>、<code>param</code>、<code>RequestBody</code>、<code>Header</code></li>
</ol>
<h3 id="Response-疑问"><a href="#Response-疑问" class="headerlink" title="Response 疑问"></a>Response 疑问</h3><p>常见格式如下:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;age&quot;</span>: <span class="number">4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;ok&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>code如何定义？ code=0表示成功 or 返回http_code 值？</li>
<li>error_code如何定义？ 扩展问题为，前端如何根据code进行提示渲染？</li>
</ol>
<h2 id="约定"><a href="#约定" class="headerlink" title="约定"></a>约定</h2><h3 id="Request-规范"><a href="#Request-规范" class="headerlink" title="Request 规范"></a>Request 规范</h3><ol>
<li>接口无法兼容时，升级版本。一般为非高频事件，所以默认接口无版本号，升级时path中增加版本，从**/v2/**开始。</li>
<li>针对<strong>request method</strong>，不完全依赖restful风格，仅使用<strong>GET</strong> &amp; <strong>POST</strong>两种方法。除查询接口使用<strong>GET</strong>方法外，其他业务逻辑接口均使用<strong>POST</strong>，降低调用方成本。</li>
<li>入参定义<ol>
<li>不使用<code>@PathVariable</code>，因为业务难以做到单参数满足业务需求，不方便扩展。</li>
<li>使用<code>@RequestParam</code>描述参数，不符合时返回<code>400</code>状态码。</li>
<li>表单提交使用<strong>POST</strong>， 通过<code>application/json</code>利用 <code>@RequestBody</code> 转换javaBean。</li>
<li><code>Header</code> 传输通用信息，如 ip、deviceId、token 等，且在nginx转发时，同时转发header参数。</li>
</ol>
</li>
</ol>
<h3 id="Response-规范"><a href="#Response-规范" class="headerlink" title="Response 规范"></a>Response 规范</h3><ol>
<li>通过<code>http_status</code>返回<strong>error_code</strong>。常用如:400、500以及自定义频段。此时response内容为<strong>error_message</strong>。</li>
<li>前端基于<code>http_status</code>查询对应渲染文案（含国际化）。</li>
</ol>
<p>不使用json定义code的理由如下：</p>
<ol>
<li>更符合http规范</li>
<li>减少性能损耗。状态码保存在状态行，通过字节流传输。所以读取<code>http_status</code>为error时，不需要解析response内容。</li>
</ol>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>常见的http状态码，可以基于实际场景选用。</p>
<h3 id="2xx"><a href="#2xx" class="headerlink" title="2xx"></a>2xx</h3><ol>
<li>200 (OK) = 成功</li>
<li>201 (Created) = 成功创建了一个资源</li>
<li>202 (Accepted) = 请求已接受，但未处理完成。如：定时触发的批量任务，以及触发，则返回202状态，实体内容返回已处理进度</li>
<li>204 (No Content) = 成功 but 无实体内容</li>
<li>206 (Partial Content) = 响应范围请求，request报文中包含range，response报文中包含Content-Range，断点续传</li>
</ol>
<h3 id="3xx"><a href="#3xx" class="headerlink" title="3xx"></a>3xx</h3><ol>
<li>301 (Moved Permanently) = 永久性重定向， 基于Location更新书签</li>
<li>302 (Found) = 临时更新，无需更新</li>
<li>303 (See Other) = 功能和302一致，但是必须通过GET方法再次发起请求</li>
<li>304 (Not Modified) = 不满足附带条件(If-Modified-Since) 不返回主体。非重定向，客户端可以使用本地缓存资源。</li>
<li>307 (Temporary Redirect) = 功能和302一致，但是不会从POST变成GET</li>
</ol>
<h3 id="4xx"><a href="#4xx" class="headerlink" title="4xx"></a>4xx</h3><ol>
<li>400 (Bad Request) = 请求报文存在语法错误，调用方参数异常</li>
<li>401 (Unauthorized) = 未通过认证授权，not login</li>
<li>403 (Forbidden) = 未给出原因，可以在实体中定义错误原因及错误码</li>
<li>404 (Not Found) = 资源不存在</li>
<li>405 (Method Not Allowed) = 请求方法错误，如用GET方法请求一个POST接口</li>
<li>429 (Too Many Requests) = 用户单位时间内发送了太多请求，限流 </li>
</ol>
<h3 id="5xx"><a href="#5xx" class="headerlink" title="5xx"></a>5xx</h3><ol>
<li>500 (Internal Server Error) = 程序执行错误，服务端不知道如何处理</li>
<li>502 (Bad Gateway) = 网关无法得到响应，如:nginx无法找到负载服务</li>
<li>503 (Service Unavailable) = 超负载或服务启动中，通过Retry-After标识可提供服务时间</li>
<li>504 (Gateway Timeout) = 网关和内部服务通信超时</li>
</ol>
]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
        <tag>request</tag>
        <tag>response</tag>
      </tags>
  </entry>
  <entry>
    <title>java aop实现http接口日志记录</title>
    <url>/2018/11/03/httplog/</url>
    <content><![CDATA[<h1 id="http-log"><a href="#http-log" class="headerlink" title="http log"></a>http log</h1><p>本文旨在讨论如何利用aop打印springboot http日志，包括访问日志、接口返回response，以及异常堆栈信息。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h3 id="为什么需要log"><a href="#为什么需要log" class="headerlink" title="为什么需要log"></a>为什么需要log</h3><p>有过线上问题排查经历的同学都知道，日志可以给你提供最直白、最明确的信息。此外，通过对日志的收集、审计，可以对BI以及系统健壮性提供建议。尤其是新系统上线之初，系统稳定性不足，更需要日志监控。</p>
<span id="more"></span>

<h3 id="为什么不实用Greys-access-log"><a href="#为什么不实用Greys-access-log" class="headerlink" title="为什么不实用Greys+access log"></a>为什么不实用Greys+access log</h3><p><a href="https://github.com/oldmanpushcart/greys-anatomy">Greys</a> 作为Java线上问题诊断工具，可以监控实时访问参数，但是对历史访问无记录，尤其是在前后分离or微服务架构下，日志是可以作为呈堂证供的存在。而access log不够灵活和强大。</p>
<h3 id="方案优势"><a href="#方案优势" class="headerlink" title="方案优势"></a>方案优势</h3><ol>
<li>简化日志打印</li>
<li>统一的日志格式，可以配合收集机制</li>
<li>灵活，可以自由选择是否记录日志、是否忽略response、是否忽略某些参数（如file参数显然不适合记录日志）、以及是否打印header参数</li>
<li>日志记录比例可配置（系统稳定，流量增大之后，可以通过配置降低记录比例）</li>
<li>方便回溯异常请求参数</li>
<li>记录接口耗时</li>
</ol>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="AOP-面向切面编程"><a href="#AOP-面向切面编程" class="headerlink" title="AOP-面向切面编程"></a>AOP-面向切面编程</h3><p>一句话描述，在java对象方法中增加切点，在不改变对象领域的前提下通过代理扩展功能。</p>
<h3 id="切面选择"><a href="#切面选择" class="headerlink" title="切面选择"></a>切面选择</h3><p>网上常见教程会选择拦截所有http请求，并打印request.parameters。但是存在问题：</p>
<ol>
<li>不够灵活，部分参数不想打印，如文件数据（过大）、敏感数据（身份证）等。</li>
<li>隐式的aop，容易给维护人员造成疑惑。(个人习惯偏向于避免隐藏的aop逻辑)</li>
<li>部分参数通过header传输</li>
</ol>
<p>因此，自定义日志输出<code>@annotation</code> <strong>HttpLog</strong>作为切点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于打印http请求访问日志</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yuheng.wang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> HttpLog &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 忽略参数，避免文件or无意义参数打印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 忽略参数数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要打印的header参数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> header参数名数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] headerParams() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoreResponse</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志记录比例</span></span><br><span class="line"><span class="comment">     *  &gt;100 or &lt; 0时，每次请求都会被记录</span></span><br><span class="line"><span class="comment">     *  = 0 时，不会记录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">percent</span><span class="params">()</span> <span class="keyword">default</span> 100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpLogHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(wang.crick.study.httplog.annotation.HttpLog)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logAnnotation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> Optional&lt;HttpLog&gt; <span class="title">getLogAnnotation</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (joinPoint <span class="keyword">instanceof</span> MethodInvocationProceedingJoinPoint) &#123;</span><br><span class="line">        Signature signature = joinPoint.getSignature();</span><br><span class="line">        <span class="keyword">if</span> (signature <span class="keyword">instanceof</span> MethodSignature) &#123;</span><br><span class="line">            MethodSignature methodSignature = (MethodSignature) signature;</span><br><span class="line">            Method method = methodSignature.getMethod();</span><br><span class="line">            <span class="keyword">if</span> (method.isAnnotationPresent(HttpLog.class)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Optional.of(method.getAnnotation(HttpLog.class));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打印异常信息"><a href="#打印异常信息" class="headerlink" title="打印异常信息"></a>打印异常信息</h3><ol>
<li>为了方便回溯，定义UUID形式的traceId，并通过ThreadLocal持有。</li>
<li>为了记录接口相应时间，定义startTime，并通过ThreadLocal持有。</li>
<li>AfterThrowing方法不会阻碍Exception的抛出，不会影响全局异常捕获。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(throwing = &quot;e&quot;, pointcut = &quot;logAnnotation()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">throwing</span><span class="params">(JoinPoint joinPoint, Exception e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Optional&lt;HttpLog&gt; httpLog = getLogAnnotation(joinPoint);</span><br><span class="line">        httpLog.ifPresent(anno -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!anno.ignoreResponse()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;ERROR_LOG. traceId:&#123;&#125;, cost:&#123;&#125;&quot;</span>,</span><br><span class="line">                        traceIdThreadLocal.get(), costTime(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;print error log fail!&quot;</span>, exception);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        startTimeThreadLocal.remove();</span><br><span class="line">        traceIdThreadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打印response"><a href="#打印response" class="headerlink" title="打印response"></a>打印response</h3><ol>
<li>通过JSONObject.toJSONString()转换，因为restful接口常见为返回json格式。</li>
<li>需要判断是否忽略了response打印</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(returning = &quot;restApiResponse&quot;, pointcut = &quot;logAnnotation()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">(JoinPoint joinPoint, Object restApiResponse)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Optional&lt;HttpLog&gt; httpLog = getLogAnnotation(joinPoint);</span><br><span class="line">        httpLog.ifPresent(anno -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!anno.ignoreResponse()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;RESPONSE_LOG. traceId:&#123;&#125;, result:&#123;&#125;, cost:&#123;&#125;&quot;</span>,</span><br><span class="line">                        traceIdThreadLocal.get(), JSONObject.toJSONString(restApiResponse), costTime());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;print response log fail!&quot;</span>, exception);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        startTimeThreadLocal.remove();</span><br><span class="line">        traceIdThreadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="获取请求日志"><a href="#获取请求日志" class="headerlink" title="获取请求日志"></a>获取请求日志</h3><h4 id="获取HttpServletRequest"><a href="#获取HttpServletRequest" class="headerlink" title="获取HttpServletRequest"></a>获取HttpServletRequest</h4><p>重点在于获取HttpServletRequest对象，而spring已经很贴心的在initContextHolders时通过RequestContextHolder持有了RequestAttributes参数(基于ThreadLocal)。 所以我们可以很轻松的获取请求参数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> HttpServletRequest <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RequestAttributes ra = RequestContextHolder.getRequestAttributes();</span><br><span class="line">    ServletRequestAttributes sra = (ServletRequestAttributes) ra;</span><br><span class="line">    <span class="keyword">return</span> sra.getRequest();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取RequestBody"><a href="#获取RequestBody" class="headerlink" title="获取RequestBody"></a>获取RequestBody</h4><p>！！上面获取参数的方式有一个缺陷，无法获取RequestBody参数，因为RequestBody是以流的形式读取，只能被读取一次，如果在aop中的提前读取了内容信息，后面的业务方法则无法获取。<br>一般的解决方案为封装一层HttpServletRequestWrapper暂存流的信息，实现多次读取。但是此种方案对需要修改HttpServletRequest，侵入性较大，所以我们采取另一种方案，基于aop+反射的特性获取java方法参数，遍历判断是否为@RequestBody参数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;Object&gt; <span class="title">getRequestBodyParam</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (joinPoint <span class="keyword">instanceof</span> MethodInvocationProceedingJoinPoint) &#123;</span><br><span class="line">        Signature signature = joinPoint.getSignature();</span><br><span class="line">        <span class="keyword">if</span> (signature <span class="keyword">instanceof</span> MethodSignature) &#123;</span><br><span class="line">            MethodSignature methodSignature = (MethodSignature) signature;</span><br><span class="line">            Method method = methodSignature.getMethod();</span><br><span class="line">            Parameter[] methodParameters = method.getParameters();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != methodParameters</span><br><span class="line">                    &amp;&amp; Arrays.stream(methodParameters).anyMatch(p-&gt; AnnotationUtils.findAnnotation(p, RequestBody.class) != <span class="keyword">null</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Optional.of(joinPoint.getArgs());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Optional.empty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取uri"><a href="#获取uri" class="headerlink" title="获取uri"></a>获取uri</h4><p>根据拦截规则不同，getServletPath()和request.getPathInfo()可能为空，简单的做一次健壮性判断。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getRequestPath</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> (<span class="keyword">null</span> != request.getServletPath() &amp;&amp; request.getServletPath().length() &gt; <span class="number">0</span>)</span><br><span class="line">           ? request.getServletPath() : request.getPathInfo();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="日志记录百分比"><a href="#日志记录百分比" class="headerlink" title="日志记录百分比"></a>日志记录百分比</h3><ol>
<li>接口请求量一般为平稳持续</li>
<li>并不需要十分精确的比例</li>
</ol>
<p>所以通过接口访问时间戳(startTime)尾数进行判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">needLog</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">long</span> startTimeMillis)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (percent&lt; <span class="number">0</span> || percent &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (percent == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> percent &gt; startTimeMillis % <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="加载HttpLogAspect对象"><a href="#加载HttpLogAspect对象" class="headerlink" title="加载HttpLogAspect对象"></a>加载HttpLogAspect对象</h3><ol>
<li>可以在@SpringBootApplication类下直接加载，也可以在HttpLogAspect中增加@Component注解。</li>
<li>不需要显示声明@EnableAspectJAutoProxy注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HttpLogAspect <span class="title">httpLogAspect</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> HttpLogAspect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controller配置日志打印"><a href="#Controller配置日志打印" class="headerlink" title="Controller配置日志打印"></a>Controller配置日志打印</h3><p>在controller中在接口方法中通过HttpLog配置，即可实现日志记录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;log&#x2F;pwdExcludeResponse&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">@HttpLog(headerParams&#x3D;&quot;username&quot;, ignoreResponse &#x3D; true, percent &#x3D; 50, exclude&#x3D;&#123;&quot;avatar&quot;&#125;)</span><br><span class="line">public RestApiResponse&lt;User&gt; getInfoWithPwd(@PathVariable(&quot;id&quot;) int id,</span><br><span class="line">                                            @RequestParam(&quot;age&quot;) int age,</span><br><span class="line">                                            @RequestParam(&quot;avatar&quot;) MultipartFile avatar,</span><br><span class="line">                                            @RequestHeader(&quot;password&quot;) String password)&#123;</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setId(id);</span><br><span class="line">    user.setPassword(password);</span><br><span class="line">    user.setAge(age);</span><br><span class="line">    return RestApiResponse.success(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">REQUEST_LOG. traceId:737001cf-f546-4092-9c77-f7762275ddcf. requestUrl: /user/<span class="built_in">log</span>/7 -PARAMS- age: [6], </span><br><span class="line">RESPONSE_LOG. traceId:737001cf-f546-4092-9c77-f7762275ddcf, result:&#123;<span class="string">&quot;code&quot;</span>:10000,<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:6,<span class="string">&quot;id&quot;</span>:7,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;8025373076402792850&quot;</span>&#125;&#125;, cost:171</span><br><span class="line">REQUEST_LOG. traceId:8c907a7e-f36a-4ccc-a931-f167b55697ee. requestUrl: /user/<span class="built_in">log</span>/<span class="built_in">pwd</span>/0 -PARAMS- age: [7],  -HEADER_PARAMS- password: 6460630360418207541, </span><br><span class="line">RESPONSE_LOG. traceId:8c907a7e-f36a-4ccc-a931-f167b55697ee, result:&#123;<span class="string">&quot;code&quot;</span>:10000,<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;id&quot;</span>:0,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;6460630360418207541&quot;</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;2250855379452327045&quot;</span>&#125;&#125;, cost:9</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>log</tag>
      </tags>
  </entry>
  <entry>
    <title>优雅的国际化实现</title>
    <url>/2018/09/07/i18n/</url>
    <content><![CDATA[<p>本文项目已发布到github，后续学习项目也会添加到此工程下，欢迎fork点赞。<br><a href="https://github.com/wangyuheng/spring-boot-sample">https://github.com/wangyuheng/spring-boot-sample</a></p>
<h1 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h1><blockquote>
<p>简单来说，国际化就是让应用（app、web）适应不同的语言和地区的需要，比如根据地区选择页面展示语言。 </p>
</blockquote>
<p><strong>i18n</strong>=internationalization，首末字符i和n，18为中间的字符数</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>基于传入<strong>语言or地区</strong>标识进行判断，输出不同内容。伪代码如下：</p>
<span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">func <span class="title">hello</span><span class="params">(<span class="keyword">var</span> lang)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lang == <span class="string">&quot;にほんご&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;おはよう&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lang == <span class="string">&quot;English&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> “你好”</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原理简单，但是如何优雅的实现？spring是否已经提供了现成的轮子？答案是肯定的。基于原理可以认为，实现国际化主要分为2部分</p>
<ol>
<li>输入<strong>语言or地区</strong>标识</li>
<li>输出不同语言or地区的内容文案</li>
</ol>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>通过MessageSource实现不同语言输出。</p>
<p>在spring初始化refresh过程中，会初始化MessageSource。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractApplicationContext</span> <span class="keyword">extends</span> <span class="title">DefaultResourceLoader</span></span></span><br><span class="line"><span class="class">		<span class="keyword">implements</span> <span class="title">ConfigurableApplicationContext</span>, <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line">...		</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">			<span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">			prepareRefresh();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">			ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">			prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">				postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">				invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">				registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Initialize message source for this context.</span></span><br><span class="line">				initMessageSource();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">				initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">				onRefresh();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">				registerListeners();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">				finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">				finishRefresh();</span><br><span class="line">			&#125;</span><br><span class="line">...	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而springboot会初始化ResourceBundleMessageSource实例作为MessageSource的默认实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = MessageSource.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@Conditional(ResourceBundleCondition.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.messages&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageSourceAutoConfiguration</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.hasText(<span class="keyword">this</span>.basename)) &#123;</span><br><span class="line">			messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">					StringUtils.trimAllWhitespace(<span class="keyword">this</span>.basename)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.encoding != <span class="keyword">null</span>) &#123;</span><br><span class="line">			messageSource.setDefaultEncoding(<span class="keyword">this</span>.encoding.name());</span><br><span class="line">		&#125;</span><br><span class="line">		messageSource.setFallbackToSystemLocale(<span class="keyword">this</span>.fallbackToSystemLocale);</span><br><span class="line">		messageSource.setCacheSeconds(<span class="keyword">this</span>.cacheSeconds);</span><br><span class="line">		messageSource.setAlwaysUseMessageFormat(<span class="keyword">this</span>.alwaysUseMessageFormat);</span><br><span class="line">		<span class="keyword">return</span> messageSource;</span><br><span class="line">	&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MessageSource内部则通过basename以及Locale定位到具体Resource Bundle文件，并基于code**(properties key)**读取对应的显示文本。</p>
<p>其中涉及到的三个概念</p>
<ol>
<li>basename标识</li>
<li>Locale</li>
<li>Resource Bundle</li>
</ol>
<h4 id="basename"><a href="#basename" class="headerlink" title="basename"></a>basename</h4><p>用于指定Resource Bundle文件位置，可以通过配置文件配置, 默认为<strong>messages</strong></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.messages.basename</span>=<span class="string">messages</span></span><br></pre></td></tr></table></figure>

<h4 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h4><p>Locale对象代表具体的地理，政治或文化地区，用来指定语言及地区。构造函数如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Locale(String language)</span><br><span class="line"></span><br><span class="line">Locale(String language, String country)</span><br><span class="line"></span><br><span class="line">Locale(String language, String country, String variant)</span><br></pre></td></tr></table></figure>

<p>variant 变体值，用于指示变化的任意值Locale。<br>同时， Locale类内置了众多常用国家地区的常量实例，如 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">final</span> Locale ENGLISH = createConstant(<span class="string">&quot;en&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">final</span> Locale CHINESE = createConstant(<span class="string">&quot;zh&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">final</span> Locale SIMPLIFIED_CHINESE = createConstant(<span class="string">&quot;zh&quot;</span>, <span class="string">&quot;CN&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">final</span> Locale TRADITIONAL_CHINESE = createConstant(<span class="string">&quot;zh&quot;</span>, <span class="string">&quot;TW&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Resource-Bundle"><a href="#Resource-Bundle" class="headerlink" title="Resource Bundle"></a>Resource Bundle</h4><p>ResourceBundle类和Properties类似，都可以读取程序内的文件，不过ResourceBundle更强大，提供了诸如缓存、Locale区分一类的操作。</p>
<p>所以<strong>MessageSource</strong>其实是对ResourceBundle的一种封装增加，优化了使用，并且托管与spring容器生命周期。这时就有一个很重要的选择：</p>
<p><strong>如果通过静态类封装了restful的接口返回，可以自己扩展ResourceBundle类，而不是将MessageSource的spring实例放置在静态类中。</strong></p>
<p>而idea中提供了Resource Bundle资源束的支持，方便用户添加管理国际化文案。</p>
<p><img src="http://img.yuheng.wang/i18n.png" alt="i18n"><br><img src="http://img.yuheng.wang/i18n_0.png" alt="i18n_0"></p>
<h3 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h3><p>看完输出的形式，可以知道，我们只需要确认Locale就可以实现国际化。所以我们再找一下Locale的轮子。</p>
<h4 id="accept-language"><a href="#accept-language" class="headerlink" title="accept-language"></a>accept-language</h4><p>servlet自带轮子，基于http协议，即通过header中的<strong>accept-language</strong>报文头，实现Locale的自动识别。</p>
<p>代码见<code>org.apache.catalina.connector.Request</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> <span class="keyword">implements</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">catalina</span>.<span class="title">servlet4preview</span>.<span class="title">http</span>.<span class="title">HttpServletRequest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">getLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!localesParsed) &#123;</span><br><span class="line">            parseLocales();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (locales.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> locales.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">parseLocales</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        localesParsed = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Store the accumulated languages that have been requested in</span></span><br><span class="line">        <span class="comment">// a local collection, sorted by the quality value (so we can</span></span><br><span class="line">        <span class="comment">// add Locales in descending order).  The values will be ArrayLists</span></span><br><span class="line">        <span class="comment">// containing the corresponding Locales to be added</span></span><br><span class="line">        TreeMap&lt;Double, ArrayList&lt;Locale&gt;&gt; locales = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        Enumeration&lt;String&gt; values = getHeaders(<span class="string">&quot;accept-language&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (values.hasMoreElements()) &#123;</span><br><span class="line">            String value = values.nextElement();</span><br><span class="line">            parseLocalesHeader(value, locales);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Process the quality values in highest-&gt;lowest order (due to</span></span><br><span class="line">        <span class="comment">// negating the Double value when creating the key)</span></span><br><span class="line">        <span class="keyword">for</span> (ArrayList&lt;Locale&gt; list : locales.values()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Locale locale : list) &#123;</span><br><span class="line">                addLocale(locale);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring提供的轮子</p>
<ol>
<li>LocaleResolver 实现次接口，用于自定义解析规则</li>
<li>RequestContextUtils 基于request获取Locale，优先使用自定义LocaleResolver</li>
<li>LocaleContextHolder通过ThreadLocal持有Locale对象，在FrameworkServlet支持servlet.service时执行初始化。</li>
<li>LocaleChangeInterceptor通过Configuration配置Locale切换规则</li>
</ol>
<p>综上，只要请求方在header中增加了<strong>accept-language</strong>报文头，即可在代码中通过LocaleContextHolder获取Locale对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.MessageSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.i18n.LocaleContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">I18nApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(I18nApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hello</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> messageSource.getMessage(<span class="string">&quot;10000&quot;</span>, <span class="keyword">new</span> Object[]&#123;&#125;, LocaleContextHolder.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="lang"><a href="#lang" class="headerlink" title="lang"></a>lang</h4><p>除了accept-language外，常见在url中增加了国家及地区参数，如: <a href="https://twitter.com/?lang=zh">https://twitter.com/?lang=zh</a></p>
<p>通过<strong>lang</strong>配置国际化，需要通过<strong>LocaleChangeInterceptor</strong>进行配置，此配置的优先级高于<strong>accept-language</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">I18nConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionLocaleResolver sessionLocaleResolver = <span class="keyword">new</span> SessionLocaleResolver();</span><br><span class="line">        <span class="keyword">return</span> sessionLocaleResolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleChangeInterceptor <span class="title">localeChangeInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LocaleChangeInterceptor localeChangeInterceptor = <span class="keyword">new</span> LocaleChangeInterceptor();</span><br><span class="line">        localeChangeInterceptor.setParamName(<span class="string">&quot;lang&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> localeChangeInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(localeChangeInterceptor());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Test-Case"><a href="#Test-Case" class="headerlink" title="Test Case"></a>Test Case</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.embedded.LocalServerPort;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.web.client.TestRestTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.i18n.LocaleContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment=SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">I18nApiTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@LocalServerPort</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TestRestTemplate restTemplate = <span class="keyword">new</span> TestRestTemplate();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_message_by_different_accept_language</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">        headers.add(<span class="string">&quot;accept-language&quot;</span>, <span class="string">&quot;en&quot;</span>);</span><br><span class="line">        HttpEntity entity = <span class="keyword">new</span> HttpEntity(headers);</span><br><span class="line">        ResponseEntity&lt;String&gt; resultEn = restTemplate.exchange(<span class="string">&quot;http://localhost:&quot;</span>+port+<span class="string">&quot;/hello&quot;</span>, HttpMethod.GET, entity, String.class);</span><br><span class="line">        assertEquals(<span class="string">&quot;hello&quot;</span>, resultEn.getBody());</span><br><span class="line"></span><br><span class="line">        headers.remove(<span class="string">&quot;accept-language&quot;</span>);</span><br><span class="line">        headers.add(<span class="string">&quot;accept-language&quot;</span>, <span class="string">&quot;zh&quot;</span>);</span><br><span class="line">        entity = <span class="keyword">new</span> HttpEntity(headers);</span><br><span class="line">        ResponseEntity&lt;String&gt; resultCh = restTemplate.exchange(<span class="string">&quot;http://localhost:&quot;</span>+port+<span class="string">&quot;/hello&quot;</span>, HttpMethod.GET, entity, String.class);</span><br><span class="line">        assertEquals(<span class="string">&quot;你好&quot;</span>, resultCh.getBody());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_zh_message_by_accept_language_zh_locale</span><span class="params">()</span></span>&#123;</span><br><span class="line">        LocaleContextHolder.setLocale(Locale.CHINA);</span><br><span class="line">        assertEquals(<span class="string">&quot;你好&quot;</span>, ResourceBundle.getBundle(<span class="string">&quot;messages&quot;</span>, LocaleContextHolder.getLocale()).getString(<span class="string">&quot;10000&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_zh_message_by_different_lang</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String lang = <span class="string">&quot;en&quot;</span>;</span><br><span class="line">        ResponseEntity&lt;String&gt; resultEn = restTemplate.getForEntity(<span class="string">&quot;http://localhost:&quot;</span>+port+<span class="string">&quot;/hello?lang=&quot;</span>+lang, String.class);</span><br><span class="line">        assertEquals(<span class="string">&quot;hello&quot;</span>, resultEn.getBody());</span><br><span class="line">        lang = <span class="string">&quot;zh&quot;</span>;</span><br><span class="line">        ResponseEntity&lt;String&gt; resultCh = restTemplate.getForEntity(<span class="string">&quot;http://localhost:&quot;</span>+port+<span class="string">&quot;/hello?lang=&quot;</span>+lang, String.class);</span><br><span class="line">        assertEquals(<span class="string">&quot;你好&quot;</span>, resultCh.getBody());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_by_lang_when_set_lang_and_accept_language</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String lang = <span class="string">&quot;zh&quot;</span>;</span><br><span class="line">        HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">        headers.add(<span class="string">&quot;accept-language&quot;</span>, <span class="string">&quot;en&quot;</span>);</span><br><span class="line">        HttpEntity entity = <span class="keyword">new</span> HttpEntity(headers);</span><br><span class="line">        ResponseEntity&lt;String&gt; resultEn = restTemplate.exchange(<span class="string">&quot;http://localhost:&quot;</span>+port+<span class="string">&quot;/hello?lang=&quot;</span>+lang, HttpMethod.GET, entity, String.class);</span><br><span class="line">        assertEquals(<span class="string">&quot;你好&quot;</span>, resultEn.getBody());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LanguageTagCompliant"><a href="#LanguageTagCompliant" class="headerlink" title="LanguageTagCompliant"></a>LanguageTagCompliant</h3><p>Locale的命名规则为 lang-country， 如: <strong>zh-CN</strong>，有时会看到<strong>zh_CH</strong>这种写法，这是另一种规范，可以在CookieLocaleResolver了解规范定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Parse the given locale value coming from an incoming cookie.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The default implementation calls &#123;<span class="doctag">@link</span> StringUtils#parseLocaleString(String)&#125;</span></span><br><span class="line"><span class="comment"> * or JDK 7&#x27;s &#123;<span class="doctag">@link</span> Locale#forLanguageTag(String)&#125;, depending on the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #setLanguageTagCompliant &quot;languageTagCompliant&quot;&#125; configuration property.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> locale the locale value to parse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the corresponding &#123;<span class="doctag">@code</span> Locale&#125; instance</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@UsesJava7</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Locale <span class="title">parseLocaleValue</span><span class="params">(String locale)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (isLanguageTagCompliant() ? Locale.forLanguageTag(locale) : StringUtils.parseLocaleString(locale));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要在中LocaleChangeInterceptor开启兼容模式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">localeChangeInterceptor.setLanguageTagCompliant(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>但是为了符合规范，不推荐<strong>zh_CH</strong>这种写法。</p>
<h2 id="倾向"><a href="#倾向" class="headerlink" title="倾向"></a>倾向</h2><p>按照<a href="http://blog.crick.wang/2018/05/06/http-param/">《Http参数格式约定》</a>文中所述，通用&amp;非业务参数，一般会选择放到header中，所以比较倾向于<strong>accept-language</strong>这种定义方法。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>i8n</tag>
      </tags>
  </entry>
  <entry>
    <title>java split 报错java.lang.ArrayIndexOutOfBoundsException</title>
    <url>/2015/12/14/java-split-exception/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="java-lang-split方法简介"><a href="#java-lang-split方法简介" class="headerlink" title="java.lang#split方法简介"></a>java.lang#split方法简介</h1><p>java.lang提供的split方法，可以根据指定分隔符，将String字符串，切割并返回String[]字符串数组。</p>
<pre><code>public String[] split(String regex)
public String[] split(String regex, int limit)
</code></pre>
<p><strong>regex</strong>为指定分隔符，支持正在表达式<br><strong>limit</strong>为切割后的数组长度，默认为0，不会超过实际长度<br>例:</p>
<pre><code>public static void main(String[] args) &#123;
    String str = &quot;a,b,c,d,e&quot;;
    String[] arr1 = str.split(&quot;,&quot;); // [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;] length=5
    String[] arr2 = str.split(&quot;,&quot;, 3); //[&quot;a&quot;, &quot;b&quot;, &quot;c,d,e&quot;] length=3
    String[] arr3 = str.split(&quot;,&quot;, 10); //[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;] length=5
    String[] arr4 = str.split(&quot;nan&quot;); //[&quot;a,b,c,d,e&quot;] length=1
    String[] arr5 = &quot;&quot;.split(&quot;nan&quot;); //[&quot;&quot;] length=1
&#125;
</code></pre>
<hr>
<h1 id="特殊用法"><a href="#特殊用法" class="headerlink" title="特殊用法"></a>特殊用法</h1><p>因为split支持正则参数，可能会需要根据多个分隔符进行分隔，如 <strong>id=? and gender=? or age&gt;?</strong>,希望根据<em>and</em>和<em>or</em>两个分隔符进行分隔，则可通过正则实现。</p>
<pre><code>public static void main(String[] args) &#123;
    String str = &quot;id=? and gender=? or age&gt;?&quot;;
    String[] arr1 = str.split(&quot;and | or&quot;); // [&quot;id=? &quot;,&quot;gender=?&quot;,&quot; age&gt;?&quot;] length=3
&#125;
</code></pre>
<p>注意上述中的空格符， 如果只根据关键字分隔，不能输入空格。**”and|or”**，可实现分隔效果。</p>
<hr>
<h1 id="易现exception"><a href="#易现exception" class="headerlink" title="易现exception"></a>易现exception</h1><h2 id="NullPointerException"><a href="#NullPointerException" class="headerlink" title="NullPointerException"></a>NullPointerException</h2><p>字符串为””时， 返回结果为String[]{“”},但是字符串为null，会抛出空指针异常<strong>java.lang.NullPointerException</strong></p>
<h2 id="ArrayIndexOutOfBoundsException"><a href="#ArrayIndexOutOfBoundsException" class="headerlink" title="ArrayIndexOutOfBoundsException"></a>ArrayIndexOutOfBoundsException</h2><p>标题中出现的java.lang.ArrayIndexOutOfBoundsException, 是一个容易出现的bug，因为支持正则参数，如果传入参数为转义符，则会出现非预期的结果数据。<br>如：</p>
<pre><code>public static void main(String[] args) &#123;
    String str = &quot;a.b.c.d.e&quot;;
    String[] arr1 = str.split(&quot;.&quot;); // length=0 如果读取数组 则会出现数组越界异常ArrayIndexOutOfBoundsException
    String[] arr2 = str.split(&quot;\\.&quot;); // [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;] length=5
&#125;
</code></pre>
<p>同理， 根据**”|”<strong>分隔，需要使用</strong>“\|”**</p>
<h2 id="java-util-regex-PatternSyntaxException"><a href="#java-util-regex-PatternSyntaxException" class="headerlink" title="java.util.regex.PatternSyntaxException"></a>java.util.regex.PatternSyntaxException</h2><p>同样是由于正则表达式参数，**”+”** <strong>“*”<strong>需要使用</strong>“\+”</strong> **”\*”**进行转义，否则，会报错java.util.regex.PatternSyntaxException</p>
<pre><code>public static void main(String[] args) &#123;
    String str = &quot;a+b+c+d+e&quot;;
    String[] arr1 = str.split(&quot;\\+&quot;); // [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;] length=5
    String[] arr2 = str.split(&quot;+&quot;); // java.util.regex.PatternSyntaxException: Dangling meta character &#39;+&#39; near index 0
&#125;
</code></pre>
<hr>
<p><strong>Best regards</strong><br><strong>Wang Yuheng</strong></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>bug</tag>
        <tag>split</tag>
      </tags>
  </entry>
  <entry>
    <title>java压缩图片生成缩略图，并添加水印</title>
    <url>/2015/12/16/java-thumbnail-watermark/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>在编写的cms系统中，提供了图片上传功能，但是用户经常(或者说从不)按照推荐的比例上传图片，当然这不是主要问题，关键点在于，经常会上传一些超大分辨率的图片，严重影响整个网站的加载速度。<br>面对这个问题，除了限制上传图片的大小外，是否还有更自动化的解决方案？</p>
<h2 id="待解决问题："><a href="#待解决问题：" class="headerlink" title="待解决问题："></a>待解决问题：</h2><ol>
<li>图片长宽比</li>
<li>图片大小</li>
<li>图片格式</li>
<li>水印(用户要求)<br>关于添加水印的问题，其实用户希望制作一款不能被下载图片的网站，但个人能力有限，实在不能胜任。于是用户提出水印要求，本身可能会觉得水印是本地图片操作的职责，但为了体验系统的自动化，决定增加自动添加水印功能。</li>
</ol>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>java 的io操作一直是我较为困扰的部分。原因无它，因为可以实现的方式实在是太多了，在数十个工具类和数个知名类库中该如何选择？而java在图像处理方面，私以为并不占有优势。<br>经过多方比较，适用，最终采用了<a href="https://github.com/coobird/thumbnailator">thumbnailator</a>这一开源解决方案</p>
<h2 id="thumbnailator"><a href="#thumbnailator" class="headerlink" title="thumbnailator"></a>thumbnailator</h2><blockquote>
<p>thumbnailator是一个开源的java生成缩略图类库，没有依赖其他外部库，不需要自己去学习Image I/O API, Java 2D API, image processing, image scaling techniques， BufferedImages，Graphics2D 等技术，可以简单方便的实现这些功能。</p>
</blockquote>
<h3 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h3><p>thumbnailator是一个简单的jar文件，也支持通过maven进行依赖管理</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;net.coobird&lt;/groupId&gt;
    &lt;artifactId&gt;thumbnailator&lt;/artifactId&gt;
    &lt;version&gt;0.4.8&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>thumbnailator提供的功能简单、强大，且API规则良好，可以容易的理解接口含义。下面针对上面的问题，介绍一下thumbnailator的主要功能。</p>
<h4 id="重置图片大小"><a href="#重置图片大小" class="headerlink" title="重置图片大小"></a>重置图片大小</h4><pre><code>Thumbnails.of(new File(&quot;original.jpg&quot;))
    .size(640, 480)
    .outputFormat(&quot;jpg&quot;)
    .toFiles(Rename.NO_CHANGE);
</code></pre>
<p>new File(“original.jpg”) 可以是listFiles()来实现对目录下所有文件的操作，也可以直接输入String类型”original.jpg”<br>toFiles表示文件输出位置，单个文件可以自定义指定文件路径。<br>在处理多文件时，可以根据Rename提供的方法Rename.NO_CHANGE表示变更当前图片文件，还有Rename.PREFIX_DOT_THUMBNAIL等增加前缀、后缀等方式，此时会保留原文件和生成后的图片文件。<br>outputFormat现支持ImageIO.getWriterFormatNames();提供的格式类型，本测试环境为jdk1.6.0_38，提供的类型有<em>BMP bmp jpg JPG wbmp jpeg png PNG JPEG WBMP GIF gif</em></p>
<h4 id="生成一个旋转90°带水印的缩略图"><a href="#生成一个旋转90°带水印的缩略图" class="headerlink" title="生成一个旋转90°带水印的缩略图"></a>生成一个旋转90°带水印的缩略图</h4><pre><code>Thumbnails.of(new File(&quot;original.jpg&quot;))
        .size(160, 160)
        .rotate(70)
        .watermark(Positions.BOTTOM_RIGHT, ImageIO.read(new File(&quot;watermark.png&quot;)), 0.5f)
        .outputQuality(0.8)
        .toFile(new File(&quot;image-with-watermark.jpg&quot;));
        
</code></pre>
<p>rotate表示图片旋转角度，如果不是进行直角(n*90°)旋转的话，图片的size会发生变化。<br>watermark指定了水印，通过Positions指定水印位置，BufferedImage指定水印图片，第三个参数指定了水印的不透明性，范围为(0<del>1.0f),1.0f为不透明。<br>outputQuality 指定输出图片的质量，范围同样为(0</del>1.0f)。</p>
<p>除了<strong>toFile</strong>，Thumbnails还可以将图片输出为OutputStream(<strong>toOutputStream</strong>)和BufferedImage(<strong>asBufferedImage</strong>)，或者是指定的输出目录(<strong>toFiles</strong>)。</p>
<h4 id="按比例缩略图片"><a href="#按比例缩略图片" class="headerlink" title="按比例缩略图片"></a>按比例缩略图片</h4><pre><code>Thumbnails.of(new File(&quot;original.jpg&quot;))
    .scale(0.2)
    .outputFormat(&quot;jpg&quot;)
    .toFiles(Rename.NO_CHANGE);
</code></pre>
<p>scale提供了按照比例缩略图片的方法，也可以通过大于1的数字扩大图片。</p>
<h3 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h3><p>在测试环境中，发现水印图片过大导致显示不全和旋转图片后的图片比例变更等问题，都是因为使用不当。<br>在生产环境中，暂时未遇到使用问题。如果有问题，会在这里指出，并提供解决方案。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>thumbnailator是难得的让我通过java简单的使用io和图像处理的工具类，很喜欢它提供api方式，正在学习源码。</p>
<p><strong>Best regards</strong><br><strong>Wang Yuheng</strong></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>thumbnail</tag>
        <tag>watermark</tag>
      </tags>
  </entry>
  <entry>
    <title>java通过DOM操作xml</title>
    <url>/2015/12/22/java-xml-by-dom/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><p>XML (eXtensible Markup Language), 可扩展标记语言,发明之初是为了取代HTML，但在使用过程中，开发者发现这种规范的语言格式，在数据传输方面有着明显的优势。<br><em>这里只将XML作为一种数据交换格式。</em><br>比如说java语言本身的javaBean数据，在程序内使用没有问题，但是如果涉及到与其他语言进行交互，则会出现很多问题。所以通过XML进行数据传输通信，可以拥有更好的跨平台性和可移植性，并且让底层数据预备了可读性。<br>本篇文章的重点在于介绍如果通过java DOM对XML文件进行解析与操作。</p>
<h1 id="dom"><a href="#dom" class="headerlink" title="dom"></a>dom</h1><p>DOM是W3C处理XML的标准API，多种语言都实现了该标准，java对dom的实现在org.w3c.dom包内。很多工具类都是在此基础上进行了封装和扩充，如jdom、dom4j等，这里使用原生实现来完成对xml文档的基本操作。<br>DOM的实现原理是将XML作为树结构全部读入内存，再进行操作。好处是简单快捷，可以修改结构和数据，而造成的隐患则是是在读取大型XML文件时，可能会造成过多的内存占用。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="读取解析xml文件"><a href="#读取解析xml文件" class="headerlink" title="读取解析xml文件"></a>读取解析xml文件</h2><p>需要读取的xml文件如下，传递了商品订单信息，包括商品名、价格、购买数量。通过程序读取数据，并计算出订单总价格。<br>因为本次重点在于xml的解析操作，所以价格直接用float类型处理。如果是生产环境，一定要使用BigDecimal操作，避免float的精度问题！！</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;shopping&gt;
    &lt;goods&gt;
        &lt;name&gt;品名1&lt;/name&gt;
        &lt;price&gt;3&lt;/price&gt;
        &lt;number&gt;4&lt;/number&gt;
    &lt;/goods&gt;
    &lt;goods&gt;
        &lt;name&gt;品名2&lt;/name&gt;
        &lt;price&gt;1.2&lt;/price&gt;
        &lt;number&gt;3&lt;/number&gt;
    &lt;/goods&gt;
&lt;/shopping&gt;
</code></pre>
<p>java 读取XML代码 </p>
<pre><code>import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

public class XmlParser &#123;
    
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    
    public Document parseDoc(String filePath) &#123;
        Document document = null;
        try &#123;
            DocumentBuilder builder = factory.newDocumentBuilder();
            document = builder.parse(new File(filePath));
        &#125; catch (ParserConfigurationException e) &#123;
            e.printStackTrace();
        &#125; catch (SAXException e) &#123;
            e.printStackTrace();
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
        &#125;
        return document;
    &#125;
    
    public static void main(String[] args) &#123;
        XmlParser parser = new XmlParser();
        Document document = parser.parseDoc(&quot;D://shopping.xml&quot;);
        Element rootElement = document.getDocumentElement();
        List&lt;Goods&gt; goodsList = new ArrayList&lt;Goods&gt;();
        NodeList goodsNodeList = rootElement.getElementsByTagName(&quot;goods&quot;);
        for (int i = 0; i &lt; goodsNodeList.getLength(); i++) &#123;
            Element child = (Element) goodsNodeList.item(i);
            Goods goods = new Goods(child);
            goodsList.add(goods);
        &#125;
        
//        NodeList goodsNodeList = rootElement.getChildNodes();
//        for (int i = 0; i &lt; goodsNodeList.getLength(); i++) &#123;
//            Node node = goodsNodeList.item(i);
//            if (node.getNodeType() == Node.ELEMENT_NODE) &#123;
//                Element child = (Element) node;
//                Goods goods = new Goods(child);
//                goodsList.add(goods);
//            &#125;
//        &#125;
        float total = 0;
        int sum = 0;
        for (Goods goods : goodsList) &#123;
            total += goods.getTotal();
            sum += goods.getNumber();
        &#125;
        System.out.println(total);
        System.out.println(sum);
    &#125;
    
    static class Goods &#123;
        private float price;
        private int number;
        public Goods(Element element) &#123;
            this.price = Float.parseFloat(element.getElementsByTagName(&quot;price&quot;).item(0).getTextContent());
            this.number = Integer.parseInt(element.getElementsByTagName(&quot;number&quot;).item(0).getTextContent());
        &#125;
        public float getTotal()&#123;
            return this.price * this.number;
        &#125;
        public int getNumber()&#123;
            return number;
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="node和element的关系"><a href="#node和element的关系" class="headerlink" title="node和element的关系"></a>node和element的关系</h3><p>element一定是node但是node不一定是element，node可能是元素节点、属性节点、文本节点，而element表示包含开始标签和结束标签的完整元素。<br>所以上面的代码中 用</p>
<pre><code>NodeList goodsNodeList = rootElement.getElementsByTagName(&quot;goods&quot;);
</code></pre>
<p>获取了NodeList，可以直接转型为Element： Element child = (Element) node;<br>如果获取的是node节点</p>
<pre><code>NodeList goodsNodeList = rootElement.getChildNodes();
</code></pre>
<p>则必须在循环中增加判断if (node.getNodeType() == Node.ELEMENT_NODE) {} 判断当前节点是否为Element元素。</p>
<h2 id="生成xml文件"><a href="#生成xml文件" class="headerlink" title="生成xml文件"></a>生成xml文件</h2><p>将统计后的订单信息以xml格式输出，生成文件格式如下</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;order&gt;
    &lt;total&gt;15.6&lt;/total&gt;
    &lt;sums&gt;7&lt;/sums&gt;
&lt;/order&gt;
</code></pre>
<p>生成xml的操作和读取的顺序类似，先创建rootElement，然后添加childElement，再将rootElement放到document中，最后通过io输出xml文件到指定路径。<br>代码如下：</p>
<pre><code>import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.List;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.OutputKeys;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerConfigurationException;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

public class XmlParser &#123;
    
    DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
    TransformerFactory transformerFactory = TransformerFactory.newInstance();
    
    public Document parseDoc(String filePath) &#123;
        Document document = null;
        try &#123;
            DocumentBuilder builder = documentBuilderFactory.newDocumentBuilder();
            document = builder.parse(new File(filePath));
        &#125; catch (ParserConfigurationException e) &#123;
            e.printStackTrace();
        &#125; catch (SAXException e) &#123;
            e.printStackTrace();
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
        &#125;
        return document;
    &#125;
    
    public void generateXml(String filePath, Document document)&#123;
        DOMSource source = new DOMSource(document);
        Transformer transformer = createtransformer();
        PrintWriter pw = null;
        try &#123;
            pw = new PrintWriter(new FileOutputStream(filePath));
            StreamResult result = new StreamResult(pw);
            transformer.transform(source, result);
        &#125; catch (FileNotFoundException e) &#123;
            e.printStackTrace();
        &#125; catch (TransformerConfigurationException e1) &#123;
            e1.printStackTrace();
        &#125; catch (TransformerException e) &#123;
            e.printStackTrace();
        &#125; finally &#123;
            pw.close();
        &#125;
    &#125;
    
    public Document createDoc() &#123;
        Document document = null;
        try &#123;
            DocumentBuilder builder = documentBuilderFactory.newDocumentBuilder();
            document = builder.newDocument();
            document.setXmlStandalone(true);
        &#125; catch (ParserConfigurationException e) &#123;
            e.printStackTrace();
        &#125;
        return document;
    &#125;
    
    public Transformer createtransformer()&#123;
        Transformer transformer = null;
        try &#123;
            transformer = transformerFactory.newTransformer();
            //default former
//            transformer.setOutputProperty(OutputKeys.STANDALONE, &quot;yes&quot;);
            transformer.setOutputProperty(OutputKeys.ENCODING, &quot;utf-8&quot;);
            transformer.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);
        &#125; catch (TransformerConfigurationException e) &#123;
            e.printStackTrace();
        &#125;
        return transformer;
    &#125;
    
    public static void main(String[] args) &#123;
        XmlParser parser = new XmlParser();
        Document document = parser.parseDoc(&quot;D://shopping.xml&quot;);
        Element rootElement = document.getDocumentElement();
        List&lt;Goods&gt; goodsList = new ArrayList&lt;Goods&gt;();
        NodeList goodsNodeList = rootElement.getElementsByTagName(&quot;goods&quot;);
        for (int i = 0; i &lt; goodsNodeList.getLength(); i++) &#123;
            Element child = (Element) goodsNodeList.item(i);
            Goods goods = new Goods(child);
            goodsList.add(goods);
        &#125;
        float total = 0;
        int sum = 0;
        for (Goods goods : goodsList) &#123;
            total += goods.getTotal();
            sum += goods.getNumber();
        &#125;
        Document orderDocument = parser.createDoc();
        Order order = new Order(total, sum);
        Element orderElement = order.getElement(orderDocument);
        orderDocument.appendChild(orderElement);
        
        parser.generateXml(&quot;D://order.xml&quot;, orderDocument);

    &#125;
    
    static class Order &#123;
        private float total = 0;
        private int   sum   = 0;
        
        public Order(float total, int sum) &#123;
            this.total = total;
            this.sum = sum;
        &#125;
        
        public Element getElement(Document document) &#123;
            Element rootElement = document.createElement(&quot;order&quot;);
            
            Element totalElement = document.createElement(&quot;total&quot;);
            totalElement.setTextContent(String.valueOf(this.total));
            rootElement.appendChild(totalElement);
            
            Element sumElement = document.createElement(&quot;sum&quot;);
            sumElement.setTextContent(String.valueOf(this.sum));
            rootElement.appendChild(sumElement);
            
            return rootElement;
        &#125;
        
    &#125;
    
    static class Goods &#123;
        private float price;
        private int   number;
        
        public Goods(Element element) &#123;
            this.price = Float.parseFloat(element.getElementsByTagName(&quot;price&quot;).item(0).getTextContent());
            this.number = Integer.parseInt(element.getElementsByTagName(&quot;number&quot;).item(0).getTextContent());
        &#125;
        
        public float getTotal() &#123;
            return this.price * this.number;
        &#125;
        
        public int getNumber() &#123;
            return number;
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="standalone"><a href="#standalone" class="headerlink" title="standalone"></a>standalone</h3><p>这里有一个小坑 就是生成的xml中有一个属性为standalone=”no”<br>standalone表示是否为独立文件，也就是说是否依赖于其他外部文件，如果为yes，则表示为不依赖其他外部文件的独立文件，默认为yes。<br>但是生成之后的standalone=”no”，不符合预期，并且</p>
<pre><code>transformer.setOutputProperty(OutputKeys.STANDALONE, &quot;yes&quot;);
</code></pre>
<p>设置格式之后standalone=”no”仍然为no。这时需要设置document中的setXmlStandalone属性，</p>
<pre><code>document.setXmlStandalone(true);
</code></pre>
<p>再次输出，可以去掉standalone属性。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>理解xml的结构之后，和dom的树形结构后，无论是使用原生支持还是通过第三方类库去操作xml文件，都可以很容易的上手。<br>and <strong>我喜欢用json</strong></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>xml</tag>
        <tag>dom</tag>
      </tags>
  </entry>
  <entry>
    <title>Java8 Lambda 场景示例</title>
    <url>/2018/12/24/java8-lambda/</url>
    <content><![CDATA[<p>收集整理了一些实际业务场景下, 对Java8函数的使用.</p>
<p><strong>预警:</strong> 代码较多, 比较无趣</p>
<h2 id="阅读前提"><a href="#阅读前提" class="headerlink" title="阅读前提"></a>阅读前提</h2><ol>
<li>了解java8的一些新特性, 如: Optional、 Stream</li>
<li>对函数式编程感兴趣</li>
</ol>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>一切的一切，源于不喜欢在代码中写太多的 <code>ifelse</code>.</p>
<h2 id="scene-amp-solution"><a href="#scene-amp-solution" class="headerlink" title="scene &amp; solution"></a>scene &amp; solution</h2><h3 id="1-Optional"><a href="#1-Optional" class="headerlink" title="1. Optional"></a>1. Optional</h3><p><code>Optional</code>应该可以算作对<code>null</code>的一种优雅封装, 比如如下场景 我有一个枚举, 并且提供了一个<code>parse</code>方法, 可以根据key返回对应的枚举值.</p>
<h4 id="1-1-enum-parse"><a href="#1-1-enum-parse" class="headerlink" title="1.1 enum parse"></a>1.1 enum parse</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">BooleanEnum</span> </span>&#123;    </span><br><span class="line">    <span class="comment">// 封装boolean    </span></span><br><span class="line">    TRUE(<span class="number">1</span>, <span class="string">&quot;是&quot;</span>),     </span><br><span class="line">    FALSE(<span class="number">0</span>, <span class="string">&quot;否&quot;</span>);    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer key;    </span><br><span class="line">    <span class="keyword">private</span> String label;  </span><br><span class="line">      </span><br><span class="line">    BooleanEnum(Integer key, String label) &#123;        </span><br><span class="line">        <span class="keyword">this</span>.key = key;        </span><br><span class="line">        <span class="keyword">this</span>.label = label;    </span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="function">BooleanEnum <span class="title">parse</span><span class="params">(Integer key)</span> </span>&#123;        </span><br><span class="line">        ...        </span><br><span class="line">        <span class="keyword">return</span> ...    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但事实可能没那么美好, 如果这个parse方法传入了一个非法的key, 比如”-999”, 那么应该如何处理？</p>
<ol>
<li>返回null</li>
<li>返回default</li>
<li>抛出IllegalException</li>
</ol>
<p>可能性多了, 在调用不同方法时, 就需要考虑这个方法会选择哪种方案.<br>比如通过方法是否声明了<code>IllegalException</code>异常进行判断、对每个结果进行<code>null!=result</code>判断.<br>这时, 方法的提供者就应该考虑, 返回一个<code>Optional</code>对象, 方便调用方进行下一步的判断处理.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Optional&lt;BooleanEnum&gt; <span class="title">parse</span><span class="params">(Integer key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(values()).filter(i -&gt; i.getKey().equals(key)).findAny();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-nested-isPresent"><a href="#1-2-nested-isPresent" class="headerlink" title="1.2 nested isPresent()"></a>1.2 nested isPresent()</h4><p>基于上述思考, 我们会将方法的返回值通过<code>Optional</code>进行封装, 可能就出现了如下代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;User&gt; <span class="title">login_check_by_if</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    Optional&lt;UserPO&gt; optionalUserPO = findByUsername(username);</span><br><span class="line">    <span class="keyword">if</span> (optionalUserPO.isPresent()) &#123;</span><br><span class="line">        UserPO po = optionalUserPO.get();</span><br><span class="line">        <span class="keyword">if</span> (password.equals(po.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.of(convert(po));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.empty();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这说明使用者知道了<code>Optional</code>可以方便进行非空判断, 但是远不止于此. <code>Optional</code>已经为我们开启了一个流, 所以基于<strong>惰性求值</strong>的原则, 我们可以将上述代码简化.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;User&gt; <span class="title">login_check_by_map</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> findByUsername(username)</span><br><span class="line">            .filter(po -&gt; Objects.equals(po.getPassword(), password))</span><br><span class="line">            .map(<span class="keyword">this</span>::convert);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-get-get-get"><a href="#1-3-get-get-get" class="headerlink" title="1.3 .get().get().get()"></a>1.3 .get().get().get()</h4><p>我们在使用ServerWebExchange获取session值的时候, 为了保证健壮性, 需要针对每一级进行非空判断, 如</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getTreasureIf</span><span class="params">(Exchange exchange)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != exchange) &#123;</span><br><span class="line">        Session session = exchange.getSession();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != session) &#123;</span><br><span class="line">            Request request = session.getRequest();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != request) &#123;</span><br><span class="line">                <span class="keyword">return</span> request.getTreasure();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于上述原则, 同样可以通过<code>Optional</code>进行简化</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;String&gt; <span class="title">getTreasureOptionalMap</span><span class="params">(Exchange exchange)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Optional.ofNullable(exchange)</span><br><span class="line">            .map(Exchange::getSession)</span><br><span class="line">            .map(Session::getRequest)</span><br><span class="line">            .map(Request::getTreasure);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>去掉了<code>ifelse</code>之后, 世界是不是清爽了很多?</p>
<h3 id="2-Distinct-field"><a href="#2-Distinct-field" class="headerlink" title="2. Distinct field"></a>2. Distinct field</h3><p>在<strong>mysql</strong>中, 针对<strong>field</strong>去重, 我们可以直接使用<code>distinct</code>. 那么在<strong>java</strong>中如何对一个<strong>list</strong>进行去重呢? 可能是这样</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">removeDuplication</span><span class="params">(List&lt;T&gt; list, String... keys)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (list == <span class="keyword">null</span> || list.isEmpty()) &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;List is empty.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keys == <span class="keyword">null</span> || keys.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;Missing parameters.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(key)) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Key is empty.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;T&gt; newList = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">    Set&lt;String&gt; keySet = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (T t : list) &#123;</span><br><span class="line">        StringBuffer logicKey = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (String keyField : keys) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                logicKey.append(BeanUtils.getProperty(t, keyField));</span><br><span class="line">                logicKey.append(SEPARATOR);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> list;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!keySet.contains(logicKey.toString())) &#123;</span><br><span class="line">            keySet.add(logicKey.toString());</span><br><span class="line">            newList.add(t);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.err.println(logicKey + <span class="string">&quot; has duplicated.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实我们只是借助了<code>Set</code>值不可重复的特性, 为了工具类的通用性, 我们根据 key 和<strong>反射</strong>进行匹配. </p>
<p>听起来和看起来都很复杂, 我们尝试进行优化, java8已经允许我们使用<strong>函数作为入参</strong>, 所以我们可以把获取field的方法传入</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_2_because_distinct_by_age</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userList = userList.stream()</span><br><span class="line">                .filter(distinctByKey(User::getName))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    userList.forEach(System.out::println);</span><br><span class="line">    assertEquals(<span class="number">2</span>, userList.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T, R&gt; <span class="function">Predicate&lt;T&gt; <span class="title">distinctByKey</span><span class="params">(Function&lt;T, R&gt; keyExtractor)</span> </span>&#123;</span><br><span class="line">    Set&lt;R&gt; seen = ConcurrentHashMap.newKeySet();</span><br><span class="line">    <span class="keyword">return</span> t -&gt; seen.add(keyExtractor.apply(t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们传入一个<code>Function</code>, 返回一个<code>Predicate</code>. 而<code>Predicate</code>正好是<code>Stream#filter</code>的入参.</p>
<h3 id="3-Predicate-union-predicate"><a href="#3-Predicate-union-predicate" class="headerlink" title="3. Predicate union predicate"></a>3. Predicate union predicate</h3><p>如果需要一个工具类,用来判断url是否符合设定的pattern.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AntPathMatcher ANT_PATH_MATCHER = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">includedPathSelector</span><span class="params">(String antPattern, String urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(urls) || StringUtils.isEmpty(antPattern)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls.split(<span class="string">&quot;, &quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Objects.nonNull(url)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ANT_PATH_MATCHER.match(antPattern, url.trim())) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果<code>antPattern</code>也是一个数组集合, 那么就需要进行嵌套循环进行判断. 复杂到不想实现. 所以我们通过<code>reduce</code>&amp;<code>Predicate#or</code>进行判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AntPathMatcher ANT_PATH_MATCHER = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Predicate&lt;String&gt; <span class="title">includedPathSelector</span><span class="params">(String urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(urls)) &#123;</span><br><span class="line">        <span class="keyword">return</span> x -&gt; <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Pattern.compile(<span class="string">&quot;, &quot;</span>).splitAsStream(urls)</span><br><span class="line">            .filter(Objects::nonNull)</span><br><span class="line">            .map(String::trim)</span><br><span class="line">            .map(<span class="keyword">this</span>::ant)</span><br><span class="line">            .reduce(p -&gt; <span class="keyword">false</span>, Predicate::or);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Predicate&lt;String&gt; <span class="title">ant</span><span class="params">(<span class="keyword">final</span> String antPattern)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == antPattern) &#123;</span><br><span class="line">        <span class="keyword">return</span> input -&gt; <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> input -&gt; ANT_PATH_MATCHER.match(antPattern, input);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里希望说明的是返回<code>Predicate</code>对比直接返回<code>boolean</code>有一个好处是可以通过语义更明确的链接进行组合, 如<code>and</code>、<code>or</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_true_when_one_of_split_item_match_predicate_or</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Predicate&lt;String&gt; predicate1 = <span class="keyword">this</span>.includedPathSelector(<span class="string">&quot;/permission&quot;</span>);</span><br><span class="line">    Predicate&lt;String&gt; predicate2 = <span class="keyword">this</span>.includedPathSelector(<span class="string">&quot;/config&quot;</span>);</span><br><span class="line">    assertTrue(predicate1.or(predicate2).test(<span class="string">&quot;/config&quot;</span>));</span><br><span class="line">    assertTrue(predicate1.or(predicate2).test(<span class="string">&quot;/permission&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_false_when_one_of_split_item_match_predicate_and</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Predicate&lt;String&gt; predicate1 = <span class="keyword">this</span>.includedPathSelector(<span class="string">&quot;/permission&quot;</span>);</span><br><span class="line">    Predicate&lt;String&gt; predicate2 = <span class="keyword">this</span>.includedPathSelector(<span class="string">&quot;/config&quot;</span>);</span><br><span class="line">    assertFalse(predicate1.and(predicate2).test(<span class="string">&quot;/config&quot;</span>));</span><br><span class="line">    assertFalse(predicate1.and(predicate2).test(<span class="string">&quot;/permission&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-map-amp-group"><a href="#4-map-amp-group" class="headerlink" title="4. map &amp; group"></a>4. map &amp; group</h3><p><code>Stream</code>提供了丰富的分组、聚合功能. 比如业务中需要把<code>List&lt;Item&gt;</code>转换为一个<code>Map&lt;String,Item&gt;</code>, key为<strong>item</strong>的id,value为<strong>item</strong>本身, 或者<strong>item</strong>中的某个属性. 又或者基于某个属性字段进行分组, 得到一个<code>Map&lt;String,List&lt;Item&gt;&gt;</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map_item_arr_by_uid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, List&lt;Item&gt;&gt; uidMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Item item : list) &#123;</span><br><span class="line">        <span class="keyword">if</span> (uidMap.containsKey(item.getUid())) &#123;</span><br><span class="line">            uidMap.get(item.getUid()).add(item);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            itemList.add(item);</span><br><span class="line">            uidMap.put(item.getUid(), itemList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    uidMap.forEach((k, v) -&gt; System.out.println(String.format(<span class="string">&quot;key = %s : value = %s&quot;</span>, k, v)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接看如何利用Stream实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String uid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;Item&gt; list;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> id = <span class="number">0L</span>;</span><br><span class="line">    list = Arrays.asList(<span class="keyword">new</span> Item(++id, <span class="string">&quot;a&quot;</span>), </span><br><span class="line">            <span class="keyword">new</span> Item(++id, <span class="string">&quot;a&quot;</span>), </span><br><span class="line">            <span class="keyword">new</span> Item(++id, <span class="string">&quot;b&quot;</span>), </span><br><span class="line">            <span class="keyword">new</span> Item(++id, <span class="string">&quot;b&quot;</span>), </span><br><span class="line">            <span class="keyword">new</span> Item(++id, <span class="string">&quot;c&quot;</span>), </span><br><span class="line">            <span class="keyword">new</span> Item(++id, <span class="string">&quot;d&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    System.out.println(<span class="string">&quot;--------------------&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map_item_by_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;Long, Item&gt; idMap = list.stream().collect(Collectors.toMap(Item::getId, Function.identity()));</span><br><span class="line">    idMap.forEach((k, v) -&gt; System.out.println(String.format(<span class="string">&quot;key = %s : value = %s&quot;</span>, k, v)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map_item_arr_by_uid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, List&lt;Item&gt;&gt; uidMap = list.stream().collect(Collectors.groupingBy(Item::getUid, Collectors.toList()));</span><br><span class="line">    uidMap.forEach((k, v) -&gt; System.out.println(String.format(<span class="string">&quot;key = %s : value = %s&quot;</span>, k, v)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map_uid_arr_by_uid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, List&lt;Long&gt;&gt; uidMapString = list.stream().collect(Collectors.groupingBy(Item::getUid, Collectors.mapping(Item::getId, Collectors.toList())));</span><br><span class="line">    uidMapString.forEach((k, v) -&gt; System.out.println(String.format(<span class="string">&quot;key = %s : value = %s&quot;</span>, k, v)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map_item_count_by_uid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Long&gt; uidMapCount = list.stream().collect(Collectors.groupingBy(Item::getUid, Collectors.mapping(Function.identity(), Collectors.counting())));</span><br><span class="line">    uidMapCount.forEach((k, v) -&gt; System.out.println(String.format(<span class="string">&quot;key = %s : value = %s&quot;</span>, k, v)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-concurrent-amp-paged"><a href="#5-concurrent-amp-paged" class="headerlink" title="5. concurrent &amp; paged"></a>5. concurrent &amp; paged</h3><p>另一个业务中常见的操作是因为原数据比较大, 所以我们将数据拆分为多页, 并设计多个线程并发的进行相应的业务处理. 大致思路应该是</p>
<ol>
<li>设定每页period, 计算页数</li>
<li>设定CountDownLatch</li>
<li>创建线程池</li>
<li>遍历list并通过subList拆分</li>
<li>线程处理对应的subList</li>
</ol>
<p>java8允许将函数作为入参, 所以第5步的操作, 我们可以把处理逻辑作为入参传递. 但是上面4步, 如何操作呢?</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">interface</span> <span class="title">DivideHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">int</span> <span class="title">getPeriod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">divideBatchHandler</span><span class="params">(List&lt;T&gt; dataList, Consumer&lt;List&lt;T&gt;&gt; consumer)</span> </span>&#123;</span><br><span class="line">        Optional.ofNullable(dataList).ifPresent(list -&gt; </span><br><span class="line">            IntStream.range(<span class="number">0</span>, list.size())</span><br><span class="line">                .mapToObj(i -&gt; <span class="keyword">new</span> AbstractMap.SimpleImmutableEntry&lt;&gt;(i, list.get(i)))</span><br><span class="line">                .collect(Collectors.groupingBy(e -&gt; e.getKey() / getPeriod(), Collectors.mapping(Map.Entry::getValue, Collectors.toList())))</span><br><span class="line">                .values()</span><br><span class="line">                .parallelStream()</span><br><span class="line">                .forEach(consumer)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintDivideHandler</span> <span class="keyword">implements</span> <span class="title">DivideHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPeriod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">batchPrint</span><span class="params">(List&lt;String&gt; dataList)</span> </span>&#123;</span><br><span class="line">        divideBatchHandler(dataList, System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>parallelStream</code>会调用<strong>Fork/Join</strong>框架进行并行处理. 如果需要在程序中显性的指定线程数, 可以通过<code>newForkJoinPool(threadNum).submit(()-&gt;&#123;&#125;)</code>进行封装</p>
<h3 id="6-chain-return-notNull-amp-fail-fast"><a href="#6-chain-return-notNull-amp-fail-fast" class="headerlink" title="6. chain return notNull &amp; fail-fast"></a>6. chain return notNull &amp; fail-fast</h3><p>场景如下: 我们需要获取name值, 但是有多个方式可以获取, 也可能获取不到. 所以我们结合业务要求与获取效率进行排序, 并且针对结果进行判断, 非空则返回.</p>
<p>听起来又是一连串的if.</p>
<p>针对这种case如何通过Stream优化呢? 依然是通过<strong>惰性求值</strong>以及<strong>函数入参</strong>.</p>
<p>我们先预设一个Stream逻辑, 其中顺序排列多个获取name值的函数, 然后统一执行.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;String&gt; <span class="title">getOptionalName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Stream&lt;Supplier&lt;String&gt;&gt; nameStream = Stream.of(</span><br><span class="line">            <span class="keyword">this</span>::getName1,</span><br><span class="line">            <span class="keyword">this</span>::getName2,</span><br><span class="line">            <span class="keyword">this</span>::getName3,</span><br><span class="line">            <span class="keyword">this</span>::getName4</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nameStream.map(Supplier::get)</span><br><span class="line">            .filter(Objects::nonNull)</span><br><span class="line">            .findAny();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如何复杂度再提升, 需要获取多个值构造一个bean, 其中任意一个值为空, 那么就终止stream, 不去进行下一个值的获取操作.</p>
<p>此时可以利用flatMap进行连接</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;User&gt; <span class="title">fillBuild</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Stream&lt;String&gt; nameStreamWrapper = buildStream(Arrays.asList(<span class="keyword">this</span>::getName1, <span class="keyword">this</span>::getName2, <span class="keyword">this</span>::getName3, <span class="keyword">this</span>::getName4));</span><br><span class="line">    Stream&lt;Integer&gt; ageStreamWrapper = buildStream(Arrays.asList(<span class="keyword">this</span>::getAge1, <span class="keyword">this</span>::getAge2));</span><br><span class="line">    BuildUser buildUser = (name, age) -&gt; Stream.of(<span class="keyword">new</span> User(name, age));</span><br><span class="line">    <span class="keyword">return</span> ageStreamWrapper.flatMap(age -&gt; nameStreamWrapper.flatMap(name -&gt; buildUser.build(name, age))).findAny();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Stream&lt;T&gt; <span class="title">buildStream</span><span class="params">(List&lt;Supplier&lt;T&gt;&gt; suppliers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> suppliers.stream().map(Supplier::get).filter(Objects::nonNull);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">interface</span> <span class="title">BuildUser</span> </span>&#123;</span><br><span class="line">    <span class="function">Stream&lt;User&gt; <span class="title">build</span><span class="params">(String name, Integer age)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加上了<code>@Deprecated</code>标记是因为这么写看起来比较丑, 降低了语义和阅读性.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>函数式编程带来更强的语义, 但是绝不仅是语法糖.</li>
<li>尝试用函数式思维重构复杂逻辑, 会有意外收获</li>
</ol>
<p>所有代码及完整测试用例在 <a href="https://github.com/wangyuheng/java8-lambda-sample">https://github.com/wangyuheng/java8-lambda-sample</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>lambda</tag>
      </tags>
  </entry>
  <entry>
    <title>javascript开发日历</title>
    <url>/2015/12/18/javascript-calendar/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>需要实现一个日历功能，网上找了几个示例，都是根据各种库和插件，居然没有纯净的js完成的日历插件，不免有些诧异，正好有时间，准备通过js编写一个简单的日历demo基础，可自由根据使用的插件进行显示层的定制。</p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="https://img.yuheng.wang/mweb/javascript-calendar-01.png" alt="javascript-calendar-01"><br><img src="https://img.yuheng.wang/mweb/javascript-calendar-02.png" alt="javascript-calendar-02"></p>
<h1 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h1><h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><p>说一下日历的算法</p>
<ol>
<li>(本月第一天的星期数+本月的天数)/7 可以知道本月需要占据几行。</li>
<li>将日历看为二维数组，第一级遍历条件为本月行数，第二级为0~7（直观形象为一个日历table，自左向右，自上而下循环）。</li>
<li>n为0~7循环参数， 计算当前日历方格显示数值为当前日期： 行数*7 + n - 本月第一天 + 1。</li>
<li>二月的天数根据闰年会有不同，闰年的计算方式： 当前年份能被400整除，或者当前的年份能被4整除且不能被100整除。</li>
</ol>
<h2 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h2><p>日历功能实现必须通过js的Date对象提供的基础数值。介绍一下用到的方法功能</p>
<pre><code>new Date().getFullYear(); //当前年份 2015
new Date().getMonth(); //当前月份 0~11 
new Date().getDate(); //当前月中的某一天 1~31
new Date().getDay(); //一周中的某一天 0~6
new Date(year, month, day); //根据构造函数返回Date对象
</code></pre>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p><em>这里写出来编写代码思路分析的过程，可以跳过直接看下方的完整代码。</em><br>先抽象出二维数组模型，7列已经确定，需要先根据<strong>算法1</strong>算出本月的日历行数，但是二月的天数不一致，所以先要根据是否为闰年算出二月的天数。</p>
<pre><code>var calendar = &#123;
    isLeap: function(vYear) &#123;
        return vYear % 400 == 0 || (vYear % 4 == 0 &amp;&amp; vYear % 100 != 0);
    &#125;,
    getFebruaryDays: function(vYear) &#123;
        return this.isLeap(vYear) ? 29 : 28;
    &#125;
&#125;
</code></pre>
<p>本月第一天的星期数可以根据new Date(currentYear, currentMonth, 1).getDay()得出。<br>monthFirstDay为本月第一天的星期数，monthDays为12月的天数组成的数组。根据构造函数计算赋值，并返回this对象方便链式调用。</p>
<pre><code>var calendar = &#123;
    year: null,
    month: null,
    date: null,
    day: null,
    monthDays: null,
    monthFirstDay: null,
    ctor: function(vNow) &#123;
        var now = vNow || new Date(); //如果为指定date对象，则为当前日期对象
        this.year = now.getFullYear();
        this.month = now.getMonth();
        this.date = now.getDate();
        this.day = now.getDay();
        this.monthFirstDay = new Date(this.year, this.month, 1).getDay();
        this.monthDays = [
            31, this.getFebruaryDays(this.year), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31
        ];
        return this;
    &#125;,
    isLeap: function(vYear) &#123;
        return vYear % 400 == 0 || (vYear % 4 == 0 &amp;&amp; vYear % 100 != 0);
    &#125;,
    getFebruaryDays: function(vYear) &#123;
        return this.isLeap(vYear) ? 29 : 28;
    &#125;
&#125;
</code></pre>
<p>计算日历行数</p>
<pre><code>getMonthDay: function() &#123;
    return this.monthDays[this.month];
&#125;,
getCalTr: function() &#123;
    return (this.monthFirstDay + this.getMonthDay()) / 7;
&#125;,
</code></pre>
<p>循环二维数组得到日历, *console.log(n);*可结合使用的框架进行输出展示。</p>
<pre><code>cal: function() &#123;
    var that = this;
    for (var i = 0; i &lt; this.getCalTr(); i++) &#123;
        for (var j = 0; j &lt; 7; j++) &#123;
            var n = (i * 7 + j) - that.monthFirstDay + 1;
            
            if (n &gt; 0 &amp;&amp; n &lt;= that.getMonthDay()) &#123;
                console.log(n);
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<h2 id="完整代码，在控制台查看输出的日历"><a href="#完整代码，在控制台查看输出的日历" class="headerlink" title="完整代码，在控制台查看输出的日历"></a>完整代码，在控制台查看输出的日历</h2><pre><code>var calendar = &#123;
    year: null,
    month: null,
    date: null,
    day: null,
    monthDays: null,
    monthFirstDay: null,
    days: [
        &quot;星期一&quot;,
        &quot;星期二&quot;,
        &quot;星期三&quot;,
        &quot;星期四&quot;,
        &quot;星期五&quot;,
        &quot;星期六&quot;,
        &quot;星期日&quot;
    ],

    ctor: function(vNow) &#123;
        var now = vNow || new Date(); //如果为指定date对象，则为当前日期对象
        this.year = now.getFullYear();
        this.month = now.getMonth();
        this.date = now.getDate();
        this.day = now.getDay();
        this.monthFirstDay = new Date(this.year, this.month, 1).getDay();
        this.monthDays = [
            31, this.getFebruaryDays(this.year), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31
        ];
        return this;
    &#125;,
    isLeap: function(vYear) &#123;
        return vYear % 400 == 0 || (vYear % 4 == 0 &amp;&amp; vYear % 100 != 0);
    &#125;,
    getFebruaryDays: function(vYear) &#123;
        return this.isLeap(vYear) ? 29 : 28;
    &#125;,
    format: function() &#123;
        return (this.month + 1) + &quot;/&quot; + this.date + &quot;/&quot; + this.year + &quot;  &quot; + this.dayMap[this.day];
    &#125;,
    getDay: function() &#123;
        return this.days[this.day - 1]
    &#125;,
    getMonthDay: function() &#123;
        return this.monthDays[this.month];
    &#125;,
    getCalTr: function() &#123;
        return (this.monthFirstDay + this.getMonthDay()) / 7;
    &#125;,
    cal: function() &#123;
        var that = this;
        console.log(&quot;%c   日   一   二   三   四   五   六   &quot;,&#39;background: #222; color: #bada55&#39;);
        console.log(&quot;-----------------------------------&quot;);
        for (var i = 0; i &lt; this.getCalTr(); i++) &#123;
            var temp = &quot;&quot;;
            for (var j = 0; j &lt; 7; j++) &#123;
                var tempData = (i * 7 + j) - that.monthFirstDay + 1
                if (tempData &lt; 1) &#123;
                    temp = temp + &quot;prev &quot;;
                &#125; else if (tempData &gt; that.getMonthDay()) &#123;
                    temp = temp + &quot; next&quot;;
                &#125; else &#123;
                    if (tempData &gt; 9) &#123;
                        temp = temp + &quot;  &quot; + tempData + &quot; &quot;;
                    &#125; else &#123;
                        temp = temp + &quot;   &quot; + tempData + &quot; &quot;;
                    &#125;
                &#125;
            &#125;
            console.log(temp);
            console.log(&quot;-----------------------------------&quot;);
        &#125;
    &#125;
&#125;
calendar.ctor().cal();
calendar.ctor(new Date(2015, 10)).cal();
</code></pre>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h2><p>本例中的ctor并非构造函数，而是针对一个对象进行变更，重新执行ctor后会替换calendar的属性值。<br>未对之前和之后的日期进行获取，如需相关功能，可在ctor中设置prevMonth 和 nextMonth的值，需要注意跨年度问题，时间和需求问题，暂未实现。</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>是否采用构造函数的方式生成多个对象？ （如果是工具类的话，不需要构造函数）<br>方法中采用this.param 还是获取外部参数 如何界定？</p>
<h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p>用面向对象的方式编写js，思路清晰，语感更好。</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>calendar</tag>
      </tags>
  </entry>
  <entry>
    <title>javascript检查属性是否存在(hasOwnProperty和propertyIsEnumerable的区别)</title>
    <url>/2015/12/23/javascript-hasownproperty-propertyisenumerable/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>javascript对象就是各种属性的集合，业务场景为接收用户传来的options参数，如果默认defaultOptions存在传入的参数属性，则进行替换。所以存在一个检查对象是否包含某个属性的操作。<br>在原型属性中找到了hasOwnProperty和propertyIsEnumerable两个方法。那么这两个方法有什么区别呢？各自的使用场景又是什么呢？</p>
<h1 id="hasOwnProperty-NaN"><a href="#hasOwnProperty-NaN" class="headerlink" title="hasOwnProperty"></a>hasOwnProperty</h1><p>hasOwnProperty()方法可以接收一个字符参数，用来判断对象中是否存在以字符参数命名的属性。它只会查找自身属性，不会根据原型链进行查找。<br><strong>注：原型链会再另一篇文章中做详细的介绍！</strong></p>
<pre><code>var obj = &#123;x:&quot;1&quot;&#125;;
obj.y = function()&#123;&#125;;
console.log(obj.hasOwnProperty(&quot;x&quot;)); //true
console.log(obj.hasOwnProperty(&quot;y&quot;)); //true 方法也是属性
console.log(obj.hasOwnProperty(&quot;z&quot;)); //false 属性不存在
console.log(obj.hasOwnProperty(&quot;toString&quot;)); //false hasOwnProperty是继承Object的属性，自身属性中不存在
</code></pre>
<h1 id="propertyIsEnumerable-NaN"><a href="#propertyIsEnumerable-NaN" class="headerlink" title="propertyIsEnumerable"></a>propertyIsEnumerable</h1><p>propertyIsEnumerable()方法在hasOwnProperty()的基础上，校验属性是否为枚举属性。也就是说属性必须满足为自身属性且为枚举属性时，才会返回true。</p>
<h2 id="枚举属性"><a href="#枚举属性" class="headerlink" title="枚举属性"></a>枚举属性</h2><p>枚举属性，其实是可被枚举，表示该属性可以在对象中被遍历。javascript属性默认均为枚举属性。如</p>
<pre><code>var obj = &#123;x:&quot;1&quot;&#125;;
Object.defineProperty(obj, &#39;y&#39;, &#123;value : &#39;2&#39;, enumerable : true &#125;);
Object.defineProperty(obj, &#39;z&#39;, &#123;value : &#39;3&#39;, enumerable : false &#125;);
console.log(obj);//Object &#123;x: &quot;1&quot;, y: &quot;2&quot;, z: &quot;3&quot;&#125;
for (var i in obj) &#123;
    console.log(i); //x,y
&#125;
</code></pre>
<p>上述代码中属性z被手动指定为非枚举属性，因此没有被遍历。<br>结合上面的2例子，可以清晰的知道propertyIsEnumerable()函数的作用：</p>
<pre><code>var obj = &#123;x:&quot;1&quot;&#125;;
obj.y = function()&#123;&#125;;
Object.defineProperty(obj, &#39;z&#39;, &#123;value : &#39;2&#39;, enumerable : true &#125;);
Object.defineProperty(obj, &#39;w&#39;, &#123;value : &#39;3&#39;, enumerable : false &#125;);
console.log(obj.propertyIsEnumerable(&quot;x&quot;)); //true 属性默认为枚举属性
console.log(obj.propertyIsEnumerable(&quot;y&quot;)); //true 方法也是属性
console.log(obj.propertyIsEnumerable(&quot;z&quot;)); //true
console.log(obj.propertyIsEnumerable(&quot;w&quot;)); //false 属性不是枚举属性
console.log(obj.propertyIsEnumerable(&quot;v&quot;)); //false 属性不存在
console.log(obj.propertyIsEnumerable(&quot;toString&quot;)); //false propertyIsEnumerable是继承Object的属性，自身属性中不存在
</code></pre>
<h1 id="扩展一-undefined"><a href="#扩展一-undefined" class="headerlink" title="扩展一 !== undefined"></a>扩展一 !== undefined</h1><p>有一种简单的方法可以判断属性是否存在，通过属性!== undefined来判断。此时会检测自身和继承来的属性。之所以使用!==而不是!=是因为!==可以区分undefined和null。但是此方法有一个弊端，当属性存在且值为undefined时，无法做出准确判断。如：</p>
<pre><code>var obj = &#123;x:&quot;1&quot;, y:undefined, z:null&#125;;
console.log(obj.x !== undefined); //true 属性存在
console.log(obj.y !== undefined); //false 此时会出现歧义，不能准确判断属性是不存在还是属性值为undefined
console.log(obj.z !== undefined); //true 属性存在
console.log(obj.z != undefined); //false != 不能区分undefined和null，将两者同等对待
console.log(obj.w !== undefined); //false 属性不存在
console.log(obj.toString !== undefined); //true 存在toString函数属性。
</code></pre>
<h1 id="扩展二-in"><a href="#扩展二-in" class="headerlink" title="扩展二 in"></a>扩展二 in</h1><p>为了避免!==undefined带来的歧义，可以使用in运算符进行属性存在的检测。in是根据属性，而不是通过属性值来判断是否存在。</p>
<pre><code>var obj = &#123;x:&quot;1&quot;, y:undefined, z:null&#125;;
console.log(&quot;x&quot; in obj); //true 属性存在
console.log(&quot;y&quot; in obj); //true 属性存在
console.log(&quot;z&quot; in obj); //true 属性存在
console.log(&quot;w&quot; in obj); //false 属性不存在
console.log(&quot;toString&quot; in obj); //true 属性存在
</code></pre>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>hasOwnProperty 自身存在的属性</li>
<li>propertyIsEnumerable 自身存在的属性，且为枚举属性</li>
<li>!== undefined 自身存在的属性，继承的属性，不能识别值为undefined的属性</li>
<li>in 自身存在的属性，继承的属性</li>
</ul>
<p>根据具体业务场景，自由选择或组合对应的方法，可以实现对属性的检测。</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Ant Design上手的一些坑</title>
    <url>/2016/08/30/js-antdesign-starter/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h2 id="前因"><a href="#前因" class="headerlink" title="前因"></a>前因</h2><p>一直在找样式模板，始终不太满意，看到了<a href="http://ant.design/">http://ant.design</a> 封装了一系列的react模块控件，样式和动画效果也不错，觉得这就是自己想要的，兴冲冲的上手。但在使用过程中遇到了一些小坑，本文意在让和我一样的小白用户能够顺利开始使用Ant Design</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h3><p>一些脚手架工具都是基于nodejs环境开发，所以需要现在本机安装nodejs环境。可在 <a href="https://nodejs.org/en/">nodejs官网</a> 下载对应系统的nodejs安装文件。现在nodejs有两个分支</p>
<ol>
<li>长期支持版LTS(推荐)</li>
<li>最新版</li>
</ol>
<p>本文基于最新的LTS版本v4.5.0 LTS</p>
<h3 id="升级npm"><a href="#升级npm" class="headerlink" title="升级npm"></a>升级npm</h3><p>npm是nodejs附带的一个包管理工具，需要使用npm安装antd，但是附带的npm版本可能过低，导致出现依赖问题。所以安装完nodejs之后，就将npm升级到最新版本</p>
<pre><code>npm -v
npm install -g npm
npm -v
</code></pre>
<h3 id="切换镜像仓库"><a href="#切换镜像仓库" class="headerlink" title="切换镜像仓库"></a>切换镜像仓库</h3><p>如果npm下载速度过慢，可以用淘宝封装的npm镜像仓库替换</p>
<pre><code>npm install -g cnpm --registry=https://registry.npm.taobao.org
</code></pre>
<p>安装完成后就可以使用cnpm命令替换npm</p>
<h2 id="安装antd"><a href="#安装antd" class="headerlink" title="安装antd"></a>安装antd</h2><p>安装的坑一般都在环境准备上，antd的安装及使用过程在官网有着详细介绍 <a href="http://ant.design/docs/react/getting-started">http://ant.design/docs/react/getting-started</a> </p>
<p>以下为简单的记录自己的安装过程。</p>
<h3 id="安装脚手架"><a href="#安装脚手架" class="headerlink" title="安装脚手架"></a>安装脚手架</h3><pre><code>npm install antd-init -g
</code></pre>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><pre><code>mkdir antd-demo &amp;&amp; cd antd-demo
antd-init --type plain-react
</code></pre>
<p>执行antd-init时，需要下载依赖，可能需要一段时间等待</p>
<h3 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h3><pre><code>npm start
</code></pre>
<p>启动后，可以通过 <a href="http://localhost:8989/">http://localhost:8989</a> 查看效果。在修改antd-demo中的文件后，不需要刷新，即可查看效果。</p>
<h2 id="感悟"><a href="#感悟" class="headerlink" title="感悟"></a>感悟</h2><p>很喜欢react的模块化思想，antd提供的样式组件及动画，给个人的开发工作提供了极大的便利。通过查看Ant Design中对组件的封装过程，也是一个学习和理解react的过程。</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>react</tag>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>JS实现HTML标签转义及反转义</title>
    <url>/2015/12/15/js-encode-html-tags/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>简单说一下业务场景，前台用户通过input输入内容，在离开焦点时，将内容在div中显示。<br>这时遇到一个问题，如果用户输入了html标签，则在div显示中，标签被解析。<br>由于是纯前端操作，不涉及后端，因此需要通过js对输入内容进行转义。</p>
<p>这里提供一个非常简单有效的转义方案，利用了<strong>innerHTML</strong>和<strong>innerText</strong><br><em>注：火狐不支持innerText，需要使用</em> <strong>textContent</strong> <em>属性，而IE早期版本不支持此属性，为了同时兼容IE及火狐，需要进行判断操作.</em></p>
<p>因为<strong>innerText（textContent）</strong>会获取纯文本内容，忽略html节点标签，而<strong>innerHTML</strong>会显示标签内容，<br>所以我们先将需转义的内容赋值给<strong>innerText（textContent）</strong>，再获取它的<strong>innerHTML</strong>属性，这时获取到的就是转义后文本内容。<br>代码如下：</p>
<pre><code>function HTMLEncode(html) &#123;
    var temp = document.createElement(&quot;div&quot;);
    (temp.textContent != null) ? (temp.textContent = html) : (temp.innerText = html);
    var output = temp.innerHTML;
    temp = null;
    return output;
&#125;

var tagText = &quot;&lt;p&gt;&lt;b&gt;123&amp;456&lt;/b&gt;&lt;/p&gt;&quot;;
console.log(HTMLEncode(tagText));//&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;123&amp;amp;456&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt; 
</code></pre>
<p>通过测试结果，可以看到html标签及&amp;符都被转义后保存。<br>同理，反转义的方法为先将转义文本赋值给<strong>innerHTML</strong>，然后通过<strong>innerText（textContent）</strong>获取转义前的文本内容</p>
<pre><code>function HTMLDecode(text) &#123; 
    var temp = document.createElement(&quot;div&quot;); 
    temp.innerHTML = text; 
    var output = temp.innerText || temp.textContent; 
    temp = null; 
    return output; 
&#125; 
var tagText = &quot;&lt;p&gt;&lt;b&gt;123&amp;456&lt;/b&gt;&lt;/p&gt;&quot;;
var encodeText = HTMLEncode(tagText);
console.log(encodeText);//&amp;lt;p&amp;gt;&amp;lt;b&amp;gt;123&amp;amp;456&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;
console.log(HTMLDecode(encodeText)); //&lt;p&gt;&lt;b&gt;123&amp;456&lt;/b&gt;&lt;/p&gt; 
</code></pre>
<p><strong>Best regards</strong><br><strong>Wang Yuheng</strong></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>encode</tag>
      </tags>
  </entry>
  <entry>
    <title>上传图片本地预览</title>
    <url>/2016/09/29/js-image-view/</url>
    <content><![CDATA[<p>在上传图片的时候，希望在浏览器上能预览图片。 </p>
<p>之前的做法是ajax方式上传图片，返回服务器的图片访问地址，本地预览。</p>
<p>在想有没有办法，不上传直接预览。之前记得是因为安全性原因，不能预览。但是着找到了这么个示例，贴出来大家看看。兼容性没去校验。</p>
<span id="more"></span>

<p>效果演示：<a href="http://demo.dreamlu.net/image-upload-view.html">http://demo.dreamlu.net/image-upload-view.html</a></p>
<pre><code>&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;title&gt;如梦技术IT-图片上传预览&lt;/title&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;&gt;
  &lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no&quot;&gt;
  &lt;meta name=&quot;renderer&quot; content=&quot;webkit&quot;&gt;
  &lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-siteapp&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;input type=&quot;file&quot; id=&quot;user-pic&quot;&gt;
&lt;img id=&quot;viewImg&quot;&gt;
&lt;script src=&quot;http://libs.baidu.com/jquery/1.11.1/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
//图片预览，兼容各个浏览器
function previewImage(file) &#123;
   var porImg  = $(file),
       viewImg = $(&#39;#viewImg&#39;);
   var image = porImg.val();
   if (!/^\S*\.(?:png|jpe?g|bmp|gif)$/i.test(image)) &#123;
       layer.msg(&#39;请选择图片~&#39;, &#123;shift: 6&#125;);
       porImg.val(&quot;&quot;);
       return false;
   &#125;
   if (file[&quot;files&quot;] &amp;&amp; file[&quot;files&quot;][0]) &#123;
       var reader = new FileReader();
       reader.onload = function(evt)&#123;
           viewImg.attr(&#123;src : evt.target.result&#125;);
       &#125;
       reader.readAsDataURL(file.files[0]);
   &#125; else &#123;
       var ieImageDom = document.createElement(&quot;div&quot;);
       var proIeImageDom = document.createElement(&quot;div&quot;);
       $(ieImageDom).css(&#123;
           float: &#39;left&#39;,
           position: &#39;relative&#39;,
           overflow: &#39;hidden&#39;,
           width: &#39;100px&#39;,
           height: &#39;100px&#39;
       &#125;).attr(&#123;&quot;id&quot;:&quot;view&quot;&#125;);
       $(proIeImageDom).attr(&#123;&quot;id&quot;: porImg.attr(&quot;id&quot;)&#125;);
       porImg.parent().prepend(proIeImageDom);
       porImg.remove();
       file.select();
       path = document.selection.createRange().text;
       $(ieImageDom).css(&#123;&quot;filter&quot;: &quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=&#39;true&#39;,sizingMethod=&#39;scale&#39;,src=\&quot;&quot; + path + &quot;\&quot;)&quot;&#125;);
   &#125;
&#125;

    //图片上传预览
    $(&#39;#user-pic&#39;).change(function(e)&#123;
        previewImage(this);
    &#125;);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>image</tag>
      </tags>
  </entry>
  <entry>
    <title>junit 读取 resource 目录下照片文件</title>
    <url>/2017/10/28/junit-resource/</url>
    <content><![CDATA[<p>编写单元测试过程中，接口入参为照片文件byte[]，想到的方法是在test/resources目录下，放好测试照片。代码编写遇到两个问题</p>
<h3 id="1-读取resources目录下文件"><a href="#1-读取resources目录下文件" class="headerlink" title="1. 读取resources目录下文件"></a>1. 读取resources目录下文件</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ClassPathResource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;front.png&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-Resource转换为byte"><a href="#2-Resource转换为byte" class="headerlink" title="2. Resource转换为byte[]"></a>2. Resource转换为byte[]</h3><p>Resource有getFile()接口，InputStreamSource有getInputStream()接口，ClassPathResource作为子类，可以通过这两个接口方法，然后再进行转换。还有一个更简便的方法，通过Files工具读取path<br><strong>注：Files读取的path不是ClassPathResource#getPath()的返回值，而是ClassPathResource#getURL()#getPath()的值</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] bytes = Files.readAllBytes(Paths.get(resource.getURL().getPath()));</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>junit</category>
      </categories>
      <tags>
        <tag>junit</tag>
        <tag>resource</tag>
      </tags>
  </entry>
  <entry>
    <title>5分钟搭建一个k8s平台</title>
    <url>/2021/03/25/k8s-5m/</url>
    <content><![CDATA[<p>记录在    ubuntu-20.04.2-live-server系统上通过rancher安装k8s的过程。</p>
<span id="more"></span>

<h2 id="0-更换阿里云软件源"><a href="#0-更换阿里云软件源" class="headerlink" title="0. 更换阿里云软件源"></a>0. 更换阿里云软件源</h2><p>为了保障下载速度，将ubuntu软件源替换为阿里云软件源。如果网络通畅，可跳过。</p>
<h3 id="0-1-备份"><a href="#0-1-备份" class="headerlink" title="0.1. 备份"></a>0.1. 备份</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak </span><br></pre></td></tr></table></figure>

<h3 id="0-2-修改"><a href="#0-2-修改" class="headerlink" title="0.2. 修改"></a>0.2. 修改</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<p>将source.list文件内容替换成下面的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-security main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-updates main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-proposed main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-backports main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-security main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-updates main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-proposed main restricted universe multiverse</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<h3 id="0-3-更新"><a href="#0-3-更新" class="headerlink" title="0.3. 更新"></a>0.3. 更新</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<h2 id="1-安装Docker"><a href="#1-安装Docker" class="headerlink" title="1. 安装Docker"></a>1. 安装Docker</h2><p>通过命令行安装最新版本docker。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class="line">sudo sh get-docker.sh</span><br><span class="line">sudo usermod -aG docker your-user</span><br></pre></td></tr></table></figure>

<p>安装后将当前账户加入到docker组内，否则只有root权限可以执行docker命令。对root权限的限制，也是docker相比于podman的劣势之一。<br>完成添加之后需要退出账号重新登陆，让设置生效。</p>
<h2 id="2-安装rancher"><a href="#2-安装rancher" class="headerlink" title="2. 安装rancher"></a>2. 安装rancher</h2><p>通过命令行完成rancher安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --restart=unless-stopped -p 8080:80 -p 8443:443 rancher/rancher:v2.4.5</span><br></pre></td></tr></table></figure>

<h3 id="2-0-登陆"><a href="#2-0-登陆" class="headerlink" title="2.0. 登陆"></a>2.0. 登陆</h3><p>安装完成后通过浏览器访问 <a href="https://ip:8443/">https://ip:8443</a> 首次访问会要求设置管理员(用户名:admin)密码</p>
<p><img src="https://img.yuheng.wang/mweb/k_0.png" alt="k_0"></p>
<h3 id="2-1-添加集群"><a href="#2-1-添加集群" class="headerlink" title="2.1. 添加集群"></a>2.1. 添加集群</h3><p>单击添加集群按钮后，选择自定义</p>
<p><img src="https://img.yuheng.wang/mweb/k_1.png" alt="k_1"></p>
<p>只需指定集群名称，剩下全部选择默认配置<br><img src="https://img.yuheng.wang/mweb/k_2.png" alt="k_2"></p>
<p>需要指定集群角色。生产环境需要根据机器及集群状况，保障系统性能及稳定性(最小可用节点数量 n/2+1 通过raft算法保障)。测试环境可以给一个集群授予多种角色。拷贝生成的命令在已安装docker的机器上运行，向rancher完成注册操作。这里仍然在这台ubuntu机器上完成注册操作。</p>
<p><img src="https://img.yuheng.wang/mweb/k_3.png" alt="k_3"></p>
<p>等待agent完成注册操作。期间会通过轮询的方式进行进度检测，可以在rancher页面中看到注册进度。</p>
<p><img src="https://img.yuheng.wang/mweb/16166606259635.jpg" alt="-w1282"></p>
<p>在安装完成后，可以在页面中看到集群信息</p>
<p><img src="https://img.yuheng.wang/mweb/16166606636686.jpg" alt="-w1326"></p>
<p>理论上我们在一台机器中部署了4类节点</p>
<ol>
<li>rancher: 可视化管理集群</li>
<li>Control Plane: k8s主节点，管理、监控工作节点</li>
<li>etcd: 配置数据存储</li>
<li>worker: k8s工作节点，用于运行容器</li>
</ol>
<p>实际上运行的容器会更多，用于保障集群功能，比如ingress-controller</p>
<p><img src="https://img.yuheng.wang/mweb/16166607226715.jpg" alt="-w1427"></p>
<h3 id="2-2-安装kubectl"><a href="#2-2-安装kubectl" class="headerlink" title="2.2 安装kubectl"></a>2.2 安装kubectl</h3><p>需要根据系统选择不同的安装方式，示例仍然安装在同一台ubuntu系统内，如果跨机器，需要确认ip之间的访问通道</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">snap install kubectl --classic</span><br></pre></td></tr></table></figure>
<p>将Kubeconfig File文件(Yaml格式)复制到机器的<code>~/.kube/config</code>目录下(如果没有则新建)完成授权操作<br><img src="https://img.yuheng.wang/mweb/k_5.png" alt="k_5"></p>
<p>通过kubectl访问集群</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pods -n ingress-nginx</span><br></pre></td></tr></table></figure>

<p>看到下列信息表示配置已完成。</p>
<p><img src="https://img.yuheng.wang/mweb/k_4.png" alt="k_4"></p>
<p>至此，已完成k8s平台搭建以及命令行管理的配置。</p>
]]></content>
      <categories>
        <category>devops</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>浅入浅出kafka</title>
    <url>/2018/07/05/kafka/</url>
    <content><![CDATA[<p>wikipedia的解释</p>
<blockquote>
<p>弗兰兹·卡夫卡，生活于奥匈帝国统治下的捷克德语小说家，本职为保险业职员。主要作品有小说《审判》、《城堡》、《变形记》等。</p>
</blockquote>
<p>kafka官网的解释</p>
<blockquote>
<p>Kafka是由Apache软件基金会开发的一个开源<code>流处理</code>平台，由Scala和Java编写。Kafka是一种<code>高吞吐量</code>的<code>分布式</code> <code>发布订阅</code> <code>消息系统</code>，它可以处理消费者规模的网站中的所有动作流数据。 </p>
</blockquote>
<p>两个kafka有一个共同特点: 很会写</p>
<h3 id="消息系统"><a href="#消息系统" class="headerlink" title="消息系统"></a>消息系统</h3><p>实现低耦合、可靠投递、广播、流量控制、最终一致性等一系列功能，成为异步RPC的主要手段之一。</p>
<span id="more"></span>

<h4 id="什么是消息系统"><a href="#什么是消息系统" class="headerlink" title="什么是消息系统"></a>什么是消息系统</h4><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyMjFweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjMwMnB4O2hlaWdodDoyMjFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzMDIgMjIxIiB3aWR0aD0iMzAycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iNDQiIHgyPSI0NCIgeTE9IjM2LjI5NjkiIHkyPSIxODUuODI4MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIxMjUiIHgyPSIxMjUiIHkxPSIzNi4yOTY5IiB5Mj0iMTg1LjgyODEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMjU0LjUiIHgyPSIyNTQuNSIgeTE9IjM2LjI5NjkiIHkyPSIxODUuODI4MSIvPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzkiIHg9IjUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NSIgeD0iMTIiIHk9IjI0Ljk5NTEiPnByb2R1Y2VyPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzkiIHg9IjUiIHk9IjE4NC44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUiIHg9IjEyIiB5PSIyMDQuODIzMiI+cHJvZHVjZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2MyIgeD0iOTQiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OSIgeD0iMTAxIiB5PSIyNC45OTUxIj5icm9rZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2MyIgeD0iOTQiIHk9IjE4NC44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDkiIHg9IjEwMSIgeT0iMjA0LjgyMzIiPmJyb2tlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0IiB4PSIyMTIuNSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwIiB4PSIyMTkuNSIgeT0iMjQuOTk1MSI+Y29uc3VtZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4NCIgeD0iMjEyLjUiIHk9IjE4NC44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAiIHg9IjIxOS41IiB5PSIyMDQuODIzMiI+Y29uc3VtZXI8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMTMuNSw2My40Mjk3LDEyMy41LDY3LjQyOTcsMTEzLjUsNzEuNDI5NywxMTcuNSw2Ny40Mjk3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0NC41IiB4Mj0iMTE5LjUiIHkxPSI2Ny40Mjk3IiB5Mj0iNjcuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyIiB4PSI1MS41IiB5PSI2Mi4zNjM4Ij4mIzIxNDU3OyYjMzY4NjU7JiMyNTk2ODsmIzI1NDU0OzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI0Mi41LDkyLjU2MjUsMjUyLjUsOTYuNTYyNSwyNDIuNSwxMDAuNTYyNSwyNDYuNSw5Ni41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMjUuNSIgeDI9IjI0OC41IiB5MT0iOTYuNTYyNSIgeTI9Ijk2LjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NyIgeD0iMTMyLjUiIHk9IjkxLjQ5NjYiPnB1c2gmIzI1OTY4OyYjMjU0NTQ7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM2LjUsMTIxLjY5NTMsMTI2LjUsMTI1LjY5NTMsMTM2LjUsMTI5LjY5NTMsMTMyLjUsMTI1LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEzMC41IiB4Mj0iMjUzLjUiIHkxPSIxMjUuNjk1MyIgeTI9IjEyNS42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDgiIHg9IjE0Mi41IiB5PSIxMjAuNjI5NCI+YWNrJiMzMDgzMDsmIzM1NzQ4OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMjUuNSIgeDI9IjE2Ny41IiB5MT0iMTU0LjgyODEiIHkyPSIxNTQuODI4MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2Ny41IiB4Mj0iMTY3LjUiIHkxPSIxNTQuODI4MSIgeTI9IjE2Ny44MjgxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTI2LjUiIHgyPSIxNjcuNSIgeTE9IjE2Ny44MjgxIiB5Mj0iMTY3LjgyODEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNi41LDE2My44MjgxLDEyNi41LDE2Ny44MjgxLDEzNi41LDE3MS44MjgxLDEzMi41LDE2Ny44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTUiIHg9IjEzMi41IiB5PSIxNDkuNzYyMiI+JiMyMTAyNDsmIzM4NTAwOy8mIzIyNzkxOyYjMjAyMjE7bWVzc2FnZTwvdGV4dD48IS0tU1JDPVtBb1pBSm9iREpZcklxQkxKSTJoQXBxdWppZGhRRl81YkctRXBnSGtVelF4WldlWTFQOUZweXVmQlN1N28yV01ibkhiR1FQV1dhZFE1bkVKaXZtbE5sTFl0MTRhcEpFdmZudUFOQ3ZWZUZydElfY0p0dGpwS3VrQjR6NUcwXS0tPjwvZz48L3N2Zz4='>

<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyNTJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjMxMnB4O2hlaWdodDoyNTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzMTIgMjUyIiB3aWR0aD0iMzEycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjQ2LjI2NTYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIyMi41IiB4PSI4NCIgeT0iODIuNDI5NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSI0NCIgeDI9IjQ0IiB5MT0iMzYuMjk2OSIgeTI9IjIxNi45NjA5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjEyNSIgeDI9IjEyNSIgeTE9IjM2LjI5NjkiIHkyPSIyMTYuOTYwOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIyNTQuNSIgeDI9IjI1NC41IiB5MT0iMzYuMjk2OSIgeTI9IjIxNi45NjA5Ii8+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3OSIgeD0iNSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSIxMiIgeT0iMjQuOTk1MSI+cHJvZHVjZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3OSIgeD0iNSIgeT0iMjE1Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NSIgeD0iMTIiIHk9IjIzNS45NTYxIj5wcm9kdWNlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjYzIiB4PSI5NCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5IiB4PSIxMDEiIHk9IjI0Ljk5NTEiPmJyb2tlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjYzIiB4PSI5NCIgeT0iMjE1Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OSIgeD0iMTAxIiB5PSIyMzUuOTU2MSI+YnJva2VyPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODQiIHg9IjIxMi41IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAiIHg9IjIxOS41IiB5PSIyNC45OTUxIj5jb25zdW1lcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0IiB4PSIyMTIuNSIgeT0iMjE1Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MCIgeD0iMjE5LjUiIHk9IjIzNS45NTYxIj5jb25zdW1lcjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExMy41LDYzLjQyOTcsMTIzLjUsNjcuNDI5NywxMTMuNSw3MS40Mjk3LDExNy41LDY3LjQyOTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQ0LjUiIHgyPSIxMTkuNSIgeTE9IjY3LjQyOTciIHkyPSI2Ny40Mjk3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIiIHg9IjUxLjUiIHk9IjYyLjM2MzgiPiYjMjE0NTc7JiMzNjg2NTsmIzI1OTY4OyYjMjU0NTQ7PC90ZXh0PjxwYXRoIGQ9Ik04NCw4Mi40Mjk3IEwxNjIsODIuNDI5NyBMMTYyLDg5LjU2MjUgTDE1Miw5OS41NjI1IEw4NCw5OS41NjI1IEw4NCw4Mi40Mjk3ICIgZmlsbD0iI0VFRUVFRSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI0Ni4yNjU2IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIyMjIuNSIgeD0iODQiIHk9IjgyLjQyOTciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMiIHg9Ijk5IiB5PSI5NS40OTY2Ij5sb29wPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMiIgeD0iMTc3IiB5PSI5NC42NDAxIj5bJiMzNjcxODsmIzM1ODEwO108L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzYuNSwxMTYuNjk1MywxMjYuNSwxMjAuNjk1MywxMzYuNSwxMjQuNjk1MywxMzIuNSwxMjAuNjk1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTMwLjUiIHgyPSIyNTMuNSIgeTE9IjEyMC42OTUzIiB5Mj0iMTIwLjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OCIgeD0iMTQyLjUiIHk9IjExNS42Mjk0Ij5wdWxsJiMyNTk2ODsmIzI1NDU0OzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNi41LDE1Mi44MjgxLDEyNi41LDE1Ni44MjgxLDEzNi41LDE2MC44MjgxLDEzMi41LDE1Ni44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMzAuNSIgeDI9IjI1My41IiB5MT0iMTU2LjgyODEiIHkyPSIxNTYuODI4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4IiB4PSIxNDIuNSIgeT0iMTUxLjc2MjIiPmFjayYjMzA4MzA7JiMzNTc0ODs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTI1LjUiIHgyPSIxNjcuNSIgeTE9IjE4NS45NjA5IiB5Mj0iMTg1Ljk2MDkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjcuNSIgeDI9IjE2Ny41IiB5MT0iMTg1Ljk2MDkiIHkyPSIxOTguOTYwOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEyNi41IiB4Mj0iMTY3LjUiIHkxPSIxOTguOTYwOSIgeTI9IjE5OC45NjA5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzYuNSwxOTQuOTYwOSwxMjYuNSwxOTguOTYwOSwxMzYuNSwyMDIuOTYwOSwxMzIuNSwxOTguOTYwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE1IiB4PSIxMzIuNSIgeT0iMTgwLjg5NSI+JiMyMTAyNDsmIzM4NTAwOy8mIzIyNzkxOyYjMjAyMjE7bWVzc2FnZTwvdGV4dD48IS0tU1JDPVtBb1pBSm9iREpZcklxQkxKSTJoQXBxdWppZGhRRl81YkctRXBnSGtVelF4Wm9pZEZCcjF1aU5WVFlfTUJrMUkwMEE5Nm1LUE44SmFfaHhXcTV3WFVlUTBxOW1VZ0YzS2xYR2ljV01JYUdjOW96bEU1d3J3aU15ODVERzE5eGNkN1dmU3BiLVdfTlRCLVBGVlV0REpZdWlKcUwwMDBdLS0+PC9nPjwvc3ZnPg=='>

<p>一个最简单的消息系统：producer发送消息给broker(消息队列)，broker持有数据，在合适的时机发送给consumer，consumer确认后，broker删除消息数据。</p>
<h5 id="扩展概念"><a href="#扩展概念" class="headerlink" title="扩展概念"></a>扩展概念</h5><ol>
<li>消息队列模型 sender -&gt; queue -&gt; receiver</li>
<li>发布/订阅模型 publish -&gt; topic -&gt; subscribe</li>
<li>消息投递 push</li>
<li>消息拉取 pull</li>
</ol>
<h4 id="什么时候使用消息系统"><a href="#什么时候使用消息系统" class="headerlink" title="什么时候使用消息系统"></a>什么时候使用消息系统</h4><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxNjVweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjMwNXB4O2hlaWdodDoxNjVweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzMDUgMTY1IiB3aWR0aD0iMzA1cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tZW50aXR5IGMxLS0+PGcgaWQ9ImVsZW1fYzEiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTYsMTYsMjYsNiwxMzUsNiwxMzUsNDIuMjk2OSwxMjUsNTIuMjk2OSwxNiw1Mi4yOTY5LDE2LDE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjUiIHgyPSIxMzUiIHkxPSIxNiIgeTI9IjYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNiIgeDI9IjEyNSIgeTE9IjE2IiB5Mj0iMTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjUiIHgyPSIxMjUiIHkxPSIxNiIgeTI9IjUyLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OSIgeD0iMzEiIHk9IjM4Ljk5NTEiPiYjMjEwNjk7JiMzMTQ3MTsmIzI2MzgxOyYjMjExNTM7JiMyMjEyMDsxPC90ZXh0PjwvZz48IS0tZW50aXR5IGMyLS0+PGcgaWQ9ImVsZW1fYzIiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTcwLjUsMTYsMTgwLjUsNiwyODguNSw2LDI4OC41LDQyLjI5NjksMjc4LjUsNTIuMjk2OSwxNzAuNSw1Mi4yOTY5LDE3MC41LDE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNzguNSIgeDI9IjI4OC41IiB5MT0iMTYiIHkyPSI2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTcwLjUiIHgyPSIyNzguNSIgeTE9IjE2IiB5Mj0iMTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNzguNSIgeDI9IjI3OC41IiB5MT0iMTYiIHkyPSI1Mi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzgiIHg9IjE4NS41IiB5PSIzOC45OTUxIj4mIzIxMDY5OyYjMzE0NzE7JiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7MjwvdGV4dD48L2c+PCEtLWVudGl0eSBtMS0tPjxnIGlkPSJlbGVtX20xIj48ZWxsaXBzZSBjeD0iMTUyLjUiIGN5PSIxMjgiIGZpbGw9IiNGMUYxRjEiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0OC41LDExNiwxNTQuNSwxMTEsMTUyLjUsMTE2LDE1NC41LDEyMSwxNDguNSwxMTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3IiB4PSIxMDQiIHk9IjE1Ni45OTUxIj5tZXRyaWNzJiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7PC90ZXh0PjwvZz48IS0tbGluayBjMSB0byBtMS0tPjxnIGlkPSJsaW5rX2MxX20xIj48cGF0aCBkPSJNOTEuNjQxNyw1Mi4wMTEgQzEwNC41MTg3LDY5LjU3MSAxMTguOTUzNyw4OS4yNTU5IDEzMi4wMzE3LDEwNy4wODg2ICIgZmlsbD0ibm9uZSIgaWQ9ImMxLXRvLW0xIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNS41OCwxMTEuOTI2OSwxMzMuNDgzMSwxMDIuMzAzOSwxMzIuNjIzMSwxMDcuODk0OSwxMjcuMDMyLDEwNy4wMzQ5LDEzNS41OCwxMTEuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGMyIHRvIG0xLS0+PGcgaWQ9ImxpbmtfYzJfbTEiPjxwYXRoIGQ9Ik0yMTMuMzU4LDUyLjAxMSBDMjAwLjQ4MSw2OS41NzEgMTg2LjA0NjMsODkuMjU1OSAxNzIuOTY4MywxMDcuMDg4NiAiIGZpbGw9Im5vbmUiIGlkPSJjMi10by1tMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjkuNDIsMTExLjkyNjksMTc3Ljk2OCwxMDcuMDM0OSwxNzIuMzc2OSwxMDcuODk0OSwxNzEuNTE2OSwxMDIuMzAzOSwxNjkuNDIsMTExLjkyNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tU1JDPVtveWpGSUxMR1VqaFAtdHByLWNUcFVmenNCTm13U3VNWGFlOVppNEFvOExTVURiYVpZQW1ITHQ5LU5hYkhWZXcyS2N2Z0lMNWNTWjVTMUxYMWhZNU5pZzYyUmFmLVVQd2s3UFhkWENHMzAwMDBdLS0+PC9nPjwvc3ZnPg=='>

<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxNjVweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQ2MHB4O2hlaWdodDoxNjVweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0NjAgMTY1IiB3aWR0aD0iNDYwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tZW50aXR5IGMxLS0+PGcgaWQ9ImVsZW1fYzEiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMzI0LDE2LDMzNCw2LDQ0Myw2LDQ0Myw0Mi4yOTY5LDQzMyw1Mi4yOTY5LDMyNCw1Mi4yOTY5LDMyNCwxNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDMzIiB4Mj0iNDQzIiB5MT0iMTYiIHkyPSI2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzI0IiB4Mj0iNDMzIiB5MT0iMTYiIHkyPSIxNiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQzMyIgeDI9IjQzMyIgeTE9IjE2IiB5Mj0iNTIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc5IiB4PSIzMzkiIHk9IjM4Ljk5NTEiPiYjMjEwNjk7JiMzMTQ3MTsmIzI2MzgxOyYjMjExNTM7JiMyMjEyMDsxPC90ZXh0PjwvZz48IS0tZW50aXR5IGMyLS0+PGcgaWQ9ImVsZW1fYzIiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTcwLjUsMTYsMTgwLjUsNiwyODguNSw2LDI4OC41LDQyLjI5NjksMjc4LjUsNTIuMjk2OSwxNzAuNSw1Mi4yOTY5LDE3MC41LDE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNzguNSIgeDI9IjI4OC41IiB5MT0iMTYiIHkyPSI2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTcwLjUiIHgyPSIyNzguNSIgeTE9IjE2IiB5Mj0iMTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNzguNSIgeDI9IjI3OC41IiB5MT0iMTYiIHkyPSI1Mi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzgiIHg9IjE4NS41IiB5PSIzOC45OTUxIj4mIzIxMDY5OyYjMzE0NzE7JiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7MjwvdGV4dD48L2c+PCEtLWVudGl0eSBjMy0tPjxnIGlkPSJlbGVtX2MzIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjE2LDE2LDI2LDYsMTM1LDYsMTM1LDQyLjI5NjksMTI1LDUyLjI5NjksMTYsNTIuMjk2OSwxNiwxNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTI1IiB4Mj0iMTM1IiB5MT0iMTYiIHkyPSI2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTYiIHgyPSIxMjUiIHkxPSIxNiIgeTI9IjE2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTI1IiB4Mj0iMTI1IiB5MT0iMTYiIHkyPSI1Mi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzkiIHg9IjMxIiB5PSIzOC45OTUxIj4mIzIxNTE4OyYjMjE0ODg7JiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7MTwvdGV4dD48L2c+PCEtLWVudGl0eSBzMS0tPjxnIGlkPSJlbGVtX3MxIj48ZWxsaXBzZSBjeD0iMjM0LjUiIGN5PSIxMjgiIGZpbGw9IiNGMUYxRjEiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzMC41LDExNiwyMzYuNSwxMTEsMjM0LjUsMTE2LDIzNi41LDEyMSwyMzAuNSwxMTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3IiB4PSIxODYiIHk9IjE1Ni45OTUxIj5tZXRyaWNzJiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7PC90ZXh0PjwvZz48IS0tZW50aXR5IHMyLS0+PGcgaWQ9ImVsZW1fczIiPjxlbGxpcHNlIGN4PSIxMDEuNSIgY3k9IjEyOCIgZmlsbD0iI0YxRjFGMSIgcng9IjEyIiByeT0iMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTcuNSwxMTYsMTAzLjUsMTExLDEwMS41LDExNiwxMDMuNSwxMjEsOTcuNSwxMTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSI1Mi41IiB5PSIxNTYuOTk1MSI+JiMyNjA4NTsmIzI0NTM1OyYjMzU3NjA7JiMyNDQwNTsmIzI2MzgxOyYjMjExNTM7JiMyMjEyMDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgczMtLT48ZyBpZD0iZWxlbV9zMyI+PGVsbGlwc2UgY3g9IjM3Ny41IiBjeT0iMTI4IiBmaWxsPSIjRjFGMUYxIiByeD0iMTIiIHJ5PSIxMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNzMuNSwxMTYsMzc5LjUsMTExLDM3Ny41LDExNiwzNzkuNSwxMjEsMzczLjUsMTE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OCIgeD0iMzI4LjUiIHk9IjE1Ni45OTUxIj4mIzI5OTkyOyYjMjUxNDM7JiMzNDg5MjsmIzIwMDI2OyYjMjYzODE7JiMyMTE1MzsmIzIyMTIwOzwvdGV4dD48L2c+PCEtLWxpbmsgYzEgdG8gczEtLT48ZyBpZD0ibGlua19jMV9zMSI+PHBhdGggZD0iTTM1Mi4yNjUsNTIuMDExIEMzMjcuMzQ3LDY5LjU3MSAyOTcuNDUxNSw5MC42Mzc5IDI3Mi4xNDY1LDEwOC40NzA2ICIgZmlsbD0ibm9uZSIgaWQ9ImMxLXRvLXMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI2Ny4yNDIsMTExLjkyNjksMjc2LjkwMjksMTEwLjAxMjIsMjcxLjMyOTEsMTA5LjA0NjcsMjcyLjI5NDYsMTAzLjQ3MjgsMjY3LjI0MiwxMTEuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGMyIHRvIHMxLS0+PGcgaWQ9ImxpbmtfYzJfczEiPjxwYXRoIGQ9Ik0yMzAuNTQ4LDUyLjAxMSBDMjMxLjM4NCw2OS41NzEgMjMyLjI2NjcsODguMTAxIDIzMy4xMTU3LDEwNS45MzM3ICIgZmlsbD0ibm9uZSIgaWQ9ImMyLXRvLXMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzMy40MDEsMTExLjkyNjksMjM2Ljk2ODUsMTAyLjc0NjksMjMzLjE2MzIsMTA2LjkzMjYsMjI4Ljk3NzUsMTAzLjEyNzMsMjMzLjQwMSwxMTEuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGMxIHRvIHMyLS0+PGcgaWQ9ImxpbmtfYzFfczIiPjxwYXRoIGQ9Ik0zMjQuMzg0LDUyLjAxMSBDMjcyLjg2Myw3MS4xOTQ3IDIwNC42NDM5LDk2LjU5NTMgMTU2LjI5NDksMTE0LjU5NzYgIiBmaWxsPSJub25lIiBpZD0iYzEtdG8tczIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTUwLjY3MiwxMTYuNjkxMiwxNjAuNTAyMSwxMTcuMjk5MywxNTUuMzU3NywxMTQuOTQ2NSwxNTcuNzEwNiwxMDkuODAyMiwxNTAuNjcyLDExNi42OTEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgYzIgdG8gczItLT48ZyBpZD0ibGlua19jMl9zMiI+PHBhdGggZD0iTTIwMi42NjcsNTIuMDExIEMxODEuMjYxLDY5LjU3MSAxNTYuMDA0OSw5MC4yODg5IDEzNC4yNjU5LDEwOC4xMjE2ICIgZmlsbD0ibm9uZSIgaWQ9ImMyLXRvLXMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyOS42MjcsMTExLjkyNjksMTM5LjEyMjIsMTA5LjMxMTUsMTMzLjQ5MjgsMTA4Ljc1NTgsMTM0LjA0ODUsMTAzLjEyNjMsMTI5LjYyNywxMTEuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGMxIHRvIHMzLS0+PGcgaWQ9ImxpbmtfYzFfczMiPjxwYXRoIGQ9Ik0zODIuMjQyLDUyLjAxMSBDMzgxLjIzOSw2OS41NzEgMzgwLjE3OTMsODguMTA0IDM3OS4xNjAzLDEwNS45MzY3ICIgZmlsbD0ibm9uZSIgaWQ9ImMxLXRvLXMzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM3OC44MTgsMTExLjkyNjksMzgzLjMyNDksMTAzLjE2OTgsMzc5LjEwMzIsMTA2LjkzNSwzNzUuMzM4LDEwMi43MTM0LDM3OC44MTgsMTExLjkyNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBjMiB0byBzMy0tPjxnIGlkPSJsaW5rX2MyX3MzIj48cGF0aCBkPSJNMjYwLjUyNiw1Mi4wMTEgQzI4NS4yNzYsNjkuNTcxIDMxNC45NDg0LDkwLjYyMjUgMzQwLjA4NDQsMTA4LjQ1NTIgIiBmaWxsPSJub25lIiBpZD0iYzItdG8tczMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzQ0Ljk3OCwxMTEuOTI2OSwzMzkuOTUyMSwxMDMuNDU2OSwzNDAuOSwxMDkuMDMzOCwzMzUuMzIzMiwxMDkuOTgxNywzNDQuOTc4LDExMS45MjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgYzMgdG8gczEtLT48ZyBpZD0ibGlua19jM19zMSI+PHBhdGggZD0iTTEwOC44MzE2LDUyLjAxMSBDMTM1LjQyMiw2OS41NzEgMTY3LjU1MDIsOTAuNzg3OCAxOTQuNTU0MiwxMDguNjIwNSAiIGZpbGw9Im5vbmUiIGlkPSJjMy10by1zMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxOTkuNTYxLDExMS45MjY5LDE5NC4yNTUsMTAzLjYyOTUsMTk1LjM4ODcsMTA5LjE3MTYsMTg5Ljg0NjYsMTEwLjMwNTIsMTk5LjU2MSwxMTEuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGMzIHRvIHMyLS0+PGcgaWQ9ImxpbmtfYzNfczIiPjxwYXRoIGQ9Ik04MC45NTA1LDUyLjAxMSBDODUuMjk4NSw2OS41NzEgODkuOTI4OCw4OC4yNzAxIDk0LjM0NDUsMTA2LjEwMjggIiBmaWxsPSJub25lIiBpZD0iYzMtdG8tczIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTUuNzg2NywxMTEuOTI2OSw5Ny41MDYyLDEwMi4yMjkzLDk0LjU4NDksMTA3LjA3MzUsODkuNzQwNywxMDQuMTUyMiw5NS43ODY3LDExMS45MjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLVNSQz1bb3lqRklMTHVzamR4VkZOd1B0RHdkdE9qVjNmcFhRNjJPeDEyaVk1TjdYT3Y4eDJTNExIa0dqX0pfV3JlLWVvdmFsRnBJZWhvU25Ib0txa0FDZkVCdVY4V3dNOTNrRklwd0trVnhmXy1PanM2ZnRrZGVnZW5XZ2p2RmNONWl1eGpCblJzRkRjbjJyS0RxMWYzMVRzS19GOHlOSmttZ0tPZUYyR3Y4bkd2OG5Hdk9uR3Y4Q3lPbkhHYWRYNDBdLS0+PC9nPjwvc3ZnPg=='>

<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzNTVweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQ3MnB4O2hlaWdodDozNTVweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0NzIgMzU1IiB3aWR0aD0iNDcycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tZW50aXR5IGMxLS0+PGcgaWQ9ImVsZW1fYzEiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTYsMTYsMjYsNiwxMzksNiwxMzksNTguNTkzOCwxMjksNjguNTkzOCwxNiw2OC41OTM4LDE2LDE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjkiIHgyPSIxMzkiIHkxPSIxNiIgeTI9IjYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNiIgeDI9IjEyOSIgeTE9IjE2IiB5Mj0iMTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjkiIHgyPSIxMjkiIHkxPSIxNiIgeTI9IjY4LjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzIiB4PSIzMSIgeT0iMzguOTk1MSI+JiMxNzE7cHJvZHVjZXImIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzkiIHg9IjMzIiB5PSI1NS4yOTIiPiYjMjEwNjk7JiMzMTQ3MTsmIzI2MzgxOyYjMjExNTM7JiMyMjEyMDsxPC90ZXh0PjwvZz48IS0tZW50aXR5IGMyLS0+PGcgaWQ9ImVsZW1fYzIiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTc0LDE2LDE4NCw2LDI5Nyw2LDI5Nyw1OC41OTM4LDI4Nyw2OC41OTM4LDE3NCw2OC41OTM4LDE3NCwxNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjg3IiB4Mj0iMjk3IiB5MT0iMTYiIHkyPSI2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTc0IiB4Mj0iMjg3IiB5MT0iMTYiIHkyPSIxNiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI4NyIgeDI9IjI4NyIgeTE9IjE2IiB5Mj0iNjguNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMiIHg9IjE4OSIgeT0iMzguOTk1MSI+JiMxNzE7cHJvZHVjZXImIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzgiIHg9IjE5MS41IiB5PSI1NS4yOTIiPiYjMjEwNjk7JiMzMTQ3MTsmIzI2MzgxOyYjMjExNTM7JiMyMjEyMDsyPC90ZXh0PjwvZz48IS0tZW50aXR5IGMzLS0+PGcgaWQ9ImVsZW1fYzMiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMzMyLDE2LDM0Miw2LDQ1NSw2LDQ1NSw1OC41OTM4LDQ0NSw2OC41OTM4LDMzMiw2OC41OTM4LDMzMiwxNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDQ1IiB4Mj0iNDU1IiB5MT0iMTYiIHkyPSI2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzMyIiB4Mj0iNDQ1IiB5MT0iMTYiIHkyPSIxNiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQ0NSIgeDI9IjQ0NSIgeTE9IjE2IiB5Mj0iNjguNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMiIHg9IjM0NyIgeT0iMzguOTk1MSI+JiMxNzE7cHJvZHVjZXImIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzkiIHg9IjM0OSIgeT0iNTUuMjkyIj4mIzIxNTE4OyYjMjE0ODg7JiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7MTwvdGV4dD48L2c+PCEtLWVudGl0eSBrYWZrYS0tPjxnIGlkPSJlbGVtX2thZmthIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjE4NywxNTYsMTk3LDE0NiwyODQsMTQ2LDI4NCwxOTguNTkzOCwyNzQsMjA4LjU5MzgsMTg3LDIwOC41OTM4LDE4NywxNTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI3NCIgeDI9IjI4NCIgeTE9IjE1NiIgeTI9IjE0NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE4NyIgeDI9IjI3NCIgeTE9IjE1NiIgeTI9IjE1NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI3NCIgeDI9IjI3NCIgeTE9IjE1NiIgeTI9IjIwOC41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NyIgeD0iMjAyIiB5PSIxNzguOTk1MSI+JiMxNzE7a2Fma2EmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTYiIHg9IjIwMi41IiB5PSIxOTUuMjkyIj4mIzI4MDQwOyYjMjQ2ODc7JiMzMTk5NTsmIzMyNDc5OzwvdGV4dD48L2c+PCEtLWVudGl0eSBzMS0tPjxnIGlkPSJlbGVtX3MxIj48ZWxsaXBzZSBjeD0iMTAyLjUiIGN5PSIzMTguMjk2OSIgZmlsbD0iI0YxRjFGMSIgcng9IjEyIiByeT0iMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTguNSwzMDYuMjk2OSwxMDQuNSwzMDEuMjk2OSwxMDIuNSwzMDYuMjk2OSwxMDQuNSwzMTEuMjk2OSw5OC41LDMwNi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NyIgeD0iNTQiIHk9IjM0Ny4yOTIiPm1ldHJpY3MmIzI2MzgxOyYjMjExNTM7JiMyMjEyMDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OSIgeD0iNTgiIHk9IjI5OC45OTUxIj4mIzE3MTtjb25zdW1lciYjMTg3OzwvdGV4dD48L2c+PCEtLWVudGl0eSBzMi0tPjxnIGlkPSJlbGVtX3MyIj48ZWxsaXBzZSBjeD0iMjM1LjUiIGN5PSIzMTguMjk2OSIgZmlsbD0iI0YxRjFGMSIgcng9IjEyIiByeT0iMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjMxLjUsMzA2LjI5NjksMjM3LjUsMzAxLjI5NjksMjM1LjUsMzA2LjI5NjksMjM3LjUsMzExLjI5NjksMjMxLjUsMzA2LjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSIxODYuNSIgeT0iMzQ3LjI5MiI+JiMyNjA4NTsmIzI0NTM1OyYjMzU3NjA7JiMyNDQwNTsmIzI2MzgxOyYjMjExNTM7JiMyMjEyMDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OSIgeD0iMTkxIiB5PSIyOTguOTk1MSI+JiMxNzE7Y29uc3VtZXImIzE4Nzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgczMtLT48ZyBpZD0iZWxlbV9zMyI+PGVsbGlwc2UgY3g9IjM2OC41IiBjeT0iMzE4LjI5NjkiIGZpbGw9IiNGMUYxRjEiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM2NC41LDMwNi4yOTY5LDM3MC41LDMwMS4yOTY5LDM2OC41LDMwNi4yOTY5LDM3MC41LDMxMS4yOTY5LDM2NC41LDMwNi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OCIgeD0iMzE5LjUiIHk9IjM0Ny4yOTIiPiYjMjk5OTI7JiMyNTE0MzsmIzM0ODkyOyYjMjAwMjY7JiMyNjM4MTsmIzIxMTUzOyYjMjIxMjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODkiIHg9IjMyNCIgeT0iMjk4Ljk5NTEiPiYjMTcxO2NvbnN1bWVyJiMxODc7PC90ZXh0PjwvZz48IS0tbGluayBjMSB0byBrYWZrYS0tPjxnIGlkPSJsaW5rX2MxX2thZmthIj48cGF0aCBkPSJNMTEyLjU2NTMsNjkuMTI3IEMxMzguNzQ5LDkxLjk5NiAxNjkuODUzOSwxMTkuMTY0MSAxOTYuMDEzOSwxNDIuMDEyMSAiIGZpbGw9Im5vbmUiIGlkPSJjMS10by1rYWZrYSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDAuNTMzLDE0NS45NTksMTk2LjM4NTcsMTM3LjAyNTksMTk2Ljc2NzEsMTQyLjY2OTksMTkxLjEyMzEsMTQzLjA1MTMsMjAwLjUzMywxNDUuOTU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNCIgeD0iMTY3LjUiIHk9IjExMi4wNjY5Ij5wdWI8L3RleHQ+PC9nPjwhLS1saW5rIGMyIHRvIGthZmthLS0+PGcgaWQ9ImxpbmtfYzJfa2Fma2EiPjxwYXRoIGQ9Ik0yMzUuNSw2OS4xMjcgQzIzNS41LDkxLjk5NiAyMzUuNSwxMTcuMTExIDIzNS41LDEzOS45NTkgIiBmaWxsPSJub25lIiBpZD0iYzItdG8ta2Fma2EiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM1LjUsMTQ1Ljk1OSwyMzkuNSwxMzYuOTU5LDIzNS41LDE0MC45NTksMjMxLjUsMTM2Ljk1OSwyMzUuNSwxNDUuOTU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNCIgeD0iMjM2LjUiIHk9IjExMi4wNjY5Ij5wdWI8L3RleHQ+PC9nPjwhLS1saW5rIGMzIHRvIGthZmthLS0+PGcgaWQ9ImxpbmtfYzNfa2Fma2EiPjxwYXRoIGQ9Ik0zNTguNDM1LDY5LjEyNyBDMzMyLjI1MSw5MS45OTYgMzAxLjE0NjEsMTE5LjE2NDEgMjc0Ljk4NjEsMTQyLjAxMjEgIiBmaWxsPSJub25lIiBpZD0iYzMtdG8ta2Fma2EiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjcwLjQ2NywxNDUuOTU5LDI3OS44NzY5LDE0My4wNTEzLDI3NC4yMzI5LDE0Mi42Njk5LDI3NC42MTQzLDEzNy4wMjU5LDI3MC40NjcsMTQ1Ljk1OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQiIHg9IjMyNS41IiB5PSIxMTIuMDY2OSI+cHViPC90ZXh0PjwvZz48IS0tcmV2ZXJzZSBsaW5rIGthZmthIHRvIHMxLS0+PGcgaWQ9Imxpbmtfa2Fma2FfczEiPjxwYXRoIGQ9Ik0yMDIuMTY0OSwyMTMuMzM5MSBDMTgwLjQ0NzksMjM2LjAzNTEgMTU1LjAzMSwyNjIuNTk5NyAxMzMuMDA1LDI4NS42MTg4ICIgZmlsbD0ibm9uZSIgaWQ9ImthZmthLWJhY2t0by1zMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDYuMzEzLDIwOS4wMDQsMTk3LjIwMDgsMjEyLjc0MTMsMjAyLjg1NjIsMjEyLjYxNjYsMjAyLjk4MDksMjE4LjI3MjEsMjA2LjMxMywyMDkuMDA0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMyIgeD0iMTc4LjUiIHk9IjI1Mi4wNjY5Ij5zdWI8L3RleHQ+PC9nPjwhLS1yZXZlcnNlIGxpbmsga2Fma2EgdG8gczItLT48ZyBpZD0ibGlua19rYWZrYV9zMiI+PHBhdGggZD0iTTIzNS41LDIxNS4wMDQgQzIzNS41LDIzNy43IDIzNS41LDI2Mi41OTk3IDIzNS41LDI4NS42MTg4ICIgZmlsbD0ibm9uZSIgaWQ9ImthZmthLWJhY2t0by1zMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzUuNSwyMDkuMDA0LDIzMS41LDIxOC4wMDQsMjM1LjUsMjE0LjAwNCwyMzkuNSwyMTguMDA0LDIzNS41LDIwOS4wMDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzIiB4PSIyMzYuNSIgeT0iMjUyLjA2NjkiPnN1YjwvdGV4dD48L2c+PCEtLXJldmVyc2UgbGluayBrYWZrYSB0byBzMy0tPjxnIGlkPSJsaW5rX2thZmthX3MzIj48cGF0aCBkPSJNMjY4LjgzNTEsMjEzLjMzOTEgQzI5MC41NTIxLDIzNi4wMzUxIDMxNS45NjksMjYyLjU5OTcgMzM3Ljk5NSwyODUuNjE4OCAiIGZpbGw9Im5vbmUiIGlkPSJrYWZrYS1iYWNrdG8tczMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjY0LjY4NywyMDkuMDA0LDI2OC4wMTkxLDIxOC4yNzIxLDI2OC4xNDM4LDIxMi42MTY2LDI3My43OTkyLDIxMi43NDEzLDI2NC42ODcsMjA5LjAwNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjMiIHg9IjMwNy41IiB5PSIyNTIuMDY2OSI+c3ViPC90ZXh0PjwvZz48IS0tU1JDPVtveWpGSUxMdXNqZHhWRk53UHREd2R0T2pWM2ZwWFE2Mk94MTJpZzZESks1SFZhZmZTY2dIZEhyTjdYUHJIYzFySGJaS0pVWHhzaHkxcEpuWko3TkZqZEt5UXJwX1ZGRmt2eGxkV3pIYTl3UGI5emhPVzJjV2NrSnlsOUFZXzFvNXRESUllaXBhT2hYdjhBTjVHRVMxdk9qQlN5NzZtUEctY3h4cXdWeGZCelBqVUJmdEFnZnc4d3BnZHF6UHlRblotdWs1Rkt6c3g0OUxSdW9ndGIxMURvTV9GNF9OM2s5ODFRazJxWUlrUDJFaWVpUk9IOGsxOWZHTThDSUFHTTk2TUNJQ0NTRzBdLS0+PC9nPjwvc3ZnPg=='>

<h5 id="适合场景"><a href="#适合场景" class="headerlink" title="适合场景"></a>适合场景</h5><ul>
<li>业务解耦，领域更清晰。区分业务核心系统</li>
<li>最终一致性(反之，强一致性，需要接收方回调确认，同步RPC更合适)</li>
<li>广播，1 VS N，稳定上游服务</li>
<li>错峰流控，拉平峰值，避免木桶</li>
<li>日志同步</li>
</ul>
<h5 id="不适合场景"><a href="#不适合场景" class="headerlink" title="不适合场景"></a>不适合场景</h5><ul>
<li>强事务保证</li>
<li>对延迟敏感，需要实时响应</li>
</ul>
<h3 id="kafka好在哪"><a href="#kafka好在哪" class="headerlink" title="kafka好在哪"></a>kafka好在哪</h3><h4 id="吞吐量-延时"><a href="#吞吐量-延时" class="headerlink" title="吞吐量/延时"></a>吞吐量/延时</h4><ul>
<li>吞吐量: 每秒能够处理的消息or字节数。</li>
<li>延时: 客户端发送请求、服务端处理请求并发送相应给客户端。</li>
</ul>
<h5 id="延时越低，吞吐越高？"><a href="#延时越低，吞吐越高？" class="headerlink" title="延时越低，吞吐越高？"></a>延时越低，吞吐越高？</h5><p>通常情况下，我们认为延时越低，单位时间可以处理的请求变多，所以吞吐量增加。但是两者并不是正相关关系。</p>
<p><em><em>e.g. kafka处理一条消息需要花费2ms，吞吐量为1000/2=500。如果通过batch，批量发送，每8s发送一次600条，延时=2ms+8ms=10ms，600</em>(1000/10)=60000。</em>*</p>
<h4 id="消息持久化"><a href="#消息持久化" class="headerlink" title="消息持久化"></a>消息持久化</h4><p>保存在硬盘，不会丢失，可以重放。and <strong>性能很高!!!</strong> 后面聊原因。</p>
<h4 id="负载均衡和故障转移"><a href="#负载均衡和故障转移" class="headerlink" title="负载均衡和故障转移"></a>负载均衡和故障转移</h4><p>多副本、多分区，保障高可用。</p>
<h4 id="伸缩性"><a href="#伸缩性" class="headerlink" title="伸缩性"></a>伸缩性</h4><p>自身无状态，方便扩展。</p>
<h3 id="名词解析"><a href="#名词解析" class="headerlink" title="名词解析"></a>名词解析</h3><ol>
<li>message -&gt; 消息</li>
<li>broker -&gt; kafka服务器</li>
<li>topic -&gt; 主题，逻辑概念。定义一类消息，一个消息内容体</li>
<li>partition -&gt; 分区，消息实际存储的物理位置。保存在磁盘中的有序队列，维护offset。</li>
<li>replica -&gt; 副本(partition)。分为leader replica 和 follower replica。和Master-Slave不同，follower只从leader同步数据，不提供读写。只有在leader挂了之后，才会选举follower作为leader提供服务。kafka保障同一个partition的replica在不同的broker，否则无法提供故障转移。同一个topic可以有不同的leader，同一个topic+partition只有一个leader。</li>
<li>ISR(is-sync replica) -&gt; 同步副本集合。如果follower延迟过大，会被踢出集合，追赶上数据之后，重新向leader申请，加入ISR集合。并不是所有的follower都可以成为leader，ISR集合中的follower可以竞选leader。通过replica.lag.time.max.ms(默认10s)设置follower同步时间，通过RetchRequest(offset)同步leader信息。</li>
<li>offset -&gt; 位移、偏移量</li>
<li>producer -&gt; 生产者</li>
<li>consumer -&gt; 消费者</li>
<li>group -&gt; 组。通过维护各group的offset，每条消息只会被发送到同一个group下的一个consumer，实现不同模型。</li>
<li>controller -&gt; 控制器。选举broker作为controller，管理和协调kafka集群，和zookeeper通信。</li>
<li>coordinator -&gt; 协调者。用于实现成员管理、消费分配方案制定(rebalance)以及提交位移等，每个group选举consumer作为协调者。</li>
</ol>
<h4 id="topic、partition和broker"><a href="#topic、partition和broker" class="headerlink" title="topic、partition和broker"></a>topic、partition和broker</h4><p><img src="http://img.yuheng.wang/kafka_0.png" alt="kafka_0"></p>
<ul>
<li>同一个topic可以在不同broker上维护不同的分区(负载均衡)</li>
<li>同一个topic可以在不同broker上维护同一个分区(冗余机制,故障转移)</li>
</ul>
<h4 id="offset同步及水位"><a href="#offset同步及水位" class="headerlink" title="offset同步及水位"></a>offset同步及水位</h4><p><img src="http://img.yuheng.wang/kafka_1.png" alt="kafka_1"></p>
<ul>
<li>上次提交的位移:group确认的offset</li>
<li>当前位置:读取后，未提交</li>
<li>HW:ISR确认已同步后，leader增加HW。</li>
<li>LEO: leader接收到的最新一条producer发送的数据</li>
<li>consumer只能消费到HW，未同步给所有ISR成员的消息无法消费</li>
<li>leader保存 LEO、HW和remote LEO, min(LEO, remote LEO) 更新HW</li>
<li>follower轮询leader，purgatory暂存请求，500ms</li>
<li>新版本epoch保存leader变更版本，维护kv (epoch, offset)</li>
</ul>
<h4 id="group"><a href="#group" class="headerlink" title="group"></a>group</h4><ul>
<li>一个group有一或多个consumer</li>
<li>一个消息可以发送给多个group</li>
</ul>
<h3 id="kafka高性能的秘密"><a href="#kafka高性能的秘密" class="headerlink" title="kafka高性能的秘密"></a>kafka高性能的秘密</h3><h4 id="顺序写"><a href="#顺序写" class="headerlink" title="顺序写?"></a>顺序写?</h4><p><img src="http://img.yuheng.wang/kafka_2.png" alt="kafka_2"></p>
<p>网上的教程经常看到介绍，写入耗时主要集中在<strong>磁头寻道</strong>和<strong>盘片旋转</strong>，而<strong>数据传输</strong>速度很快。kafka采用了顺序写，所以效率高。不免有些疑问:</p>
<ol>
<li>顺序写性能高，为什么还有随机写？</li>
<li>磁盘不会被占用，每次写入都需要寻道、旋转，那么顺序写的优势在哪？</li>
</ol>
<p>原因</p>
<ol>
<li>因为写入的是不同的文件，占用连续的page。顺序写，不能修改。</li>
<li>增加前提:一次写入一个文件且文件足够大。</li>
</ol>
<p>所以本质原因在于<strong>追加写</strong>，”每个partition是一个文件”。<br>读取时，识别顺序写，会进行预读。</p>
<h4 id="PageCache"><a href="#PageCache" class="headerlink" title="PageCache"></a>PageCache</h4><ul>
<li>Kafka不会每次都写磁盘，而是写入分页存储<strong>PageCache</strong>就认为producer成功。</li>
<li>操作系统决定什么时候将PageCache写入磁盘(flush)。增加flush时间间隔，可以提升吞吐</li>
<li>flush时为顺序写入，不会有额外的性能损耗。</li>
<li>读取时，优先读取PageCache。</li>
</ul>
<h4 id="PageCache为缓存，数据会不会丢失？"><a href="#PageCache为缓存，数据会不会丢失？" class="headerlink" title="PageCache为缓存，数据会不会丢失？"></a>PageCache为缓存，数据会不会丢失？</h4><p>因为是操作系统管理，所以kafka进程挂了，数据不会丢失。如果操作系统掉电。。。依靠副本</p>
<h4 id="Zero-Copy"><a href="#Zero-Copy" class="headerlink" title="Zero Copy"></a>Zero Copy</h4><p>依赖于linux系统的sendfile函数，针对java，则通过FileChannel.transferTO</p>
<p><img src="http://img.yuheng.wang/kafka_3.png" alt="kafka_3"></p>
<p><img src="http://img.yuheng.wang/kafka_4.png" alt="kafka_4"></p>
<h3 id="partition"><a href="#partition" class="headerlink" title="partition"></a>partition</h3><ol>
<li>leader针对partition而不是broker</li>
<li>partition不是一个文件而是一个文件夹</li>
<li>partition是我们能操作的最小概念</li>
</ol>
<p><img src="http://img.yuheng.wang/kafka_5.png" alt="kafka_5"></p>
<p>如果一直追加会导致文件过大，不便于使用(读写)和维护(删除旧数据)，kafka为此采用了几种措施</p>
<ol>
<li>区分segment</li>
<li>增加索引,包括index和timeindex</li>
</ol>
<h4 id="segment"><a href="#segment" class="headerlink" title="segment"></a>segment</h4><p><img src="http://img.yuheng.wang/kafka_6.png" alt="kafka_6"></p>
<ul>
<li><code>segment=log+index+timeindex</code></li>
<li>命名规则为<strong>segment文件最后一条消息的offset值</strong>。</li>
<li>log.segment.bytes 日志切割(默认1G)</li>
</ul>
<h4 id="index和timeindex"><a href="#index和timeindex" class="headerlink" title="index和timeindex"></a>index和timeindex</h4><p><img src="http://img.yuheng.wang/kafka_7.png" alt="kafka_7"></p>
<ol>
<li>index，位移索引，间隔创建索引指向物理偏移地址。间隔通过log.index.interval.bytes设置，默认4MB。</li>
<li>timeindex，时间索引，为满足时序型统计需求。</li>
</ol>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append</span></span>(largestOffset: <span class="type">Long</span>,</span><br><span class="line">           largestTimestamp: <span class="type">Long</span>,</span><br><span class="line">           shallowOffsetOfMaxTimestamp: <span class="type">Long</span>,</span><br><span class="line">           records: <span class="type">MemoryRecords</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  <span class="keyword">if</span> (records.sizeInBytes &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    trace(<span class="string">s&quot;Inserting <span class="subst">$&#123;records.sizeInBytes&#125;</span> bytes at end offset <span class="subst">$largestOffset</span> at position <span class="subst">$&#123;log.sizeInBytes&#125;</span> &quot;</span> +</span><br><span class="line">          <span class="string">s&quot;with largest timestamp <span class="subst">$largestTimestamp</span> at shallow offset <span class="subst">$shallowOffsetOfMaxTimestamp</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> physicalPosition = log.sizeInBytes()</span><br><span class="line">    <span class="keyword">if</span> (physicalPosition == <span class="number">0</span>)</span><br><span class="line">      rollingBasedTimestamp = <span class="type">Some</span>(largestTimestamp)</span><br><span class="line"></span><br><span class="line">    ensureOffsetInRange(largestOffset)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// append the messages</span></span><br><span class="line">    <span class="keyword">val</span> appendedBytes = log.append(records)</span><br><span class="line">    trace(<span class="string">s&quot;Appended <span class="subst">$appendedBytes</span> to <span class="subst">$&#123;log.file&#125;</span> at end offset <span class="subst">$largestOffset</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// Update the in memory max timestamp and corresponding offset.</span></span><br><span class="line">    <span class="keyword">if</span> (largestTimestamp &gt; maxTimestampSoFar) &#123;</span><br><span class="line">      maxTimestampSoFar = largestTimestamp</span><br><span class="line">      offsetOfMaxTimestamp = shallowOffsetOfMaxTimestamp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// append an entry to the index (if needed)</span></span><br><span class="line">    <span class="keyword">if</span> (bytesSinceLastIndexEntry &gt; indexIntervalBytes) &#123;</span><br><span class="line">      offsetIndex.append(largestOffset, physicalPosition)</span><br><span class="line">      timeIndex.maybeAppend(maxTimestampSoFar, offsetOfMaxTimestamp)</span><br><span class="line">      bytesSinceLastIndexEntry = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    bytesSinceLastIndexEntry += records.sizeInBytes</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>索引文件预分配空间，切分时裁剪。</p>
<p>p.s. producer发送消息时，可以指定时间戳。如果机器时区不同，或者retry、网络延时等导致时间混乱，按照时间索引进行查询时，导致查询不到消息。?? 时间会在发送时获取本机时间</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">long timestamp &#x3D; record.timestamp() &#x3D;&#x3D; null ? time.milliseconds() : record.timestamp();</span><br></pre></td></tr></table></figure>

<h3 id="producer"><a href="#producer" class="headerlink" title="producer"></a>producer</h3><p><img src="http://img.yuheng.wang/kafka_8.png" alt="kafka_8"></p>
<h4 id="producer配置"><a href="#producer配置" class="headerlink" title="producer配置"></a>producer配置</h4><p>通过配置文件了解细节</p>
<ul>
<li>bootstrap.servers 指定其中一个，会自动找到leader，但是如果指定的机器挂了，无法切换</li>
<li>acks 0, 1, all|-1。 0表示无需确认，1表示leader确认，-1表示所有ISR确认。</li>
<li>buffer.memory 缓存消息的缓冲区大小32MB，过小会影响吞吐。写入速度超过发送速度，停止&amp;等待IO发送，still追不上会报错。</li>
<li>compression.type 开启压缩，提升IO吞吐，增加CPU压力。需要看服务器是IO密集型or计算密集型。 属性 0: 无压缩，1: GZIP，2: Snappy，3: LZ4</li>
<li>retries 重试，屏蔽网络抖动or leader选举 or NotController，导致消息重复发送。详细参见<code>RetriableException</code></li>
<li>retry.backoff.ms 重试间隔</li>
<li>batch.size 批量发送大小，默认16KB，增加可提升吞吐</li>
<li>linger.ms 发送时间，默认为0，立即发送，不判断batch.size大小。</li>
<li>max.request.size 消息大小，因为存在header等，实际大小大于消息本身</li>
<li>request.timeout.ms 超时时间，默认30s。broker给producer反馈</li>
<li>partitioner.class</li>
<li>key.serializer &amp; value.serializer</li>
<li>interceptor.classes 自定义拦截器</li>
</ul>
<h4 id="自定义serializer"><a href="#自定义serializer" class="headerlink" title="自定义serializer"></a>自定义serializer</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastJsonSerializer</span> <span class="keyword">implements</span> <span class="title">Serializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(Map configs, <span class="keyword">boolean</span> isKey)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] serialize(String topic, Object data) &#123;</span><br><span class="line">        <span class="keyword">return</span> JSONObject.toJSONBytes(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义partitioner"><a href="#自定义partitioner" class="headerlink" title="自定义partitioner"></a>自定义partitioner</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsPartitioner</span> <span class="keyword">implements</span> <span class="title">Partitioner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(String topic, Object key, <span class="keyword">byte</span>[] keyBytes, Object value, <span class="keyword">byte</span>[] valueBytes, Cluster cluster)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Long.parseLong(String.valueOf(key)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(Map&lt;String, ?&gt; configs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义分区策略 机器人发送到同一个partition，为了快速响应真实用户。如果只是为了均匀分布，不需要指定key(和旧版本不同)。</p>
<p>如果未指定key，会通过轮询，避免skewed</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster) &#123;</span><br><span class="line">        List&lt;PartitionInfo&gt; partitions &#x3D; cluster.partitionsForTopic(topic);</span><br><span class="line">        int numPartitions &#x3D; partitions.size();</span><br><span class="line">        if (keyBytes &#x3D;&#x3D; null) &#123;</span><br><span class="line">            int nextValue &#x3D; nextValue(topic);</span><br><span class="line">            List&lt;PartitionInfo&gt; availablePartitions &#x3D; cluster.availablePartitionsForTopic(topic);</span><br><span class="line">            if (availablePartitions.size() &gt; 0) &#123;</span><br><span class="line">                int part &#x3D; Utils.toPositive(nextValue) % availablePartitions.size();</span><br><span class="line">                return availablePartitions.get(part).partition();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                &#x2F;&#x2F; no partitions are available, give a non-available partition</span><br><span class="line">                return Utils.toPositive(nextValue) % numPartitions;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            &#x2F;&#x2F; hash the keyBytes to choose a partition</span><br><span class="line">            return Utils.toPositive(Utils.murmur2(keyBytes)) % numPartitions;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="producer拦截器"><a href="#producer拦截器" class="headerlink" title="producer拦截器"></a>producer拦截器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerLogInterceptor</span> <span class="keyword">implements</span> <span class="title">ProducerInterceptor</span>&lt;<span class="title">String</span>, <span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProducerRecord&lt;String, Object&gt; <span class="title">onSend</span><span class="params">(ProducerRecord&lt;String, Object&gt; record)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;send topic: &quot;</span> + record.topic());</span><br><span class="line">        <span class="keyword">return</span> record;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAcknowledgement</span><span class="params">(RecordMetadata metadata, Exception exception)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;record metadata&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(Map&lt;String, ?&gt; configs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="100-送达配置-无消息丢失配置"><a href="#100-送达配置-无消息丢失配置" class="headerlink" title="100% 送达配置 | 无消息丢失配置"></a>100% 送达配置 | 无消息丢失配置</h4><p>通过配置替换 <code>send().get()</code> </p>
<ul>
<li>max.block.ms=999999</li>
<li>acks=-1</li>
<li>retries=999 不会重试非RetriableException异常</li>
<li>max.in.flight.requests.per.connection=1 发送未响应请求的数量</li>
<li>KafkaProducer.send(record,callback)</li>
<li>clonse(0)</li>
</ul>
<h4 id="消息内容"><a href="#消息内容" class="headerlink" title="消息内容"></a>消息内容</h4><table>
<thead>
<tr>
<th>CRC</th>
<th>版本号</th>
<th>属性</th>
<th>时间戳</th>
<th>key长度</th>
<th>key内容</th>
<th>value长度</th>
<th>value内容</th>
</tr>
</thead>
<tbody><tr>
<td>4B</td>
<td>1B</td>
<td>1B</td>
<td>8B</td>
<td>4B</td>
<td>n</td>
<td>4B</td>
<td>n</td>
</tr>
</tbody></table>
<h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><p>group保存位移offset，替换zookeeper保存(<code>/consumers/groupid/offsets/topic/partition</code>节点)。checkpointing定期从consumer到broker对offset进行持久化。(log.flush.offset.checkpoint.interval.ms 默认60s)<br>offset格式=map(groupId+topic+partition, offset)</p>
<p>为什么不用zookeeper保存？</p>
<ul>
<li>zookeeper不擅长频繁写(强一致性)</li>
</ul>
<p>为什么不用broker保存？</p>
<ol>
<li>增加应答机制，确认消费成功，影响吞吐</li>
<li>保存多个consumer的offset，数据结构复杂</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  Start the background threads to flush logs and do log cleanup</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">def <span class="title">startup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* Schedule the cleanup task to delete old logs */</span></span><br><span class="line">  <span class="keyword">if</span> (scheduler != <span class="keyword">null</span>) &#123;</span><br><span class="line">    info(<span class="string">&quot;Starting log cleanup with a period of %d ms.&quot;</span>.format(retentionCheckMs))</span><br><span class="line">    scheduler.schedule(<span class="string">&quot;kafka-log-retention&quot;</span>,</span><br><span class="line">                       cleanupLogs _,</span><br><span class="line">                       delay = InitialTaskDelayMs,</span><br><span class="line">                       period = retentionCheckMs,</span><br><span class="line">                       TimeUnit.MILLISECONDS)</span><br><span class="line">    info(<span class="string">&quot;Starting log flusher with a default period of %d ms.&quot;</span>.format(flushCheckMs))</span><br><span class="line">    scheduler.schedule(<span class="string">&quot;kafka-log-flusher&quot;</span>,</span><br><span class="line">                       flushDirtyLogs _,</span><br><span class="line">                       delay = InitialTaskDelayMs,</span><br><span class="line">                       period = flushCheckMs,</span><br><span class="line">                       TimeUnit.MILLISECONDS)</span><br><span class="line">    scheduler.schedule(<span class="string">&quot;kafka-recovery-point-checkpoint&quot;</span>,</span><br><span class="line">                       checkpointLogRecoveryOffsets _,</span><br><span class="line">                       delay = InitialTaskDelayMs,</span><br><span class="line">                       period = flushRecoveryOffsetCheckpointMs,</span><br><span class="line">                       TimeUnit.MILLISECONDS)</span><br><span class="line">    scheduler.schedule(<span class="string">&quot;kafka-log-start-offset-checkpoint&quot;</span>,</span><br><span class="line">                       checkpointLogStartOffsets _,</span><br><span class="line">                       delay = InitialTaskDelayMs,</span><br><span class="line">                       period = flushStartOffsetCheckpointMs,</span><br><span class="line">                       TimeUnit.MILLISECONDS)</span><br><span class="line">    scheduler.schedule(<span class="string">&quot;kafka-delete-logs&quot;</span>, <span class="comment">// will be rescheduled after each delete logs with a dynamic period</span></span><br><span class="line">                       deleteLogs _,</span><br><span class="line">                       delay = InitialTaskDelayMs,</span><br><span class="line">                       unit = TimeUnit.MILLISECONDS)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (cleanerConfig.enableCleaner)</span><br><span class="line">    cleaner.startup()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Consumer配置"><a href="#Consumer配置" class="headerlink" title="Consumer配置"></a>Consumer配置</h4><ul>
<li><code>session.timeout.ms</code> 协调者(coordinator)检测失败的时间，踢出consumer rebalance</li>
<li><code>heartbeat.interval.ms</code> 如果需要rebalance，会在心跳线程的response中set rebalance_in_progress，心跳线程间隔。必须小于session.timeout.ms</li>
<li><code>max.poll.interval.ms</code> consumer处理逻辑最大时间 &amp; consumer启动选举coordinator时间</li>
<li><code>auto.offset.reset</code> earliest|lastest 更换group后，重新消费。 默认lastest</li>
<li><code>enable.auto.commit</code> false 手动提交位移</li>
<li><code>auto.commit.interval.ms</code> 自动提交位移时间间隔</li>
<li><code>fetch.max.bytes</code> 如果消息很大，需要手动设置 50 * 1024 * 1024 </li>
<li><code>max.poll.records</code> 单次调用返回的消息数 500</li>
<li><code>connections.max.idle.ms</code> 默认9分钟，推荐-1。不关闭空闲连接，周期性请求处理时间增加。</li>
<li><code>partition.assignment.strategy</code> partition分配策略, 默认 RangeAssignor</li>
</ul>
<h4 id="partition分配策略"><a href="#partition分配策略" class="headerlink" title="partition分配策略"></a>partition分配策略</h4><p>每个partition分配给一个consumer。</p>
<p><strong>e.g. 如果一个group订阅一个topic，一个topic有100个partition，一个group有5个consumer。则每个consumer消费20个partition</strong></p>
<p>partition分配策略，继承AbstractPartitionAssignor自定义策略规则，加权重等。自带分配规则:</p>
<ol>
<li>range 分区顺序排列、分组、分配给consumer</li>
<li>round-robin 分区顺序排列， 轮询consumer，读取分区</li>
<li>sticky 基于历史分配方案，避免数据倾斜</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RangeAssignor</span> <span class="keyword">extends</span> <span class="title">AbstractPartitionAssignor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;range&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;String&gt;&gt; consumersPerTopic(Map&lt;String, Subscription&gt; consumerMetadata) &#123;</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; res = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Subscription&gt; subscriptionEntry : consumerMetadata.entrySet()) &#123;</span><br><span class="line">            String consumerId = subscriptionEntry.getKey();</span><br><span class="line">            <span class="keyword">for</span> (String topic : subscriptionEntry.getValue().topics())</span><br><span class="line">                put(res, topic, consumerId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                    Map&lt;String, Subscription&gt; subscriptions) &#123;</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; consumersPerTopic = consumersPerTopic(subscriptions);</span><br><span class="line">        Map&lt;String, List&lt;TopicPartition&gt;&gt; assignment = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String memberId : subscriptions.keySet())</span><br><span class="line">            assignment.put(memberId, <span class="keyword">new</span> ArrayList&lt;TopicPartition&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;String&gt;&gt; topicEntry : consumersPerTopic.entrySet()) &#123;</span><br><span class="line">            String topic = topicEntry.getKey();</span><br><span class="line">            List&lt;String&gt; consumersForTopic = topicEntry.getValue();</span><br><span class="line"></span><br><span class="line">            Integer numPartitionsForTopic = partitionsPerTopic.get(topic);</span><br><span class="line">            <span class="keyword">if</span> (numPartitionsForTopic == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            Collections.sort(consumersForTopic);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> numPartitionsPerConsumer = numPartitionsForTopic / consumersForTopic.size();</span><br><span class="line">            <span class="keyword">int</span> consumersWithExtraPartition = numPartitionsForTopic % consumersForTopic.size();</span><br><span class="line"></span><br><span class="line">            List&lt;TopicPartition&gt; partitions = AbstractPartitionAssignor.partitions(topic, numPartitionsForTopic);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, n = consumersForTopic.size(); i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> start = numPartitionsPerConsumer * i + Math.min(i, consumersWithExtraPartition);</span><br><span class="line">                <span class="keyword">int</span> length = numPartitionsPerConsumer + (i + <span class="number">1</span> &gt; consumersWithExtraPartition ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">                assignment.get(consumersForTopic.get(i)).addAll(partitions.subList(start, start + length));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> assignment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="误解"><a href="#误解" class="headerlink" title="误解"></a>误解</h4><p>使用过程中对kafka consumer的一些误解</p>
<h5 id="误解1"><a href="#误解1" class="headerlink" title="误解1"></a>误解1</h5><blockquote>
<p><code>poll(long timeout)</code>和<code>max.poll.records</code> 按照时间或者消息记录数，控制每次获取消息。</p>
</blockquote>
<p>poll表示轮询，使用poll而不是pull，并不需要wakeup。所以可以使用<code>poll(Long.MAX_VALUE)</code>，每次数据流准备好后，会返回并进行业务处理。</p>
<h5 id="误解2"><a href="#误解2" class="headerlink" title="误解2"></a>误解2</h5><blockquote>
<p>“consumer只能订阅一个topic。”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">consumer.subscribe(Pattern.compile(&quot;kafka.*&quot;))</span><br></pre></td></tr></table></figure>

<h5 id="误解3"><a href="#误解3" class="headerlink" title="误解3"></a>误解3</h5><blockquote>
<p>“commitSync同步提交，阻塞消费。commitAsync异步提交，不阻塞消费。”</p>
</blockquote>
<p>commitSync和commitAsync都会阻塞poll，因为在poll执行时轮询时会判断commit状态。commitAsync不阻塞业务处理后续方法执行。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">invokeCompletedOffsetCommitCallbacks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        OffsetCommitCompletion completion = completedOffsetCommits.poll();</span><br><span class="line">        <span class="keyword">if</span> (completion == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        completion.invoke();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="EOS-Exactly-once-Semantics"><a href="#EOS-Exactly-once-Semantics" class="headerlink" title="EOS(Exactly-once Semantics)"></a>EOS(Exactly-once Semantics)</h4><ul>
<li>at most once 最多一次，消息可能丢失，但不会被重复处理。获取消息后，先commit，然后业务处理。</li>
<li>at least once 最少一次 消息不会丢失，但可能被处理多次。获取消息后，先业务处理，然后commit。</li>
<li>exactly once 会被处理且只会被处理一次</li>
</ul>
<h4 id="消费指定partition"><a href="#消费指定partition" class="headerlink" title="消费指定partition"></a>消费指定partition</h4><p>自定义分配策略？不需要，可以通过assign指定topic partition</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">consumer.assign(Collections.singletonList(<span class="keyword">new</span> TopicPartition(TOPIC, partition)));</span><br></pre></td></tr></table></figure>

<ul>
<li>assign + subscribe 冲突错误<code>java.lang.IllegalStateException: Subscription to topics, partitions and pattern are mutually exclusive</code></li>
<li>assign + assign 后一个生效</li>
<li>2个consumer assign同一个partition 消费两次</li>
<li>一个consumer assign 一个consumer subscribe, rebalance 踢出assign</li>
</ul>
<h4 id="控制提交分区offset"><a href="#控制提交分区offset" class="headerlink" title="控制提交分区offset"></a>控制提交分区offset</h4><p>Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets 控制提交分区offset，细粒度</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">consumer.commitSync(Collections.singletonMap(tp, offset));</span><br></pre></td></tr></table></figure>

<h4 id="rebalance"><a href="#rebalance" class="headerlink" title="rebalance"></a>rebalance</h4><p>通过<strong>状态机</strong>模式管理。</p>
<h5 id="rebalance触发条件"><a href="#rebalance触发条件" class="headerlink" title="rebalance触发条件"></a>rebalance触发条件</h5><ol>
<li>consumer加入、退出、崩溃</li>
<li>topic发生变更，如正则匹配，增加topic</li>
<li>分区发生变动</li>
<li>消费处理超时</li>
</ol>
<h5 id="rebalance协议"><a href="#rebalance协议" class="headerlink" title="rebalance协议"></a>rebalance协议</h5><ol>
<li>joinCroup 请求</li>
<li>SyncGroup 请求，group leader 同步分配方案</li>
<li>Heartbeat 请求 向coordinator汇报心跳</li>
<li>LeaveGroup 请求 </li>
<li>DescribeGroup 查看组信息</li>
</ol>
<h5 id="rebalance优化"><a href="#rebalance优化" class="headerlink" title="rebalance优化"></a>rebalance优化</h5><ul>
<li>因为rebalance系统开销大，需要合理设置request.timeout.ms、max.poll.records 和 max.poll.interval.ms 减少rebalance次数。</li>
<li>rebalance generation 标识 rebalance，每次+1， 延迟提交offset会被group拒绝 ILLEGAL_GENERATION</li>
</ul>
<h5 id="rebalance细节"><a href="#rebalance细节" class="headerlink" title="rebalance细节"></a>rebalance细节</h5><ol>
<li>收集join consumer，选取leader，同步给coordinator。 leader 负责分配</li>
<li>同步更新分配方案，发送SyncGroup请求给coordinator，每个consumer都发送，coordinator接受leader的方案，分配，返回response</li>
</ol>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handleJoinGroupRequest</span></span>(request: <span class="type">RequestChannel</span>.<span class="type">Request</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> joinGroupRequest = request.body[<span class="type">JoinGroupRequest</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the callback for sending a join-group response</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendResponseCallback</span></span>(joinResult: <span class="type">JoinGroupResult</span>) &#123;</span><br><span class="line">      <span class="keyword">val</span> members = joinResult.members map &#123; <span class="keyword">case</span> (memberId, metadataArray) =&gt; (memberId, <span class="type">ByteBuffer</span>.wrap(metadataArray)) &#125;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">createResponse</span></span>(requestThrottleMs: <span class="type">Int</span>): <span class="type">AbstractResponse</span> = &#123;</span><br><span class="line">        <span class="keyword">val</span> responseBody = <span class="keyword">new</span> <span class="type">JoinGroupResponse</span>(requestThrottleMs, joinResult.error, joinResult.generationId,</span><br><span class="line">          joinResult.subProtocol, joinResult.memberId, joinResult.leaderId, members.asJava)</span><br><span class="line"></span><br><span class="line">        trace(<span class="string">&quot;Sending join group response %s for correlation id %d to client %s.&quot;</span></span><br><span class="line">          .format(responseBody, request.header.correlationId, request.header.clientId))</span><br><span class="line">        responseBody</span><br><span class="line">      &#125;</span><br><span class="line">      sendResponseMaybeThrottle(request, createResponse)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!authorize(request.session, <span class="type">Read</span>, <span class="type">Resource</span>(<span class="type">Group</span>, joinGroupRequest.groupId(), <span class="type">LITERAL</span>))) &#123;</span><br><span class="line">      sendResponseMaybeThrottle(request, requestThrottleMs =&gt;</span><br><span class="line">        <span class="keyword">new</span> <span class="type">JoinGroupResponse</span>(</span><br><span class="line">          requestThrottleMs,</span><br><span class="line">          <span class="type">Errors</span>.<span class="type">GROUP_AUTHORIZATION_FAILED</span>,</span><br><span class="line">          <span class="type">JoinGroupResponse</span>.<span class="type">UNKNOWN_GENERATION_ID</span>,</span><br><span class="line">          <span class="type">JoinGroupResponse</span>.<span class="type">UNKNOWN_PROTOCOL</span>,</span><br><span class="line">          <span class="type">JoinGroupResponse</span>.<span class="type">UNKNOWN_MEMBER_ID</span>, <span class="comment">// memberId</span></span><br><span class="line">          <span class="type">JoinGroupResponse</span>.<span class="type">UNKNOWN_MEMBER_ID</span>, <span class="comment">// leaderId</span></span><br><span class="line">          <span class="type">Collections</span>.emptyMap())</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// let the coordinator handle join-group</span></span><br><span class="line">      <span class="keyword">val</span> protocols = joinGroupRequest.groupProtocols().asScala.map(protocol =&gt;</span><br><span class="line">        (protocol.name, <span class="type">Utils</span>.toArray(protocol.metadata))).toList</span><br><span class="line">      groupCoordinator.handleJoinGroup(</span><br><span class="line">        joinGroupRequest.groupId,</span><br><span class="line">        joinGroupRequest.memberId,</span><br><span class="line">        request.header.clientId,</span><br><span class="line">        request.session.clientAddress.toString,</span><br><span class="line">        joinGroupRequest.rebalanceTimeout,</span><br><span class="line">        joinGroupRequest.sessionTimeout,</span><br><span class="line">        joinGroupRequest.protocolType,</span><br><span class="line">        protocols,</span><br><span class="line">        sendResponseCallback)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="多线程消费"><a href="#多线程消费" class="headerlink" title="多线程消费"></a>多线程消费</h4><p>自己实现缓存区，批量执行及确认consumer.commitSync</p>
<ol>
<li>多consumer thread 效率高，单独offset。 缺点：受限于topic分区数，broker压力大，rebalance可能性大</li>
<li>单consumer 多handler thread ，获取和处理节藕，伸缩性好。难于管理分区内消息顺序，位移提交困难，处理不当导致数据丢失。</li>
</ol>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="日志留存"><a href="#日志留存" class="headerlink" title="日志留存"></a>日志留存</h4><ul>
<li>log.retemtopm.{hours|minutes|ms}</li>
<li>log.retention.bytes 字节 默认-1</li>
<li>当前日志段不会清除</li>
<li>和日志最近修改时间比较、比较记录时间戳</li>
</ul>
<h4 id="暂停consumer消费"><a href="#暂停consumer消费" class="headerlink" title="暂停consumer消费"></a>暂停consumer消费</h4><p><strong>e.g. 消费逻辑为调用三方接口，如果三方接口不稳定，需要关闭一段时间。</strong></p>
<ul>
<li>暂停 <code>consumer.pause(consumer.assignment());</code></li>
<li>启动 <code>consumer.resume(consumer.assignment());</code></li>
</ul>
<h4 id="compaction"><a href="#compaction" class="headerlink" title="compaction"></a>compaction</h4><ul>
<li>订阅binlog see <a href="https://github.com/alibaba/canal">canal</a></li>
<li>高可用日志化</li>
</ul>
<h4 id="manager指定lisnterners"><a href="#manager指定lisnterners" class="headerlink" title="manager指定lisnterners"></a>manager指定lisnterners</h4><p>因为kafka内部使用全称域名，不统一，导致无法获取元数据</p>
<h4 id="生产环境"><a href="#生产环境" class="headerlink" title="生产环境"></a>生产环境</h4><ol>
<li>优雅的启动和关闭(Spring生命周期)</li>
<li>offset跳过与重放</li>
</ol>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><ol>
<li><a href="http://www.broadview.com.cn/book/5013">Apache Kafka实战</a></li>
<li><a href="https://www.jianshu.com/p/ed5900d31f1f">Page Cache的落地问题</a></li>
<li><a href="https://tech.meituan.com/kafka-fs-design-theory.html?utm_source=tool.lu">Kafka文件存储机制那些事</a></li>
<li><a href="https://segmentfault.com/a/1190000011883632">Netty 之 Zero-copy 的实现（下）</a></li>
<li><a href="https://tech.meituan.com/about-desk-io.html?utm_source=tool.lu">磁盘I/O那些事</a></li>
<li><a href="https://www.cnblogs.com/huxi2b/p/6223228.html">Kafka消费组(consumer group)</a></li>
</ol>
]]></content>
      <categories>
        <category>kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>距离全栈 你只差一个kotlinx</title>
    <url>/2020/09/10/kotlin-dsl-html/</url>
    <content><![CDATA[<p><img src="https://img.yuheng.wang/mweb/dsl_1.jpeg" alt="dsl_1"></p>
<span id="more"></span>

<blockquote>
<p>全栈不能保证一定能够解决复杂的问题, 但却能帮你打开解决复杂问题的大门.</p>
</blockquote>
<p><img src="https://img.yuheng.wang/mweb/dsl_0.jpeg" alt="dsl_0"></p>
<p>近些年，前端技术变得愈发复杂。这一趋势除了导致全球变暖，也让全栈开发的难度越来越大。</p>
<p>但是，阻碍一个后端开发去写页面的根本原因到底是什么呢？<br>我认为是开发环境的搭建，如果环境变量准备好，可以用自己平时使用的IDE直接写代码，刷新就能看效果，这事貌似可行。</p>
<p>那么如何解决这个问题呢？<br>我觉得终极解决方案是用一门编程语言同时写前后端代码。</p>
<p>Kotlin配合DSL就可以。</p>
<h2 id="DSL"><a href="#DSL" class="headerlink" title="DSL"></a>DSL</h2><blockquote>
<p>DSL(Domain Specific Language)，领域特定语言。专注于一个方面而特殊设计的语言。 </p>
</blockquote>
<p>比如<code>SQL</code>是数据库领域的DSL。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol>
<li>只描述和解决特定领域</li>
</ol>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ol>
<li>语义更明确，直观</li>
<li>可以屏蔽数据结构和技术细节，由领域专家编写</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>额外的理解、学习成本</li>
<li>抽象设计难度高，需要平衡表现力和实现成本。</li>
</ol>
<p>比如描述2天前的时间，你可以定义为<br><code>2 days ago</code><br>也可以是<br><code>new Date().before(2, DAY)</code></p>
<p>这又引出了DSL的2种分类</p>
<ul>
<li>内部(Internal)DSL，借助宿主语言(如:Scala、Kotlin)实现。和提取函数方法不同，提供了一套更接近自然语言的语法表现形式</li>
<li>外部(External)DSL，语言无关，需要自定义语法并实现解析器。比如 <code>XMl</code>、<code>YAML</code></li>
</ul>
<h2 id="kotlin-DSL"><a href="#kotlin-DSL" class="headerlink" title="kotlin DSL"></a>kotlin DSL</h2><p><code>Kotlin</code> 借助 <code>Lambda</code> + <code>Extensions扩展</code> 来实现内部DSL </p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    expression &#123;</span><br><span class="line">        source = <span class="string">&quot;a&quot;</span></span><br><span class="line">        target = <span class="string">&quot;b&quot;</span></span><br><span class="line">        <span class="keyword">operator</span> = Operator.ADD</span><br><span class="line">        onBefore &#123; println(<span class="string">&quot;before <span class="variable">$source</span>&quot;</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Operator</span> </span>&#123;</span><br><span class="line">    ADD,</span><br><span class="line">    SUBTRACT,</span><br><span class="line">    MULTIPLY,</span><br><span class="line">    DIVIDE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Expression</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> source: String? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> target: String? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">operator</span>: Operator? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> before: () -&gt; <span class="built_in">Unit</span> = &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onBefore</span><span class="params">(onBefore: () -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        before = onBefore</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">execute</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">this</span>.before()</span><br><span class="line">        <span class="keyword">val</span> result = <span class="string">&quot;<span class="variable">$source</span> <span class="variable">$operator</span> <span class="variable">$target</span>&quot;</span></span><br><span class="line">        println(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">expression</span><span class="params">(<span class="keyword">init</span>: <span class="type">Expression</span>.() -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> wrap = Expression()</span><br><span class="line">    wrap.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">    wrap.execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>expression</code>函数的入参是一个<code>Expression.() -&gt; Unit</code>类型的<code>lambda</code>。未简化的代码为</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> lambdaExpression:Expression.() -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    source = <span class="string">&quot;a&quot;</span></span><br><span class="line">    target = <span class="string">&quot;b&quot;</span></span><br><span class="line">    <span class="keyword">operator</span> = Operator.ADD</span><br><span class="line">    onBefore &#123; </span><br><span class="line">        println(<span class="string">&quot;before <span class="variable">$source</span>&quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">expression(lambdaExpression)</span><br></pre></td></tr></table></figure>

<p>简化后借助 <code>Lambda argument should be moved out of parentheses</code>， 变为 </p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">expression &#123;</span><br><span class="line">    source = <span class="string">&quot;a&quot;</span></span><br><span class="line">    target = <span class="string">&quot;b&quot;</span></span><br><span class="line">    <span class="keyword">operator</span> = Operator.ADD</span><br><span class="line">    onBefore &#123; </span><br><span class="line">        println(<span class="string">&quot;before <span class="variable">$source</span>&quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是不是有DSL内味了</p>
<h2 id="kotlinx"><a href="#kotlinx" class="headerlink" title="kotlinx"></a>kotlinx</h2><blockquote>
<p><code>kotlinx.html</code> 是一个通过DSL构造HTML的kotlin扩展库。 </p>
</blockquote>
<p>本质上是通过kotlin定义好了一套htmlTag类。</p>
<p>DSL定义</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">html &#123;</span><br><span class="line">    head &#123;</span><br><span class="line">        script &#123;</span><br><span class="line">            src = <span class="string">&quot;https://code.jquery.com/jquery-3.5.1.slim.min.js&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    body &#123;</span><br><span class="line">        div &#123;</span><br><span class="line">            +<span class="string">&quot;Hello <span class="variable">$name</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成的HTML</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.5.1.slim.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello DSL<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在此基础上扩展并封装UI组件，达到简化开发成本的目的。比如</p>
<ul>
<li>封装bootstrap V4的header资源引用</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> HEAD.<span class="title">b4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    link &#123;</span><br><span class="line">        href = <span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;</span></span><br><span class="line">        rel = <span class="string">&quot;stylesheet&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    script &#123;</span><br><span class="line">        src = <span class="string">&quot;https://code.jquery.com/jquery-3.5.1.slim.min.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    script &#123;</span><br><span class="line">        src = <span class="string">&quot;https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    script &#123;</span><br><span class="line">        src = <span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>封装基于bootstrap4的dropdown</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> DIV.<span class="title">b4dropdown</span><span class="params">(btn: <span class="type">String</span>, block: <span class="type">DIV</span>.() -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    div(<span class="string">&quot;dropdown&quot;</span>) &#123;</span><br><span class="line">        a(<span class="string">&quot;#&quot;</span>) &#123;</span><br><span class="line">            classes = setOf(<span class="string">&quot;btn&quot;</span>, <span class="string">&quot;btn-secondary&quot;</span>, <span class="string">&quot;dropdown-toggle&quot;</span>)</span><br><span class="line">            role = <span class="string">&quot;button&quot;</span></span><br><span class="line">            attributes[<span class="string">&quot;aria-expanded&quot;</span>] = <span class="string">&quot;false&quot;</span></span><br><span class="line">            attributes[<span class="string">&quot;data-toggle&quot;</span>] = <span class="string">&quot;dropdown&quot;</span></span><br><span class="line">            +btn</span><br><span class="line">        &#125;</span><br><span class="line">        div(<span class="string">&quot;dropdown-menu&quot;</span>) &#123;</span><br><span class="line">            attributes[<span class="string">&quot;aria-labelledby&quot;</span>] = <span class="string">&quot;dropdownMenuLink&quot;</span></span><br><span class="line">            block()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> DIV.<span class="title">b4dropdownItem</span><span class="params">(content: <span class="type">String</span>, href: <span class="type">String</span>? = <span class="string">&quot;#&quot;</span>, target: <span class="type">String</span>? = <span class="literal">null</span>)</span></span> &#123;</span><br><span class="line">    a(href, target, <span class="string">&quot;dropdown-item&quot;</span>) &#123; +content &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>封装基于bootstrap4的table</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> HtmlBlockTag.<span class="title">b4table</span><span class="params">(headers: <span class="type">List</span>&lt;<span class="type">String</span>&gt;, rows: <span class="type">List</span>&lt;<span class="type">List</span>&lt;() -&gt; <span class="type">Unit</span>&gt;&gt;, showIndex: <span class="type">Boolean</span> = <span class="literal">false</span>)</span></span> &#123;</span><br><span class="line">    table(<span class="string">&quot;table&quot;</span>) &#123;</span><br><span class="line">        thead &#123;</span><br><span class="line">            tr &#123;</span><br><span class="line">                <span class="keyword">if</span> (showIndex) th(ThScope.col) &#123; +<span class="string">&quot;#&quot;</span> &#125;</span><br><span class="line">                headers.forEach &#123; th(ThScope.col) &#123; +it &#125; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        tbody &#123;</span><br><span class="line">            <span class="keyword">for</span> ((index, row) <span class="keyword">in</span> rows.withIndex()) &#123;</span><br><span class="line">                tr &#123;</span><br><span class="line">                    <span class="keyword">if</span> (showIndex) td &#123; +<span class="string">&quot;<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&quot;</span> &#125;</span><br><span class="line">                    row.forEach &#123; td &#123; it() &#125; &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>则View层代码为</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> dropdownList = arrayListOf(<span class="string">&quot;Action&quot;</span>, <span class="string">&quot;Another action&quot;</span>, <span class="string">&quot;Something else here&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> tableHeaders = arrayListOf(<span class="string">&quot;First&quot;</span>, <span class="string">&quot;Last&quot;</span>, <span class="string">&quot;Handle&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> tableRows = arrayListOf(</span><br><span class="line">        arrayListOf(<span class="string">&quot;Mark&quot;</span>, <span class="string">&quot;Otto&quot;</span>, <span class="string">&quot;@mdo&quot;</span>),</span><br><span class="line">        arrayListOf(<span class="string">&quot;Jacob&quot;</span>, <span class="string">&quot;Thornton&quot;</span>, <span class="string">&quot;@fat&quot;</span>),</span><br><span class="line">        arrayListOf(<span class="string">&quot;Larry&quot;</span>, <span class="string">&quot;the Bird&quot;</span>, <span class="string">&quot;@twitter&quot;</span>)</span><br><span class="line">)</span><br><span class="line">createHTML()</span><br><span class="line">        .html &#123;</span><br><span class="line">            head &#123;</span><br><span class="line">                b4()</span><br><span class="line">            &#125;</span><br><span class="line">            body &#123;</span><br><span class="line">                b4table(tableHeaders, tableRowsUnit, <span class="literal">false</span>)</span><br><span class="line">                div &#123;</span><br><span class="line">                    b4dropdown(<span class="string">&quot;Dropdown link&quot;</span>) &#123;</span><br><span class="line">                        dropdownList.forEach &#123; b4dropdownItem(it) &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>浏览器效果</p>
<p><img src="https://img.yuheng.wang/mweb/dsl_2.jpeg" alt="dsl_2"></p>
<p>通常table的最后一列为action列，所以table rows类型为<code>List&lt;List&lt;() -&gt; Unit&gt;&gt;</code>，可以传入html元素</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">createHTML()</span><br><span class="line">    .html &#123;</span><br><span class="line">        <span class="keyword">val</span> tableRowsUnit = tableRows.map &#123; r -&gt;</span><br><span class="line">            r.map &#123;</span><br><span class="line">                &#123; +it &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        head &#123;</span><br><span class="line">            b4()</span><br><span class="line">        &#125;</span><br><span class="line">        body &#123;</span><br><span class="line">            b4table(tableHeaders, tableRowsUnit, <span class="literal">false</span>)</span><br><span class="line">            div &#123;</span><br><span class="line">                b4dropdown(<span class="string">&quot;Dropdown link&quot;</span>) &#123;</span><br><span class="line">                    list.forEach &#123; b4dropdownItem(it) &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            div &#123;</span><br><span class="line">                b4table(</span><br><span class="line">                        tableHeaders.toList().plus(<span class="string">&quot;action&quot;</span>),</span><br><span class="line">                        tableRowsUnit.map &#123; r -&gt;</span><br><span class="line">                            r.plus &#123;</span><br><span class="line">                                ul &#123;</span><br><span class="line">                                    lia(<span class="string">&quot;#&quot;</span>) &#123; +<span class="string">&quot;Edit&quot;</span> &#125;</span><br><span class="line">                                    lia(<span class="string">&quot;#&quot;</span>) &#123; +<span class="string">&quot;Delete&quot;</span> &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="literal">true</span></span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="Javalin"><a href="#Javalin" class="headerlink" title="Javalin"></a>Javalin</h3><p>示例项目使用了<code>Javalin</code></p>
<blockquote>
<p>Javalin is more of a library than a framework. Some key points:</p>
</blockquote>
<ul>
<li>You don’t need to extend anything</li>
<li>There are no @Annotations</li>
<li>There is no reflection</li>
<li>There is no other magic; just code.</li>
</ul>
<p>想必你也听得出是在影射哪个框架</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ol>
<li>kotlinx.html可以作为jsp、FreeMarker这类模板方案的替代，优势是无需在两种语法之间切换。</li>
<li>如果没想清楚如何解决问题，那DSL不是一个好的选择</li>
</ol>
]]></content>
      <categories>
        <category>kotlin</category>
      </categories>
      <tags>
        <tag>kotlin</tag>
        <tag>DSL</tag>
        <tag>全栈</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlin使用GraalVM+Picocli开发原生命令行应用</title>
    <url>/2020/08/30/kotlin-graalvm-picocli/</url>
    <content><![CDATA[<p>为什么Java很少用于开发原生命令行(<strong>CLI</strong>)应用呢？</p>
<p>代码已开源： <a href="https://github.com/wangyuheng/ddl2plantuml">https://github.com/wangyuheng/ddl2plantuml</a></p>
<span id="more"></span>

<h1 id="Kotlin使用GraalVM-Picocli开发原生命令行应用"><a href="#Kotlin使用GraalVM-Picocli开发原生命令行应用" class="headerlink" title="Kotlin使用GraalVM+Picocli开发原生命令行应用"></a>Kotlin使用GraalVM+Picocli开发原生命令行应用</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>之前用<code>kotlin</code>开发过一款根据建表DDL语句生成plantuml ER图的应用。被问如何使用，答曰”给你一个jar包，然后执行<code>java -jar ddl2plantuml.jar ./ddl.sql ./er.puml</code> 就可以了。是不是so easy?”</p>
<p>结果被吐槽了一番，</p>
<ol>
<li>为什么不能像命令行应用一样提供相关帮助信息？</li>
<li>为什么是Java， 而不是一个原生命令行应用？</li>
</ol>
<p>这个吐槽带来了一个思考： 为什么Java很少用于开发原生命令行(<strong>CLI</strong>)应用呢？我认为主要问题有2个</p>
<ol>
<li>Java通过JVM实现跨平台。也就是说，如果要使用Java应用需要先安装JRE。</li>
<li>Java的优势在于JVM热点代码检测和运行时编译及优化，所以这是一门程序运行时间越长，速度越快的神奇语言。而付出的代价则是应用启动速度较慢。这与一次性启动运行的命令行应用的场景需求正相反。</li>
</ol>
<h2 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h2><p>为了解决上述问题，引入2个名词</p>
<ol>
<li><code>Picocli</code></li>
<li><code>GraalVM</code></li>
</ol>
<h3 id="Picocli"><a href="#Picocli" class="headerlink" title="Picocli"></a>Picocli</h3><blockquote>
<p>Picocli 致力于提供“最简便的方式来创建富命令行应用，这种应用可以在 JVM 上和 JVM 之外运行”</p>
</blockquote>
<p>使用起来非常简单</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> cmd = CommandLine(Convert())</span><br><span class="line">    <span class="keyword">when</span> &#123;</span><br><span class="line">        args.isEmpty() -&gt; &#123;</span><br><span class="line">            cmd.usage(System.<span class="keyword">out</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> exitCode = cmd.execute(*args)</span><br><span class="line">            exitProcess(exitCode)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CommandLine</span>.Command(name = <span class="string">&quot;ddl2plantuml&quot;</span>,</span><br><span class="line">        version = [<span class="string">&quot;软件名称：Ddl2plantuml\n版本：V1.1.0&quot;</span>],</span><br><span class="line">        description = [<span class="string">&quot;convert sql ddl to plantuml er&quot;</span>],</span><br><span class="line">        mixinStandardHelpOptions = <span class="literal">true</span></span><br><span class="line">)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Convert</span> : <span class="type">Callable</span>&lt;<span class="type">Int</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CommandLine</span>.Parameters(index = <span class="string">&quot;0&quot;</span>, description = [<span class="string">&quot;The sql ddl file that should be convert to plantuml er.&quot;</span>])</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> src: Path</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CommandLine</span>.Option(names = [<span class="string">&quot;-o&quot;</span>, <span class="string">&quot;--output&quot;</span>], description = [<span class="string">&quot;The file where the plantuml file to be saved. default is console &quot;</span>])</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> target: Path? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">call</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        require(src.toFile().exists()) &#123; <span class="string">&quot;ddl file must be existed!&quot;</span> &#125;</span><br><span class="line">        <span class="keyword">when</span> (target) &#123;</span><br><span class="line">            <span class="literal">null</span> -&gt; &#123;</span><br><span class="line">                FileReader(src).read()</span><br><span class="line">                        .apply &#123; ConsoleWriter(<span class="keyword">this</span>).write() &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                FileReader(src).read()</span><br><span class="line">                        .apply &#123; FileWriter(target!!, <span class="keyword">this</span>).write() &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src="https://img.yuheng.wang/mweb/15983652142253.jpg" alt="kgp-00"></p>
<p>这里介绍用到的几个注解及概念</p>
<ul>
<li><code>@Parameters</code> 和 <code>@Options</code> 都是用来定义参数，区别在于 <code>@Parameters</code>根据位置区分，而<code>@Options</code>可以指定名称</li>
</ul>
<p><img src="https://img.yuheng.wang/mweb/15987745425601.jpg" alt="kgp-01"></p>
<ul>
<li>退出码。<code>call()</code>方法返回的0表示退出码，用来描述命令行应用的执行结果。通常用0表示成功，其他数字为自定义异常。退出码不会影响程序的执行，但是有一个很实用的功能是当你通过连接的方式同时执行多个应用时，一个非零的退出码会中断这个组合。如： <code>./ddl2plantuml_mac ddl.sql |grep &quot;table&quot;</code></li>
<li>版本及帮助信息。可以自定义并指定样式，version可以通过<code>versionProvider</code>自定义生成。</li>
</ul>
<h3 id="GraalVM"><a href="#GraalVM" class="headerlink" title="GraalVM"></a>GraalVM</h3><p><code>Go</code>的一个宣传点是可以将程序编译为一个静态可执行文件，而Java也可以通过<code>GraalVM</code>做到这一点</p>
<blockquote>
<p>GraalVM: Run Programs Faster Anywhere </p>
</blockquote>
<p>这个slogan和Java的”Write Once, Run Anywhere”遥相呼应，同时又展示了极大的野心，准备带来下一个20年的辉煌。</p>
<blockquote>
<p>GraalVM 是一个高性能的通用虚拟机，可以运行使用 JavaScript，Python 3，Ruby，R，基于 JVM 的语言以及基于 LLVM 的语言开发的应用。 GraalVM 消除了编程语言之间的隔离性，并且通过共享运行时增强了他们的互操作性。它可以独立运行，也可以运行在 OpenJDK，Node.js，Oracle，MySQL 等环境中。</p>
</blockquote>
<p>可以看到<code>GraalVM</code>提供了非常强大的功能，这里我们不做展开介绍，只看如何解决我们遇到的问题。主要用到了2个功能特性</p>
<ol>
<li>即时编译，提升程序启动速度</li>
<li>Native Image，将应用编译为单个静态可执行文件</li>
</ol>
<p>使用方式</p>
<ol>
<li>安装GraalVM</li>
<li>安装 native-image 工具 <code>gu install native-image</code></li>
<li>编译应用 <code>native-image -jar target/ddl2plantuml-1.1.0.jar ddl2plantuml</code></li>
</ol>
<p>编译后的native image不运行在Java VM上，但是包含了必要的组件，如内存管理和线程调度，这些组件来自另一个<code>Substrate VM</code>。这个过程称为<em>提前编译</em></p>
<p>此时我们已经得到了一个可以直接执行的原生命令行应用</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./ddl2plantuml_mac ddl.sql </span><br></pre></td></tr></table></figure>
<p>注意:</p>
<p>native image不支持Java的所有特性，尤其是对<code>reflection</code>的限制。在这次改造过程中，原来通过阿里的<code>druid</code>进行sql解析，但是<code>druid</code>使用了大量的<code>reflection</code>导致native image编译失败，所以改用<code>jsqlparser</code>。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>Picocli提供了maven插件<code>native-image-maven-plugin</code>，用于编译阶段进行native image构建。但是建议分离开发和构建，在<code>CICD</code>中执行构建过程，可以节省开发时间，并构建不同平台的应用，解决开发环境局限</li>
<li>除了构建命令行应用，GraalVM也带来了更多的可能性，比如Java在<code>FAAS</code>中的应用。</li>
</ol>
]]></content>
      <categories>
        <category>GraalVM</category>
      </categories>
      <tags>
        <tag>kotlin</tag>
        <tag>GraalVM</tag>
        <tag>Picocli</tag>
      </tags>
  </entry>
  <entry>
    <title>如何骗你的测试女朋友用java写测试用例</title>
    <url>/2020/09/19/kotlin-test-case/</url>
    <content><![CDATA[<p>首先你要有个女朋友</p>
<span id="more"></span>

<p>其次要回答3个灵魂拷问</p>
<ol>
<li>使用成本</li>
<li>能节省什么</li>
<li>能带来什么</li>
</ol>
<p>最好是感知不到是在写代码。</p>
<h2 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h2><p>上篇《距离全栈 你只差一个kotlinx》聊到了<br><code>Kotlin</code> 借助 <code>Lambda</code> + <code>Extensions扩展</code> 来实现内部DSL，这次展开聊聊<code>扩展</code>和<code>操作符重载</code>是如何让你的代码不像代码的。</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><blockquote>
<p>Kotlin 可以对一个类的属性和方法进行扩展，且不需要继承或使用 Decorator 模式。<br>扩展是一种静态行为，对被扩展的类代码本身不会造成任何影响。</p>
</blockquote>
<h4 id="扩展方法"><a href="#扩展方法" class="headerlink" title="扩展方法"></a>扩展方法</h4><p>如果我希望对一个已有类增加一个方法，就可以直接给这个类增加扩展方法，同时所有的对象都可以调用这个扩展方法。</p>
<p>举例说明</p>
<p><img src="https://img.yuheng.wang/mweb/16004804290505.jpg"></p>
<h4 id="扩展属性"><a href="#扩展属性" class="headerlink" title="扩展属性"></a>扩展属性</h4><p>扩展属性与成员变量不同，因为扩展不会真的在类中插入一个成员变量。因此扩展属性不能初始化，只能通过getter方法定义</p>
<p><img src="https://img.yuheng.wang/mweb/16004811548487.jpg"></p>
<h3 id="操作符重载"><a href="#操作符重载" class="headerlink" title="操作符重载"></a>操作符重载</h3><blockquote>
<p>Kotlin允许我们为自己的类型提供预定义的一组操作符实现（这些操作符都对应的成员函数或扩展函数），他们是一一对应的</p>
</blockquote>
<h4 id="算术运算符operator"><a href="#算术运算符operator" class="headerlink" title="算术运算符operator"></a>算术运算符operator</h4><p>基本类型中，<code>Int + Int</code> 表示数字相加， <code>String + String</code> 则代表了字符串拼接，那么如果是 <code>ArrayList&lt;String&gt; + String</code> 呢？ </p>
<p>kotlin中重载了Collection的算术运算符，其中 <code>plus</code> 对应了 <code>+</code>的操作函数。所以 <code>ArrayList&lt;String&gt; + String</code> 会把 <code>String</code> 添加到<code>ArrayList&lt;String&gt;</code>集合中</p>
<p><img src="https://img.yuheng.wang/mweb/16004818492818.jpg"></p>
<p>我们也可以自定义<code>+</code>的重载，比如将<code>String</code>拼接到<code>ArrayList&lt;String&gt;</code>每个元素的末尾</p>
<p><img src="https://img.yuheng.wang/mweb/16004822147992.jpg"></p>
<p>看起来和扩展函数有些类似，我们继续放飞</p>
<h4 id="中缀表示法infix"><a href="#中缀表示法infix" class="headerlink" title="中缀表示法infix"></a>中缀表示法infix</h4><blockquote>
<p>标有 infix 关键字的函数也可以使用中缀表示法（忽略该调用的点与圆括号）调用。中缀函数必须满足以下要求：</p>
<ul>
<li>它们必须是成员函数或扩展函数；</li>
<li>它们必须只有一个参数；</li>
<li>其参数不得接受可变数量的参数且不能有默认值。</li>
</ul>
</blockquote>
<p>通过这种表示方法，我们的代码逻辑可以变成陈述句</p>
<p><img src="https://img.yuheng.wang/mweb/16004827954027.jpg"></p>
<p>并且有IDE的高亮及语法提示支持</p>
<p><img src="https://img.yuheng.wang/mweb/16004823921268.jpg"></p>
<p>这条用例的代码元素还有2个，<code>JUnit</code> + <code>fun</code></p>
<h4 id="调用操作符invoke"><a href="#调用操作符invoke" class="headerlink" title="调用操作符invoke"></a>调用操作符invoke</h4><p>调用操作符<br>圆括号转换为调用带有适当数量参数的 invoke。</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>翻译为</th>
</tr>
</thead>
<tbody><tr>
<td>a()</td>
<td>a.invoke()</td>
</tr>
<tr>
<td>a(i)</td>
<td>a.invoke(i)</td>
</tr>
<tr>
<td>a(i, j)</td>
<td>a.invoke(i, j)</td>
</tr>
<tr>
<td>a(i_1, ……, i_n)</td>
<td>a.invoke(i_1, ……, i_n)</td>
</tr>
</tbody></table>
<p>我们可以通过重载<code>invoke</code>的方法移除<code>fun</code>的概念，变成 <code>标题 &#123;内容&#125;</code>的格式进行触发函数。 而<code>JUnit</code>可以通过父类完成TestCase的注册</p>
<p><img src="https://img.yuheng.wang/mweb/16004853041475.jpg"></p>
<h3 id="kotest"><a href="#kotest" class="headerlink" title="kotest"></a>kotest</h3><blockquote>
<p>Kotest is a flexible and comprehensive testing project for Kotlin with multiplatform support.</p>
</blockquote>
<p>TestCase的注册，以及如何在idea中运行某个测试方法比较复杂，我们可以直接使用<code>Kotest</code>及其插件完成。而<code>Kotest</code>的实现原理就是上文提到的<strong>扩展</strong>以及<strong>操作符重载</strong></p>
<p><img src="https://img.yuheng.wang/mweb/16004853756591.jpg"></p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><p>看一下是否能回答上述灵魂拷问</p>
<h3 id="1-使用成本"><a href="#1-使用成本" class="headerlink" title="1. 使用成本"></a>1. 使用成本</h3><ol>
<li>通过IDE约束及提示，简化编写成本</li>
<li>增加了额外的约束。但是从DDD的过程来看，统一语言在团队协作方面有着重要地位。命名表明了你对事物的理解，所以团队内统一描述语言是很有必要的</li>
</ol>
<h3 id="2-能节省什么"><a href="#2-能节省什么" class="headerlink" title="2. 能节省什么"></a>2. 能节省什么</h3><ol>
<li>通过代码和工具函数的封装，可以简化重复操</li>
<li>可以直接调用开发代码方法及接口</li>
<li>通过封装简化接口自动化成本</li>
</ol>
<p><img src="https://img.yuheng.wang/mweb/16004955502372.jpg"></p>
<p>如果看不懂这个语法，可以看上一篇的DSL</p>
<h3 id="3-能带来什么"><a href="#3-能带来什么" class="headerlink" title="3. 能带来什么"></a>3. 能带来什么</h3><ol>
<li>配合CICD在潜移默化中完成自动化测试并输出测试报告</li>
<li>借助代码管理工具(gitlab、github)，完成统计、review、操作留痕、版本等管理操作</li>
</ol>
<p><img src="https://img.yuheng.wang/mweb/16004949316841.jpg"><br><img src="https://img.yuheng.wang/mweb/16004949394397.jpg"></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ol>
<li>为什么标题说java，内容都是kotlin? 因为这篇是标题党</li>
<li>使用扩展or重载时，一定要明确<strong>函数作用域</strong></li>
<li>为什么要做扩展和操作符重载？ <strong>Because I can</strong></li>
</ol>
]]></content>
      <categories>
        <category>kotlin</category>
      </categories>
      <tags>
        <tag>junit</tag>
        <tag>kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>linux通过rpm安装jdk</title>
    <url>/2016/09/02/linux-jdk-starter/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>linux安装java环境，安装jdk1.8。</p>
<h2 id="查看java程序是否存在"><a href="#查看java程序是否存在" class="headerlink" title="查看java程序是否存在"></a>查看java程序是否存在</h2><pre><code>java -version
rpm -qa |grep java
rpm -qa |grep jdk
rpm -qa |grep gcj
</code></pre>
<p>如果java已存在，可以卸载已存在的版本</p>
<pre><code>rpm -qa | grep java | xargs rpm -e --nodeps
</code></pre>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="下载java仓库rpm"><a href="#下载java仓库rpm" class="headerlink" title="下载java仓库rpm"></a>下载java仓库rpm</h3><p>在oracle官网 <a href="http://www.oracle.com/technetwork/java/javase/downloads">http://www.oracle.com/technetwork/java/javase/downloads</a> 找到rpm安装包下载地址，选择版本为jdk1.8 linux 64位。因为协议限制，不能通过wget直接下载，需要增加协议设置语句。<br>需要根据本机的操作系统版本，选择对应的jdk版本。如果32位系统，安装64位jdk会提示</p>
<p><strong>package jdk1.8.0_102-2000:1.8.0_102-fcs.x86_64 is intended for a x86_64 architecture</strong></p>
<pre><code>wget --no-check-certificate --no-cookie --header &quot;Cookie: oraclelicense=accept-securebackup-cookie;&quot;  http://download.oracle.com/otn-pub/java/jdk/8u102-b14/jdk-8u102-linux-x64.rpm
</code></pre>
<h3 id="安装仓库"><a href="#安装仓库" class="headerlink" title="安装仓库"></a>安装仓库</h3><pre><code>sudo rpm -Uvh jdk-8u102-linux-x64.rpm
</code></pre>
<p>也可以手动配置repo，此时不需要下载rpm文件。</p>
<h3 id="查看是否安装成功"><a href="#查看是否安装成功" class="headerlink" title="查看是否安装成功"></a>查看是否安装成功</h3><pre><code>java -version
</code></pre>
<p>rpm省掉了配置JAVA_HOME的过程。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>linux安装maven(非yum)</title>
    <url>/2016/09/01/linux-maven-starter/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>通过yum安装maven，发现需要依赖jdk，希望通过绿色方式安装。</p>
<h3 id="下载maven"><a href="#下载maven" class="headerlink" title="下载maven"></a>下载maven</h3><p>在官网下载Binary tar.gz archive版本</p>
<pre><code>wget http://mirrors.hust.edu.cn/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
</code></pre>
<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><pre><code>tar -zxvf apache-maven-3.3.9-bin.tar.gz
</code></pre>
<h3 id="将目录移动到local"><a href="#将目录移动到local" class="headerlink" title="将目录移动到local"></a>将目录移动到local</h3><pre><code>mv apache-maven-3.3.9 /usr/local/apache-maven
</code></pre>
<h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><pre><code>export M2_HOME=/usr/local/apache-maven
export M2=$M2_HOME/bin 
export PATH=$M2:$PATH
source ~/.bashrc
</code></pre>
<h3 id="查看是否安装成功"><a href="#查看是否安装成功" class="headerlink" title="查看是否安装成功"></a>查看是否安装成功</h3><pre><code>mvn -version
</code></pre>
]]></content>
      <categories>
        <category>maven</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 通过yum方式安装MongoDB-3.2</title>
    <url>/2016/05/18/linux-mongodb/</url>
    <content><![CDATA[<p>工作需要，在虚拟机中安装了一个CentOS7的linux环境，用来测试MongoDB。记录一下MongoDB的安装和配置过程。</p>
<h3 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h3><p>安装过程通过yum方式，需要配置repo。</p>
<h4 id="配置repo"><a href="#配置repo" class="headerlink" title="配置repo"></a>配置repo</h4><pre><code>vi /etc/yum.repos.d/mongodb-org-3.2.repo
</code></pre>
<p>通过命令打开文档，输入如下内容</p>
<pre><code>[mongodb-org-3.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-3.2.asc
</code></pre>
<h4 id="执行yum安装"><a href="#执行yum安装" class="headerlink" title="执行yum安装"></a>执行yum安装</h4><pre><code>sudo yum install -y mongodb-org
</code></pre>
<h4 id="设置mongodb监听端口"><a href="#设置mongodb监听端口" class="headerlink" title="设置mongodb监听端口"></a>设置mongodb监听端口</h4><pre><code>semanage port -a -t mongod_port_t -p tcp 27017
</code></pre>
<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><pre><code>sudo service mongod start
</code></pre>
<h4 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h4><pre><code>chkconfig mongod on
</code></pre>
<p>此时会看到服务启动成功的提示 【OK】</p>
<h3 id="开发调试"><a href="#开发调试" class="headerlink" title="开发调试"></a>开发调试</h3><p>在虚拟机中安装好环境后，如何用本机环境进行开发访问？<br>本机为windows环境并没有安装mongodb客户端程序，无法通过命令行直接访问，全部依赖于java代码访问。<br>此时有个问题，mongodb安装完成后，默认只监听本机ip(localhost)，必须要修改绑定</p>
<h4 id="查看本机ip"><a href="#查看本机ip" class="headerlink" title="查看本机ip"></a>查看本机ip</h4><p>为了让mongodb监听虚拟机的ip(局域网内ip)，必须先将虚拟机的网络连接环境设置为桥接。通过命令查看</p>
<pre><code>ifconfig
</code></pre>
<p>注：因为我的安装镜像为mini.iso，默认并没有安装网络工具，此时可能会报错<br>ifconfig command not found，需要先安装此工具集</p>
<pre><code>yum install net-tools
</code></pre>
<h4 id="修改绑定监听IP"><a href="#修改绑定监听IP" class="headerlink" title="修改绑定监听IP"></a>修改绑定监听IP</h4><pre><code>vi /etc/mongod.conf
</code></pre>
<p>打开文档，并将bind_ip修改为ifconfig查看到的本地ip</p>
<h4 id="重启mongodb服务"><a href="#重启mongodb服务" class="headerlink" title="重启mongodb服务"></a>重启mongodb服务</h4><pre><code>sudo service mongod restart
</code></pre>
<h4 id="创建集合（数据库）"><a href="#创建集合（数据库）" class="headerlink" title="创建集合（数据库）"></a>创建集合（数据库）</h4><p>需要进入mongo后，才可以执行mongo相关命令。进入方式为执行如下命令。默认ip为127.0.0.1，因为修改过bind_ip，所以此处的ip地址为刚配置的bing_ip</p>
<pre><code>mongo ip地址
</code></pre>
<p>创建集合</p>
<pre><code>use zero
</code></pre>
<h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><p>mongodb默认为允许匿名用户访问，可以通过以下命令添加此集合的管理员账户</p>
<pre><code>db.createUser(&#123;user:&#39;zero_admin&#39;,pwd:&#39;zero_123456&#39;,roles:[&#123;role:&#39;dbOwner&#39;,db:&#39;zero&#39;&#125;]&#125;) 
</code></pre>
<p>至此，已完成在虚拟机中搭建mongodb服务，并可在本机程序访问调试。下篇文章将介绍如何通过java程序连接mongodb</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 通过yum方式安装mysql5.7</title>
    <url>/2016/05/19/linux-mysql/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>在CentOS7环境下搭建mysql5.7数据库服务，强调一下版本号，因为安装过程中需要指定。</p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="下载mysql仓库rpm"><a href="#下载mysql仓库rpm" class="headerlink" title="下载mysql仓库rpm"></a>下载mysql仓库rpm</h3><pre><code>wget http://repo.mysql.com//mysql57-community-release-el7-8.noarch.rpm
</code></pre>
<h3 id="安装仓库"><a href="#安装仓库" class="headerlink" title="安装仓库"></a>安装仓库</h3><pre><code>sudo rpm -Uvh /mysql57-community-release-el7-8.noarch.rpm
</code></pre>
<p>也可以手动配置repo，此时不需要下载rpm文件。</p>
<h3 id="配置仓库"><a href="#配置仓库" class="headerlink" title="配置仓库"></a>配置仓库</h3><pre><code>vi /etc/yum.repos.d/mysql-community.repo 
</code></pre>
<p>通过命令打开文档，输入如下内容</p>
<blockquote>
<p>[mysql57-community]<br>name=MySQL 5.7 Community Server<br>baseurl=<a href="http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/">http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/</a><br>enabled=1<br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</p>
</blockquote>
<p>注意baseurl中的版本号需要与当前系统环境一致。如/el/7中的7与系统centOS7版本一致。</p>
<h3 id="查看可用软件源"><a href="#查看可用软件源" class="headerlink" title="查看可用软件源"></a>查看可用软件源</h3><pre><code>yum repolist enabled | grep mysql
</code></pre>
<h3 id="执行yum安装"><a href="#执行yum安装" class="headerlink" title="执行yum安装"></a>执行yum安装</h3><pre><code>yum install mysql-community-server 
</code></pre>
<h3 id="启动mysql服务"><a href="#启动mysql服务" class="headerlink" title="启动mysql服务"></a>启动mysql服务</h3><pre><code>service mysqld start
</code></pre>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="查询root密码"><a href="#查询root密码" class="headerlink" title="查询root密码"></a>查询root密码</h3><p>密码由mysql自动生成，可以在log文件中查看。</p>
<pre><code>sudo grep &#39;temporary password&#39; /var/log/mysqld.log
</code></pre>
<h3 id="登陆mysql"><a href="#登陆mysql" class="headerlink" title="登陆mysql"></a>登陆mysql</h3><pre><code>mysql -uroot -p上步获取的密码
</code></pre>
<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><pre><code>登陆成功后，不能执行操作，需要先修改密码。犹豫安全策略，新设置的密码必须包含大小写字母，数字以及符号。

ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;MyNewPass4!&#39;; 
</code></pre>
<h3 id="修改访问权限"><a href="#修改访问权限" class="headerlink" title="修改访问权限"></a>修改访问权限</h3><p>此时的数据库只能本机访问，通过修改表的方式将权限开放给全部用户。</p>
<pre><code>mysql -uroot -pMyNewPass4!

use mysql;

update user set Host = &#39;%&#39; where User=&#39;root&#39;;
</code></pre>
<p>注意，修改表后，必须重启mysql服务，修改才能生效。</p>
<pre><code>service mysqld restart;
</code></pre>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS通过yum安装nginx</title>
    <url>/2016/09/01/linux-nginx-starter/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>在CentOS环境下搭建一个nginx的服务器，安装过程比较简单，做一个简单的记录。</p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="配置repo"><a href="#配置repo" class="headerlink" title="配置repo"></a>配置repo</h3><pre><code>vi /etc/yum.repos.d/nginx.repo 
</code></pre>
<p>通过命令打开文档，输入如下内容</p>
<pre><code>[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/7/$basearch/
gpgcheck=0
enabled=1
</code></pre>
<p>其中centos表明当前系统，7表示系统版本。</p>
<h3 id="执行yum安装"><a href="#执行yum安装" class="headerlink" title="执行yum安装"></a>执行yum安装</h3><pre><code>sudo yum install -y nginx
</code></pre>
<p>安装程序执行完毕后，可以通过</p>
<pre><code>nginx -v
</code></pre>
<p>查看安装nginx版本，并确认程序安装成功。</p>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><pre><code>service nginx start 
</code></pre>
<p>此时会提示 Redirecting to /bin/systemctl start  nginx.service<br>因为在centos7中将service 和 chkconfig 命令合并到systemctl中，但仍可通过service启动nginx服务。<br>此时通过浏览器访问<a href="http://localhost,可以看到nginx启动成功的提示./">http://localhost，可以看到nginx启动成功的提示。</a></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="修改服务目录"><a href="#修改服务目录" class="headerlink" title="修改服务目录"></a>修改服务目录</h3><pre><code>vi /etc/nginx/conf.d/default.conf
</code></pre>
<p>listen 80; 表示监听80端口<br>server_name localhost;表示域名或ip，可以以此搭建反向代理服务器，实现负载均衡。这个后续会有文档单独写。<br>location / {} root表示指向的静态文件目录路径，index表示首页文件，可以自定义修改root目录， 或者直接修改默认目录下的首页文件 /usr/share/nginx/www/index.html<br>重启nginx服务</p>
<pre><code>service nginx restart
</code></pre>
<p>刷新浏览器，可以看见修改以生效。</p>
]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 通过yum方式安装Nginx</title>
    <url>/2016/05/19/linux-nginx/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>在CentOS环境下搭建一个nginx的服务器，安装过程比较简单，做一个简单的记录。</p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="配置repo"><a href="#配置repo" class="headerlink" title="配置repo"></a>配置repo</h3><pre><code>vi /etc/yum.repos.d/nginx.repo 
</code></pre>
<p>通过命令打开文档，输入如下内容</p>
<blockquote>
<p>[nginx]<br>name=nginx repo<br>baseurl=<a href="http://nginx.org/packages/centos/7/$basearch/">http://nginx.org/packages/centos/7/$basearch/</a><br>gpgcheck=0<br>enabled=1</p>
</blockquote>
<p>其中centos表明当前系统，7表示系统版本。</p>
<h3 id="执行yum安装"><a href="#执行yum安装" class="headerlink" title="执行yum安装"></a>执行yum安装</h3><pre><code>sudo yum install -y nginx
</code></pre>
<p>安装程序执行完毕后，可以通过</p>
<pre><code>nginx -v
</code></pre>
<p>查看安装nginx版本，并确认程序安装成功。</p>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><pre><code>service nginx start 
</code></pre>
<p>此时会提示 Redirecting to /bin/systemctl start  nginx.service<br>因为在centos7中将service 和 chkconfig 命令合并到systemctl中，但仍可通过service启动nginx服务。<br>此时通过浏览器访问<a href="http://localhost,可以看到nginx启动成功的提示./">http://localhost，可以看到nginx启动成功的提示。</a></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="修改服务目录"><a href="#修改服务目录" class="headerlink" title="修改服务目录"></a>修改服务目录</h3><pre><code>vi /etc/nginx/conf.d/default.conf
</code></pre>
<p>listen 80; 表示监听80端口<br>server_name localhost;表示域名或ip，可以以此搭建反向代理服务器，实现负载均衡。这个后续会有文档单独写。<br>location / {} root表示指向的静态文件目录路径，index表示首页文件，可以自定义修改root目录， 或者直接修改默认目录下的首页文件 /usr/share/nginx/www/index.html<br>重启nginx服务</p>
<pre><code>service nginx restart
</code></pre>
<p>刷新浏览器，可以看见修改以生效。</p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>linux tomcat starter</title>
    <url>/2016/09/02/linux-tomcat-starter/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h2 id="CentOs7-2-运行tomcat"><a href="#CentOs7-2-运行tomcat" class="headerlink" title="CentOs7.2 运行tomcat"></a>CentOs7.2 运行tomcat</h2><h3 id="下载tomcat"><a href="#下载tomcat" class="headerlink" title="下载tomcat"></a>下载tomcat</h3><p>下载Binary Distributions Core版本</p>
<pre><code>wget http://apache.fayea.com/tomcat/tomcat-9/v9.0.0.M9/bin/apache-tomcat-9.0.0.M9.tar.gz
</code></pre>
<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><pre><code>tar -zxvf apache-tomcat-9.0.0.M9.tar.gz
</code></pre>
<h3 id="启动tomcat"><a href="#启动tomcat" class="headerlink" title="启动tomcat"></a>启动tomcat</h3><p>在apache-tomcat-9.0.0.M9的bin目录下执行</p>
<pre><code>sh start.sh
</code></pre>
<h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><p>centos 7</p>
<p>停止</p>
<pre><code>systemctl stop firewalld.service 
</code></pre>
<p>禁用</p>
<pre><code>systemctl disable firewalld.service 
</code></pre>
<p>之前的版本</p>
<p>停止</p>
<pre><code>service iptables stop
</code></pre>
<p>禁用</p>
<pre><code>chkconfig iptables off
</code></pre>
<p>通过浏览器访问http://服务器ip:8080 可以看到tomcat界面</p>
]]></content>
      <categories>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown入门学习</title>
    <url>/2015/12/14/markdown/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<blockquote>
<p>Markdown是一种可以使用普通文本编辑器编写的标记语言，通过简单的标记语法，它可以使普通文本内容具有一定的格式。</p>
</blockquote>
<h1 id="初识markdown"><a href="#初识markdown" class="headerlink" title="初识markdown"></a>初识markdown</h1><p>&#160; &#160; &#160; &#160;第一次接触markdown，用在blog的编辑器上，发现并没有传统的富文本支持，自己的代码格式又是一片混乱，然后发现了一句“支持markdown语法”。经过查找之后发现，markdown确实可以提供非常良好的写作体验。<br>markdown给我的第一感觉是类似于HTML语言，同样都是通过简单的标记实现样式显示，但是markdown要简单的多，并且通过普通的文本编辑器就可书写，也可以非常方便的进行移植。</p>
<h2 id="markdown优点"><a href="#markdown优点" class="headerlink" title="markdown优点"></a>markdown优点</h2><ul>
<li>纯文本实现，兼容各种文本编辑器，移植行好</li>
<li>标签简单，可读性好</li>
<li>插件众多，扩展性强</li>
<li>可导出为HTML、PDF等多种格式</li>
</ul>
<p>我最看重的一点是，对于blog而言，markdown能让我更专注于文字内容本身，而不用关心布局。这有助于让我摆脱网站布局和繁重的word。</p>
<hr>
<h1 id="学习markdown"><a href="#学习markdown" class="headerlink" title="学习markdown"></a>学习markdown</h1><p>markdown语言简单，容易记忆，只需了解一些常用的标记方式，就可实现文字的编辑工作。<br>(**注:**markdown的标准语言为：标签和文字内容之间要保留一个空格。)</p>
<h2 id="常用标记"><a href="#常用标记" class="headerlink" title="常用标记"></a>常用标记</h2><h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>将一句话作为文章的标题，只需在文字前加上**#**即可。<br>    # 一级标题<br>    ## 二级标题<br>    ### 三级标题<br>以此类推，markdown和HTML一样，也提供了6种不同大小的标题方式。</p>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>列表分为有序列表和无序列表两种：</p>
<p>无序列表只需在文字前加上**-<strong>或***</strong>，可混合使用，推荐使用**-**<br>    - 列表1<br>    * 列表2<br>    - 列表3</p>
<ul>
<li>列表1</li>
</ul>
<ul>
<li>列表2</li>
</ul>
<ul>
<li>列表3</li>
</ul>
<p>有序列表直接在文字前加上<strong>“1.”</strong> <strong>“2.”</strong>，可以全部输入数字<strong>“1.”</strong> ,markdown会自动实现排序<br>    1. 列表1<br>    1. 列表2<br>    1. 列表3</p>
<ol>
<li>列表1</li>
<li>列表2</li>
<li>列表3</li>
</ol>
<h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p>提供了非常方便的粗体和斜体格式规则 一个* 包含的文字为斜体， 两个*包含则为粗体</p>
<pre><code>*斜体格式*
</code></pre>
<p><em>斜体格式</em></p>
<pre><code>**粗体格式**
</code></pre>
<p><strong>粗体格式</strong></p>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>引用外部一段文字的语法非常简单，只需在文字前加上大于号**&gt;**<br>    &gt;这是一段引用的文字</p>
<blockquote>
<p>这是一段引用的文字</p>
</blockquote>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><pre><code>[链接](http://wangyuheng.github.io)
</code></pre>
<p><a href="http://wangyuheng.github.io/">链接</a></p>
<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><p>图片和链接的使用方式类似，差别在于图片需要前面加一个!<br><code>![](http://wangyuheng.github.io/images/searchicon.png)</code><br><img src="http://wangyuheng.github.io/images/searchicon.png"></p>
<h3 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h3><pre><code>| Tables        | Are           | Cool  |
| ------------- |:-------------:| -----:|
| col 3 is      | right-aligned | $1600 |
| col 2 is      | centered      |   $12 |
| zebra stripes | are neat      |    $1 |
</code></pre>
<table>
<thead>
<tr>
<th>Tables</th>
<th align="center">Are</th>
<th align="right">Cool</th>
</tr>
</thead>
<tbody><tr>
<td>col 3 is</td>
<td align="center">right-aligned</td>
<td align="right">$1600</td>
</tr>
<tr>
<td>col 2 is</td>
<td align="center">centered</td>
<td align="right">$12</td>
</tr>
<tr>
<td>zebra stripes</td>
<td align="center">are neat</td>
<td align="right">$1</td>
</tr>
</tbody></table>
<h3 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h3><p>分割线的语法很简单，只需要三个*****就可以，相当于HTML中的<br />，文本会另起一行<br>    ***</p>
<hr>
<h1 id="markdown相关软件"><a href="#markdown相关软件" class="headerlink" title="markdown相关软件"></a>markdown相关软件</h1><hr>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>通过上面的简单介绍，已经可以在提供了markdown的环境下，简单的使用这一写作神奇了。至于更高级的功能、软件，以及熟练程度，都需要在实际的使用过程中慢慢积累。<br>最后，祝您写作愉快！</p>
<hr>
<p><strong>Best regards</strong><br><strong>Wang Yuheng</strong></p>
]]></content>
      <categories>
        <category>通用基础</category>
      </categories>
      <tags>
        <tag>markdown</tag>
        <tag>写作</tag>
        <tag>文本编辑器</tag>
      </tags>
  </entry>
  <entry>
    <title>微服务之旅</title>
    <url>/2018/12/25/microservice-road/</url>
    <content><![CDATA[<p>记录我所经历的微服务架构变更过程。</p>
<h2 id="单体应用"><a href="#单体应用" class="headerlink" title="单体应用"></a>单体应用</h2><p>初期最常见的一种架构模式，采用单体架构，服务端和页面在一个war包项目中。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzNDZweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjMxMHB4O2hlaWdodDozNDZweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzMTAgMzQ2IiB3aWR0aD0iMzEwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tZW50aXR5IFVzZXItLT48ZyBpZD0iZWxlbV9Vc2VyIj48ZWxsaXBzZSBjeD0iMTU2IiBjeT0iMTQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE1NiwyMiBMMTU2LDQ5IE0xNDMsMzAgTDE2OSwzMCBNMTU2LDQ5IEwxNDMsNjQgTTE1Niw0OSBMMTY5LDY0ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzEiIHg9IjE0MC41IiB5PSI3OC40OTUxIj5Vc2VyPC90ZXh0PjwvZz48IS0tZW50aXR5IE9wZXJhdG9yLS0+PGcgaWQ9ImVsZW1fT3BlcmF0b3IiPjxlbGxpcHNlIGN4PSIyNTkiIGN5PSIxNCIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjU5LDIyIEwyNTksNDkgTTI0NiwzMCBMMjcyLDMwIE0yNTksNDkgTDI0Niw2NCBNMjU5LDQ5IEwyNzIsNjQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NiIgeD0iMjI2IiB5PSI3OC40OTUxIj5PcGVyYXRvcjwvdGV4dD48L2c+PCEtLWVudGl0eSBmcm9udC0tPjxnIGlkPSJlbGVtX2Zyb250Ij48cG9seWdvbiBmaWxsPSIjRkZBNTAwIiBwb2ludHM9IjEyMiwxNTIuNSwxMzIsMTQyLjUsMTkwLDE0Mi41LDE5MCwxNzguNzk2OSwxODAsMTg4Ljc5NjksMTIyLDE4OC43OTY5LDEyMiwxNTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTgwIiB4Mj0iMTkwIiB5MT0iMTUyLjUiIHkyPSIxNDIuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEyMiIgeDI9IjE4MCIgeTE9IjE1Mi41IiB5Mj0iMTUyLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxODAiIHgyPSIxODAiIHkxPSIxNTIuNSIgeTI9IjE4OC43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjEzNyIgeT0iMTc1LjQ5NTEiPiYjMjEwNjk7JiMyMTQ4ODs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgYmFjay0tPjxnIGlkPSJlbGVtX2JhY2siPjxwb2x5Z29uIGZpbGw9IiNGRkE1MDAiIHBvaW50cz0iMjI1LDE1Mi41LDIzNSwxNDIuNSwyOTMsMTQyLjUsMjkzLDE3OC43OTY5LDI4MywxODguNzk2OSwyMjUsMTg4Ljc5NjksMjI1LDE1Mi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyODMiIHgyPSIyOTMiIHkxPSIxNTIuNSIgeTI9IjE0Mi41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjI1IiB4Mj0iMjgzIiB5MT0iMTUyLjUiIHkyPSIxNTIuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI4MyIgeDI9IjI4MyIgeTE9IjE1Mi41IiB5Mj0iMTg4Ljc5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iMjQwIiB5PSIxNzUuNDk1MSI+JiMyMTUxODsmIzIxNDg4OzwvdGV4dD48L2c+PCEtLWVudGl0eSBkYi0tPjxnIGlkPSJlbGVtX2RiIj48cGF0aCBkPSJNMTY5LDI5MSBDMTY5LDI4MSAyMDAsMjgxIDIwMCwyODEgQzIwMCwyODEgMjMxLDI4MSAyMzEsMjkxIEwyMzEsMzE2LjI5NjkgQzIzMSwzMjYuMjk2OSAyMDAsMzI2LjI5NjkgMjAwLDMyNi4yOTY5IEMyMDAsMzI2LjI5NjkgMTY5LDMyNi4yOTY5IDE2OSwzMTYuMjk2OSBMMTY5LDI5MSAiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xNjksMjkxIEMxNjksMzAxIDIwMCwzMDEgMjAwLDMwMSBDMjAwLDMwMSAyMzEsMzAxIDIzMSwyOTEgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MiIgeD0iMTc5IiB5PSIzMTcuOTk1MSI+bXlzcWw8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQkktLT48ZyBpZD0iZWxlbV9CSSI+PGVsbGlwc2UgY3g9IjE5IiBjeT0iMjc0IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xOSwyODIgTDE5LDMwOSBNNiwyOTAgTDMyLDI5MCBNMTksMzA5IEw2LDMyNCBNMTksMzA5IEwzMiwzMjQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNCIgeD0iMTIiIHk9IjMzOC40OTUxIj5CSTwvdGV4dD48L2c+PCEtLWVudGl0eSBEVy0tPjxnIGlkPSJlbGVtX0RXIj48ZWxsaXBzZSBjeD0iODEiIGN5PSIyNzQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTgxLDI4MiBMODEsMzA5IE02OCwyOTAgTDk0LDI5MCBNODEsMzA5IEw2OCwzMjQgTTgxLDMwOSBMOTQsMzI0ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjUiIHg9IjY4LjUiIHk9IjMzOC40OTUxIj5EVzwvdGV4dD48L2c+PCEtLWxpbmsgVXNlciB0byBmcm9udC0tPjxnIGlkPSJsaW5rX1VzZXJfZnJvbnQiPjxwYXRoIGQ9Ik0xNTYsODEuODExIEMxNTYsMTAxLjYyNiAxNTYsMTE5LjMxMiAxNTYsMTM2LjI0NSAiIGZpbGw9Im5vbmUiIGlkPSJVc2VyLXRvLWZyb250IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE1NiwxNDIuMjQ1LDE2MCwxMzMuMjQ1LDE1NiwxMzcuMjQ1LDE1MiwxMzMuMjQ1LDE1NiwxNDIuMjQ1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgT3BlcmF0b3IgdG8gYmFjay0tPjxnIGlkPSJsaW5rX09wZXJhdG9yX2JhY2siPjxwYXRoIGQ9Ik0yNTksODEuODExIEMyNTksMTAxLjYyNiAyNTksMTE5LjMxMiAyNTksMTM2LjI0NSAiIGZpbGw9Im5vbmUiIGlkPSJPcGVyYXRvci10by1iYWNrIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1OSwxNDIuMjQ1LDI2MywxMzMuMjQ1LDI1OSwxMzcuMjQ1LDI1NSwxMzMuMjQ1LDI1OSwxNDIuMjQ1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZnJvbnQgdG8gZGItLT48ZyBpZD0ibGlua19mcm9udF9kYiI+PHBhdGggZD0iTTE2My4xNjcsMTg4LjY1MyBDMTcxLjM5OCwyMTQuMDk0IDE4Mi45NjcyLDI0OS44NTE0IDE5MS4xMzQyLDI3NS4wOTcyICIgZmlsbD0ibm9uZSIgaWQ9ImZyb250LXRvLWRiIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5Mi45ODEsMjgwLjgwNTksMTk0LjAxNjcsMjcxLjAxMTYsMTkxLjQ0MiwyNzYuMDQ4NiwxODYuNDA1LDI3My40NzQsMTkyLjk4MSwyODAuODA1OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGJhY2sgdG8gZGItLT48ZyBpZD0ibGlua19iYWNrX2RiIj48cGF0aCBkPSJNMjQ5LjM4OSwxODguNjUzIEMyMzguMzUzLDIxNC4wOTQgMjIyLjc1MjEsMjUwLjA1NTggMjExLjc5OTEsMjc1LjMwMTYgIiBmaWxsPSJub25lIiBpZD0iYmFjay10by1kYiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDkuNDExLDI4MC44MDU5LDIxNi42NjI2LDI3NC4xNDE1LDIxMS40MDEsMjc2LjIxOSwyMDkuMzIzNiwyNzAuOTU3NCwyMDkuNDExLDI4MC44MDU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBCSSB0byBkYi0tPjxnIGlkPSJsaW5rX0JJX2RiIj48cGF0aCBkPSJNMzEuNDc5MywyNTkuODgyOSBDMzcuMDk0MSwyNDYuNDU3IDQzLjI4NzgsMjM4LjMwOSA1NiwyMzAuNSBDNzEuMTQ4MiwyMjEuMTk1IDc5LjA0ODEsMjI1LjE0NCA5NiwyMzAuNSBDMTI3LjEzMSwyNDAuMzM1IDE1Ny4wMjcsMjYzLjE5NzMgMTc2LjcxLDI4MC43MzY1ICIgZmlsbD0ibm9uZSIgaWQ9IkJJLWJhY2t0by1kYiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyOS4xNjQzLDI2NS40MTgzLDM2LjMyNywyNTguNjU4NSwzMS4wOTM0LDI2MC44MDU0LDI4Ljk0NjQsMjU1LjU3MTksMjkuMTY0MywyNjUuNDE4MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzgiIHg9IjU3IiB5PSIyMzEuNTY2OSI+YmlubG9nPC90ZXh0PjwvZz48IS0tcmV2ZXJzZSBsaW5rIERXIHRvIGRiLS0+PGcgaWQ9ImxpbmtfRFdfZGIiPjxwYXRoIGQ9Ik0xMDAuNjUwOCwzMDMuNSBDMTE4LjU5OSwzMDMuNSAxNDQuNjcyLDMwMy41IDE2OC43MjksMzAzLjUgIiBmaWxsPSJub25lIiBpZD0iRFctYmFja3RvLWRiIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk0LjY1MDgsMzAzLjUsMTAzLjY1MDgsMzA3LjUsOTkuNjUwOCwzMDMuNSwxMDMuNjUwOCwyOTkuNSw5NC42NTA4LDMwMy41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOCIgeD0iMTEyLjc1IiB5PSIyOTYuNTY2OSI+YmlubG9nPC90ZXh0PjwvZz48IS0tU1JDPVtJcW1rb0l6STIyckVCVTlBMTNGejJyQUI0ZTRDQmd3eV85SEsxUU1kZFJyRi1wU2VBSUdNQXdHTHZVVUxBMlpkNW9OY2ZRVjJmMlZxbVFJSjRmRXB1UjlTQU9hYllLYzluUWFBa1BONVhKYVctUEdhQll3R0hHZ3dBVmRiVVJmczRGRXVPMVIyWEs3Y1M3NTFCOEU5MFZNMlpLVllHenRodjBiYms4SHBTSmJ2QWpaZTBZTWo1OThveXRCb3F4YlNtYjQ1MDAwMF0tLT48L2c+PC9zdmc+'>

<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>上线最快，用于验证业务模式</p>
<h3 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h3><ol>
<li>页面通过jsp、velocity等服务端渲染，开发成本大，效率低。 e.g. java开发将html修改为jsp时产生布局样式偏差错误</li>
<li>前后台同时操作同一个DB表</li>
<li>DW和BI订阅业务表，业务端暴露了存储结构并耦合</li>
<li>发生任何变动，需要整体部署</li>
</ol>
<h2 id="初探微服务"><a href="#初探微服务" class="headerlink" title="初探微服务"></a>初探微服务</h2><p>在业务深耕的过程中，单体应用已经难以应付业务复杂度和数据量。多需求同时迭代，在分支合并时总是带来意想不到的问题。而高耦合的应用导致，前端页面的变更，也需要所有服务发布。架构师为了救我们于水火之中，给我们带来了微服务。概括来讲，就是<strong>拆</strong>！</p>
<ol>
<li>服务端拆分，业务按db结构拆分为不同的微服务，上层产品服务调用微服务，负责聚合编排。</li>
<li>前后端分离，nodejs替换服务端渲染，负责页面展示、路由及登陆鉴权。</li>
</ol>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI4NjNweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjY4NnB4O2hlaWdodDo4NjNweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2ODYgODYzIiB3aWR0aD0iNjg2cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciA/Py0tPjxnIGlkPSJjbHVzdGVyXyYjMjEwNjk7JiMzMTQ3MTsiPjxwYXRoIGQ9Ik0yNjYuOTc2NywxMzguMTE5NCBDMjcxLjcxOTMsMTMwLjE4MjUgMjgwLjU3MDMsMTI4LjQwNyAyODUuNDcsMTM3Ljk1MzEgQzI5MS42NzksMTI3LjY4NiAzMDAuOTEyMiwxMjYuNTM5OCAzMDguNTMzOCwxMzYuMzI4OCBDMzE1LjAzODIsMTI5LjAzMDMgMzIxLjM2MjcsMTI2LjcxNDYgMzI3LjEwNTQsMTM3LjEyNzUgQzMzNC4wNDMzLDEyNS42MTQxIDM0MS43MTM5LDEyNi4wNTA4IDM0OC45MDEzLDEzNi44ODQyIEMzNTQuMjQxNSwxMjUuNTAyMyAzNjAuNzMzNSwxMjYuMjY2NyAzNjguODE4MSwxMzQuMDI5MSBDMzc0LjIxNTUsMTI3LjI3MSAzODIuMjExLDEyNy45NzkgMzg2LjE4MywxMzUuNzM0NSBDMzkxLjM1MzEsMTI1LjE4MTggNDAwLjM0NTcsMTI1LjYwODIgNDA2LjQ5MzMsMTM0LjcyNTEgQzQxMy43NTkzLDEyNC4xMzA1IDQyMy4wMjE1LDEyNS4zMDkyIDQyOS4yMzk3LDEzNS44NTI1IEM0MzUuMjgxOSwxMjcuMjQxNSA0NDMuNDkwMSwxMjguNzUzIDQ0OC41MzU2LDEzNi45OTM5IEM0NTQuNDEwOSwxMjcuMjE2NSA0NjEuNzM1NywxMjguMjg5MiA0NjcuMjEwNywxMzcuMzg5OSBDNDc0LjIzMzEsMTI2Ljk2NDkgNDgyLjE0MjIsMTI1LjQ1MjEgNDg5LjY4MTQsMTM2Ljg1ODEgQzQ5Ni4xMjI2LDEyOC42MDk4IDUwMi42OTYyLDEyOC42MTE1IDUwNy43MjksMTM4LjI3NjkgQzUxMy44NDQyLDEyNy40MzYxIDUyNC44NTQzLDEyOS40MjMyIDUzMC4wNCwxMzkuMjc4OCBDNTM2LjEwMiwxMzEuODA1OSA1NDEuMzQzMSwxMzAuMjEyMSA1NDcuMzYxLDEzOS4zMjQ4IEM1NTkuMDczNiwxNDAuMjY1OSA1NjEuMzQsMTUwLjEzNDkgNTU1LjYyNTQsMTU4LjU2MjYgQzU2Ny4zMzIyLDE2Mi4wNDI3IDU2OS40OTE5LDE2OS42MzcyIDU2MC43NTcsMTc4LjQwNDIgQzU2OC42NTY0LDE4OC45MjM1IDU2Ni4xNTE4LDE5NS42OTkxIDU1My42MzI1LDE5OS4yMzQ4IEM1NjIuOTAzOSwyMDYuNjAyMiA1NjEuMTcxMSwyMTUuNjgwNyA1NTAuMDg1NSwyMTkuNDgxOCBDNTQ0LjYyOTcsMjI4LjI2OTcgNTM0Ljk4NSwyMzEuMDI1NSA1MjkuMDE0NywyMjAuMDI5OSBDNTIzLjczNjcsMjI5LjcxMjUgNTE2LjIyNTYsMjMwLjY5MzkgNTA4Ljg4MTIsMjIyLjMzNTkgQzUwMi41MjgxLDIzMy43OTk1IDQ5My40ODM5LDIzMS43ODI1IDQ4Ni42ODk5LDIyMi44MTQ4IEM0ODIuNjYyMSwyMzEuMzA2NiA0NzYuNDY0MiwyMzQuMjMyNiA0NjkuMTMzOCwyMjYuMzU3MyBDNDYzLjg2MzUsMjM2LjIzNyA0NTUuMTE2MSwyMzguMDcyNCA0NDguMjIwMywyMjguMDY2OSBDNDQzLjQyMzMsMjM5LjI0ODkgNDMyLjY3NSwyMzkuMjkxNiA0MjYuNTU2NywyMjkuNDI2OSBDNDIyLjY5MzQsMjM5LjczNjMgNDEzLjcxMTksMjQyLjYzMzggNDA2LjQ3LDIzMi43OTUyIEMzOTkuMDg3MSwyNDEuNDI3OSAzOTIuNzI1NiwyNDAuOTAxOCAzODcuODMzLDIzMC4zNzMxIEMzNzkuNDU1MiwyMzguOTgyOSAzNzIuNDA0NSwyMzguODc4MiAzNjUuOTUzOSwyMjguMTg4MyBDMzYxLjMzMDQsMjM3LjE3NzMgMzUzLjA2NTIsMjM2LjQ5OTEgMzQ5LjE2MzMsMjI3LjUxNDIgQzM0MS41NzMzLDIzNy41NDE3IDMzMi41NjMyLDIzNy4zNjYgMzI3LjQwMDQsMjI1LjE0MDQgQzMyMC4zMjAxLDIzNC45MTA5IDMxMS43NzY5LDIzMi45OTA3IDMwNi43NDg3LDIyMi45OTYzIEMzMDAuMzQ4MywyMzAuODA3OCAyOTIuOTAxNSwyMjkuMzYxNSAyODguMTg5NCwyMjEuMDUyNiBDMjgxLjc1OSwyMzEuMTgzMiAyNzIuMjY0OSwyMzEuNDMxMyAyNjcuMTg2LDIxOS43NTEyIEMyNTUuNDA1NCwyMTMuNjQzIDI1Ni42NjI4LDIwNi4xMSAyNjYuMDcyOCwxOTguODcyMSBDMjU1LjE4NzIsMTk0LjE5MjcgMjU2LjQ2MzEsMTg1LjA2NSAyNjQuMDczNCwxNzguNTY0NiBDMjU0Ljc4NDEsMTcyLjg5MTIgMjU1LjU2OTksMTY0LjQ5NzggMjY1LjMzMzksMTYwLjEyNyBDMjU1LjMxNjEsMTUyLjM5ODEgMjU2LjE5ODUsMTQ0LjI5NTkgMjY2Ljk3NjcsMTM4LjExOTQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzAiIHg9IjM5MC45NjY4IiB5PSIxNTQuNDk1MSI+JiMyMTA2OTsmIzMxNDcxOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8tLT48ZyBpZD0iY2x1c3Rlcl8mIzIxNTE4OyYjMjE0ODg7Ij48cGF0aCBkPSJNNDQ2LjM4MDYsMjY4LjQ5NDYgQzQ0OS40NTEzLDI2Mi44NjU1IDQ1My40MzExLDI2MS4zNzIxIDQ1Ny44MzkyLDI2Ny4xNTEyIEM0NjEuOTY0OCwyNjAuMjE5MyA0NjguMzY1LDI2MC41OTMxIDQ3Mi40MDk3LDI2Ny4yMzggQzQ3NS45NDgsMjYxLjUwNyA0NzkuODMzNywyNTkuNTY3NSA0ODQuOTU1MywyNjUuNTQxIEM0ODcuMDEwOCwyNjAuMzk5NCA0OTEuNjU4MiwyNTguNzI5MiA0OTUuNzU4MywyNjMuMjU2NiBDNTAwLjg5MiwyNTUuOTAxNCA1MDYuNzY0MiwyNTguMzY3NyA1MTAuNTA3LDI2NC43NSBDNTEyLjg0OTMsMjU5LjE1NDggNTE4LjYzNzUsMjU4LjI1ODQgNTIyLjMwMjgsMjYzLjI4IEM1MjQuNjg5NiwyNTcuMzc3MiA1MzAuMzM3MiwyNTYuMTMxOCA1MzMuOTYyNSwyNjIuMDU5NSBDNTM4Ljg3MDEsMjU1LjY5MDUgNTQzLjY2NTcsMjU0LjU4MzEgNTQ4LjMzMjYsMjYyLjMwNTEgQzU1Mi4yODYsMjU2LjkzODIgNTU2Ljc0OTIsMjU2LjE5MyA1NjAuNDE4OSwyNjIuNTk2MyBDNTY0Ljk5MDMsMjU4LjU1NDIgNTY5LjU0NjYsMjU4LjUzMzYgNTcxLjUxODQsMjY1LjI3MjcgQzU3NS45Nzk0LDI1Ny42MDA1IDU4MC40ODMxLDI1OC41OTc0IDU4NS45MDU0LDI2NC4yMzM0IEM1OTAuMDE1OCwyNTguNzE1OCA1OTQuMzk4LDI2MC4wMjE1IDU5Ny4xMjEyLDI2NS42MzE2IEM2MDAuOTAxLDI2MC40NzU0IDYwNi40Nzg5LDI1OS4xMDA5IDYwOS43MzIzLDI2Ni4xNzQ0IEM2MTQuNDY5MiwyNjAuNjU5NSA2MTkuMzM4MSwyNjAuMTI0MyA2MjMuNzkyMSwyNjYuNTA4NiBDNjMyLjI3NjgsMjcwLjA0NDYgNjMyLjMxOSwyNzcuODc5MSA2MjUuMDU1LDI4Mi42NDc1IEM2MzEuNTgzNSwyODQuNjA5MyA2MzIuNDg1OSwyOTAuMDM4MyA2MjcuNzcxNSwyOTQuNTYzMiBDNjM1Ljk0NCwyOTYuOTgwNSA2MzYuODA2NiwzMDEuNzM0NiA2MzEuNzQ2NCwzMDguMDUxNSBDNjM4LjA5NjYsMzE0LjIxNCA2MzYuMTEwMiwzMjAuNDQxNSA2MjcuNjYyNywzMjIuMzg5NCBDNjM0LjEyNjIsMzI2LjYyMzMgNjMyLjc3NTQsMzMzLjM3NjUgNjI2LjM0NjUsMzM2LjM5OTEgQzYzMi40NjMsMzQyLjQxMjEgNjMxLjQ1ODUsMzQ4LjcxNzcgNjIzLjExMDIsMzUxLjY2NDEgQzYxOS4yMjc3LDM1Ny45OTQxIDYxMy44MjY2LDM1Ny4xNTg5IDYwOS45MjAyLDM1MS42OTA4IEM2MDYuODMxNCwzNTcuODQgNjAyLjIyMDksMzU2LjMzNTIgNTk4Ljg3NiwzNTEuOTU5NSBDNTkzLjc0NDQsMzU4LjY4OTEgNTg5LjEzMDQsMzU3LjA5OTIgNTg0LjkwMSwzNTAuOTc4MyBDNTgyLjE5MSwzNTguNTA3MyA1NzYuMDgyNSwzNTguMjY5OCA1NzEuNzIxMSwzNTIuNjMxMiBDNTY4LjQyOTQsMzU4LjAwNDcgNTYyLjgxMSwzNTkuMjQxIDU1OS4wNjk5LDM1My4xMjYgQzU1NS4wNTEsMzU4LjUxNzggNTUwLjg3MDksMzU3LjA5NTkgNTQ3LjkxMDksMzUxLjk5OTUgQzU0My45Mjc1LDM1Ny41MjUyIDUzOS41MTYyLDM1OC42MjkyIDUzNS40ODI0LDM1Mi4wNTEzIEM1MzEuODIwOCwzNTguOTMyNSA1MjYuODU1MiwzNTkuOTc1NCA1MjEuOTI4NCwzNTMuMzE3OSBDNTE4LjA2NzEsMzU4LjcxMjcgNTEyLjA4MTIsMzU5LjMzNTkgNTA5LjMwMzEsMzUyLjIyNDQgQzUwNS45ODAyLDM1Ny4xODMzIDUwMC40MTExLDM1OC42MTM5IDQ5Ny4wODY0LDM1Mi4yMjY0IEM0OTIuNzEyNywzNTguNjk2OCA0ODcuODE1NywzNTcuNDcxNyA0ODMuNzA3NCwzNTEuOTMwNyBDNDc5LjQzOTIsMzU2LjYzMDQgNDc1LjkwMTYsMzU2LjU3MDIgNDcyLjQ3OTQsMzUxLjAwNTIgQzQ2OC40NTg3LDM1Ny41NzkxIDQ2NC4wNTQsMzU4LjU2OTUgNDU5LjIyNjIsMzUxLjgwNzMgQzQ1NC40NzAxLDM1OC4yMzI3IDQ0OC4wNjEyLDM1OC4wMTczIDQ0NS4xNDQzLDM1MC4wMTI2IEM0MzguNDExNiwzNDYuNTcwNiA0MzYuOTgzMywzNDEuMjEzOSA0NDMuNTI4NSwzMzYuMjE2OCBDNDM2LjA2MDMsMzM0LjA5NTIgNDM0LjUzNzUsMzI3Ljc4NzcgNDQwLjc3NDEsMzIyLjg0MzYgQzQzMi45NTMsMzE4LjYzNjEgNDMyLjc1OTQsMzEzLjUwODUgNDM5LjcxNjYsMzA4LjIzMTQgQzQzNS4wMjE4LDMwMy42NDA1IDQzNS43MTU1LDI5OS45OTIxIDQ0MC45OTAzLDI5Ni40ODIgQzQzNC4yMTI5LDI5MS4xNDI2IDQzNC4zMzEsMjgzLjMyMjUgNDQzLjQxNjEsMjgwLjM3MTYgQzQzOC40NzA3LDI3NS4xNDc5IDQ0MC42MTk2LDI3MS4wNDYxIDQ0Ni4zODA2LDI2OC40OTQ2ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMwIiB4PSI1MTguNDY2OCIgeT0iMjg0LjQ5NTEiPiYjMjE1MTg7JiMyMTQ4ODs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/LS0+PGcgaWQ9ImNsdXN0ZXJfJiMyMTA2OTsmIzIxNDg4OyI+PHBhdGggZD0iTTQ5LjMyODUsNDA1LjI4ODcgQzYxLjQ0MDIsMzg1LjM4NTIgNzguMTYyMywzODQuMzcgOTEuNTgxMiw0MDMuODg3NyBDMTAyLjE4ODksMzg3LjM0OTMgMTE4LjAwOTgsMzg0LjQzNjggMTI5LjEyOTEsNDAzLjM0NTkgQzE0Mi4wMTEyLDM3OS42MzE0IDE1Ny4wODE3LDM3My43NTA3IDE3Ni4zMjYzLDM5Ni45NDQzIEMxOTAuMDIwMywzNzMuODI1OSAyMDIuNjM3MywzNzUuMDc1NSAyMTcuNjg5LDM5NS42NTkzIEMyMzIuMTM1NSwzNzUuNTc0IDI0OS42MDM2LDM3Ni43NTEgMjYwLjU2NzYsMzk5LjE3MjIgQzI3My41NjA0LDM4MC40MzQyIDI4NS44MTE5LDM4Mi4xMjQyIDI5OS45NDA4LDM5Ny44NzUyIEMzMDguNTg1MywzNzUuOTAxNiAzMjguMzY1NCwzNzYuODgxMSAzNDEuMDc2NSwzOTMuNTQ1NyBDMzUzLjc0MTksMzc1Ljk0NzUgMzcyLjMwMjksMzc4LjYyNzkgMzgyLjY5ODMsMzk2LjIyOTggQzM5Ny45NTE1LDM3Ni4yNDk0IDQxNS4wNzI1LDM3MS45NTc5IDQzMC4yODYsMzk2LjI3MjUgQzQ0Ni4wODQ4LDM3OC44MDQ1IDQ2Mi41NjA5LDM3OC43NjE5IDQ3NC44NDA0LDQwMC4yOTMxIEM0ODYuNTE5MiwzNzguMzMyNSA1MDQuMTAzNSwzODMuMjI1MiA1MTUuOTY2Nyw0MDAuMDk3OSBDNTI5LjMxNDksMzgwLjE0MzggNTQ1Ljg5OCwzNzcuOTAzMiA1NTkuNjkxNywzOTkuNjMwNyBDNTY4LjczOTksMzg0LjY4NjEgNTg0LjI5ODMsMzgxLjgxNDcgNTk1LjA4NTMsMzk3LjYyOTkgQzYxNC44OTQ1LDM4MC4wNzg2IDYzMS42ODk0LDM3Ni4yNzA5IDY0My45NjY4LDQwNS41IEM2NDQuOTgwNyw0MDQuNTM5MSA2NDUuODUxMiw0MDQuNzU4OSA2NDYuMjE5Miw0MDYuMTI1MSBDNjcyLjkzNzIsNDE3Ljk2MTcgNjc5LjgyODgsNDQzLjQ4MDggNjUxLjM3NjgsNDYwLjU0NTkgQzY3NC4wMjU2LDQ3MC42NzQ1IDY3My4wNjg4LDQ5Mi43NjI3IDY1NC4zOTcsNTA1LjY1NzcgQzY3OS44MDI2LDUyMS4yNTA4IDY3NS4xMzE1LDU0NC41NTU4IDY0OS40NTA5LDU1NS4wMzEyIEM2NzguNzIyNCw1NzEuOTkyMyA2NzkuNzIxNyw1OTIuNjg1NCA2NTIuMDY2OCw2MTIuMjQ5MiBDNjczLjM0Niw2MjcuOTMxNyA2NjkuMjExOSw2NDEuNjQ3MyA2NDkuNjk2Myw2NTUuMDcxNiBDNjczLjY3MDksNjc5Ljg0MjkgNjY4LjA1MzIsNjk5LjE0OTggNjM2Ljk2NjgsNzExLjUgQzYzOS4wNjc2LDcxMi4yOTA2IDYzOS44MDE2LDcxMy41MTMgNjM4LjIwMDEsNzE1LjQ1NzQgQzYyNi4yMzQsNzM3LjU5ODEgNjA3Ljg5MTEsNzMzLjg3MDQgNTk2LjM2NjUsNzE1LjAwNyBDNTg3LjI2OTMsNzM2Ljk1MjEgNTc0LjgzNjIsNzM4LjQ2MDYgNTU4LjQ5MDEsNzIyLjE5MTkgQzU0Ni4zNjYzLDc0Ni41MDI2IDUyNC45NjY2LDc0NC4wNzg3IDUxMS43NzI0LDcyMy4zMDExIEM0OTcuODE3Nyw3NDQuNjI4MSA0NzkuNzIyMyw3NDAuMTM1OSA0NjkuNjk3Miw3MTkuMzcyOCBDNDU4Ljc3MzIsNzM4LjE4OTggNDQzLjQzMDQsNzM5LjE4NTQgNDMxLjU0MzEsNzIwLjM0OSBDNDIxLjUzNDEsNzQyLjM3NTcgNDAyLjMyMTMsNzQ0Ljg0OTcgMzg3Ljc2OSw3MjUuMTEwOSBDMzc1LjM5MjQsNzQzLjc5OTcgMzU5Ljg1NTgsNzQ4LjI4MzMgMzQ1LjMxNzgsNzI3LjQzMTMgQzMyOS41ODI3LDc0My43NDY2IDMxNi4xMTE5LDc0MC42NTcyIDMwNC43ODczLDcyMi4yNzg5IEMyOTMuNzQwOCw3NDEuODU3NCAyNzEuMjExMyw3NDkuNTU0NCAyNTguMDAwMSw3MjQuNTUwNiBDMjQyLjQ4NzMsNzQ2LjkwNzcgMjI5LjA1MDUsNzQ2LjAxNDUgMjEzLjg3NTEsNzI0LjIxMzQgQzE5Ny41ODkzLDc0My45MzQ4IDE3OS45NTE2LDc0MS4yMjggMTcwLjQ2MjMsNzE3LjQzMzEgQzE2MS4xMDQyLDczNC44MTk2IDE0NC44NDcsNzM4LjY1MTUgMTMxLjU4NDMsNzIxLjg3NjggQzExNi40NDc3LDc0Mi4wMzI2IDEwMy43NzI2LDc0MC4xMDEgOTEuMTUwMyw3MTkuMzg5MSBDNjUuODU0OSw3NDMuMTQyOCA0NS42Mjc1LDczOC42OTMgMzUuOTY2OCw3MDQuNSBDMzcuODcyMiw3MDUuNjc2OSAzNy45NTg1LDcwNy4wMjE3IDM2LjI5MTYsNzA4LjQ4OTQgQzkuMjU0Miw2OTQuNDg2NyA2LjE2MDQsNjcxLjI0MTUgMzQuMDI3OSw2NTQuOTE4NiBDMTUuMjQ2MSw2NDEuNTUyIDEwLjc4NjEsNjIxLjc3NjEgMzMuODQ4MSw2MDguMjQ4MyBDMTEuNjkyOCw1OTEuNTIwMyA2LDU3Ni4xMzA2IDMyLjM3MjksNTU3Ljk3ODQgQzcuMDY2LDU0MS45ODggOS43OTUsNTE3Ljg1MDkgMzYuOTI5Nyw1MDYuNTAyNyBDMTMuMDE0LDQ5My45OTM5IDExLjAyMDcsNDcwLjI2MzIgMzQuOTE3Miw0NTUuODU0NiBDMTEuNjY2OCw0MzMuOTcxMyAxMS45MzYyLDQxMi43NjUxIDQyLjk2NjgsMzk4LjUgQzQ3LjkxNiwzOTcuNzQ4MyA1MC4yODQyLDQwMC41MDcgNDkuMzI4NSw0MDUuMjg4NyAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMCIgeD0iMzI0Ljk2NjgiIHk9IjQxNi40OTUxIj4mIzIxMDY5OyYjMjE0ODg7PC90ZXh0PjwvZz48IS0tZW50aXR5IGZqcy0tPjxnIGlkPSJlbGVtX2ZqcyI+PHBvbHlnb24gZmlsbD0iIzkwRUU5MCIgcG9pbnRzPSIyNzMuNDY2OCwxNzMuNSwyODMuNDY2OCwxNjMuNSwzODguNDY2OCwxNjMuNSwzODguNDY2OCwxOTkuNzk2OSwzNzguNDY2OCwyMDkuNzk2OSwyNzMuNDY2OCwyMDkuNzk2OSwyNzMuNDY2OCwxNzMuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzc4LjQ2NjgiIHgyPSIzODguNDY2OCIgeTE9IjE3My41IiB5Mj0iMTYzLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNzMuNDY2OCIgeDI9IjM3OC40NjY4IiB5MT0iMTczLjUiIHkyPSIxNzMuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM3OC40NjY4IiB4Mj0iMzc4LjQ2NjgiIHkxPSIxNzMuNSIgeTI9IjIwOS43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzUiIHg9IjI4OC40NjY4IiB5PSIxOTYuNDk1MSI+JiMyMTA2OTsmIzIxNDg4O25vZGVqczwvdGV4dD48L2c+PCEtLWVudGl0eSBianMtLT48ZyBpZD0iZWxlbV9ianMiPjxwb2x5Z29uIGZpbGw9IiM5MEVFOTAiIHBvaW50cz0iNDIzLjQ2NjgsMTczLjUsNDMzLjQ2NjgsMTYzLjUsNTM4LjQ2NjgsMTYzLjUsNTM4LjQ2NjgsMTk5Ljc5NjksNTI4LjQ2NjgsMjA5Ljc5NjksNDIzLjQ2NjgsMjA5Ljc5NjksNDIzLjQ2NjgsMTczLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjUyOC40NjY4IiB4Mj0iNTM4LjQ2NjgiIHkxPSIxNzMuNSIgeTI9IjE2My41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDIzLjQ2NjgiIHgyPSI1MjguNDY2OCIgeTE9IjE3My41IiB5Mj0iMTczLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1MjguNDY2OCIgeDI9IjUyOC40NjY4IiB5MT0iMTczLjUiIHkyPSIyMDkuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc1IiB4PSI0MzguNDY2OCIgeT0iMTk2LjQ5NTEiPiYjMjE1MTg7JiMyMTQ4ODtub2RlanM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgYnAtLT48ZyBpZD0iZWxlbV9icCI+PGVsbGlwc2UgY3g9IjQ4MC45NjY4IiBjeT0iMzA5LjUiIGZpbGw9IiNGRkE1MDAiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ3Ni45NjY4LDI5Ny41LDQ4Mi45NjY4LDI5Mi41LDQ4MC45NjY4LDI5Ny41LDQ4Mi45NjY4LDMwMi41LDQ3Ni45NjY4LDI5Ny41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iNDUyLjk2NjgiIHk9IjMzOC40OTUxIj4mIzIxNTE4OyYjMjE0ODg7JiMyMDEzNTsmIzIxNjk3OzwvdGV4dD48L2c+PCEtLWVudGl0eSBiYmQtLT48ZyBpZD0iZWxlbV9iYmQiPjxwYXRoIGQ9Ik01NDQuNDY2OCwzMDUgQzU0NC40NjY4LDI5NSA1NzguOTY2OCwyOTUgNTc4Ljk2NjgsMjk1IEM1NzguOTY2OCwyOTUgNjEzLjQ2NjgsMjk1IDYxMy40NjY4LDMwNSBMNjEzLjQ2NjgsMzMwLjI5NjkgQzYxMy40NjY4LDM0MC4yOTY5IDU3OC45NjY4LDM0MC4yOTY5IDU3OC45NjY4LDM0MC4yOTY5IEM1NzguOTY2OCwzNDAuMjk2OSA1NDQuNDY2OCwzNDAuMjk2OSA1NDQuNDY2OCwzMzAuMjk2OSBMNTQ0LjQ2NjgsMzA1ICIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTU0NC40NjY4LDMwNSBDNTQ0LjQ2NjgsMzE1IDU3OC45NjY4LDMxNSA1NzguOTY2OCwzMTUgQzU3OC45NjY4LDMxNSA2MTMuNDY2OCwzMTUgNjEzLjQ2NjgsMzA1ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDkiIHg9IjU1NC40NjY4IiB5PSIzMzEuOTk1MSI+JiMyMTUxODsmIzIxNDg4O0RCPC90ZXh0PjwvZz48IS0tZW50aXR5IGZwMS0tPjxnIGlkPSJlbGVtX2ZwMSI+PGVsbGlwc2UgY3g9IjI3My45NjY4IiBjeT0iNDQxLjUiIGZpbGw9IiNGRkE1MDAiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI2OS45NjY4LDQyOS41LDI3NS45NjY4LDQyNC41LDI3My45NjY4LDQyOS41LDI3NS45NjY4LDQzNC41LDI2OS45NjY4LDQyOS41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NSIgeD0iMjQxLjQ2NjgiIHk9IjQ3MC40OTUxIj4mIzIxMDY5OyYjMjE0ODg7JiMyMDEzNTsmIzIxNjk3OzE8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZnAyLS0+PGcgaWQ9ImVsZW1fZnAyIj48ZWxsaXBzZSBjeD0iMzczLjk2NjgiIGN5PSI0NDEuNSIgZmlsbD0iI0ZGQTUwMCIgcng9IjEyIiByeT0iMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzY5Ljk2NjgsNDI5LjUsMzc1Ljk2NjgsNDI0LjUsMzczLjk2NjgsNDI5LjUsMzc1Ljk2NjgsNDM0LjUsMzY5Ljk2NjgsNDI5LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY0IiB4PSIzNDEuOTY2OCIgeT0iNDcwLjQ5NTEiPiYjMjEwNjk7JiMyMTQ4ODsmIzIwMTM1OyYjMjE2OTc7MjwvdGV4dD48L2c+PCEtLWVudGl0eSBtczAtLT48ZyBpZD0iZWxlbV9tczAiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNDMuOTY2OCw1NDQuNSw1My45NjY4LDUzNC41LDE5MS45NjY4LDUzNC41LDE5MS45NjY4LDU3MC43OTY5LDE4MS45NjY4LDU4MC43OTY5LDQzLjk2NjgsNTgwLjc5NjksNDMuOTY2OCw1NDQuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTgxLjk2NjgiIHgyPSIxOTEuOTY2OCIgeTE9IjU0NC41IiB5Mj0iNTM0LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0My45NjY4IiB4Mj0iMTgxLjk2NjgiIHkxPSI1NDQuNSIgeTI9IjU0NC41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTgxLjk2NjgiIHgyPSIxODEuOTY2OCIgeTE9IjU0NC41IiB5Mj0iNTgwLjc5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDgiIHg9IjU4Ljk2NjgiIHk9IjU2Ny40OTUxIj5NaWNyb1NlcnZpY2VfMDwvdGV4dD48L2c+PCEtLWVudGl0eSBtczEtLT48ZyBpZD0iZWxlbV9tczEiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjY4Ljk2NjgsNTQ0LjUsMjc4Ljk2NjgsNTM0LjUsNDE2Ljk2NjgsNTM0LjUsNDE2Ljk2NjgsNTcwLjc5NjksNDA2Ljk2NjgsNTgwLjc5NjksMjY4Ljk2NjgsNTgwLjc5NjksMjY4Ljk2NjgsNTQ0LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQwNi45NjY4IiB4Mj0iNDE2Ljk2NjgiIHkxPSI1NDQuNSIgeTI9IjUzNC41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjY4Ljk2NjgiIHgyPSI0MDYuOTY2OCIgeTE9IjU0NC41IiB5Mj0iNTQ0LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MDYuOTY2OCIgeDI9IjQwNi45NjY4IiB5MT0iNTQ0LjUiIHkyPSI1ODAuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOCIgeD0iMjgzLjk2NjgiIHk9IjU2Ny40OTUxIj5NaWNyb1NlcnZpY2VfMTwvdGV4dD48L2c+PCEtLWVudGl0eSBtczItLT48ZyBpZD0iZWxlbV9tczIiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNDg4LjQ2NjgsNTQ0LjUsNDk4LjQ2NjgsNTM0LjUsNjM1LjQ2NjgsNTM0LjUsNjM1LjQ2NjgsNTcwLjc5NjksNjI1LjQ2NjgsNTgwLjc5NjksNDg4LjQ2NjgsNTgwLjc5NjksNDg4LjQ2NjgsNTQ0LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYyNS40NjY4IiB4Mj0iNjM1LjQ2NjgiIHkxPSI1NDQuNSIgeTI9IjUzNC41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDg4LjQ2NjgiIHgyPSI2MjUuNDY2OCIgeTE9IjU0NC41IiB5Mj0iNTQ0LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MjUuNDY2OCIgeDI9IjYyNS40NjY4IiB5MT0iNTQ0LjUiIHkyPSI1ODAuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNyIgeD0iNTAzLjQ2NjgiIHk9IjU2Ny40OTUxIj5NaWNyb1NlcnZpY2VfMjwvdGV4dD48L2c+PCEtLWVudGl0eSBmZGJtLS0+PGcgaWQ9ImVsZW1fZmRibSI+PHBhdGggZD0iTTI5OC45NjY4LDY1MS41IEMyOTguOTY2OCw2NDEuNSAzNDIuOTY2OCw2NDEuNSAzNDIuOTY2OCw2NDEuNSBDMzQyLjk2NjgsNjQxLjUgMzg2Ljk2NjgsNjQxLjUgMzg2Ljk2NjgsNjUxLjUgTDM4Ni45NjY4LDY5My4wOTM4IEMzODYuOTY2OCw3MDMuMDkzOCAzNDIuOTY2OCw3MDMuMDkzOCAzNDIuOTY2OCw3MDMuMDkzOCBDMzQyLjk2NjgsNzAzLjA5MzggMjk4Ljk2NjgsNzAzLjA5MzggMjk4Ljk2NjgsNjkzLjA5MzggTDI5OC45NjY4LDY1MS41ICIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTI5OC45NjY4LDY1MS41IEMyOTguOTY2OCw2NjEuNSAzNDIuOTY2OCw2NjEuNSAzNDIuOTY2OCw2NjEuNSBDMzQyLjk2NjgsNjYxLjUgMzg2Ljk2NjgsNjYxLjUgMzg2Ljk2NjgsNjUxLjUgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY4IiB4PSIzMDguOTY2OCIgeT0iNjc4LjQ5NTEiPiYjMTcxO21hc3RlciYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MiIgeD0iMzIxLjk2NjgiIHk9IjY5NC43OTIiPm15c3FsPC90ZXh0PjwvZz48IS0tZW50aXR5IGZkYnMtLT48ZyBpZD0iZWxlbV9mZGJzIj48cGF0aCBkPSJNMTEzLjQ2NjgsNjUxLjUgQzExMy40NjY4LDY0MS41IDE1MC45NjY4LDY0MS41IDE1MC45NjY4LDY0MS41IEMxNTAuOTY2OCw2NDEuNSAxODguNDY2OCw2NDEuNSAxODguNDY2OCw2NTEuNSBMMTg4LjQ2NjgsNjkzLjA5MzggQzE4OC40NjY4LDcwMy4wOTM4IDE1MC45NjY4LDcwMy4wOTM4IDE1MC45NjY4LDcwMy4wOTM4IEMxNTAuOTY2OCw3MDMuMDkzOCAxMTMuNDY2OCw3MDMuMDkzOCAxMTMuNDY2OCw2OTMuMDkzOCBMMTEzLjQ2NjgsNjUxLjUgIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTEzLjQ2NjgsNjUxLjUgQzExMy40NjY4LDY2MS41IDE1MC45NjY4LDY2MS41IDE1MC45NjY4LDY2MS41IEMxNTAuOTY2OCw2NjEuNSAxODguNDY2OCw2NjEuNSAxODguNDY2OCw2NTEuNSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUiIHg9IjEyMy40NjY4IiB5PSI2NzguNDk1MSI+JiMxNzE7c2xhdmUmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9IjEyOS45NjY4IiB5PSI2OTQuNzkyIj5teXNxbDwvdGV4dD48L2c+PCEtLWVudGl0eSBBUFAtLT48ZyBpZD0iZWxlbV9BUFAiPjxlbGxpcHNlIGN4PSIyOTkuOTY2OCIgY3k9IjE0IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yOTkuOTY2OCwyMiBMMjk5Ljk2NjgsNDkgTTI4Ni45NjY4LDMwIEwzMTIuOTY2OCwzMCBNMjk5Ljk2NjgsNDkgTDI4Ni45NjY4LDY0IE0yOTkuOTY2OCw0OSBMMzEyLjk2NjgsNjQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iMjg1Ljk2NjgiIHk9Ijc4LjQ5NTEiPkFQUDwvdGV4dD48L2c+PCEtLWVudGl0eSBINS0tPjxnIGlkPSJlbGVtX0g1Ij48ZWxsaXBzZSBjeD0iMzYyLjk2NjgiIGN5PSIxNCIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzYyLjk2NjgsMjIgTDM2Mi45NjY4LDQ5IE0zNDkuOTY2OCwzMCBMMzc1Ljk2NjgsMzAgTTM2Mi45NjY4LDQ5IEwzNDkuOTY2OCw2NCBNMzYyLjk2NjgsNDkgTDM3NS45NjY4LDY0ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkiIHg9IjM1My40NjY4IiB5PSI3OC40OTUxIj5INTwvdGV4dD48L2c+PCEtLWVudGl0eSBPcGVyYXRvci0tPjxnIGlkPSJlbGVtX09wZXJhdG9yIj48ZWxsaXBzZSBjeD0iNDgwLjk2NjgiIGN5PSIxNCIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNDgwLjk2NjgsMjIgTDQ4MC45NjY4LDQ5IE00NjcuOTY2OCwzMCBMNDkzLjk2NjgsMzAgTTQ4MC45NjY4LDQ5IEw0NjcuOTY2OCw2NCBNNDgwLjk2NjgsNDkgTDQ5My45NjY4LDY0ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjYiIHg9IjQ0Ny45NjY4IiB5PSI3OC40OTUxIj5PcGVyYXRvcjwvdGV4dD48L2c+PCEtLWVudGl0eSBCSS0tPjxnIGlkPSJlbGVtX0JJIj48ZWxsaXBzZSBjeD0iMTEwLjk2NjgiIGN5PSI3OTEiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTExMC45NjY4LDc5OSBMMTEwLjk2NjgsODI2IE05Ny45NjY4LDgwNyBMMTIzLjk2NjgsODA3IE0xMTAuOTY2OCw4MjYgTDk3Ljk2NjgsODQxIE0xMTAuOTY2OCw4MjYgTDEyMy45NjY4LDg0MSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0IiB4PSIxMDMuOTY2OCIgeT0iODU1LjQ5NTEiPkJJPC90ZXh0PjwvZz48IS0tZW50aXR5IERXLS0+PGcgaWQ9ImVsZW1fRFciPjxlbGxpcHNlIGN4PSIxOTAuOTY2OCIgY3k9Ijc5MSIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTkwLjk2NjgsNzk5IEwxOTAuOTY2OCw4MjYgTTE3Ny45NjY4LDgwNyBMMjAzLjk2NjgsODA3IE0xOTAuOTY2OCw4MjYgTDE3Ny45NjY4LDg0MSBNMTkwLjk2NjgsODI2IEwyMDMuOTY2OCw4NDEgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNSIgeD0iMTc4LjQ2NjgiIHk9Ijg1NS40OTUxIj5EVzwvdGV4dD48L2c+PCEtLWxpbmsgQVBQIHRvIGZqcy0tPjxnIGlkPSJsaW5rX0FQUF9manMiPjxwYXRoIGQ9Ik0zMDguMTExOCw4MS41NDYgQzMxMy44MTU4LDEwNy40OTMgMzE5Ljk2MjMsMTM1LjQ1IDMyNC43NzgzLDE1Ny4zNTIgIiBmaWxsPSJub25lIiBpZD0iQVBQLXRvLWZqcyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMjYuMDY2OCwxNjMuMjEyLDMyOC4wNDA3LDE1My41NjMsMzI0Ljk5MywxNTguMzI4NywzMjAuMjI3MywxNTUuMjgxLDMyNi4wNjY4LDE2My4yMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBINSB0byBmanMtLT48ZyBpZD0ibGlua19INV9manMiPjxwYXRoIGQ9Ik0zNTQuNTU4OCw4MS41NDYgQzM0OC42NzA4LDEwNy40OTMgMzQyLjMyMzgsMTM1LjQ1ODggMzM3LjM1MjgsMTU3LjM2MDggIiBmaWxsPSJub25lIiBpZD0iSDUtdG8tZmpzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMzNi4wMjQ4LDE2My4yMTIsMzQxLjkxNzYsMTU1LjMyMDYsMzM3LjEzMTUsMTU4LjMzNiwzMzQuMTE2LDE1My41NDk5LDMzNi4wMjQ4LDE2My4yMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBPcGVyYXRvciB0byBianMtLT48ZyBpZD0ibGlua19PcGVyYXRvcl9ianMiPjxwYXRoIGQ9Ik00ODAuOTY2OCw4MS41NDYgQzQ4MC45NjY4LDEwNy40OTMgNDgwLjk2NjgsMTM1LjMxIDQ4MC45NjY4LDE1Ny4yMTIgIiBmaWxsPSJub25lIiBpZD0iT3BlcmF0b3ItdG8tYmpzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ4MC45NjY4LDE2My4yMTIsNDg0Ljk2NjgsMTU0LjIxMiw0ODAuOTY2OCwxNTguMjEyLDQ3Ni45NjY4LDE1NC4yMTIsNDgwLjk2NjgsMTYzLjIxMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGJwIHRvIGJiZC0tPjxnIGlkPSJsaW5rX2JwX2JiZCI+PHBhdGggZD0iTTUwOS4yOTQ4LDMxNy41IEM1MjAuOTk3OCwzMTcuNSA1MjYuNzAwOCwzMTcuNSA1MzguNDAyOCwzMTcuNSAiIGZpbGw9Im5vbmUiIGlkPSJicC10by1iYmQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTQ0LjQwMjgsMzE3LjUsNTM1LjQwMjgsMzEzLjUsNTM5LjQwMjgsMzE3LjUsNTM1LjQwMjgsMzIxLjUsNTQ0LjQwMjgsMzE3LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBianMgdG8gYnAtLT48ZyBpZD0ibGlua19ianNfYnAiPjxwYXRoIGQ9Ik00ODAuOTY2OCwyMDkuNjc2IEM0ODAuOTY2OCwyMzMuMDE2IDQ4MC45NjY4LDI2My41OTQgNDgwLjk2NjgsMjg3LjMwOSAiIGZpbGw9Im5vbmUiIGlkPSJianMtdG8tYnAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDgwLjk2NjgsMjkzLjMwOSw0ODQuOTY2OCwyODQuMzA5LDQ4MC45NjY4LDI4OC4zMDksNDc2Ljk2NjgsMjg0LjMwOSw0ODAuOTY2OCwyOTMuMzA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZnAxIHRvIG1zMC0tPjxnIGlkPSJsaW5rX2ZwMV9tczAiPjxwYXRoIGQ9Ik0yNDEuMjYzOCw0NzIuNzIxIEMyMTQuNTQ5OCw0OTAuODczIDE4MS45NTA2LDUxMy4wMjM5IDE1NS4zMjE2LDUzMS4xMTc5ICIgZmlsbD0ibm9uZSIgaWQ9ImZwMS10by1tczAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTUwLjM1ODgsNTM0LjQ5LDE2MC4wNTEsNTMyLjc0MDMsMTU0LjQ5NDQsNTMxLjY3OTksMTU1LjU1NDksNTI2LjEyMzMsMTUwLjM1ODgsNTM0LjQ5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZnAxIHRvIG1zMS0tPjxnIGlkPSJsaW5rX2ZwMV9tczEiPjxwYXRoIGQ9Ik0yODguOTM4OCw0NzMuNSBDMzAwLjY3MDgsNDkxLjUyNCAzMTMuNjIyNyw1MTEuNDE5NCAzMjUuMjIzNyw1MjkuMjQyNCAiIGZpbGw9Im5vbmUiIGlkPSJmcDEtdG8tbXMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMyOC40OTY4LDUzNC4yNzEsMzI2LjkzOTUsNTI0LjU0NiwzMjUuNzY5Miw1MzAuMDgwNSwzMjAuMjM0Nyw1MjguOTEwMiwzMjguNDk2OCw1MzQuMjcxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZnAxIHRvIG1zMi0tPjxnIGlkPSJsaW5rX2ZwMV9tczIiPjxwYXRoIGQ9Ik0zMDYuNzA4OCw0NjUuNzcgQzMxMi43NDA4LDQ2OC40MzkgMzE5LjAxMzgsNDcxLjEyMSAzMjQuOTY2OCw0NzMuNSBDMzgxLjIzNjgsNDk1Ljk5MiA0NDAuNTc5OSw1MTYuNjMxMiA0ODguMjcyOSw1MzIuNTMzMiAiIGZpbGw9Im5vbmUiIGlkPSJmcDEtdG8tbXMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ5My45NjQ4LDUzNC40MzEsNDg2LjY5MjEsNTI3Ljc4OTYsNDg5LjIyMTUsNTMyLjg0OTUsNDg0LjE2MTcsNTM1LjM3ODksNDkzLjk2NDgsNTM0LjQzMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGZwMiB0byBtczAtLT48ZyBpZD0ibGlua19mcDJfbXMwIj48cGF0aCBkPSJNMzQxLjc5MjgsNDY1LjU3NiBDMzM1Ljg4NTgsNDY4LjI2NSAzMjkuNzU3OCw0NzEuMDAzIDMyMy45NjY4LDQ3My41IEMyNzQuMDQyOCw0OTUuMDI1IDIyMi4yMDYxLDUxNS44MjM2IDE4MC42OTAxLDUzMi4xMzc2ICIgZmlsbD0ibm9uZSIgaWQ9ImZwMi10by1tczAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc1LjEwNTgsNTM0LjMzMiwxODQuOTQ1Miw1MzQuNzYzMywxNzkuNzU5NCw1MzIuNTAzMywxODIuMDE5NCw1MjcuMzE3NSwxNzUuMTA1OCw1MzQuMzMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZnAyIHRvIG1zMS0tPjxnIGlkPSJsaW5rX2ZwMl9tczEiPjxwYXRoIGQ9Ik0zNjcuMjM5OCw0NzMuNSBDMzYxLjk2ODgsNDkxLjUyNCAzNTYuMzYzOSw1MTAuNjg5MiAzNTEuMTUxOSw1MjguNTEyMiAiIGZpbGw9Im5vbmUiIGlkPSJmcDItdG8tbXMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0OS40Njc4LDUzNC4yNzEsMzU1LjgzMzEsNTI2Ljc1NTUsMzUwLjg3MTIsNTI5LjQ3MiwzNDguMTU0Nyw1MjQuNTEwMSwzNDkuNDY3OCw1MzQuMjcxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZnAyIHRvIG1zMi0tPjxnIGlkPSJsaW5rX2ZwMl9tczIiPjxwYXRoIGQ9Ik00MDYuMjg0OCw0NjguNzIyIEM0MzguNjIwOCw0ODYuOTU0IDQ4My4xNjMzLDUxMi4wNjgyIDUxNy42OTAzLDUzMS41MzUyICIgZmlsbD0ibm9uZSIgaWQ9ImZwMi10by1tczIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTIyLjkxNjgsNTM0LjQ4Miw1MTcuMDQxNiw1MjYuNTc3NSw1MTguNTYxNCw1MzIuMDI2Myw1MTMuMTEyNSw1MzMuNTQ2MSw1MjIuOTE2OCw1MzQuNDgyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgbXMwIHRvIG1zMS0tPjxnIGlkPSJsaW5rX21zMF9tczEiPjxwYXRoIGQ9Ik0xOTIuMjYzOCw1NTcuNSBDMjE2Ljg0MDgsNTU3LjUgMjM4LjE3NjgsNTU3LjUgMjYyLjc0NzgsNTU3LjUgIiBmaWxsPSJub25lIiBpZD0ibXMwLXRvLW1zMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNjguNzQ3OCw1NTcuNSwyNTkuNzQ3OCw1NTMuNSwyNjMuNzQ3OCw1NTcuNSwyNTkuNzQ3OCw1NjEuNSwyNjguNzQ3OCw1NTcuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAiIHg9IjIxMC40NjY4IiB5PSI1NTAuNTY2OSI+ZHViYm88L3RleHQ+PC9nPjwhLS1saW5rIG1zMSB0byBtczItLT48ZyBpZD0ibGlua19tczFfbXMyIj48cGF0aCBkPSJNNDE3LjEwOTgsNTU3LjUgQzQ0MC4wNjY4LDU1Ny41IDQ1OS4zNDU4LDU1Ny41IDQ4Mi4yNzE4LDU1Ny41ICIgZmlsbD0ibm9uZSIgaWQ9Im1zMS10by1tczIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDg4LjI3MTgsNTU3LjUsNDc5LjI3MTgsNTUzLjUsNDgzLjI3MTgsNTU3LjUsNDc5LjI3MTgsNTYxLjUsNDg4LjI3MTgsNTU3LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM1IiB4PSI0MzUuMjE2OCIgeT0iNTUwLjU2NjkiPmthZmthPC90ZXh0PjwvZz48IS0tbGluayBtczAgdG8gZmRibS0tPjxnIGlkPSJsaW5rX21zMF9mZGJtIj48cGF0aCBkPSJNMTYxLjg4MjgsNTgwLjU1NiBDMjAxLjQwMDgsNjAwLjQwMiAyNTMuODE0LDYyNi43MjUxIDI5My40MTUsNjQ2LjYxNDEgIiBmaWxsPSJub25lIiBpZD0ibXMwLXRvLWZkYm0iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjk4Ljc3NjgsNjQ5LjMwNywyOTIuNTI5NCw2NDEuNjkzMiwyOTQuMzA4Nyw2NDcuMDYyOSwyODguOTM4OSw2NDguODQyMiwyOTguNzc2OCw2NDkuMzA3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgbXMxIHRvIGZkYm0tLT48ZyBpZD0ibGlua19tczFfZmRibSI+PHBhdGggZD0iTTM0Mi45NjY4LDU4MC41NTYgQzM0Mi45NjY4LDU5Ny44OTggMzQyLjk2NjgsNjE2LjI0IDM0Mi45NjY4LDYzNS4zNzcgIiBmaWxsPSJub25lIiBpZD0ibXMxLXRvLWZkYm0iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzQyLjk2NjgsNjQxLjM3NywzNDYuOTY2OCw2MzIuMzc3LDM0Mi45NjY4LDYzNi4zNzcsMzM4Ljk2NjgsNjMyLjM3NywzNDIuOTY2OCw2NDEuMzc3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgbXMyIHRvIGZkYm0tLT48ZyBpZD0ibGlua19tczJfZmRibSI+PHBhdGggZD0iTTUxOS4yMjE4LDU4MC41NTYgQzQ4MS4xMzA4LDYwMC4yMSA0MzAuOTQ1OSw2MjYuMTA0OCAzOTIuNDM3OSw2NDUuOTczOCAiIGZpbGw9Im5vbmUiIGlkPSJtczItdG8tZmRibSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzODcuMTA1OCw2NDguNzI1LDM5Ni45MzgsNjQ4LjE1MjksMzkxLjU0OTIsNjQ2LjQzMjMsMzkzLjI2OTgsNjQxLjA0MzUsMzg3LjEwNTgsNjQ4LjcyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgZmRicyB0byBmZGJtLS0+PGcgaWQ9ImxpbmtfZmRic19mZGJtIj48cGF0aCBkPSJNMTk0Ljg5OTgsNjcyLjUgQzIyNi40ODM4LDY3Mi41IDI2NS40OTg4LDY3Mi41IDI5OC43MjA4LDY3Mi41ICIgZmlsbD0ibm9uZSIgaWQ9ImZkYnMtYmFja3RvLWZkYm0iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTg4Ljg5OTgsNjcyLjUsMTk3Ljg5OTgsNjc2LjUsMTkzLjg5OTgsNjcyLjUsMTk3Ljg5OTgsNjY4LjUsMTg4Ljg5OTgsNjcyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc0IiB4PSIyMDYuNzE2OCIgeT0iNjY1LjU2NjkiPnN5bmMoY2FuZWwpPC90ZXh0PjwvZz48IS0tbGluayBmanMgdG8gZnAxLS0+PGcgaWQ9ImxpbmtfZmpzX2ZwMSI+PHBhdGggZD0iTTMyNi4xMDY4LDIwOS43NTMgQzMxNS40MTg4LDI1OC42OTMgMjkxLjIzOCwzNjkuNDE4MiAyODAuMzM5LDQxOS4zMjIyICIgZmlsbD0ibm9uZSIgaWQ9ImZqcy10by1mcDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjc5LjA1ODgsNDI1LjE4NCwyODQuODg3LDQxNy4yNDQ3LDI4MC4xMjU3LDQyMC4yOTkxLDI3Ny4wNzEyLDQxNS41Mzc4LDI3OS4wNTg4LDQyNS4xODQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBmanMgdG8gZnAyLS0+PGcgaWQ9ImxpbmtfZmpzX2ZwMiI+PHBhdGggZD0iTTMzNC42MzI4LDIwOS43NTMgQzM0Mi42OTU4LDI1OC42OTMgMzYwLjkyODQsMzY5LjM1OTggMzY5LjE1MDQsNDE5LjI2MzggIiBmaWxsPSJub25lIiBpZD0iZmpzLXRvLWZwMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNzAuMTI1OCw0MjUuMTg0LDM3Mi42MDk1LDQxNS42NTM1LDM2OS4zMTMsNDIwLjI1MDUsMzY0LjcxNTksNDE2Ljk1NCwzNzAuMTI1OCw0MjUuMTg0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBmZGJzIHRvIEJJLS0+PGcgaWQ9ImxpbmtfZmRic19CSSI+PHBhdGggZD0iTTEyMS4xNDIyLDcwOC41OTk3IEMxMTQuMzc1Miw3MTguMTM4NyAxMTEuNDg2Nyw3MjQuMjQ4IDEwNy45NjY4LDczNS41IEMxMDMuMzA0OSw3NTAuNDAyIDEwMy4wNjQyLDc2Ny41MjE0IDEwNC4zNjMyLDc4Mi40MDE0ICIgZmlsbD0ibm9uZSIgaWQ9ImZkYnMtYmFja3RvLUJJIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyNC42MTM4LDcwMy43MDYsMTE2LjE0NCw3MDguNzMyMSwxMjEuNzIwOCw3MDcuNzg0MSwxMjIuNjY4OSw3MTMuMzYwOSwxMjQuNjEzOCw3MDMuNzA2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOCIgeD0iMTA4Ljk2NjgiIHk9Ijc0OC41NjY5Ij5iaW5sb2c8L3RleHQ+PC9nPjwhLS1yZXZlcnNlIGxpbmsgZmRicyB0byBEVy0tPjxnIGlkPSJsaW5rX2ZkYnNfRFciPjxwYXRoIGQ9Ik0xNjAuODQwMiw3MDkuNTM3OCBDMTY3LjA4NzIsNzMyLjMzOTggMTc0LjEwMjgsNzU3Ljk0NyAxODAuNzcxOCw3ODIuMjg3NyAiIGZpbGw9Im5vbmUiIGlkPSJmZGJzLWJhY2t0by1EVyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTkuMjU0OCw3MDMuNzUxLDE1Ny43NzUsNzEzLjQ4ODEsMTYwLjU3Niw3MDguNTczMywxNjUuNDkwNyw3MTEuMzc0MiwxNTkuMjU0OCw3MDMuNzUxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOCIgeD0iMTczLjk2NjgiIHk9Ijc0OC41NjY5Ij5iaW5sb2c8L3RleHQ+PC9nPjwhLS1TUkM9W1ZQRXpKaUNtNThMdEZ5TExreTBHZ1I3SzlRZWdLTkxlMXFHYlhleDhKYW44Y3lKMUplaWduQzM4bThfNEdwMG1tQ3BwS0Y0UW43T1NjWkdiV3RMcHlqc1N1b2tSLTNhTlMzQVI4UUFoSVJ5aXBaOGNJNTRXdkNUeTVLMWQtXzN1eV94SFdMaTRuUEZvVzZiai1fb2Z3ZU5pMDk1bWtQM0daUUZtQVd5NU8tYWstbDlLSHNhM2xLRWVZMDVFbTZ6SVB3Wi1YMlJ6c1lrb2NJZ0xBak5jcW1Pc2R5X0pORjNPb2p6VlJ6bE5VLUVSR1BTQmFlUENXbTc5MklNb0laV1U2T2U2ZUJ5TmszQVlXR2dlQ2JWVXNVdmVNZ3NyUkFuVEN2eENoUGN0ZWhYNFNHcXJLcG9EVkM3RmNMWDdGaGxlUUoySGxLRTBNbUJrOEcyTjA2d0M4amQ4d3paNDI2VzJXcTUyUEN4NFMwWl9XUjgwUEtwTXA3OXdLTmtzQ3hEUHd2aFJlazVJbW9zemtBS054X05nZk1XMm10YUdoMlpiZlVlUTVOa205OVRCcWNZbVB3eE8tbi1fQi05enFLcDFxTzg3U2ZGd0hwdjlNTm9pSmUtdzc0eExhaGJEMElES05oeEhqMnA2U3VINkt0MU1jTjZIN2owZVpOYzhubENNekhTMF0tLT48L2c+PC9zdmc+'>

<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><ol>
<li>前后端分离，职责清晰，开发效率提升，服务不需要频繁发布</li>
<li>通过微服务调用，隐藏内部表结构，拆库拆表</li>
<li>减小修改范围，快速部署</li>
<li>基于不同微服务的性能表现，针对性横向扩容</li>
</ol>
<h3 id="缺陷-1"><a href="#缺陷-1" class="headerlink" title="缺陷"></a>缺陷</h3><ol>
<li>基于表结构建模，导致众多贫血、CRUD的微服务</li>
<li>产品服务编排底层微服务，多次通信导致耦合</li>
<li>被BI、DW同步的表，无法拆分</li>
<li>调用链路增加导致测试以及问题排查成本增加</li>
</ol>
<h2 id="微服务治理"><a href="#微服务治理" class="headerlink" title="微服务治理"></a>微服务治理</h2><p>经过一段时间的积累沉淀，开发人员对微服务、对业务都有了更深层次的理解。为了更加明确业务领域，提升系统的扩展性、应对日益增多的流量以及服务于能力输出的开放平台，有必要对现有微服务进行一次治理。</p>
<ol>
<li>通过框架，跟踪记录每次调用链路</li>
<li>提升CI/CD，节约部署成本</li>
<li>服务应该基于业务上线文，明确服务需要处理的业务及系统中位置，其次再考虑需要保存什么样的数据。基于业务领域，承担并暴露更具业务含义的接口</li>
<li>通过协同，替换编排，抽离配置业务流程。</li>
<li>通过消息中间件，解耦DB和其他部门之间的数据同步</li>
</ol>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI5MjVweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjkwM3B4O2hlaWdodDo5MjVweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA5MDMgOTI1IiB3aWR0aD0iOTAzcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciA/Py0tPjxnIGlkPSJjbHVzdGVyXyYjMjQyMTI7JiMyOTk5MjsiPjxwYXRoIGQ9Ik0xOTUuNDU0NCwxNDQuNSBMMjI2LjQ1NDQsMTQ0LjUgQTMuNzUsMy43NSAwIDAgMSAyMjguOTU0NCwxNDcgTDIzNS45NTQ0LDE2Ni43OTY5IEw0OTYuNDU0NCwxNjYuNzk2OSBBMi41LDIuNSAwIDAgMSA0OTguOTU0NCwxNjkuMjk2OSBMNDk4Ljk1NDQsNDI1IEEyLjUsMi41IDAgMCAxIDQ5Ni40NTQ0LDQyNy41IEwxOTUuNDU0NCw0MjcuNSBBMi41LDIuNSAwIDAgMSAxOTIuOTU0NCw0MjUgTDE5Mi45NTQ0LDE0NyBBMi41LDIuNSAwIDAgMSAxOTUuNDU0NCwxNDQuNSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE5Mi45NTQ0IiB4Mj0iMjM1Ljk1NDQiIHkxPSIxNjYuNzk2OSIgeTI9IjE2Ni43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMwIiB4PSIxOTYuOTU0NCIgeT0iMTU5LjQ5NTEiPiYjMjQyMTI7JiMyOTk5Mjs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIGJpei0tPjxnIGlkPSJjbHVzdGVyX2JpeiI+PHBhdGggZD0iTTI0MS43OTIyLDI5MC40NzE5IEMyNDUuOTA5NCwyODMuNDM4NiAyNTAuODg4NSwyODIuMTAxMiAyNTYuMzcwMSwyODkuMDQ5MiBDMjU5LjM3MTEsMjgwLjc5ODcgMjY0LjkzMDQsMjgwLjM5NDggMjcwLjYxNjMsMjg2LjM1ODEgQzI3NC45NjU1LDI3OS4xODM0IDI4MC40NjYxLDI3Ni45MzI1IDI4Ni4yNzI3LDI4NC44NDU3IEMyOTAuOTI4MywyNzguNDk4IDI5Ni42NzgsMjc4LjQzMDMgMzAxLjM1MTYsMjg0LjgyNDQgQzMwNS4yMTcsMjc1LjcwMjUgMzExLjM5MzQsMjc1LjY2OTggMzE4LjIzNTgsMjgxLjQ1MTggQzMyMS42ODI0LDI3My4yOTQgMzI2LjIxNTgsMjcyLjUzMTIgMzMyLjMzNzEsMjc4Ljg0NTYgQzMzNi40NDA2LDI3MS44MDM4IDM0My4xMTE2LDI3My44OTM5IDM0Ni4yNzIyLDI3OS44NTYxIEMzNTIuODIxNCwyNzIuOTI2OSAzNTguMTMzLDI3My4zNTA4IDM2My41NjkyLDI4MS4xNjIyIEMzNjkuNDI2NywyNzQuNTE2NiAzNzQuNDQ1MywyNzQuNjYyNyAzNzkuMDYwMiwyODIuNDkyMiBDMzgzLjczNTgsMjc2LjkyNjYgMzg4LjI1NiwyNzYuMzA3NCAzOTEuODUxOCwyODMuNTY4OSBDMzk5LjI1MTUsMjc1LjIwNTcgNDA0LjQzNjcsMjc3LjY2NTkgNDA5LjA4MywyODYuMzUxNyBDNDEzLjc0MiwyNzguNjg1MSA0MjEuMDA1NiwyNzguNzg4NCA0MjQuNDIzOCwyODcuNTEzIEM0MjguOTM5NywyODEuMzIzOCA0MzIuOTY1MSwyODEuNzY3MyA0MzcuNDQyMSwyODcuNTU1MiBDNDQ2Ljg4NiwyODAuNzE5MyA0NTYuMjI0MywyODQuMTU3MSA0NTguOTU0NCwyOTUuNSBDNDYwLjY5OTcsMjk1LjQwMjggNDYxLjUyNjgsMjk2LjE5NjQgNDYxLjA2NTcsMjk3Ljk3ODUgQzQ3My4wNjY1LDMwMi4zODcgNDczLjgwNTcsMzA5LjA2MDkgNDY1LjM2NTQsMzE3Ljg4NDcgQzQ3NS40MTYzLDMyMS4yNjYxIDQ3OC43NTcsMzI5LjYzNzYgNDcxLjY2MzQsMzM4LjMwNjQgQzQ4Mi40OTM4LDM0Ny4yOTc5IDQ3Ny44MDgsMzU3Ljk5ODEgNDY1LjgzNjYsMzYxLjE4MTYgQzQ3NS4wMDU1LDM3Ni43NTY5IDQ2Ny42OTI4LDM4NS4wNjI0IDQ1MS45NTQ0LDM4Ny41IEM0NTIuMDg5NCwzODcuNTE5NSA0NTIuMTM0OSwzODcuNjAzMSA0NTIuMDQzNiwzODcuNzE2IEM0NDkuMTI5NywzOTMuNjY3NSA0NDQuNTgxOCwzOTUuNzYxMyA0MzkuMzg1OSwzOTAuMjMyIEM0MzMuNjg0NywzOTguMzM1IDQyNy4yMTcxLDM5Ni42MzkzIDQyMy4xMjE5LDM4OC42MTI2IEM0MTkuMjMyNiwzOTUuOTkyMiA0MTQuOTExNCwzOTYuNTQzMiA0MDkuNDgyNCwzOTAuMTM1OCBDNDA1LjQ4OTMsMzk4LjA4NzMgMzk4LjIzNzksMzk4LjU3MTMgMzk0LjEyNzQsMzkwLjI0NjYgQzM4OS45NzUsMzk4LjEyMjUgMzgxLjUxMDcsMzk5LjUwNDkgMzc2Ljc0MDUsMzkwLjg5ODIgQzM3MS4wMTMzLDM5OC4xMDk1IDM2NS4wMDk4LDM5Ny43MTI2IDM2MS40NTA1LDM4OC44Mzc3IEMzNTguMjA4NSwzOTYuOTI2NCAzNTMuMjk1OSwzOTcuNDczMSAzNDcuMzQ5MywzOTEuNTYxNyBDMzQxLjgyNzEsMzk4Ljg4OTggMzM2LjU4NzYsMzk4LjA4MDYgMzMyLjE3ODEsMzkwLjQzNDQgQzMyNi44NjEsMzk1LjY3NTQgMzIyLjI1OCwzOTQuNzIxNiAzMTguNDMzNSwzODguNjI0OSBDMzEzLjcxNTEsMzk2Ljk1MjYgMzA4LjMyOTEsMzk1Ljk5NzMgMzAzLjE1MDMsMzg5LjA4NjYgQzI5OC40NTk2LDM5OC42MTQyIDI5MS45Nzg0LDM5Ny44OTIzIDI4NS42NDY2LDM5MC44MTY2IEMyODAuOTMxMiwzOTcuMDAwMyAyNzQuMjEzNCwzOTUuODA0NCAyNzAuOTQxMSwzODkuMTYyMSBDMjY2Ljk5NDMsMzk3LjMzNTggMjU5LjYwNzIsMzk2LjMwMjMgMjU1LjE4OSwzODkuNjYzMyBDMjQ0LjM4OTcsMzk2LjE4ODIgMjM1Ljk5NTQsMzkyLjgwMDUgMjMyLjk1NDQsMzgwLjUgQzIzNC4yNTIyLDM4MS40Nzc3IDIzNC40ODM0LDM4Mi4zOTk1IDIzMy4wMjg3LDM4My40NDY2IEMyMjIuNjgwOCwzNzguNTU5MSAyMTkuODg5NiwzNzAuNjExNyAyMjkuMTQ3NiwzNjIuMTUxIEMyMTYuNTg5LDM1Ni44NDEzIDIxNS4wMzMyLDM0Ny42MjM0IDIyNS45ODYzLDMzOS4wOTA1IEMyMTguNjA4MywzMzEuMTY2NiAyMjAuOTY0MywzMjIuODY5NCAyMzAuNjI1NiwzMTguODUxMyBDMjE5Ljk2ODEsMzA2LjI1MjIgMjIxLjc2NjEsMjkyLjIzMyAyMzkuOTU0NCwyODguNSBDMjQxLjQ2OTEsMjg4LjM0MSAyNDIuMTIwNiwyODguOTEzMiAyNDEuNzkyMiwyOTAuNDcxOSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMCIgeD0iMzMwLjk1NDQiIHk9IjMwNi40OTUxIj4mIzE5OTk0OyYjMjExNTM7PC90ZXh0PjwvZz48IS0tY2x1c3RlciBGTi0tPjxnIGlkPSJjbHVzdGVyX0ZOIj48cGF0aCBkPSJNNTMzLjQ1NDQsMTM2LjUgTDU2NC40NTQ0LDEzNi41IEEzLjc1LDMuNzUgMCAwIDEgNTY2Ljk1NDQsMTM5IEw1NzMuOTU0NCwxNTguNzk2OSBMNzQ1LjQ1NDQsMTU4Ljc5NjkgQTIuNSwyLjUgMCAwIDEgNzQ3Ljk1NDQsMTYxLjI5NjkgTDc0Ny45NTQ0LDM5MyBBMi41LDIuNSAwIDAgMSA3NDUuNDU0NCwzOTUuNSBMNTMzLjQ1NDQsMzk1LjUgQTIuNSwyLjUgMCAwIDEgNTMwLjk1NDQsMzkzIEw1MzAuOTU0NCwxMzkgQTIuNSwyLjUgMCAwIDEgNTMzLjQ1NDQsMTM2LjUgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1MzAuOTU0NCIgeDI9IjU3My45NTQ0IiB5MT0iMTU4Ljc5NjkiIHkyPSIxNTguNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMCIgeD0iNTM0Ljk1NDQiIHk9IjE1MS40OTUxIj4mIzM2MTcxOyYjMzMwMjE7PC90ZXh0PjwvZz48IS0tY2x1c3RlciBGLS0+PGcgaWQ9ImNsdXN0ZXJfRiI+PHBhdGggZD0iTTQwLjMxOTIsNDc5LjIwNzUgQzUwLjc5ODgsNDU4LjY5MzggNjkuMzAwMyw0NTguNzc4OCA4MC4wNDYsNDc4Ljk0NzYgQzkwLjI4ODcsNDU5LjE0OTggMTA5LjI2OTEsNDU5LjAwNTkgMTIwLjMxNDgsNDc4LjExNjcgQzEzMy4zNTY2LDQ2NC4yODgxIDE0NS42MTI2LDQ2NC4yNDEyIDE1NS4wMDcxLDQ4Mi4xMDg3IEMxNjcuNTc2Myw0NjEuODc5MyAxODEuOTQyNCw0NjQuMzkxMyAxOTUuNjQ3Niw0ODAuODUwNSBDMjA3LjkxMTgsNDYwLjI1ODggMjIyLjMzODMsNDYxLjIyNTYgMjM2LjExMDcsNDc5LjI3MSBDMjQ1LjczMTYsNDU5LjEzMTkgMjYzLjE3NDQsNDU4LjM0NTMgMjc1LjU0ODIsNDc2LjQzMDcgQzI4NS40OTk3LDQ1My4zMDY2IDMwNy4wMDUxLDQ1NS4xNzcgMzE4LjU1NDEsNDc0LjgyNDQgQzMyOC42MzIyLDQ1OS41MTM4IDM0My41MjM1LDQ2MS44MTg0IDM1Mi4yMzM0LDQ3Ni4zNjc1IEMzNjQuOTUwNiw0NTYuODc0NCAzODMuNDY0NSw0NTQuNzY4OSAzOTQuNzA4LDQ3Ny44MzgyIEM0MDguMzI4NCw0NTUuNDk5OSA0MjEuMzQyOCw0NTYuNzcxNyA0MzUuNzU0Niw0NzcuMDc2NSBDNDQ4LjA3ODIsNDU2LjYwMzkgNDYxLjIzNzIsNDU3LjUwNDIgNDc0LjI0NTksNDc2LjQwNjcgQzQ4Ny43OTAzLDQ2Mi43NDg3IDQ5OS4wMTc5LDQ2MS4wMzY5IDUwOS4zOTA0LDQ3OS44NDA3IEM1MjQuMjMyMiw0NTcuNjk1IDUzNy4yNzQ5LDQ2My4zNzUzIDU1MC43Mzk5LDQ4MS4yNjI3IEM1NjQuNDQyLDQ2Mi4xNjc2IDU4Mi4yMTEzLDQ2NC43NTgyIDU5My45NTQ0LDQ4My41IEM1OTYuOTY0OCw0ODMuOTI4NiA1OTguMDY2OCw0ODUuOTM2OCA1OTUuOTM4NCw0ODguNDMyNCBDNjE0LjI0MDYsNDk4LjAxMDEgNjIxLjEzMSw1MTEuOTQyNyA2MDEuNzM3Miw1MjcuMTY0IEM2MjAuMjkzOCw1MzkuMTU1IDYyMi4zMjY3LDU1Mi4wOTc0IDYwMi4xMzg2LDU2NC41MDQ5IEM2MjIuNzgzMSw1NzMuODQ1MiA2MTkuNDk0Myw1OTEuMDU3OCA2MDMuNjEyMSw2MDEuODM5NyBDNjIxLjg3ODEsNjE1LjQxOCA2MjAuMzg1LDYyOC4yOTgxIDYwMy4xMTQ1LDY0MS40Mjk2IEM2MjAuODQzLDY1NC43NjA1IDYyNC45MTQ0LDY2Ny42MzYxIDYwNS4zMTE5LDY4Mi45NDMgQzYyNS45ODkyLDY5NC41MzI0IDYyNC44MjY0LDcwOS45NTYxIDYwNS43NzAxLDcyMi4wMTE2IEM2MjMuMDkyOCw3MzQuMzA3NSA2MjIuMjA0Myw3NTIuOTU5NSA2MDIuNzM4Niw3NjIuNTAwOSBDNjE5LjI3Niw3NzQuMjgyOSA2MjAuMjk2OCw3OTMuNTA2MiA1OTguNTM4NCw4MDEuMTIzNSBDNjE3LjEzNjMsODA5LjIyNDUgNjE3LjY4MTksODI0Ljc5NDUgNjAwLjUyNjIsODM0Ljk5MzkgQzYxNS43MSw4NTIuNzk2MSA2MTIuMTk3OCw4NzQuNzU0OCA1ODYuOTU0NCw4ODAuNSBDNTkxLjc0NzEsODc4LjgzNjEgNTkzLjY5MzQsODgwLjQ1NzMgNTkzLjE4NDksODg1LjQ1NjggQzU4MC44NjQ5LDkwNS4yNzM5IDU2Ni41NzY5LDkwNi40MTEyIDU1MS44NzgxLDg4OC4wMjkyIEM1MzYuMDE1MSw5MDkuOTEwOCA1MjAuNjkwMyw5MDcuODE3OCA1MDguOTUxMyw4ODQuMTQzMyBDNDk4LjI4ODEsOTA0LjA5NDYgNDg1LjkwNzYsOTA1LjU0MyA0NjkuOTIyLDg4OS45OTQ5IEM0NTguNjQ5Miw5MDcuOTQxNCA0NDUuNjM0NCw5MDYuOTU2OSA0MzQuNTIwOCw4ODkuODM0MiBDNDI0LjkzMTUsOTEwLjU1NTYgNDEwLjU0OTQsOTA5LjkyOTggMzk3LjMxMiw4OTMuNDg2NiBDMzg2LjM1NDIsOTE3LjQxNDcgMzY2Ljg5ODgsOTE4LjM0ODYgMzUyLjU2MjksODk2LjgxMTUgQzM0MC4xNTY3LDkxMy41OTM3IDMyMi42NzUzLDkxMy44NDU2IDMxMi4wMDksODk0LjgzOTkgQzMwNC4wODI0LDkxNC4wMjEgMjg1LjY2NjcsOTE0LjY5NSAyNzQuNjM0NCw4OTguMDgyOCBDMjYwLjc3MjgsOTE2LjIzOTUgMjQ4LjU2NzQsOTEzLjg4IDIzNy4wODc4LDg5NS42MjY1IEMyMjIuNjI5Myw5MTEuMjk4NyAyMDIuOTk1MSw5MDcuODI2NSAxOTUuMTQ0MSw4ODcuODUxOCBDMTg2LjI2NTcsOTAzLjAwMjkgMTY4Ljg1MDcsOTA0LjU0NCAxNTguNTQ2OSw4ODkuNTg0MyBDMTQ2Ljc2MDksOTA4LjY4MDcgMTMzLjEyMzgsOTA0Ljk3MTIgMTIxLjQ0OTcsODg5LjQ2NDMgQzEwNi4wNzAyLDkxMC44MDc4IDg5LjQ4NTYsOTA4LjEyMzUgNzUuODYyMyw4ODcuNTU0MSBDNTYuMjU0OCw5MDcuNTQ0NyAzNS4zMTU4LDg5Ny43MjA0IDI4Ljk1NDQsODczLjUgQzMxLjc5NDIsODc0LjY3OTMgMzEuNTgyNiw4NzYuOTMyMiAyOS4zNjY3LDg3OC41MjYyIEM4LjI3Miw4NjQuODY0IDkuMjExNiw4NTEuMDIwMyAyOS43MDQ4LDgzNy43MDI2IEMxMi4xNDI5LDgyNC41NzEzIDEyLjg2NjgsODEwLjY4MzkgMzIuNTkzMyw4MDAuNDQzNSBDMTYuMjg2LDc5MS4wNTgyIDEzLjkzMDEsNzcyLjY4OTMgMzEuNjYwOSw3NjIuNDY4MyBDOS43OTk5LDc1Mi40NDc5IDguMTI1Miw3MzIuNTM2OCAyOC42MDE0LDcxOS41MDE4IEM5Ljg0NDIsNzA5LjE3NDMgOS40OTY3LDY5Mi44OTEyIDI4LjczMzIsNjgyLjY5OTcgQzkuNTczMSw2NzMuMzM0NiA2LjAxMjIsNjU0LjA2OCAyNC4xMTc5LDY0MC42MTU5IEMxMS44MTYxLDYyNS4xOTk5IDEyLjYxMjksNjEyLjc3MzIgMzEuNTk4OCw2MDMuNjk2OSBDMTQuMDU1Niw1OTYuMTU4MyAxMS42ODc5LDU4MC4zODQ2IDI2LjgxNTYsNTY4LjQxNjYgQzYsNTUzLjcyMzMgOS4xMDcsNTM3LjM2NDggMjkuNzM5Myw1MjUuNDk1IEM5LjAwMSw1MDguNTk4IDguMTMzMiw0ODcuMjM3MSAzNS45NTQ0LDQ3Ni41IEMzOC42NDUyLDQ3NC45MTc2IDQwLjIwNTksNDc2LjYzNSA0MC4zMTkyLDQ3OS4yMDc1ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMwIiB4PSIyOTYuNDU0NCIgeT0iNDk0LjQ5NTEiPiYjMjEwNjk7JiMyMTQ4ODs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIGJpLS0+PGcgaWQ9ImNsdXN0ZXJfYmkiPjxwYXRoIGQ9Ik02NTcuODM2Myw2MzkuMjA2MSBDNjYxLjYyMDUsNjMwLjE2NTIgNjcwLjQ4ODEsNjI4LjYwNzIgNjc2LjU2NjgsNjM2LjY5NzUgQzY4MS42NzYyLDYyNy41MzU2IDY5MC4xMDM2LDYyNy4yMzIzIDY5NS44MDQ0LDYzNi4wNjUzIEM2OTkuNTUyNSw2MjQuODc2NCA3MDUuNTc4OCw2MjQuMjIwOSA3MTMuODU0MSw2MzEuNjg0MyBDNzE4LjQ2NTgsNjI0LjA0MTcgNzI2Ljc5NzQsNjIyLjExODQgNzMxLjQyNjUsNjMxLjY2NjUgQzczNi42Mzc3LDYyMi44NzY2IDc0My4zMzYzLDYyMi4xODI3IDc0OS4yNjAxLDYzMC45NDI0IEM3NTIuNjA5NSw2MjIuMzYxMiA3NjAuODI1MSw2MTkuMjQ2OSA3NjcuMjM5OSw2MjcuNzA4MyBDNzczLjE4MzIsNjIxLjQ0OTEgNzgxLjU5NTMsNjIxLjA5NyA3ODQuODI2NSw2MzAuNzEyOCBDNzg5LjU0ODEsNjIyLjIyODYgNzk1LjgzMSw2MjIuODg2MSA4MDEuMzI0MSw2MjkuODkxIEM4MDcuNzMwNiw2MjMuMjQxNCA4MTYuOTcyLDYyMi43ODI5IDgxOS44MjksNjMzLjY0MjMgQzgyNi4xNzYsNjI1LjkzNjYgODMzLjA2MDEsNjI2LjU2NjkgODM3LjMwMTksNjM1LjgxMjMgQzg0My4xODI4LDYyNS4wODQ0IDg1MS4wODQ4LDYyNC45NjcgODU3LjYxMzYsNjM1LjE4MzkgQzg2OC4wNzI5LDYyOC42MTIyIDg3Ny4xNjA5LDYyOS40NzgxIDg3OS45NTQ0LDY0My41IEM4ODIuMDAxOSw2NDMuNDgzMSA4ODIuNTU5Nyw2NDQuODAyOCA4ODEuNjk2Miw2NDYuNDg0NiBDODg5LjU0NTIsNjUwLjI3MDUgODg5LjIzNTIsNjU2LjU1MjQgODgzLjM3MjgsNjYxLjgzNTcgQzg5MC45MzI1LDY2Ni40ODEgODkxLjMwNjMsNjcxLjY3MzEgODg0LjAzMTksNjc2Ljk2NDYgQzg5MS44MTgsNjgyLjc5MjYgODkxLjE1NSw2ODguMTUxMyA4ODMuNjMzNiw2OTMuNjEzMSBDODkyLjExMDQsNjk3LjAyMjMgODk0LjYxMTksNzAyLjcxMTggODg3LjM4ODcsNzA5Ljc3IEM4OTMuNTM3MSw3MTQuNzYxNiA4OTEuOTQwOSw3MTkuMDkzNyA4ODYuMTI4Nyw3MjIuOTQxIEM4OTUuMjQ4Nyw3MjYuNzMxNCA4OTYuMDEzMSw3MzMuNzMzMSA4ODkuNDUzOSw3NDAuNDkzNyBDODk1Ljg3NTMsNzQ1LjE3OTQgODk0Ljg3NzEsNzUxLjY2NzcgODg4LjQ2NjUsNzU1LjUwOTcgQzg5Ni42NDE0LDc2MC41MTg5IDg5NS41MTQsNzY4LjQwMSA4ODcuOTU1NCw3NzIuOTQ5MiBDODk1LjU4MTUsNzc4LjYzNCA4OTQuODQwMyw3ODMuNDMzOSA4ODcuMDc4Miw3ODguMjM1NyBDODkzLjQxODgsNzkzLjU5NjEgODkyLjMxOTksNzk5LjI3OTggODg1LjMzMjIsODAzLjA3MTYgQzg5My4yODMxLDgwOS40NTMyIDg5MS4wNzQ5LDgxNS4wNjc1IDg4My41MjE1LDgxOS43Njc3IEM4OTAuMjcxLDgyNC4yNTQxIDg4OS4zNTgzLDgzMC42NzU4IDg4My4xMzEyLDgzNC44MjU4IEM4OTEuOTM4LDg0MC4wODU5IDg5MC4wNjY3LDg0OC40NTEgODgxLjQ4ODEsODUyLjA1MjkgQzg4Ny43MjUxLDg2Mi42ODg4IDg4NS45NjQ4LDg2OS41OTg0IDg3Mi45NTQ0LDg3MiBDODc0Ljg2MzksODcxLjc5NCA4NzUuOTU2Niw4NzMuMDA3IDg3NS4yMDc0LDg3NC44ODA0IEM4NjkuMTY1MSw4ODIuNzg4NiA4NjIuNjcyNSw4ODEuNDQ3MiA4NTcuNjg4NSw4NzMuNjk2NCBDODUzLjY0MjQsODgzLjMxNjggODQ2LjIwNTYsODg0LjExNDMgODM5LjgxMTYsODc2LjA3MjkgQzgzMy43NzM4LDg4Ni4yMDMxIDgyNi40NTI2LDg4NS43MzQ2IDgyMC43NDg3LDg3NS43NTY0IEM4MTUuMDA3OSw4ODMuNzU4MSA4MDguNTk2Niw4ODYuMTkzOCA4MDIuMzU4Myw4NzYuMjY2NiBDNzk2Ljg3NDQsODg3LjEwMzkgNzkxLjA3Niw4ODcuNTczMyA3ODMuMjk4Nyw4NzguNDU3NCBDNzc5LjcwNDYsODg1Ljg2NzcgNzcyLjM0Niw4ODYuNTQ5IDc2OC4wNDM4LDg3OS4xODg3IEM3NjAuODM0LDg4OC43MTQ4IDc1My43NDk0LDg4OS4yMDg1IDc0Ny4zMjI4LDg3OC4zOTEgQzc0MS45NTA1LDg4NS43ODI4IDczNC41MTc4LDg4NC40ODM1IDczMC43MDk4LDg3Ni42ODA2IEM3MjUuNTc0OSw4ODYuMzM0NCA3MTYuNjc5Niw4ODUuMTUyIDcxMS4wMjI2LDg3Ny4yNjY2IEM3MDYuODI5OCw4ODQuMjY4NiA2OTkuNTMwMyw4ODUuMjc2OSA2OTUuNTI0OSw4NzcuMDc1NyBDNjg5LjYyODUsODg0LjE3OTMgNjgwLjY3NTYsODg0LjE3ODEgNjc3Ljk0MjIsODczLjg3OTggQzY2NS40NzE2LDg4My40NzAxIDY1NC4wMzUyLDg4MS44NTMzIDY0OS45NTQ0LDg2NSBDNjUxLjE4NDcsODY1LjMwMDEgNjUxLjM2NTgsODY1LjkzNTggNjUwLjU3ODUsODY2Ljg5ODkgQzY0My4wMTE5LDg2Mi44NTkzIDY0MS42MTYxLDg1NC43OTIgNjUwLjQ3NTIsODUwLjY0OCBDNjQyLjI0NzIsODQ3LjU3MjYgNjQwLjYwNzQsODQxLjE3NjYgNjQ3LjQ5MjksODM1LjE4NjEgQzYzOS43NDc1LDgzMS4wODk4IDY0MC4wNjE5LDgyNS44ODI2IDY0NS44ODk0LDgyMC4zMjIxIEM2MzcuMDA4Nyw4MTQuMDcgNjM3Ljg3NzQsODA4Ljg5NDggNjQ2LjM2MDYsODAzLjExODMgQzYzNy44NTk2LDgwMC4yMTYzIDYzNS42OTY1LDc5NS4yMzc5IDY0MS45NzgxLDc4OC4wMzk1IEM2MzMuMjI3Miw3ODEuODc4NSA2MzUuNDU0Niw3NzYuMDc5MiA2NDMuMDc0Niw3NzAuOTY5NyBDNjM1LjQ2NzksNzY2LjY0NTMgNjMzLjk3MjYsNzYwLjc2ODQgNjQwLjg1NTQsNzU0LjQ5MjYgQzYzNC4zNDA1LDc1MC4zODM5IDYzNC45MTk1LDc0NC45Mjc4IDY0MC40MjcsNzQwLjQ1MjMgQzYzMy45NzE3LDczMy42MTAyIDYzNi41NTc5LDcyOC4xOTc2IDY0NC40NzY4LDcyNS4xNjMgQzYzNy4wMTM2LDcyMS4xMjMgNjM0LjkyMzgsNzEzLjAzMDYgNjQzLjc2NzYsNzA4LjMwNDYgQzYzNi43OTA4LDcwMS45MDI4IDYzOC40OTQyLDY5Ny4zNjcxIDY0Ni4wMjc4LDY5My4xMjYgQzYzOC4yNTEzLDY4Ni4wNzcgNjM5LjUxMjksNjgwLjY1MjkgNjQ4LjQ1NjEsNjc1Ljk3MDYgQzY0MS43NzQzLDY3MS40ODIxIDY0NC40NjUxLDY2NS4wMjYyIDY1MC40NTE5LDY2Mi40MDA4IEM2MzkuOTYxNCw2NTEuNTgxNiA2NDMuMzg4LDY0MS4yNzk2IDY1Ni45NTQ0LDYzNi41IEM2NTguMzM4OCw2MzcuMDUyMSA2NTguOTA0Nyw2MzcuODU0NyA2NTcuODM2Myw2MzkuMjA2MSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NCIgeD0iNzMyLjk1NDQiIHk9IjY1NC40OTUxIj5CSSAmYW1wOyBEVzwvdGV4dD48L2c+PCEtLWVudGl0eSBmanMtLT48ZyBpZD0iZWxlbV9manMiPjxwb2x5Z29uIGZpbGw9IiM5MEVFOTAiIHBvaW50cz0iMjA5LjQ1NDQsMTg5LjUsMjE5LjQ1NDQsMTc5LjUsMzI0LjQ1NDQsMTc5LjUsMzI0LjQ1NDQsMjE1Ljc5NjksMzE0LjQ1NDQsMjI1Ljc5NjksMjA5LjQ1NDQsMjI1Ljc5NjksMjA5LjQ1NDQsMTg5LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMxNC40NTQ0IiB4Mj0iMzI0LjQ1NDQiIHkxPSIxODkuNSIgeTI9IjE3OS41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjA5LjQ1NDQiIHgyPSIzMTQuNDU0NCIgeTE9IjE4OS41IiB5Mj0iMTg5LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzMTQuNDU0NCIgeDI9IjMxNC40NTQ0IiB5MT0iMTg5LjUiIHkyPSIyMjUuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc1IiB4PSIyMjQuNDU0NCIgeT0iMjEyLjQ5NTEiPiYjMjEwNjk7JiMyMTQ4ODtub2RlanM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgb2ctLT48ZyBpZD0iZWxlbV9vZyI+PHBvbHlnb24gZmlsbD0iIzkwRUU5MCIgcG9pbnRzPSIzNTkuNDU0NCwxODkuNSwzNjkuNDU0NCwxNzkuNSw0NjQuNDU0NCwxNzkuNSw0NjQuNDU0NCwyMTUuNzk2OSw0NTQuNDU0NCwyMjUuNzk2OSwzNTkuNDU0NCwyMjUuNzk2OSwzNTkuNDU0NCwxODkuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDU0LjQ1NDQiIHgyPSI0NjQuNDU0NCIgeTE9IjE4OS41IiB5Mj0iMTc5LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNTkuNDU0NCIgeDI9IjQ1NC40NTQ0IiB5MT0iMTg5LjUiIHkyPSIxODkuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQ1NC40NTQ0IiB4Mj0iNDU0LjQ1NDQiIHkxPSIxODkuNSIgeTI9IjIyNS43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUiIHg9IjM3NC40NTQ0IiB5PSIyMTIuNDk1MSI+b3BlbiYjMzI1OTM7JiMyMDg1MTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc2UtLT48ZyBpZD0iZWxlbV9zZSI+PGVsbGlwc2UgY3g9IjQxNC45NTQ0IiBjeT0iMzM5LjUiIGZpbGw9IiNGRkE1MDAiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQxMC45NTQ0LDMyNy41LDQxNi45NTQ0LDMyMi41LDQxNC45NTQ0LDMyNy41LDQxNi45NTQ0LDMzMi41LDQxMC45NTQ0LDMyNy41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iMzg2Ljk1NDQiIHk9IjM2OC40OTUxIj4mIzM1ODQzOyYjMjQyMzA7JiMyNDM0MTsmIzI1ODA2OzwvdGV4dD48L2c+PCEtLWVudGl0eSBwYy0tPjxnIGlkPSJlbGVtX3BjIj48ZWxsaXBzZSBjeD0iMzA5Ljk1NDQiIGN5PSIzMzkuNSIgZmlsbD0iI0ZGQTUwMCIgcng9IjEyIiByeT0iMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA1Ljk1NDQsMzI3LjUsMzExLjk1NDQsMzIyLjUsMzA5Ljk1NDQsMzI3LjUsMzExLjk1NDQsMzMyLjUsMzA1Ljk1NDQsMzI3LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0IiB4PSIyNjcuOTU0NCIgeT0iMzY4LjQ5NTEiPiYjMjAxMzU7JiMyMTY5NzsmIzM3MTk3OyYjMzI2MjI7JiMyMDAxMzsmIzI0NTE1OzwvdGV4dD48L2c+PCEtLWVudGl0eSBianMtLT48ZyBpZD0iZWxlbV9ianMiPjxwb2x5Z29uIGZpbGw9IiM5MEVFOTAiIHBvaW50cz0iNTU1LjQ1NDQsMTg5LjUsNTY1LjQ1NDQsMTc5LjUsNjcwLjQ1NDQsMTc5LjUsNjcwLjQ1NDQsMjE1Ljc5NjksNjYwLjQ1NDQsMjI1Ljc5NjksNTU1LjQ1NDQsMjI1Ljc5NjksNTU1LjQ1NDQsMTg5LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjY2MC40NTQ0IiB4Mj0iNjcwLjQ1NDQiIHkxPSIxODkuNSIgeTI9IjE3OS41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTU1LjQ1NDQiIHgyPSI2NjAuNDU0NCIgeTE9IjE4OS41IiB5Mj0iMTg5LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2NjAuNDU0NCIgeDI9IjY2MC40NTQ0IiB5MT0iMTg5LjUiIHkyPSIyMjUuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc1IiB4PSI1NzAuNDU0NCIgeT0iMjEyLjQ5NTEiPiYjMjE1MTg7JiMyMTQ4ODtub2RlanM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgYnAtLT48ZyBpZD0iZWxlbV9icCI+PGVsbGlwc2UgY3g9IjU4Mi45NTQ0IiBjeT0iMzM5LjUiIGZpbGw9IiNGRkE1MDAiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3OC45NTQ0LDMyNy41LDU4NC45NTQ0LDMyMi41LDU4Mi45NTQ0LDMyNy41LDU4NC45NTQ0LDMzMi41LDU3OC45NTQ0LDMyNy41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iNTU0Ljk1NDQiIHk9IjM2OC40OTUxIj4mIzIxNTE4OyYjMjE0ODg7JiMyMDEzNTsmIzIxNjk3OzwvdGV4dD48L2c+PCEtLWVudGl0eSBiYmQtLT48ZyBpZD0iZWxlbV9iYmQiPjxwYXRoIGQ9Ik02NDYuNDU0NCwzMzUgQzY0Ni40NTQ0LDMyNSA2ODAuOTU0NCwzMjUgNjgwLjk1NDQsMzI1IEM2ODAuOTU0NCwzMjUgNzE1LjQ1NDQsMzI1IDcxNS40NTQ0LDMzNSBMNzE1LjQ1NDQsMzYwLjI5NjkgQzcxNS40NTQ0LDM3MC4yOTY5IDY4MC45NTQ0LDM3MC4yOTY5IDY4MC45NTQ0LDM3MC4yOTY5IEM2ODAuOTU0NCwzNzAuMjk2OSA2NDYuNDU0NCwzNzAuMjk2OSA2NDYuNDU0NCwzNjAuMjk2OSBMNjQ2LjQ1NDQsMzM1ICIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTY0Ni40NTQ0LDMzNSBDNjQ2LjQ1NDQsMzQ1IDY4MC45NTQ0LDM0NSA2ODAuOTU0NCwzNDUgQzY4MC45NTQ0LDM0NSA3MTUuNDU0NCwzNDUgNzE1LjQ1NDQsMzM1ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDkiIHg9IjY1Ni40NTQ0IiB5PSIzNjEuOTk1MSI+JiMyMTUxODsmIzIxNDg4O0RCPC90ZXh0PjwvZz48IS0tZW50aXR5IG1zMC0tPjxnIGlkPSJlbGVtX21zMCI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI0NC45NTQ0LDUyMS41LDU0Ljk1NDQsNTExLjUsMTkyLjk1NDQsNTExLjUsMTkyLjk1NDQsNTQ3Ljc5NjksMTgyLjk1NDQsNTU3Ljc5NjksNDQuOTU0NCw1NTcuNzk2OSw0NC45NTQ0LDUyMS41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxODIuOTU0NCIgeDI9IjE5Mi45NTQ0IiB5MT0iNTIxLjUiIHkyPSI1MTEuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQ0Ljk1NDQiIHgyPSIxODIuOTU0NCIgeTE9IjUyMS41IiB5Mj0iNTIxLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxODIuOTU0NCIgeDI9IjE4Mi45NTQ0IiB5MT0iNTIxLjUiIHkyPSI1NTcuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOCIgeD0iNTkuOTU0NCIgeT0iNTQ0LjQ5NTEiPk1pY3JvU2VydmljZV8wPC90ZXh0PjwvZz48IS0tZW50aXR5IG1zMS0tPjxnIGlkPSJlbGVtX21zMSI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIyMjcuOTU0NCw1MjEuNSwyMzcuOTU0NCw1MTEuNSwzNzUuOTU0NCw1MTEuNSwzNzUuOTU0NCw1NDcuNzk2OSwzNjUuOTU0NCw1NTcuNzk2OSwyMjcuOTU0NCw1NTcuNzk2OSwyMjcuOTU0NCw1MjEuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzY1Ljk1NDQiIHgyPSIzNzUuOTU0NCIgeTE9IjUyMS41IiB5Mj0iNTExLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMjcuOTU0NCIgeDI9IjM2NS45NTQ0IiB5MT0iNTIxLjUiIHkyPSI1MjEuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM2NS45NTQ0IiB4Mj0iMzY1Ljk1NDQiIHkxPSI1MjEuNSIgeTI9IjU1Ny43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4IiB4PSIyNDIuOTU0NCIgeT0iNTQ0LjQ5NTEiPk1pY3JvU2VydmljZV8xPC90ZXh0PjwvZz48IS0tZW50aXR5IG1zMi0tPjxnIGlkPSJlbGVtX21zMiI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI0MTEuNDU0NCw1MjEuNSw0MjEuNDU0NCw1MTEuNSw1NTguNDU0NCw1MTEuNSw1NTguNDU0NCw1NDcuNzk2OSw1NDguNDU0NCw1NTcuNzk2OSw0MTEuNDU0NCw1NTcuNzk2OSw0MTEuNDU0NCw1MjEuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTQ4LjQ1NDQiIHgyPSI1NTguNDU0NCIgeTE9IjUyMS41IiB5Mj0iNTExLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MTEuNDU0NCIgeDI9IjU0OC40NTQ0IiB5MT0iNTIxLjUiIHkyPSI1MjEuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjU0OC40NTQ0IiB4Mj0iNTQ4LjQ1NDQiIHkxPSI1MjEuNSIgeTI9IjU1Ny43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA3IiB4PSI0MjYuNDU0NCIgeT0iNTQ0LjQ5NTEiPk1pY3JvU2VydmljZV8yPC90ZXh0PjwvZz48IS0tZW50aXR5IGZkYm0wLS0+PGcgaWQ9ImVsZW1fZmRibTAiPjxwYXRoIGQ9Ik0xMTkuOTU0NCw2NzMuNSBDMTE5Ljk1NDQsNjYzLjUgMTYzLjk1NDQsNjYzLjUgMTYzLjk1NDQsNjYzLjUgQzE2My45NTQ0LDY2My41IDIwNy45NTQ0LDY2My41IDIwNy45NTQ0LDY3My41IEwyMDcuOTU0NCw3MTUuMDkzOCBDMjA3Ljk1NDQsNzI1LjA5MzggMTYzLjk1NDQsNzI1LjA5MzggMTYzLjk1NDQsNzI1LjA5MzggQzE2My45NTQ0LDcyNS4wOTM4IDExOS45NTQ0LDcyNS4wOTM4IDExOS45NTQ0LDcxNS4wOTM4IEwxMTkuOTU0NCw2NzMuNSAiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMTkuOTU0NCw2NzMuNSBDMTE5Ljk1NDQsNjgzLjUgMTYzLjk1NDQsNjgzLjUgMTYzLjk1NDQsNjgzLjUgQzE2My45NTQ0LDY4My41IDIwNy45NTQ0LDY4My41IDIwNy45NTQ0LDY3My41ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OCIgeD0iMTI5Ljk1NDQiIHk9IjcwMC40OTUxIj4mIzE3MTttYXN0ZXImIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTgiIHg9IjEzNC45NTQ0IiB5PSI3MTYuNzkyIj5teXNxbF8wPC90ZXh0PjwvZz48IS0tZW50aXR5IGZkYm0xLS0+PGcgaWQ9ImVsZW1fZmRibTEiPjxwYXRoIGQ9Ik0yNTcuOTU0NCw2NzMuNSBDMjU3Ljk1NDQsNjYzLjUgMzAxLjk1NDQsNjYzLjUgMzAxLjk1NDQsNjYzLjUgQzMwMS45NTQ0LDY2My41IDM0NS45NTQ0LDY2My41IDM0NS45NTQ0LDY3My41IEwzNDUuOTU0NCw3MTUuMDkzOCBDMzQ1Ljk1NDQsNzI1LjA5MzggMzAxLjk1NDQsNzI1LjA5MzggMzAxLjk1NDQsNzI1LjA5MzggQzMwMS45NTQ0LDcyNS4wOTM4IDI1Ny45NTQ0LDcyNS4wOTM4IDI1Ny45NTQ0LDcxNS4wOTM4IEwyNTcuOTU0NCw2NzMuNSAiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yNTcuOTU0NCw2NzMuNSBDMjU3Ljk1NDQsNjgzLjUgMzAxLjk1NDQsNjgzLjUgMzAxLjk1NDQsNjgzLjUgQzMwMS45NTQ0LDY4My41IDM0NS45NTQ0LDY4My41IDM0NS45NTQ0LDY3My41ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OCIgeD0iMjY3Ljk1NDQiIHk9IjcwMC40OTUxIj4mIzE3MTttYXN0ZXImIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTgiIHg9IjI3Mi45NTQ0IiB5PSI3MTYuNzkyIj5teXNxbF8xPC90ZXh0PjwvZz48IS0tZW50aXR5IGZkYm0yLS0+PGcgaWQ9ImVsZW1fZmRibTIiPjxwYXRoIGQ9Ik0zOTUuOTU0NCw2NzMuNSBDMzk1Ljk1NDQsNjYzLjUgNDM5Ljk1NDQsNjYzLjUgNDM5Ljk1NDQsNjYzLjUgQzQzOS45NTQ0LDY2My41IDQ4My45NTQ0LDY2My41IDQ4My45NTQ0LDY3My41IEw0ODMuOTU0NCw3MTUuMDkzOCBDNDgzLjk1NDQsNzI1LjA5MzggNDM5Ljk1NDQsNzI1LjA5MzggNDM5Ljk1NDQsNzI1LjA5MzggQzQzOS45NTQ0LDcyNS4wOTM4IDM5NS45NTQ0LDcyNS4wOTM4IDM5NS45NTQ0LDcxNS4wOTM4IEwzOTUuOTU0NCw2NzMuNSAiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0zOTUuOTU0NCw2NzMuNSBDMzk1Ljk1NDQsNjgzLjUgNDM5Ljk1NDQsNjgzLjUgNDM5Ljk1NDQsNjgzLjUgQzQzOS45NTQ0LDY4My41IDQ4My45NTQ0LDY4My41IDQ4My45NTQ0LDY3My41ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OCIgeD0iNDA1Ljk1NDQiIHk9IjcwMC40OTUxIj4mIzE3MTttYXN0ZXImIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTciIHg9IjQxMS40NTQ0IiB5PSI3MTYuNzkyIj5teXNxbF8yPC90ZXh0PjwvZz48IS0tZW50aXR5IGZkYnMtLT48ZyBpZD0iZWxlbV9mZGJzIj48cGF0aCBkPSJNMjY0LjQ1NDQsODEyLjUgQzI2NC40NTQ0LDgwMi41IDMwMS45NTQ0LDgwMi41IDMwMS45NTQ0LDgwMi41IEMzMDEuOTU0NCw4MDIuNSAzMzkuNDU0NCw4MDIuNSAzMzkuNDU0NCw4MTIuNSBMMzM5LjQ1NDQsODU0LjA5MzggQzMzOS40NTQ0LDg2NC4wOTM4IDMwMS45NTQ0LDg2NC4wOTM4IDMwMS45NTQ0LDg2NC4wOTM4IEMzMDEuOTU0NCw4NjQuMDkzOCAyNjQuNDU0NCw4NjQuMDkzOCAyNjQuNDU0NCw4NTQuMDkzOCBMMjY0LjQ1NDQsODEyLjUgIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjY0LjQ1NDQsODEyLjUgQzI2NC40NTQ0LDgyMi41IDMwMS45NTQ0LDgyMi41IDMwMS45NTQ0LDgyMi41IEMzMDEuOTU0NCw4MjIuNSAzMzkuNDU0NCw4MjIuNSAzMzkuNDU0NCw4MTIuNSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUiIHg9IjI3NC40NTQ0IiB5PSI4MzkuNDk1MSI+JiMxNzE7c2xhdmUmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9IjI4MC45NTQ0IiB5PSI4NTUuNzkyIj5teXNxbDwvdGV4dD48L2c+PCEtLWVudGl0eSBqb2IxLS0+PGcgaWQ9ImVsZW1fam9iMSI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI3OTEuOTU0NCw2ODEuNSw4MDEuOTU0NCw2NzEuNSw4NjMuOTU0NCw2NzEuNSw4NjMuOTU0NCw3MDcuNzk2OSw4NTMuOTU0NCw3MTcuNzk2OSw3OTEuOTU0NCw3MTcuNzk2OSw3OTEuOTU0NCw2ODEuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iODUzLjk1NDQiIHgyPSI4NjMuOTU0NCIgeTE9IjY4MS41IiB5Mj0iNjcxLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3OTEuOTU0NCIgeDI9Ijg1My45NTQ0IiB5MT0iNjgxLjUiIHkyPSI2ODEuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijg1My45NTQ0IiB4Mj0iODUzLjk1NDQiIHkxPSI2ODEuNSIgeTI9IjcxNy43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzIiIHg9IjgwNi45NTQ0IiB5PSI3MDQuNDk1MSI+am9iMTwvdGV4dD48L2c+PCEtLWVudGl0eSBqb2IyLS0+PGcgaWQ9ImVsZW1fam9iMiI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI2ODUuNDU0NCw2ODEuNSw2OTUuNDU0NCw2NzEuNSw3NTYuNDU0NCw2NzEuNSw3NTYuNDU0NCw3MDcuNzk2OSw3NDYuNDU0NCw3MTcuNzk2OSw2ODUuNDU0NCw3MTcuNzk2OSw2ODUuNDU0NCw2ODEuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNzQ2LjQ1NDQiIHgyPSI3NTYuNDU0NCIgeTE9IjY4MS41IiB5Mj0iNjcxLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2ODUuNDU0NCIgeDI9Ijc0Ni40NTQ0IiB5MT0iNjgxLjUiIHkyPSI2ODEuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijc0Ni40NTQ0IiB4Mj0iNzQ2LjQ1NDQiIHkxPSI2ODEuNSIgeTI9IjcxNy43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzEiIHg9IjcwMC40NTQ0IiB5PSI3MDQuNDk1MSI+am9iMjwvdGV4dD48L2c+PCEtLWVudGl0eSBIQmFzZS0tPjxnIGlkPSJlbGVtX0hCYXNlIj48cGF0aCBkPSJNNzQxLjk1NDQsODIxIEM3NDEuOTU0NCw4MTEgNzczLjk1NDQsODExIDc3My45NTQ0LDgxMSBDNzczLjk1NDQsODExIDgwNS45NTQ0LDgxMSA4MDUuOTU0NCw4MjEgTDgwNS45NTQ0LDg0Ni4yOTY5IEM4MDUuOTU0NCw4NTYuMjk2OSA3NzMuOTU0NCw4NTYuMjk2OSA3NzMuOTU0NCw4NTYuMjk2OSBDNzczLjk1NDQsODU2LjI5NjkgNzQxLjk1NDQsODU2LjI5NjkgNzQxLjk1NDQsODQ2LjI5NjkgTDc0MS45NTQ0LDgyMSAiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03NDEuOTU0NCw4MjEgQzc0MS45NTQ0LDgzMSA3NzMuOTU0NCw4MzEgNzczLjk1NDQsODMxIEM3NzMuOTU0NCw4MzEgODA1Ljk1NDQsODMxIDgwNS45NTQ0LDgyMSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSI3NTEuOTU0NCIgeT0iODQ3Ljk5NTEiPkhCYXNlPC90ZXh0PjwvZz48IS0tZW50aXR5IEFQUC0tPjxnIGlkPSJlbGVtX0FQUCI+PGVsbGlwc2UgY3g9IjIzNS45NTQ0IiBjeT0iMTQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTIzNS45NTQ0LDIyIEwyMzUuOTU0NCw0OSBNMjIyLjk1NDQsMzAgTDI0OC45NTQ0LDMwIE0yMzUuOTU0NCw0OSBMMjIyLjk1NDQsNjQgTTIzNS45NTQ0LDQ5IEwyNDguOTU0NCw2NCAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSIyMjEuOTU0NCIgeT0iNzguNDk1MSI+QVBQPC90ZXh0PjwvZz48IS0tZW50aXR5IEg1LS0+PGcgaWQ9ImVsZW1fSDUiPjxlbGxpcHNlIGN4PSIyOTguOTU0NCIgY3k9IjE0IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yOTguOTU0NCwyMiBMMjk4Ljk1NDQsNDkgTTI4NS45NTQ0LDMwIEwzMTEuOTU0NCwzMCBNMjk4Ljk1NDQsNDkgTDI4NS45NTQ0LDY0IE0yOTguOTU0NCw0OSBMMzExLjk1NDQsNjQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOSIgeD0iMjg5LjQ1NDQiIHk9Ijc4LjQ5NTEiPkg1PC90ZXh0PjwvZz48IS0tZW50aXR5IFBhcnRuZXItLT48ZyBpZD0iZWxlbV9QYXJ0bmVyIj48ZWxsaXBzZSBjeD0iNDExLjk1NDQiIGN5PSIxNCIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNDExLjk1NDQsMjIgTDQxMS45NTQ0LDQ5IE0zOTguOTU0NCwzMCBMNDI0Ljk1NDQsMzAgTTQxMS45NTQ0LDQ5IEwzOTguOTU0NCw2NCBNNDExLjk1NDQsNDkgTDQyNC45NTQ0LDY0ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQiIHg9IjM4NC45NTQ0IiB5PSI3OC40OTUxIj5QYXJ0bmVyPC90ZXh0PjwvZz48IS0tZW50aXR5IE9wZXJhdG9yLS0+PGcgaWQ9ImVsZW1fT3BlcmF0b3IiPjxlbGxpcHNlIGN4PSI2MTIuOTU0NCIgY3k9IjE0IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik02MTIuOTU0NCwyMiBMNjEyLjk1NDQsNDkgTTU5OS45NTQ0LDMwIEw2MjUuOTU0NCwzMCBNNjEyLjk1NDQsNDkgTDU5OS45NTQ0LDY0IE02MTIuOTU0NCw0OSBMNjI1Ljk1NDQsNjQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NiIgeD0iNTc5Ljk1NDQiIHk9Ijc4LjQ5NTEiPk9wZXJhdG9yPC90ZXh0PjwvZz48IS0tbGluayBmanMgdG8gYml6LS0+PGcgaWQ9ImxpbmtfZmpzX2JpeiI+PHBhdGggZD0iTTI2MS40Njc0LDIyNS41MDYgQzI1OC41OTY0LDIzNy4wOTggMjU1LjA0NDQsMjUxLjU1OSAyNTEuOTU0NCwyNjQuNSBDMjUwLjkwMjMsMjY4LjkwNjMgMjQ5LjgyNjQsMjczLjQ0NzggMjQ4Ljc0NzksMjc4LjAyNzIgQzI0OC42MTMxLDI3OC41OTk2IDI0OC40NzgyLDI3OS4xNzI3IDI0OC4zNDMzLDI3OS43NDYxIEMyNDguMzA5NiwyNzkuODg5NSAyNDkuNjQ5LDI3NC4xOTIxIDI0OS42MTUzLDI3NC4zMzU1ICIgZmlsbD0ibm9uZSIgaWQ9ImZqcy10by1iaXoiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjQ4LjI0MjIsMjgwLjE3NjIsMjU0LjE5NTcsMjcyLjMzMDUsMjQ5LjM4NjUsMjc1LjMwODksMjQ2LjQwODEsMjcwLjQ5OTcsMjQ4LjI0MjIsMjgwLjE3NjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBvZyB0byBiaXotLT48ZyBpZD0ibGlua19vZ19iaXoiPjxwYXRoIGQ9Ik0zNTkuMTUwNCwyMjAuODcxIEMzMTUuNDgzNCwyMzUuNjgzIDI1OS40NTI0LDI1NS45MDIgMjUxLjk1NDQsMjY0LjUgQzI0OC45NzcyLDI2Ny45MTQ0IDI0Ni40NDI0LDI3MS43MDQzIDI0NC4yODY1LDI3NS43Mjg2IEMyNDMuNzQ3NSwyNzYuNzM0NyAyNDMuMjMyMywyNzcuNzU1NSAyNDIuNzM5NywyNzguNzg4NyBDMjQyLjQ5MzQsMjc5LjMwNTMgMjQ0LjcxNDMsMjc0LjM1MzIgMjQ0LjQ3OTIsMjc0Ljg3NTcgIiBmaWxsPSJub25lIiBpZD0ib2ctdG8tYml6IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI0Mi4wMTc3LDI4MC4zNDc1LDI0OS4zNTc5LDI3My43ODA4LDI0NC4wNjksMjc1Ljc4NzcsMjQyLjA2MjEsMjcwLjQ5ODgsMjQyLjAxNzcsMjgwLjM0NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBicCB0byBiYmQtLT48ZyBpZD0ibGlua19icF9iYmQiPjxwYXRoIGQ9Ik02MTEuMjgyNCwzNDcuNSBDNjIyLjk4NTQsMzQ3LjUgNjI4LjY4ODQsMzQ3LjUgNjQwLjM5MDQsMzQ3LjUgIiBmaWxsPSJub25lIiBpZD0iYnAtdG8tYmJkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY0Ni4zOTA0LDM0Ny41LDYzNy4zOTA0LDM0My41LDY0MS4zOTA0LDM0Ny41LDYzNy4zOTA0LDM1MS41LDY0Ni4zOTA0LDM0Ny41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgQVBQIHRvIGZqcy0tPjxnIGlkPSJsaW5rX0FQUF9manMiPjxwYXRoIGQ9Ik0yNDMuMzAxNCw4MS43MDcgQzI0OS4yODE0LDExMS45OTMgMjU2LjM2MiwxNDcuODU3NyAyNjEuMzcyLDE3My4yMjY3ICIgZmlsbD0ibm9uZSIgaWQ9IkFQUC10by1manMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjYyLjUzNDQsMTc5LjExMywyNjQuNzE1LDE2OS41MDg2LDI2MS41NjU3LDE3NC4yMDc3LDI1Ni44NjY1LDE3MS4wNTg1LDI2Mi41MzQ0LDE3OS4xMTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBINSB0byBmanMtLT48ZyBpZD0ibGlua19INV9manMiPjxwYXRoIGQ9Ik0yOTEuMzcwNCw4MS43MDcgQzI4NS4xOTc0LDExMS45OTMgMjc3Ljg4NjgsMTQ3Ljg2NDkgMjcyLjcxNTgsMTczLjIzMzkgIiBmaWxsPSJub25lIiBpZD0iSDUtdG8tZmpzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI3MS41MTc0LDE3OS4xMTMsMjc3LjIzNDQsMTcxLjA5MzIsMjcyLjUxNjEsMTc0LjIxMzcsMjY5LjM5NTYsMTY5LjQ5NTQsMjcxLjUxNzQsMTc5LjExMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIFBhcnRuZXIgdG8gb2ctLT48ZyBpZD0ibGlua19QYXJ0bmVyX29nIj48cGF0aCBkPSJNNDExLjk1NDQsODEuNzA3IEM0MTEuOTU0NCwxMTEuOTkzIDQxMS45NTQ0LDE0Ny43NDQgNDExLjk1NDQsMTczLjExMyAiIGZpbGw9Im5vbmUiIGlkPSJQYXJ0bmVyLXRvLW9nIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQxMS45NTQ0LDE3OS4xMTMsNDE1Ljk1NDQsMTcwLjExMyw0MTEuOTU0NCwxNzQuMTEzLDQwNy45NTQ0LDE3MC4xMTMsNDExLjk1NDQsMTc5LjExMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIE9wZXJhdG9yIHRvIGJqcy0tPjxnIGlkPSJsaW5rX09wZXJhdG9yX2JqcyI+PHBhdGggZD0iTTYxMi45NTQ0LDgxLjcwNyBDNjEyLjk1NDQsMTExLjk5MyA2MTIuOTU0NCwxNDcuNzQ0IDYxMi45NTQ0LDE3My4xMTMgIiBmaWxsPSJub25lIiBpZD0iT3BlcmF0b3ItdG8tYmpzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYxMi45NTQ0LDE3OS4xMTMsNjE2Ljk1NDQsMTcwLjExMyw2MTIuOTU0NCwxNzQuMTEzLDYwOC45NTQ0LDE3MC4xMTMsNjEyLjk1NDQsMTc5LjExMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGJqcyB0byBicC0tPjxnIGlkPSJsaW5rX2Jqc19icCI+PHBhdGggZD0iTTYwOC4zMzI0LDIyNS41MyBDNjAyLjc3NzQsMjUyLjAxMSA1OTQuNzI4MywyOTAuMzc1OCA1ODkuMDYyMywzMTcuMzg0OCAiIGZpbGw9Im5vbmUiIGlkPSJianMtdG8tYnAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTg3LjgzMDQsMzIzLjI1Nyw1OTMuNTkzLDMxNS4yNyw1ODguODU3LDMxOC4zNjM1LDU4NS43NjM1LDMxMy42Mjc1LDU4Ny44MzA0LDMyMy4yNTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBtczAgdG8gZmRibTAtLT48ZyBpZD0ibGlua19tczBfZmRibTAiPjxwYXRoIGQ9Ik0xMjUuMzA2NCw1NTcuODAyIEMxMzMuMTgwNCw1ODUuNDQ4IDE0NC45ODcxLDYyNi45MDI0IDE1My43NjExLDY1Ny43MTE0ICIgZmlsbD0ibm9uZSIgaWQ9Im1zMC10by1mZGJtMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTUuNDA0NCw2NjMuNDgyLDE1Ni43ODY0LDY1My43MzA2LDE1NC4wMzUsNjU4LjY3MzIsMTQ5LjA5MjMsNjU1LjkyMTgsMTU1LjQwNDQsNjYzLjQ4MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIG1zMSB0byBmZGJtMS0tPjxnIGlkPSJsaW5rX21zMV9mZGJtMSI+PHBhdGggZD0iTTMwMS45NTQ0LDU1Ny44MDIgQzMwMS45NTQ0LDU4NS40NDggMzAxLjk1NDQsNjI2LjY3MyAzMDEuOTU0NCw2NTcuNDgyICIgZmlsbD0ibm9uZSIgaWQ9Im1zMS10by1mZGJtMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMDEuOTU0NCw2NjMuNDgyLDMwNS45NTQ0LDY1NC40ODIsMzAxLjk1NDQsNjU4LjQ4MiwyOTcuOTU0NCw2NTQuNDgyLDMwMS45NTQ0LDY2My40ODIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBtczIgdG8gZmRibTItLT48ZyBpZD0ibGlua19tczJfZmRibTIiPjxwYXRoIGQ9Ik00NzguNjAyNCw1NTcuODAyIEM0NzAuNzI4NCw1ODUuNDQ4IDQ1OC45MjE4LDYyNi45MDI0IDQ1MC4xNDc4LDY1Ny43MTE0ICIgZmlsbD0ibm9uZSIgaWQ9Im1zMi10by1mZGJtMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NDguNTA0NCw2NjMuNDgyLDQ1NC44MTY2LDY1NS45MjE4LDQ0OS44NzM5LDY1OC42NzMyLDQ0Ny4xMjI1LDY1My43MzA2LDQ0OC41MDQ0LDY2My40ODIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBmZGJtMCB0byBmZGJzLS0+PGcgaWQ9ImxpbmtfZmRibTBfZmRicyI+PHBhdGggZD0iTTE4MS44MDI0LDcyNS44MjQgQzE5MS40MzI0LDc0MC43OTcgMjA0LjE2MDQsNzU4LjU4NiAyMTcuOTU0NCw3NzIuNSBDMjMxLjcwNzQsNzg2LjM3MyAyNDMuOTk3OCw3OTUuOTYxOCAyNTkuMjk1OCw4MDYuMjQ0OCAiIGZpbGw9Im5vbmUiIGlkPSJmZGJtMC10by1mZGJzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI2NC4yNzU0LDgwOS41OTIsMjU5LjAzNzUsODAxLjI1MTUsMjYwLjEyNTgsODA2LjgwMjcsMjU0LjU3NDYsODA3Ljg5MSwyNjQuMjc1NCw4MDkuNTkyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NCIgeD0iMjE4Ljk1NDQiIHk9Ijc2OC41NjY5Ij5zeW5jKGNhbmVsKTwvdGV4dD48L2c+PCEtLWxpbmsgZmRibTEgdG8gZmRicy0tPjxnIGlkPSJsaW5rX2ZkYm0xX2ZkYnMiPjxwYXRoIGQ9Ik0zMDEuOTU0NCw3MjUuNTY1IEMzMDEuOTU0NCw3NDguMjUgMzAxLjk1NDQsNzczLjI0OSAzMDEuOTU0NCw3OTYuMDMxICIgZmlsbD0ibm9uZSIgaWQ9ImZkYm0xLXRvLWZkYnMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzAxLjk1NDQsODAyLjAzMSwzMDUuOTU0NCw3OTMuMDMxLDMwMS45NTQ0LDc5Ny4wMzEsMjk3Ljk1NDQsNzkzLjAzMSwzMDEuOTU0NCw4MDIuMDMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NCIgeD0iMzAyLjk1NDQiIHk9Ijc2OC41NjY5Ij5zeW5jKGNhbmVsKTwvdGV4dD48L2c+PCEtLWxpbmsgZmRibTIgdG8gZmRicy0tPjxnIGlkPSJsaW5rX2ZkYm0yX2ZkYnMiPjxwYXRoIGQ9Ik00MjIuMTA2NCw3MjUuODI0IEM0MTIuNDc2NCw3NDAuNzk3IDM5OS43NDg0LDc1OC41ODYgMzg1Ljk1NDQsNzcyLjUgQzM3Mi4yMDE0LDc4Ni4zNzMgMzU5LjkxMSw3OTUuOTYxOCAzNDQuNjEzLDgwNi4yNDQ4ICIgZmlsbD0ibm9uZSIgaWQ9ImZkYm0yLXRvLWZkYnMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzM5LjYzMzQsODA5LjU5MiwzNDkuMzM0Myw4MDcuODkxLDM0My43ODMxLDgwNi44MDI3LDM0NC44NzE0LDgwMS4yNTE1LDMzOS42MzM0LDgwOS41OTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc0IiB4PSI0MDAuOTU0NCIgeT0iNzY4LjU2NjkiPnN5bmMoY2FuZWwpPC90ZXh0PjwvZz48IS0tbGluayBGTiB0byBGLS0+PGcgaWQ9ImxpbmtfRk5fRiI+PHBhdGggZD0iTTc0OC4wNjY3LDIzOS42NTAyIEM3NDguMTY1MiwyNDAuMTg4NyA3NDguMjYzNiwyNDAuNzMyIDc0OC4zNjE5LDI0MS4yNzk5IEM3NDkuMTQ4NywyNDUuNjYzNCA3NDkuOTMwMywyNTAuMzQ3IDc1MC42NzY0LDI1NS4yODYgQzc1Mi4xNjg3LDI2NS4xNjM5IDc1My41MTg3LDI3Ni4wNjM3IDc1NC40ODMxLDI4Ny42Mjg1IEM3NTguMzQwNCwzMzMuODg3OCA3NTYuMDI2NCwzOTAuNzg4IDczMS45NTQ0LDQzNS41IEM3MTQuNDAyOSw0NjguMTAwNSA2ODAuNjk4NCw0OTIuMzUwMyA2NTAuOTkzMyw1MDguNTcyMSBDNjM2LjE0MDgsNTE2LjY4MzEgNjIyLjI4OCw1MjIuNzg3IDYxMS45NTQyLDUyNi45MjQ0IEM2MDkuMzcwOCw1MjcuOTU4NyA2MDcuMDA3Miw1MjguODcwMiA2MDQuOTAzLDUyOS42NTkzIEM2MDQuMzc2OSw1MjkuODU2NiA2MDMuODY3MSw1MzAuMDQ2MiA2MDMuMzc0LDUzMC4yMjgyIEM2MDMuMTI3NSw1MzAuMzE5MiA2MDIuODg1Miw1MzAuNDA4MyA2MDIuNjQ3Miw1MzAuNDk1NSBDNjAyLjUyODIsNTMwLjUzOTEgNjA4LjA0NjcsNTI4LjUyNTYgNjA3LjkyOTksNTI4LjU2ODIgIiBmaWxsPSJub25lIiBpZD0iRk4tdG8tRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2MDIuMjkzNCw1MzAuNjI0OSw2MTIuMTE5Miw1MzEuMjk3Niw2MDYuOTkwNSw1MjguOTExLDYwOS4zNzcsNTIzLjc4MjIsNjAyLjI5MzQsNTMwLjYyNDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBiaXogdG8gbXMwLS0+PGcgaWQ9ImxpbmtfYml6X21zMCI+PHBhdGggZD0iTTIyNC44NzEzLDM2MS42MTcgQzIyNC43Nzc5LDM2MS43Njg1IDIyNC42ODM4LDM2MS45MjExIDIyNC41ODkxLDM2Mi4wNzQ5IEMyMjQuMzk5NiwzNjIuMzgyNCAyMjQuMjA3NCwzNjIuNjk0MyAyMjQuMDEyNCwzNjMuMDEwNyBDMjIzLjYyMjUsMzYzLjY0MzQgMjIzLjIyMTgsMzY0LjI5MzcgMjIyLjgxMDcsMzY0Ljk2MDggQzIyMS45ODg2LDM2Ni4yOTUxIDIyMS4xMjQ3LDM2Ny42OTY5IDIyMC4yMjI0LDM2OS4xNjExIEMyMTMuMDA0MSwzODAuODc1MiAyMDMuMzIzOSwzOTYuNTg0MyAxOTIuODAyMiw0MTMuNjU5MSBDMTcxLjc1ODcsNDQ3LjgwODggMTUwLjQ5NjcsNDgyLjMxMyAxMzUuNjgzMiw1MDYuMzUyICIgZmlsbD0ibm9uZSIgaWQ9ImJpei10by1tczAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTMyLjUzNTQsNTExLjQ2LDE0MC42NjI0LDUwNS44OTY0LDEzNS4xNTg1LDUwNy4yMDMzLDEzMy44NTE3LDUwMS42OTk1LDEzMi41MzU0LDUxMS40NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGJpeiB0byBtczEtLT48ZyBpZD0ibGlua19iaXpfbXMxIj48cGF0aCBkPSJNMjQwLjkyMzcsMzk1LjU0MjIgQzI0MC45ODY5LDM5NS44MzM5IDI0MS4wNTA0LDM5Ni4xMjYxIDI0MS4xMTQzLDM5Ni40MTg4IEMyNDEuMzcwMSwzOTcuNTg5NSAyNDEuNjMyMywzOTguNzY3OCAyNDEuOTAxLDM5OS45NTIgQzI0Mi40MzgzLDQwMi4zMjAyIDI0My4wMDE0LDQwNC43MTE4IDI0My41OTA5LDQwNy4xMTI5IEMyNDUuOTQ4Nyw0MTYuNzE3NCAyNDguNzI3Miw0MjYuNDc0MyAyNTEuOTU0NCw0MzUuNSBDMjYxLjY2NTQsNDYyLjY1OCAyNzQuMzE0LDQ4Ni42Nzg3IDI4NS41Miw1MDYuMDc1NyAiIGZpbGw9Im5vbmUiIGlkPSJiaXotdG8tbXMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI4OC41MjE0LDUxMS4yNzEsMjg3LjQ4MjgsNTAxLjQ3NzEsMjg2LjAyMDMsNTA2Ljk0MTYsMjgwLjU1NTcsNTA1LjQ3OSwyODguNTIxNCw1MTEuMjcxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgYml6IHRvIG1zMi0tPjxnIGlkPSJsaW5rX2Jpel9tczIiPjxwYXRoIGQ9Ik0yMzIuOTYzMiwzOTUuNjEzMiBDMjMyLjk4NzgsMzk1Ljc2MiAyMzMuMDEyNiwzOTUuOTEwNyAyMzMuMDM3OCwzOTYuMDU5NSBDMjMzLjA4ODEsMzk2LjM1NzEgMjMzLjEzOTYsMzk2LjY1NDggMjMzLjE5MjQsMzk2Ljk1MjUgQzIzNC4wMzcxLDQwMS43MTY0IDIzNS4yMDIzLDQwNi40OTU0IDIzNi43ODA3LDQxMS4xMTQxIEMyMzkuOTM3Nyw0MjAuMzUxNSAyNDQuNzQ3OSw0MjguOTQ3OCAyNTEuOTU0NCw0MzUuNSBDMjYzLjYzMDQsNDQ2LjExNiAzNzguNTUxNCw0NDYuMDUyIDM5Mi45NTQ0LDQ1Mi41IEM0MjIuNjcxNCw0NjUuODA0IDQ0NS43MzgsNDg3LjY1OTIgNDYyLjcsNTA2LjY5NjIgIiBmaWxsPSJub25lIiBpZD0iYml6LXRvLW1zMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NjYuNjkxNCw1MTEuMTc2LDQ2My42OTA3LDUwMS43OTU0LDQ2My4zNjUyLDUwNy40NDI5LDQ1Ny43MTc3LDUwNy4xMTczLDQ2Ni42OTE0LDUxMS4xNzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBqb2IxIHRvIEhCYXNlLS0+PGcgaWQ9Imxpbmtfam9iMV9IQmFzZSI+PHBhdGggZD0iTTgxOS4yNzg0LDcxNy41MTEgQzgwOS4xNDE0LDc0My4yMjggNzk0LjY4MTksNzc5LjkxNjEgNzg0LjYzMDksODA1LjQxMzEgIiBmaWxsPSJub25lIiBpZD0iam9iMS10by1IQmFzZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3ODIuNDMwNCw4MTAuOTk1LDc4OS40NTI0LDgwNC4wODksNzg0LjI2NDEsODA2LjM0MzQsNzgyLjAwOTgsODAxLjE1NTEsNzgyLjQzMDQsODEwLjk5NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIGpvYjIgdG8gSEJhc2UtLT48ZyBpZD0ibGlua19qb2IyX0hCYXNlIj48cGF0aCBkPSJNNzI5LjQ2OTQsNzE3LjUxMSBDNzM5LjQxODQsNzQzLjIyOCA3NTMuNjA2Niw3NzkuOTAyMiA3NjMuNDcwNiw4MDUuMzk5MiAiIGZpbGw9Im5vbmUiIGlkPSJqb2IyLXRvLUhCYXNlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc2NS42MzU0LDgxMC45OTUsNzY2LjExODcsODAxLjE1OCw3NjMuODMxNCw4MDYuMzMxOCw3NTguNjU3Niw4MDQuMDQ0NSw3NjUuNjM1NCw4MTAuOTk1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgRiB0byBiaS0tPjxnIGlkPSJsaW5rX0ZfYmkiPjxwYXRoIGQ9Ik02MDIuMDE4OCw1NTguMjUyNSBDNjAyLjA5NTksNTU4LjQ3IDYwMi4xNzM0LDU1OC42ODg3IDYwMi4yNTE0LDU1OC45MDg2IEM2MDIuNTYzLDU1OS43ODggNjAyLjg4MTMsNTYwLjY4NjEgNjAzLjIwNTksNTYxLjYwMTcgQzYwOC4zOTgyLDU3Ni4yNTE1IDYxNS4xODE5LDU5NS4zOTE0IDYyMS45NjQ4LDYxNC41MjkgQzYyOC43NDc4LDYzMy42NjY2IDYzNS41Mjk5LDY1Mi44MDIgNjQwLjcxOTEsNjY3LjQ0MjggQzY0MS4wNDM0LDY2OC4zNTc4IDY0MS4zNjE1LDY2OS4yNTUzIDY0MS42NzMsNjcwLjEzNDIgQzY0MS43NTA5LDY3MC4zNTM5IDYzOS44MjM5LDY2NC45MTcxIDYzOS45MDA5LDY2NS4xMzQ1ICIgZmlsbD0ibm9uZSIgaWQ9IkYtdG8tYmkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjQxLjkwNTQsNjcwLjc4OTgsNjQyLjY2ODksNjYwLjk3MDYsNjQwLjIzNSw2NjYuMDc3LDYzNS4xMjg1LDY2My42NDMxLDY0MS45MDU0LDY3MC43ODk4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MyIgeD0iNjE3Ljk1NDQiIHk9IjYwMC41NjY5Ij5tYW5hZ2U8L3RleHQ+PC9nPjwhLS1TUkM9W1pQRDFRbkduNUNWbC1ISUZBT1dVNWRPNlVZYmJlS2lmd3E1VHdDNlpQNlJJU1RVUFA0cDZJZktVUEViMWZMTGZsTlpwcWRmSDJZQUtuU0tsaS1Fa3R5OGFheWJFamdycjNZN2xGeHlhX19UVVdnRTJTVFplem43TWl6d2djVkduQm9aWDlkZ0c0dXhiMUE0U0hxem1HaTBobm9VcGFveVVsNEdXRnlmWWZScS1CRC1UZ19iR1U4MDV4MG01aEFJM3Y3NkhTNDllMHNLdmVSRjlYX0JXa21QUFNlY0JLbE9pMWN6d3lRYnl5emMzWk1xODFvX0NTVmVfZW1MZEFOWnB5cjR2RllyX1ZsbnpWQUd0NG1ITTZDU3E4UFZYd1ZZaUY3eHJ2LTFtRGxhc2xWWFFfWGhmOU5kYUJEZE5ldEJWWWpicHNrZ2VpeEtjWkpRYl9LUDV2Wl9VcGFTSmxUdE1WUlNreHVfU2tlSE5yQ0xRaEVaQVE0TmRaaGFPNXBaNG1rd3hzUXNlQzBSek4tQkFOSFdoVHhBcnJoM0MxX0xNZFQycXNNZWlHUVhrelk5SDJRQW1NT21TOFRFVWdrTExxYXhFem1PSFB6azR4bXVZeWdZaldLb3FobUR5MF9aTjBPNDFXZ0tJUDdsWVFNaHN0dWQzaDB0aHduYU0xVTZUM2JwOS1mUnJSc0czb21PdGlKS2Y5MlhJbDRqZ0pXeW96S05UYktzWi1leGc2cExtcjJoYkFoYzZCalAweEQ3ZVRlR2ZJVXpPbmx5RjlsVzc4LSAtQ2xCc2o2alpJQVFZTkxva2dZc3hpQnlNMWxIdFRrdDBCRFgtUXJ6a3k3cUNNLWF3cXJEWFVMdXdCLVlkU2RoM3Vmek9qb1NmX3V1Y2tHT1FmVjl2XzBHMDBdLS0+PC9nPjwvc3ZnPg=='>

<h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><ol>
<li>领域职责明确</li>
<li>扩展性强</li>
</ol>
<h3 id="缺陷-2"><a href="#缺陷-2" class="headerlink" title="缺陷"></a>缺陷</h3><ol>
<li>开发成本增加</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>技术选型本质上是取舍判断，比较得到的优点以及不得不面临的缺陷</li>
<li>不存在最牛的架构，只有当前阶段最适合的架构。所以在这里，我列出每次架构变更时的优缺点，希望可以作为参考</li>
<li>技术架构和人员组织会相互影响</li>
<li>高内聚、低耦合</li>
</ol>
]]></content>
      <categories>
        <category>微服务</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>微服务</tag>
      </tags>
  </entry>
  <entry>
    <title>浅入浅出监控系统</title>
    <url>/2018/06/26/monitor/</url>
    <content><![CDATA[<h2 id="如何搭建一个监控系统"><a href="#如何搭建一个监控系统" class="headerlink" title="如何搭建一个监控系统"></a>如何搭建一个监控系统</h2><p>生产环境必须是可监控的，一个对开发者黑盒的线上应用无异于灾难。一个简单的监控系统大致包含以下几部分: </p>
<ol>
<li>采集数据</li>
<li>保存数据</li>
<li>数据可视化</li>
<li>监控告警</li>
</ol>
<p><img src="http://img.yuheng.wang/monitor-00.jpg" alt="m0"></p>
<span id="more"></span>

<p>从一个熟悉的画面开始：</p>
<p><img src="http://img.yuheng.wang/monitor-01.jpg" alt="m1"></p>
<p>这是javaer每天都会看到的一个画面，当然为了减少bug，有时候也需要借助一下来自东方的神秘力量</p>
<p><img src="http://img.yuheng.wang/monitor-02.jpg" alt="m2"></p>
<p>仔细看console的第一行，灰色字体&amp;被折叠，看起来很不起眼，就被忽略了。</p>
<p><img src="http://img.yuheng.wang/monitor-03.jpg" alt="m3"></p>
<p>展开后内容如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_111.jdk&#x2F;Contents&#x2F;Home&#x2F;bin&#x2F;java </span><br><span class="line">-XX:TieredStopAtLevel&#x3D;1 </span><br><span class="line">-noverify </span><br><span class="line">-Dspring.output.ansi.enabled&#x3D;always </span><br><span class="line">-Dcom.sun.management.jmxremote </span><br><span class="line">-Dcom.sun.management.jmxremote.port&#x3D;61764 </span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate&#x3D;false </span><br><span class="line">-Dcom.sun.management.jmxremote.ssl&#x3D;false </span><br><span class="line">-Djava.rmi.server.hostname&#x3D;127.0.0.1 </span><br><span class="line">-Dspring.liveBeansView.mbeanDomain </span><br><span class="line">-Dspring.application.admin.enabled&#x3D;true </span><br><span class="line">&quot;-javaagent:&#x2F;Applications&#x2F;IntelliJ IDEA.app&#x2F;Contents&#x2F;lib&#x2F;idea_rt.jar&#x3D;61765:&#x2F;Applications&#x2F;IntelliJ IDEA.app&#x2F;Contents&#x2F;bin&quot; </span><br><span class="line">-Dfile.encoding&#x3D;UTF-8 </span><br><span class="line">-classpath ...</span><br></pre></td></tr></table></figure>

<p>出现频率最高的单词是<code>jmxremote</code>，这是我们需要了解的第一个概念<code>JMX</code>。</p>
<h3 id="JMX"><a href="#JMX" class="headerlink" title="JMX"></a>JMX</h3><blockquote>
<p>JMX（Java Management Extensions，即Java管理扩展）是Java平台上为应用程序、设备、系统等植入管理功能的框架。 –wikipedia</p>
</blockquote>
<p>如何做到<strong>管理功能</strong>呢？</p>
<ol>
<li>监控指标，包括业务监控&amp;系统性能监控</li>
<li>执行方法</li>
</ol>
<p>我们通过架构图来看一下，JMX如何实现这两个功能。</p>
<p><img src="http://img.yuheng.wang/monitor-04.jpg" alt="m4"></p>
<ol>
<li>接入层，提供远程访问接口</li>
<li>适配层，对资源的管理和注册</li>
<li>MBean，提供变量or函数</li>
</ol>
<p>还是不够直观，我们来具体看一下jmx能做什么。</p>
<p>在控制台中输入<code>jconsole</code>，你可以看到一个java GUI风格的工具窗口，这是jdk自带用于jmx连接&amp;展示的工具。</p>
<p><img src="http://img.yuheng.wang/monitor-05.jpg" alt="m5"></p>
<p>可以通过JDK提供的MBean查看线程、内存、CPU占用，检测死锁、执行GC。也可以通过三方按照JMX标准提供的MBean，查看or执行封装的函数方法。</p>
<p><img src="http://img.yuheng.wang/monitor-06.jpg" alt="m6"></p>
<p>以<code>SpringApplicationAdminMXBean</code>为例，声明了一个包含函数的interface作为MBean，并将实现类注册到MBeanServer服务中。用到了一个委托模式。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpringApplicationAdminMXBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isReady</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isEmbeddedWebApplication</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">String <span class="title">getProperty</span><span class="params">(String key)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringApplicationAdminMXBeanRegistrar</span></span></span><br><span class="line"><span class="class">		<span class="keyword">implements</span> <span class="title">ApplicationContextAware</span>, <span class="title">EnvironmentAware</span>, <span class="title">InitializingBean</span>,</span></span><br><span class="line"><span class="class">		<span class="title">DisposableBean</span>, <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationReadyEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(SpringApplicationAdmin.class);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> ConfigurableApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Environment environment = <span class="keyword">new</span> StandardEnvironment();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ObjectName objectName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> ready = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SpringApplicationAdminMXBeanRegistrar</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> MalformedObjectNameException </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.objectName = <span class="keyword">new</span> ObjectName(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">		Assert.state(applicationContext <span class="keyword">instanceof</span> ConfigurableApplicationContext,</span><br><span class="line">				<span class="string">&quot;ApplicationContext does not implement ConfigurableApplicationContext&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.applicationContext = (ConfigurableApplicationContext) applicationContext;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnvironment</span><span class="params">(Environment environment)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.environment = environment;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationReadyEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.applicationContext.equals(event.getApplicationContext())) &#123;</span><br><span class="line">			<span class="keyword">this</span>.ready = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		MBeanServer server = ManagementFactory.getPlatformMBeanServer();</span><br><span class="line">		server.registerMBean(<span class="keyword">new</span> SpringApplicationAdmin(), <span class="keyword">this</span>.objectName);</span><br><span class="line">		<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">			logger.debug(<span class="string">&quot;Application Admin MBean registered with name &#x27;&quot;</span></span><br><span class="line">					+ <span class="keyword">this</span>.objectName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ManagementFactory.getPlatformMBeanServer().unregisterMBean(<span class="keyword">this</span>.objectName);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringApplicationAdmin</span> <span class="keyword">implements</span> <span class="title">SpringApplicationAdminMXBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isReady</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> SpringApplicationAdminMXBeanRegistrar.<span class="keyword">this</span>.ready;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmbeddedWebApplication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> (SpringApplicationAdminMXBeanRegistrar.<span class="keyword">this</span>.applicationContext != <span class="keyword">null</span></span><br><span class="line">					&amp;&amp; SpringApplicationAdminMXBeanRegistrar.<span class="keyword">this</span>.applicationContext <span class="keyword">instanceof</span> EmbeddedWebApplicationContext);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> SpringApplicationAdminMXBeanRegistrar.<span class="keyword">this</span>.environment</span><br><span class="line">					.getProperty(key);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			logger.info(<span class="string">&quot;Application shutdown requested.&quot;</span>);</span><br><span class="line">			SpringApplicationAdminMXBeanRegistrar.<span class="keyword">this</span>.applicationContext.close();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>JConsole会根据方法及返回值，判断是指标还是可执行函数。</li>
<li>除了指标和函数，还有通知。但是JMX并不保证所有通知都会被监听器接收</li>
</ol>
<h3 id="influxdb"><a href="#influxdb" class="headerlink" title="influxdb"></a>influxdb</h3><p>知道了数据如何产生，接下来需要考虑数据如何持久化。</p>
<blockquote>
<p>InfluxDB是一个由InfluxData开发的开源时序型数据库。它由Go写成，着力于高性能地查询与存储时序型数据。InfluxDB被广泛应用于存储系统的监控数据，IoT行业的实时数据等场景。</p>
</blockquote>
<p>选型原因是influxdb有以下特点</p>
<ol>
<li>可度量性：你可以实时对大量数据进行计算</li>
<li>无结构（无模式）：可以是任意数量的列</li>
<li>原生的HTTP支持，内置HTTP API</li>
<li>基于时间序列，支持与时间有关的相关函数，如min, max, sum, count, mean, median 等一系列函数</li>
<li>强大的类SQL语法</li>
</ol>
<h4 id="强大的类SQL语法-amp-无结构"><a href="#强大的类SQL语法-amp-无结构" class="headerlink" title="强大的类SQL语法 &amp; 无结构"></a>强大的类SQL语法 &amp; 无结构</h4><p>看一下influxdb的语法，似曾相识。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">influx</span><br><span class="line">show databases;</span><br><span class="line">create database wyh_dev;</span><br><span class="line">use wyh_dev;</span><br><span class="line">show Measurements;</span><br></pre></td></tr></table></figure>

<p><code>Measurement</code>等价于mysql中的<code>table</code>，区别在于mysql表中存储字段，字段既可以作为展示也可以建立索引。但是influxdb存储的数据从逻辑上由<code>Measurement</code>、<code>tag组</code>、<code>field组</code>以及一个时间戳组成的。</p>
<ol>
<li>tag信息是默认被索引的。</li>
<li>Field信息用于展示，是无法被索引的。</li>
<li>time表示该条记录的时间属性。</li>
</ol>
<h5 id="Line-Protocol-语法"><a href="#Line-Protocol-语法" class="headerlink" title="Line Protocol 语法"></a>Line Protocol 语法</h5><p>利用逗号和空格，简化插入语句， 如果插入数据时没有明确指定时间戳，则默认存储在数据库中的时间戳则为该条记录的入库时间。(纳秒)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">weather,location=us-midwest temperature=82 1465839830100400200</span><br><span class="line">  |    -------------------- --------------  |</span><br><span class="line">  |             |             |             |</span><br><span class="line">  |             |             |             |</span><br><span class="line">+-----------+--------+-+---------+-+---------+</span><br><span class="line">|measurement|,tag_set| |field_set| |timestamp|</span><br><span class="line">+-----------+--------+-+---------+-+---------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> table1,tag1<span class="operator">=</span>a field1<span class="operator">=</span>&quot;fieldA&quot; </span><br><span class="line"><span class="keyword">insert</span> table1,tag1<span class="operator">=</span>tagB field1<span class="operator">=</span>&quot;fieldA&quot;,field2<span class="operator">=</span>&quot;fieldB&quot; </span><br><span class="line"><span class="keyword">insert</span> table1,tag1<span class="operator">=</span>a,tag2<span class="operator">=</span>b field1<span class="operator">=</span>&quot;fieldA&quot;,field2<span class="operator">=</span>&quot;fieldB&quot;,field3<span class="operator">=</span>&quot;fieldC&quot; </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table1</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> series <span class="keyword">from</span> table1</span><br><span class="line"><span class="keyword">SHOW</span> FIELD KEYS <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">SHOW</span> TAG KEYS <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">drop</span> measurement table1</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> table2,tagVal<span class="operator">=</span>tagA fieldVal<span class="operator">=</span>&quot;fieldA&quot; </span><br><span class="line"><span class="keyword">insert</span> table2,tagVal<span class="operator">=</span>tagB fieldVal<span class="operator">=</span>&quot;fieldA&quot; </span><br><span class="line"><span class="keyword">insert</span> table2,tagVal<span class="operator">=</span>tagA fieldVal<span class="operator">=</span>&quot;fieldB&quot; </span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table2 <span class="keyword">where</span> fieldVal<span class="operator">=</span><span class="string">&#x27;fieldA&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table2 <span class="keyword">where</span> tagVal<span class="operator">=</span><span class="string">&#x27;tagA&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table2 <span class="keyword">group</span> <span class="keyword">by</span> fieldVal</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table2 <span class="keyword">group</span> <span class="keyword">by</span> tagVal</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table1 <span class="keyword">group</span> <span class="keyword">by</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> table2 <span class="keyword">group</span> <span class="keyword">by</span> <span class="type">time</span>(<span class="number">2</span>d)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以下有两个常见教程出现的错误</p>
<ol>
<li>field 不可以作为group by条件，但是可以作为where条件</li>
<li>8083端口停用，web管理界面通过独立组件chronograf实现</li>
</ol>
<h4 id="原生的HTTP支持，内置HTTP-API"><a href="#原生的HTTP支持，内置HTTP-API" class="headerlink" title="原生的HTTP支持，内置HTTP API"></a>原生的HTTP支持，内置HTTP API</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -i -X POST &#x27;http://localhost:8086/write?db=wyh_dev&#x27; --data-binary &#x27;table2,tagVal=tagA fieldVal=&quot;http&quot; &#x27;</span><br><span class="line"></span><br><span class="line">curl -G &#x27;http://localhost:8086/query?pretty=true&#x27; --data-urlencode &quot;db=wyh_dev&quot; --data-urlencode &quot;q=SELECT * FROM table2 &quot;</span><br></pre></td></tr></table></figure>

<h4 id="基于时间序列，支持与时间有关的相关函数，如min-max-sum-count-mean-median-等一系列函数"><a href="#基于时间序列，支持与时间有关的相关函数，如min-max-sum-count-mean-median-等一系列函数" class="headerlink" title="基于时间序列，支持与时间有关的相关函数，如min, max, sum, count, mean, median 等一系列函数"></a>基于时间序列，支持与时间有关的相关函数，如min, max, sum, count, mean, median 等一系列函数</h4><p>每次insert记录，如果没有指定，默认会保存数据库当前时间(单位纳秒)。复杂的函数计算不符合浅入浅出的定位，我们换一种直观的角度。</p>
<h3 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h3><blockquote>
<p>The open platform for beautiful<br>analytics and monitoring</p>
</blockquote>
<p>很炫很好很强大，没什么好讲的。</p>
<h4 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h4><p><img src="http://img.yuheng.wang/monitor-08.jpg" alt="m8"></p>
<p>支持多种数据源。Access两种形式</p>
<ol>
<li>Server 服务器请求后渲染</li>
<li>Browser 浏览器直接请求</li>
</ol>
<h4 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h4><p><img src="http://img.yuheng.wang/monitor-09.jpg" alt="m9"><br>where 不能选择field，只能选择tag</p>
<p>画图参考<a href="https://play.grafana.org/d/000000012/grafana-play-home?orgId=1">官方文档</a></p>
<h4 id="配置告警"><a href="#配置告警" class="headerlink" title="配置告警"></a>配置告警</h4><p>配置告警通道，原生支持email、钉钉，但是支持webhook也就可以随意扩展，如企业微信、SMS等内部通信软件。e.g. <a href="!http://blog.crick.wang/2018/04/06/wechat-message-proxy/#more">企业微信</a></p>
<p><img src="http://img.yuheng.wang/monitor-10.jpg" alt="m10"></p>
<p>设定告警规则，包括统计方法、安全阈值。</p>
<h3 id="jmxtrans"><a href="#jmxtrans" class="headerlink" title="jmxtrans"></a>jmxtrans</h3><p>上面介绍完JMX之后，其实缺少了一个通道，将JMX指标输出给influxdb。放到后面介绍的原因是因为独立组件，不依赖JMX，数据来源可以是http、日志、kafka</p>
<blockquote>
<p>This is effectively the missing connector between speaking to a JVM via JMX on one end and whatever logging / monitoring / graphing package that you can dream up on the other end.</p>
</blockquote>
<p><img src="http://img.yuheng.wang/monitor-12.jpg" alt="m12"></p>
<p>可以通过 JSOM | YAML 配置读取地址、查询线程数、采集指标以及持久化方式。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;servers&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;port&quot;</span>: <span class="string">&quot;12000&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;users&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;numQueryThreads&quot;</span> : <span class="number">2</span>, </span><br><span class="line">            <span class="attr">&quot;queries&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;obj&quot;</span>: <span class="string">&quot;java.lang:type=Memory&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;attr&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;HeapMemoryUsage&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;NonHeapMemoryUsage&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;resultAlias&quot;</span>: <span class="string">&quot;MemoryUsage&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;outputWriters&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="attr">&quot;@class&quot;</span>: <span class="string">&quot;com.googlecode.jmxtrans.model.output.InfluxDbWriterFactory&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://influxdb:8086/&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;wyh&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;wyh&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;database&quot;</span>: <span class="string">&quot;wyh&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;tags&quot;</span>: &#123;</span><br><span class="line">                                <span class="attr">&quot;application&quot;</span>: <span class="string">&quot;MemoryUsage&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;obj&quot;</span>: <span class="string">&quot;kafka.consumer:type=consumer-metrics,client-id=*&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;attr&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;connection-close-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;connection-creation-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;network-io-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;outgoing-byte-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;request-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;request-size-avg&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;request-size-max&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;incoming-byte-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;response-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;select-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;io-wait-time-ns-avg&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;io-wait-ratio&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;io-time-ns-avg&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;io-ratio&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;connection-count&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;successful-authentication-rate&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;failed-authentication-rate&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;resultAlias&quot;</span>: <span class="string">&quot;ConsumerMetrics&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;outputWriters&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="attr">&quot;@class&quot;</span>: <span class="string">&quot;com.googlecode.jmxtrans.model.output.InfluxDbWriterFactory&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://influxdb:8086/&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;wyh&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;wyh&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;database&quot;</span>: <span class="string">&quot;consumer&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;tags&quot;</span>: &#123;</span><br><span class="line">                                <span class="attr">&quot;application&quot;</span>: <span class="string">&quot;ConsumerMetrics&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以通过java程序引入依赖包，增加扩展。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryPool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Injector injector = JmxTransModule.createInjector(<span class="keyword">new</span> JmxTransConfiguration());</span><br><span class="line">		ProcessConfigUtils processConfigUtils = injector.getInstance(ProcessConfigUtils.class);</span><br><span class="line">		JmxProcess process = processConfigUtils.parseProcess(<span class="keyword">new</span> File(<span class="string">&quot;memorypool.json&quot;</span>));</span><br><span class="line">		<span class="keyword">new</span> JsonPrinter(System.out).print(process);</span><br><span class="line">		JmxTransformer transformer = injector.getInstance(JmxTransformer.class);</span><br><span class="line">		transformer.executeStandalone(process);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>开源项目对JMX支持较好，但是作为普通应用，通过JMX暴露指标，需要业务开发编写大量代码，不够友好。而且，RMI存在注入风险，不能暴露外网接口。本人介绍的更多为组件和大致思路，实际使用过程中可以考虑提供通过http发送元数据、或者特殊日志格式进行采集。</p>
<p><img src="http://img.yuheng.wang/monitor-13.jpg" alt="m13"></p>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><p>docker-compose.yml文件，可以通过<code>docker-compose up -d</code>执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  influxdb:</span><br><span class="line">    image: influxdb:latest</span><br><span class="line">    container_name: influxdb</span><br><span class="line">    ports:</span><br><span class="line">      - 8086:8086</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;influxdata:&#x2F;var&#x2F;lib&#x2F;influxdb</span><br><span class="line">    environment:</span><br><span class="line">      INFLUXDB_DB: metrics</span><br><span class="line">    restart: always</span><br><span class="line">  grafana:</span><br><span class="line">    image: grafana&#x2F;grafana</span><br><span class="line">    container_name: grafana</span><br><span class="line">    ports:</span><br><span class="line">      - 3000:3000</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;grafana:&#x2F;var&#x2F;lib&#x2F;grafana</span><br><span class="line">    restart: always</span><br><span class="line">  jmxtrans:</span><br><span class="line">    image: jmxtrans&#x2F;jmxtrans</span><br><span class="line">    container_name: jmxtrans</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;jmxtrans:&#x2F;var&#x2F;lib&#x2F;jmxtrans&#x2F;</span><br><span class="line">    restart: always</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>monitor</tag>
      </tags>
  </entry>
  <entry>
    <title>java项目集成mybatis入门教程</title>
    <url>/2016/05/23/mybatis-starter/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>公司项目中一直用了myBatis，但是将dao层封装了，并不知道是如何使用的。学习的第一步是查看<a href="http://www.mybatis.org/mybatis-3/zh/index.html">官方文档</a>，发现虽然有中文文档，但是并没有完整的示例，只介绍特性和一些用法，但是并不知道怎么让环境跑起来。于是按照官方blog的介绍，搭建了一个示例环境，留给有需要的人。</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>项目采用maven构造方式，IDE为eclipse，依赖mybatis包及mysql驱动，具体版本及jdk版本见下文pom。</p>
<h3 id="pom文件"><a href="#pom文件" class="headerlink" title="pom文件"></a>pom文件</h3><p>采用了jdk1.8版本，以及最新的mysql驱动，如果jdk版本较低，需要选用相应的低版本驱动。</p>
<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;wang.crick&lt;/groupId&gt;
    &lt;artifactId&gt;study.mybatis&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;study.mybatis&lt;/name&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;6.0.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
            &lt;version&gt;3.4.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<h3 id="数据脚本"><a href="#数据脚本" class="headerlink" title="数据脚本"></a>数据脚本</h3><p>数据库安装及环境搭建，可参照其他博客，这里只提供创建表的数据脚本。</p>
<pre><code>DROP DATABASE IF EXISTS `zero`;
CREATE DATABASE IF NOT EXISTS `zero`;
USE `zero`;

DROP TABLE IF EXISTS `z_user`;
CREATE TABLE `z_user` (
    `id` INT(11) NOT NULL AUTO_INCREMENT,
    `username` VARCHAR(50) NULL DEFAULT NULL,
    `password` VARCHAR(50) NULL DEFAULT NULL,
    `role_type` INT(11) NULL DEFAULT NULL,
    `address` VARCHAR(200) NULL DEFAULT NULL,
    PRIMARY KEY (`id`),
    UNIQUE INDEX `username` (`username`)
)
COLLATE=&#39;utf8_general_ci&#39;
ENGINE=InnoDB
AUTO_INCREMENT=13;

INSERT INTO `z_user` (`id`, `username`, `password`, `role_type`, `address`) VALUES
    (1, &#39;zhangsan&#39;, &#39;123131&#39;, 1, &#39;shanghai,pudong&#39;);
</code></pre>
<h3 id="XML配置文件"><a href="#XML配置文件" class="headerlink" title="XML配置文件"></a>XML配置文件</h3><p>根据使用习惯，推荐使用XML配置文件。因为是maven项目，所以在src/main/resources目录下新建一个配置文件mybatis-config.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;

&lt;configuration&gt;
    &lt;!-- 数据库配置信息 --&gt;
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot; /&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; /&gt;
                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://172.16.99.121:3306/zero?useUnicode=true&amp;amp;characterEncoding=utf-8&quot; /&gt;
                &lt;property name=&quot;username&quot; value=&quot;root&quot; /&gt;
                &lt;property name=&quot;password&quot; value=&quot;mysqlPwd123456!&quot; /&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
    &lt;mappers&gt;
        &lt;mapper resource=&quot;wang/crick/study/mybatis/UserMapper.xml&quot; /&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>
<p>配置文件配置了一个数据源，和jdbc的配置方法类似。这里需要注意，如果在url增加额外属性配置，连字符需要用转义后的&amp;代替&amp;。<br>在mappers标签内，指定了mybatis映射的 SQL 语句。</p>
<h3 id="映射SQL语句"><a href="#映射SQL语句" class="headerlink" title="映射SQL语句"></a>映射SQL语句</h3><p>配置文件指定的UserMapper.xml文件内容如下</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;  
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;   
&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;

&lt;mapper namespace=&quot;wang.crick.study.mybatis.UserMapper&quot;&gt;

    &lt;select id=&quot;selectByName&quot; resultType=&quot;wang.crick.study.mybatis.User&quot;&gt;
        select username , password , role_type AS role_type , address 
        from z_user
        where username = #&#123;username&#125;
    &lt;/select&gt;
    
    &lt;insert id=&quot;add&quot; parameterType=&quot;wang.crick.study.mybatis.User&quot;&gt;
        insert into z_user
        (username , password , role_type , address)
        values(#&#123;username&#125; , #&#123;password&#125; , #&#123;roleType&#125; , #&#123;address&#125; )
    &lt;/insert&gt;

&lt;/mapper&gt;  
</code></pre>
<p>namespace指定了唯一标识，为了保证其唯一性，通常以包名+文件名来命名，也可以自定义名称。<br>从标签名可以判断出两个方法的作用是select和insert。<br>wang.crick.study.mybatis.User指向了一个javeBean文件，通过#{}方式，可以映射javaBean的属性变量。</p>
<pre><code>package wang.crick.study.mybatis;

public class User &#123;

    private int id;
    private String password;
    private String username;
    private int roleType;
    private String address;

    public int getId() &#123;
        return id;
    &#125;

    public void setId(int id) &#123;
        this.id = id;
    &#125;

    public String getPassword() &#123;
        return password;
    &#125;

    public void setPassword(String password) &#123;
        this.password = password;
    &#125;

    public String getUsername() &#123;
        return username;
    &#125;

    public void setUsername(String username) &#123;
        this.username = username;
    &#125;

    public int getRoleType() &#123;
        return roleType;
    &#125;

    public void setRoleType(int roleType) &#123;
        this.roleType = roleType;
    &#125;

    public String getAddress() &#123;
        return address;
    &#125;

    public void setAddress(String address) &#123;
        this.address = address;
    &#125;

&#125;
</code></pre>
<h3 id="执行数据操作"><a href="#执行数据操作" class="headerlink" title="执行数据操作"></a>执行数据操作</h3><p>mybatis提供了一个SqlSessionFactory，用来根据配置文件，创建资源。SqlSessionFactory创建出来后，在程序运行期间，一直存在，并且不应该被修改或清除。在需要执行数据操作的时候，通过单例的SqlSessionFactory打开一个SqlSession，执行CRUD操作，在执行完毕后，关闭SqlSession。</p>
<pre><code>package wang.crick.study.mybatis;

import java.io.IOException;
import java.io.InputStream;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

public class Main &#123;
    public static void main(String[] args) throws IOException &#123;
        String resource = &quot;mybatis-config.xml&quot;;
        InputStream inputStream = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        SqlSession session = sqlSessionFactory.openSession();
        
        User liUser = new User();
        liUser.setUsername(&quot;lisi&quot;);
        liUser.setPassword(&quot;123654&quot;);
        liUser.setRoleType(2);
        liUser.setAddress(&quot;辽宁省大连市&quot;);
        int result = session.insert(&quot;wang.crick.study.mybatis.UserMapper.add&quot;, liUser);
        System.out.println(result);
        
        User zhang = (User)session.selectOne(&quot;wang.crick.study.mybatis.UserMapper.selectByName&quot;, &quot;lisi&quot;);
        System.out.println(zhang.getUsername() + &quot;: from &quot; + zhang.getAddress());
//        session.commit();
    &#125;
&#125;
</code></pre>
<p>程序通过SqlSessionFactoryBuilder读取xml配置文件的方式构建了一个SqlSessionFactory，并打开一个SqlSession，执行了insert和select操作，对应Mapper文件中的两个标签，具体的映射规则为，根据Mapper文件中的namespace+方法id。参数直接传入javaBean，或者用javaBean接收参数，通过属性名映射规则，将属性与数据库字段对应。<br>只有执行commit()方法后，操作才会提交至数据库。<br>因为只有一个main方法，所以没有关闭session的操作。正常程序，应该将session.close()放在finally中，保证一定会执行。</p>
<p>至此，一个最基本的mybatis环境搭建完毕，但是这只是一个简单而丑陋的方式，还有很多方法，可以将项目精简与美化，让mybatis发挥出自身的优势。</p>
<h2 id="项目优化"><a href="#项目优化" class="headerlink" title="项目优化"></a>项目优化</h2><h3 id="properties配置文件"><a href="#properties配置文件" class="headerlink" title="properties配置文件"></a>properties配置文件</h3><p>在src/main/resources/prop目录下新建一个配置文件config.properties</p>
<pre><code>db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://172.16.99.121:3306/zero?useUnicode=true&amp;characterEncoding=utf-8
db.username=root
db.password=mysqlPwd123456!
</code></pre>
<p>注意，此时不需转义，不能用&amp;替换&amp;<br>将配置信息抽离到此文件中，在mybatis-config.xml中通过properties标签注入属性。</p>
<pre><code>&lt;properties resource=&quot;prop/config.properties&quot;&gt;
    &lt;!-- &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; /&gt; --&gt;
&lt;/properties&gt;
</code></pre>
<p>此标签在<configuration>标签内部，property标签会替换properties中的内容。</p>
<h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><p>在Mapper文件中，指定了javaBean的位置，但是需要指定包名+类名。在这里，我们可以单独指定某个类的别名，可以在Mapper中用别名替换全路径名，或者指定基础包名，然后就可以在基础包上加上路径类名，简化操作。</p>
<pre><code>&lt;typeAliases&gt;
    &lt;!-- &lt;typeAlias alias=&quot;User&quot; type=&quot;wang.crick.study.mybatis.User&quot; /&gt; --&gt;
    &lt;package name=&quot;wang.crick.study.mybatis&quot;/&gt;
&lt;/typeAliases&gt;
</code></pre>
<p>此标签同样要在<configuration>标签内部。<br>此时UserMapper.xml就可以修改为</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;  
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;   
&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;

&lt;mapper namespace=&quot;wang.crick.study.mybatis.UserMapper&quot;&gt;

    &lt;select id=&quot;selectByName&quot; resultType=&quot;User&quot;&gt;
        select username , password , role_type AS role_type , address 
        from z_user
        where username = #&#123;username&#125;
    &lt;/select&gt;
    
    &lt;insert id=&quot;add&quot; parameterType=&quot;User&quot; &gt;
        insert into z_user
        (username , password , role_type , address)
        values(#&#123;username&#125; , #&#123;password&#125; , #&#123;roleType&#125; , #&#123;address&#125; )
    &lt;/insert&gt;

&lt;/mapper&gt;
</code></pre>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>在main方法中，对于sql的调用语句如下：</p>
<pre><code>User zhang = (User)session.selectOne(&quot;wang.crick.study.mybatis.UserMapper.selectByName&quot;, &quot;lisi&quot;);
</code></pre>
<p>这有2个问题，一是通过字符串定位映射，容易出现误差，而是需要执行强制转型。<br>mybatis提供了更为清晰和类型安全的实现形式：利用接口。</p>
<pre><code>UserMapper userMapper = session.getMapper(UserMapper.class);
</code></pre>
<p>然后可以用 </p>
<pre><code>User zhang = userMapper.selectByName(&quot;lisi&quot;);
</code></pre>
<p>替换之前的 </p>
<pre><code>User zhang = (User)session.selectOne(&quot;wang.crick.study.mybatis.UserMapper.selectByName&quot;, &quot;lisi&quot;);
</code></pre>
<p>除此之外，接口还提供了另一种简便的方法，可以通过标签自定义sql语句，而不需要xml的映射文件。</p>
<pre><code>package wang.crick.study.mybatis;

import org.apache.ibatis.annotations.Select;

public interface UserMapper &#123;

    User selectByName(String username);
    
    int add(User user);
    
    @Select(&quot;select * from z_user where id = #&#123;id&#125;&quot;)
    User selectById(int id);
&#125;
</code></pre>
<p>调用方法为</p>
<pre><code>package wang.crick.study.mybatis;

import java.io.IOException;
import java.io.InputStream;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

public class Main &#123;
    public static void main(String[] args) throws IOException &#123;
        String resource = &quot;mybatis-config.xml&quot;;
        InputStream inputStream = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        SqlSession session = sqlSessionFactory.openSession();
        UserMapper userMapper = session.getMapper(UserMapper.class);
        
        User liUser = new User();
        liUser.setUsername(&quot;lisi&quot;);
        liUser.setPassword(&quot;123654&quot;);
        liUser.setRoleType(2);
        liUser.setAddress(&quot;辽宁省大连市&quot;);
        int result = userMapper.add(liUser);
        System.out.println(result);
        
        User zhang = userMapper.selectByName(&quot;lisi&quot;);
        System.out.println(zhang.getUsername() + &quot;: from &quot; + zhang.getAddress());
        
        User firstUser = userMapper.selectById(1);
        System.out.println(firstUser.getUsername() + &quot;: from &quot; + firstUser.getAddress());
//        session.commit();
    &#125;
&#125;
</code></pre>
<p>注意，此时UserMapper.xml文件中的namespace必须指向接口文件UserMapper.java</p>
<h3 id="mappers指向包"><a href="#mappers指向包" class="headerlink" title="mappers指向包"></a>mappers指向包</h3><p>可以将Mapper的接口和xml单独抽离到某个包下，然后在mybatis-config.xml中修改<mappers>标签的配置。<br>因为<mappers>是不支持通配符操作的，按之前的配置方式，没增加一个映射，就需要增加一个配置。<br>抽离之后，可以扫描整个包目录，增加映射后，不需要修改配置文件。<br>修改后的mybatis-config.xml文件为</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;

&lt;configuration&gt;
    &lt;properties resource=&quot;prop/config.properties&quot;&gt;
    &lt;/properties&gt;
    &lt;typeAliases&gt;
        &lt;package name=&quot;wang.crick.study.mybatis.domain&quot;/&gt;
    &lt;/typeAliases&gt;
    &lt;!-- 数据库配置信息 --&gt;
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot; /&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot; /&gt;
                &lt;property name=&quot;url&quot; value=&quot;$&#123;db.url&#125;&quot; /&gt;
                &lt;property name=&quot;username&quot; value=&quot;$&#123;db.username&#125;&quot; /&gt;
                &lt;property name=&quot;password&quot; value=&quot;$&#123;db.password&#125;&quot; /&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
    &lt;mappers&gt;
        &lt;package name=&quot;wang.crick.study.mybatis.mapper&quot;/&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>
<p>目录结构为</p>
<p><img src="https://img.yuheng.wang/mweb/mybatis-starter-00.png" alt="mybatis-starter-00"></p>
<h3 id="Mapper-XML-文件"><a href="#Mapper-XML-文件" class="headerlink" title="Mapper XML 文件"></a>Mapper XML 文件</h3><p>xml中的映射sql文件，是mybatis最强大的功能，但不是本篇文章的重点。所以会在另一篇文章中详细介绍一些技巧、已经容易遇到的问题。</p>
<p>至此，一个集成了mybatis的java项目已经搭建完成，可以在此基础上编写业务逻辑代码。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>Host &#39;xxxx&#39; is blocked because of many connection errors; unblock with &#39;mysqladmin flush-hosts&#39;</title>
    <url>/2015/12/15/mysql-host-is-blocked/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>由于网络连接不稳定，在连接局域网内的mysql开发服务器时，连续多次断开，结果无法连接到mysql服务器，报错内容如下：</p>
<pre><code>Host &#39;host_name&#39; is blocked because of many connection errors.
Unblock with &#39;mysqladmin flush-hosts&#39;
</code></pre>
<p>这是mysql自带的一种保护机制，如果客户端连续连接失败次数<strong>max_connect_errors</strong>，超过默认值，则会拒绝客户端继续连接。<br>可以通过</p>
<pre><code>SHOW VARIABLES LIKE &#39;max_connect_errors&#39;
    
</code></pre>
<p>查看允许连接失败的次数，默认为100次。由于网络不稳，可能会让JDBC等连接很快超过此默认值，可以通过修改此默认值来避免出现连接失败的情形，如</p>
<pre><code>SET GLOBAL max_connect_errors=10000;
</code></pre>
<p> 如果本机已被拒绝连接，可以通过另一台可连接到mysql服务器的主机执行以下命令</p>
<pre><code> mysqladmin flush-hosts -h localhost -uroot -p *****
 
</code></pre>
<p>此命令会清空所有的hosts缓存信息，执行后即可链接</p>
<p><strong>Best regards</strong><br><strong>Wang Yuheng</strong></p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>blocked</tag>
      </tags>
  </entry>
  <entry>
    <title>架构测评-OpenFaaS是私有云FaaS的解决方案吗?</title>
    <url>/2021/03/12/openfaas/</url>
    <content><![CDATA[<blockquote>
<p>微服务不是一种发明，而是一种趋势，一种总结现实世界工作方式得到的模式。 其本质是一种分治思想。</p>
</blockquote>
<span id="more"></span>

<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p><strong>FaaS</strong>: <strong>F</strong>unctions <strong>a</strong>s <strong>a</strong> <strong>S</strong>ervice</p>
<p>在应用开发过程中，随着业务复杂度的提升，以及快速迭代的需求，微服务以及变得十分主流。并且推进提升了平台、软件、硬件、管理体系等各方面，以便更好的支持微服务架构。</p>
<p>那么按照这个趋势继续推演，借助云平台提供的基础支撑能力，最细粒度不应该是一个服务，而应该是一个方法函数。这样才能将职责划分、动态调度发挥到极致。</p>
<p>所以FaaS来到了历史舞台。我觉得FaaS是一种更极端的微服务，注意是更极端，而不是更极致。</p>
<h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><p>想象一个场景，产品经理提出一个需要获取服务端当前时间的需求，我们需要创建工程项目-&gt;编写方法代码-&gt;编译打包-&gt;测试发布-&gt;被外部调用</p>
<ol>
<li>如果请求量过大，需要申请增加机器，重新发布。</li>
<li>如果请求量过小，但是为了保障高可用，至少需要部署2台机器。这时就造成了资源的浪费。</li>
</ol>
<p>同样的场景，也可能是这样一番景象：接到需求后，打开IDE或者浏览器编写方法代码，提交之后就可以被外部调用。</p>
<p>当然这是开发视角，在看不见的角落还需要有人完成 stateless、CICD、持久化、技术异构、监控、弹性、扩展 等各方面的支撑工作。</p>
<p>而 OpenFaaS 的目标就是让这个过程变得足够简单。</p>
<h2 id="OpenFaaS"><a href="#OpenFaaS" class="headerlink" title="OpenFaaS"></a>OpenFaaS</h2><blockquote>
<p>OpenFaaS® makes it easy for developers to deploy event-driven functions and microservices to Kubernetes without repetitive, boiler-plate coding. Package your code or an existing binary in a Docker image to get a highly scalable endpoint with auto-scaling and metrics.</p>
</blockquote>
<p>先来看一下OpenFaaS的图标，应该看得出来他和docker有着密不可分的关系。</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_00.png" alt="openfaas_00"></p>
<p>(话说。。。 这不是一个翻车的鲸鱼么)</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>通过Helm安装后可以看到有如下 Deployment 组件，功能会在后文描述。</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_01.jpg" alt="openfaas_01"></p>
<h3 id="使用三方Function"><a href="#使用三方Function" class="headerlink" title="使用三方Function"></a>使用三方Function</h3><p>OpenFaaS提供了UI页面，可以通过浏览器管理Functions，并且提供了Function Store 用于快速使用他人发布的Function。</p>
<p>比如 通过 Store 寻找三方提供的二维码生成Function</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_02.jpg" alt="openfaas_02"></p>
<p>在页面中通过 invoke 按钮可以调用相关函数，并获得返回结果。</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_03.jpg" alt="openfaas_03"></p>
<p>这背后的逻辑是，找到已经发布的Function docker镜像，在k8s中完成部署，并通过Gateway路由到相关方法并返回执行结果。所以也可以直接通过http api 进行调用。</p>
<h3 id="发布自定义Function"><a href="#发布自定义Function" class="headerlink" title="发布自定义Function"></a>发布自定义Function</h3><p>OpenFaas 提供了功能全面的CLI工具，可以通过 curl or brew 安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -sSL https://cli.openfaas.com | sh</span><br></pre></td></tr></table></figure>

<p>or brew </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install faas-cli</span><br></pre></td></tr></table></figure>

<p>查看官方提供的模板</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_04.jpg" alt="openfaas_04"></p>
<p>这里以java为例，开发一个java11的Function</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_05.jpg" alt="openfaas_05"></p>
<p>打开生成的项目，在 Handler 类中完成相关处理逻辑</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_06.jpg" alt="openfaas_06"></p>
<p>完成docker镜像构造</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_07.jpg" alt="openfaas_07"></p>
<p>接下来要度过一个感人的构造时间</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_08.jpg" alt="openfaas_08"></p>
<p>还有同样感人的镜像大小</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_09.jpg" alt="openfaas_09"></p>
<p>如果设置了auth控制，则需要完成登陆认证 </p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_10.jpg" alt="openfaas_10"></p>
<p>发布至服务，需要确认本机拥有k8s机器操作权限</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_11.jpg" alt="openfaas_11"></p>
<p>此时可以在k8s中查看到java-function 的 Deployment，等到服务启动成功后，就可以通过UI界面或者url接口的方式被调用</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_11_1.jpg" alt="openfaas_11_1"></p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_12.jpg" alt="openfaas_12"></p>
<p>如果需要修改Function逻辑，需要重复执行上述步骤。但是因为已经下载过基础镜像，修改之后再次打包的速度会提升很多。</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_13.jpg" alt="openfaas_13"></p>
<p>上述过程可以通过CICD流程自动完成，如: gitlab、Jenkins等</p>
<h3 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h3><p>官方提供了Grafana模板(3526)，方便快速搭建起一个Dashboard</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_14.jpg" alt="openfaas_14"></p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_15.jpeg" alt="openfaas_15"></p>
<p>但是只有最基础的内容，还需要自己设置更多的指标项。</p>
<h3 id="弹性伸缩"><a href="#弹性伸缩" class="headerlink" title="弹性伸缩"></a>弹性伸缩</h3><p>Prometheus 记录Function调用记录， AlertManager 通过 Prometheus 统计单位时间内QPS，如果超过阈值，则调用Gateway提供的Scale接口进行扩容，并指定过期时间。<br>如果超过过期时间，则自动进行缩容。<br>默认容量为1，甚至可以设置为0，以确保当有请求过来时，才会启动相关Function，以避免资源浪费。</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_16.png" alt="openfaas_16"></p>
<h3 id="异步Function"><a href="#异步Function" class="headerlink" title="异步Function"></a>异步Function</h3><p>异步Function会在Gateway中维护一个请求队列，可以外接第三方的消息中间件，如Kafka。Gateway会依次消费处理，并根据设置的Callback Url进行回调通知</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_17.png" alt="openfaas_17"></p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_17_1.png" alt="openfaas_17_1"></p>
<p>相关实现代码</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_18.png" alt="openfaas_18"></p>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><h3 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h3><p>Gateway通过轮训的方式发现指定namespace下的所有function</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_19.png" alt="openfaas_19"></p>
<p>并通过Function名称寻找对应的Deployment转发路由调用</p>
<h3 id="服务注入"><a href="#服务注入" class="headerlink" title="服务注入"></a>服务注入</h3><p>以java为例其实是在模板中内置接口，然后通过SPI的方式完成服务注入</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_20.jpg" alt="openfaas_20"></p>
<p>entrypoint 会启动一个http服务响应Gateway路由而来调用</p>
<p><img src="https://img.yuheng.wang/mweb/openfaas_21.png" alt="openfaas_21"></p>
<h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><ol>
<li>如果已经有了一套配合k8s的CICD流程，就会发现整个过程并没有节省什么，反而增加了很多限制。</li>
<li>并没有提供状态应用、持久化等方便的实现或建议。</li>
<li>已经到了代码层面，又提供了UI界面，为什么没有接口文档功能呢？</li>
<li>java 经历打jar包、docker镜像等过程，大小和时间都不够友好，当然这可能是java的问题，但是有更优方案。</li>
</ol>
]]></content>
      <categories>
        <category>serverless</category>
      </categories>
      <tags>
        <tag>faas</tag>
        <tag>serverless</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 00——为什么用 svg</title>
    <url>/2016/09/20/painter-0/</url>
    <content><![CDATA[<p>提到画图，现在的首选印象可能是canvas，但在技术选型上，为什么选择了svg而弃用Canvas？</p>
<ol>
<li> svg为矢量图，Canvas基于像素，依赖分辨率</li>
<li> Canvas发生变化时，整个场景都会重新绘制</li>
<li> svg以dom形式，方便进行数据传递与通信 （结构过度复杂可能会导致性能下降）</li>
<li> svg支持事件处理器</li>
</ol>
<p>基于以上几点，选用svg作为绘图技术，采用开源的svgjs<a href="https://github.com/wout/svg.js">https://github.com/wout/svg.js</a>进行绘画开发。</p>
<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<p>svg参考文档：<a href="http://documentup.com/wout/SVG.js">http://documentup.com/wout/SVG.js</a></p>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>svg</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 01——实现绘制矩形功能</title>
    <url>/2016/09/20/painter-1/</url>
    <content><![CDATA[<p>svgjs 本身提供了绘制图形的函数。</p>
<p>为了实现鼠标点击、绘制的功能，需要监听鼠标事件</p>
<ol>
<li>mousedown 修改绘画状态位，开始画图 </li>
<li>mousemove 修改图形大小，绘制图形</li>
<li>mouseup 修改绘画状态位，结束画图</li>
</ol>
<p>拓展了一个函数，获取鼠标点击时相对画布左上角的相对坐标</p>
<p>根据svgjs提供的函数，将图形的透明度设置为0.0全透明，可以修改边框和高度，后期可以根据上面的按钮关联修改。</p>
<p>现在默认绘制矩形，需要向上封装，实现按钮与图形绘制的绑定。</p>
<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<p>扩展Doc，获取相对坐标</p>
<pre><code>(function() &#123;
    SVG.extend(SVG.Doc, &#123;
            transformPoint : function( event )&#123;
                event = event || window.event;
                var touches = event.changedTouches &amp;&amp; event.changedTouches[0] || event;
                var node = this.node;
                var point = node.createSVGPoint();
                point.x = touches.pageX-window.scrollX;
                point.y = touches.pageY-window.scrollY;
                var matrix = node.getScreenCTM().inverse();
                return point.matrixTransform( matrix );
            &#125;
        &#125;);
&#125;)();
</code></pre>
<p>通过事件监听，绘制矩形</p>
<pre><code>if (!SVG.supported) &#123;
    alert(&#39;SVG not supported&#39;);
&#125;
var svgDraw = SVG( &quot;svgPanel&quot; ).size(&#39;100%&#39;, 600);
var svgDoc = svgDraw.doc();
var drawing = false;
var element = null;
var startPoint = null;
var parent = null;
function mousemove(event) &#123;
    console.log(&#39;rect mousemove&#39;);
    if (drawing) &#123;
        var svgPoint = svgDoc.transformPoint(event);
        var x = svgPoint.x;
        var y = svgPoint.y;
        var newWidth = x - startPoint.x;
        var newHeight = y - startPoint.y;
        var startX = startPoint.x;
        var startY = startPoint.y;
        if (newWidth &lt; 0) &#123;
            startX += newWidth;
        &#125;
        if (newHeight &lt; 0) &#123;
            startY += newHeight;
        &#125;
        newWidth = Math.abs(newWidth);
        newHeight = Math.abs(newHeight);
        element.x(startX).y(startY).width(newWidth).height(newHeight);
    &#125;
&#125;;
function mousedown(event) &#123;
    console.log(&#39;rect mousedown&#39;);
    drawing = true;
    startPoint = svgDoc.transformPoint(event);
    element = parent.rect(0, 0).style(&quot;fill-opacity&quot;, &#39;0.0&#39;).stroke(&#123;
        width: &#39;2&#39;,
        color: &#39;#000000&#39;
    &#125;);
&#125;
function mouseup(event) &#123;
    console.log(&#39;rect mouseup &#39; + element);
    drawing = false;
&#125;
var listener = &#123;
    mousedown: mousedown,
    mousemove: mousemove,
    mouseup: mouseup,
&#125;;
var Tool = &#123;&#125;;
Tool.Rect = function (parentEle) &#123;
    parent = parentEle;
    var l =listener;
    svgDoc.on( &#39;mousedown&#39;, l.mousedown );
    svgDoc.on( &#39;mousemove&#39;, l.mousemove );
    svgDoc.on( &#39;mouseup&#39;,   l.mouseup );
&#125;;
Tool.Rect(svgDraw);
</code></pre>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 10——多选元素</title>
    <url>/2016/09/26/painter-10/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="多选元素"><a href="#多选元素" class="headerlink" title="多选元素"></a>多选元素</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>在选择按钮状态下，可以绘制一个曲线矩形，遍历所有元素判断，如果当前元素在矩形的坐标范围内，则元素被选中。</p>
<p>矩形四个点的坐标范围为x,x+width,y,y+height</p>
<h4 id="变更element-click事件"><a href="#变更element-click事件" class="headerlink" title="变更element click事件"></a>变更element click事件</h4><p>选择元素时，需要触发元素选中事件。如果触发click，会增加额外判断，并延时。所以单独抽离pick事件，将click中的事件处理指向pick</p>
<pre><code>_ele.on(&quot;click&quot;, function() &#123;
    if (GlobalStatus.isPreFilled()) &#123;
        if ($(&quot;#fill_color&quot;).hasClass(&quot;active&quot;)) &#123;
            _ele.fill(GlobalStatus.getFillColor());
            _ele.style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity());
        &#125; else &#123;
            _ele.style(&quot;stroke&quot;, GlobalStatus.getFontColor());
        &#125;

    &#125; else if (GlobalStatus.isPicked()) &#123;
        _ele.fire(&quot;pick&quot;);
    &#125; else if (GlobalStatus.isRecycle()) &#123;
        _ele.remove();
    &#125;
&#125;);
_ele.on(&quot;pick&quot;, function() &#123;
    if (_ele.attr(&quot;picked&quot;)) &#123;
        _ele.attr(&quot;picked&quot;, null);
        _ele.handleBorder &amp;&amp; _ele.handleBorder.hideShade(_ele);
        GlobalStatus.removePicked(_ele);
    &#125; else &#123;
        _ele.attr(&quot;picked&quot;, true);
        _ele.handleBorder = _ele.handleBorder || new HandleBorder(svgDoc);
        _ele.handleBorder.showShade(_ele);
        GlobalStatus.pushPicked(_ele);

    &#125;
&#125;);
</code></pre>
<h4 id="新增draw-tool-pick-js"><a href="#新增draw-tool-pick-js" class="headerlink" title="新增draw.tool.pick.js"></a>新增draw.tool.pick.js</h4><p>新增DrawTool.Pick，操作与Rect类似，唯一的区别在于mouseup时判断元素是否在绘制的虚线矩形范围内，并对应触发pick事件。</p>
<pre><code>(function() &#123;

    var parent = null;
    var drawing = false;
    var element = null;
    var startPoint = null;

    function mousedown(event) &#123;
        console.log(&#39;pick mousedown&#39;);
        drawing = true;
        startPoint = svgDoc.transformPoint(event);
        element = parent.rect(0, 0).fill(GlobalStatus.getFillColor()).style(&#123;
            &quot;fill-opacity&quot;: GlobalStatus.getFillOpacity(),
            &quot;stroke-dasharray&quot;: &quot;13 10&quot;
        &#125;).stroke(&#123;
            width: &quot;1&quot;,
            color: &quot;grey&quot;
        &#125;);
        return false;
    &#125;

    function mousemove(event) &#123;
        console.log(&#39;pick mousemove&#39;);
        if (drawing) &#123;
            var svgPoint = svgDoc.transformPoint(event);
            var x = svgPoint.x;
            var y = svgPoint.y;

            var newWidth = x - startPoint.x;
            var newHeight = y - startPoint.y;
            var startX = startPoint.x;
            var startY = startPoint.y;
            if (newWidth &lt; 0) &#123;
                startX += newWidth;
            &#125;

            if (newHeight &lt; 0) &#123;
                startY += newHeight;
            &#125;
            newWidth = Math.abs(newWidth);
            newHeight = Math.abs(newHeight);
            element.x(startX).y(startY).width(newWidth).height(newHeight);
        &#125;
        return false;
    &#125;;

    function mouseup(event) &#123;
        console.log(&#39;pick mouseup &#39; + element);
        drawing = false;
        if (element.attr(&quot;width&quot;) &gt; 0) &#123;
            var sx = element.x();
            var ex = element.x() + element.width();
            var sy = element.y();
            var ey = element.y() + element.height();
            $(GlobalStatus.getAllElements()).each(function() &#123;
                console.log(this.x(), this.y(), sx &lt; this.x() &amp;&amp; this.x() &lt; ex &amp;&amp; sy &lt; this.y() &amp;&amp; this.y() &lt; ey);
                if (sx &lt; this.x() &amp;&amp; this.x() &lt; ex &amp;&amp; sy &lt; this.y() &amp;&amp; this.y() &lt; ey) &#123;
                    if (!this.attr(&quot;picked&quot;)) &#123;
                        this.fire(&quot;pick&quot;);
                    &#125;
                &#125; else if (this.attr(&quot;picked&quot;)) &#123;
                    this.fire(&quot;pick&quot;);
                &#125;
            &#125;)
        &#125;
        parent.removeElement(element);
        return false;
    &#125;

    var listener = &#123;
        mousedown: mousedown,
        mousemove: mousemove,
        mouseup: mouseup,
    &#125;;


    var Pick = function(parentEle) &#123;
        parent = parentEle;
        console.log(parent);
        svgDoc = parent.doc();
        DrawTool.init(svgDoc, listener);
        this.stop = function() &#123;
            DrawTool.stop(svgDoc, listener);
        &#125;;
    &#125;;

    this.DrawTool.Pick = Pick;

&#125;)();
</code></pre>
<h4 id="首页监听选择按钮"><a href="#首页监听选择按钮" class="headerlink" title="首页监听选择按钮"></a>首页监听选择按钮</h4><p>在首页监听选择按钮，被选中时，创建DrawTool.Pick对象</p>
<pre><code>$(&quot;#tool_pick&quot;).on(&quot;click&quot;, function() &#123;
    resetCurrentDrawTool();
    currentDrawTool = new DrawTool.Pick(svgDoc);
&#125;);
</code></pre>
<h3 id="弊端"><a href="#弊端" class="headerlink" title="弊端"></a>弊端</h3><p>有一个不足的地方，元素必须全在范围内，才能被选中。如果被选中部分，则无法选中。没想到好的解决方案。</p>
<h3 id="bug修复"><a href="#bug修复" class="headerlink" title="bug修复"></a>bug修复</h3><h4 id="picked状态混乱"><a href="#picked状态混乱" class="headerlink" title="picked状态混乱"></a>picked状态混乱</h4><p>click和mouseup互相冲突，导致选中状态丢失。</p>
<p>将pick拆分为pick和unPick两个事件，分别处理选中状态，而不进行判断。将判断交给上层调用方法</p>
<pre><code> _ele.on(&quot;click&quot;, function() &#123;
      console.log(&quot;click&quot;);
      if (GlobalStatus.isPreFilled()) &#123;
          if ($(&quot;#fill_color&quot;).hasClass(&quot;active&quot;)) &#123;
              _ele.fill(GlobalStatus.getFillColor());
              _ele.style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity());
          &#125; else &#123;
              _ele.style(&quot;stroke&quot;, GlobalStatus.getFontColor());
          &#125;

      &#125; else if (GlobalStatus.isPicked()) &#123;
          if (_ele.attr(&quot;picked&quot;)) &#123;
              _ele.fire(&quot;unPick&quot;);
          &#125; else &#123;
              _ele.fire(&quot;pick&quot;);
          &#125;

      &#125; else if (GlobalStatus.isRecycle()) &#123;
          _ele.remove();
      &#125;
  &#125;);
  _ele.on(&quot;pick&quot;, function() &#123;
      console.log(&quot;pick&quot;);
      _ele.attr(&quot;picked&quot;, true);
      _ele.handleBorder = _ele.handleBorder || new HandleBorder(svgDoc);
      _ele.handleBorder.showShade(_ele);
      GlobalStatus.pushPicked(_ele);
  &#125;);
  _ele.on(&quot;unPick&quot;, function() &#123;
      console.log(&quot;unPick&quot;);
      _ele.attr(&quot;picked&quot;, null);
      _ele.handleBorder &amp;&amp; _ele.handleBorder.hideShade(_ele);
      GlobalStatus.removePicked(_ele);

  &#125;);
  
</code></pre>
<p>Pick中</p>
<pre><code>function mouseup(event) &#123;
    console.log(&#39;pick mouseup &#39; + element);
    if (drawing) &#123;
        drawing = false;
        if (element &amp;&amp; element.attr(&quot;width&quot;) &gt; 20) &#123;
            var sx = element.x();
            var ex = element.x() + element.width();
            var sy = element.y();
            var ey = element.y() + element.height();
            $(GlobalStatus.getAllElements()).each(function() &#123;
                console.log(this.x(), this.y(), sx &lt; this.x() &amp;&amp; this.x() &lt; ex &amp;&amp; sy &lt; this.y() &amp;&amp; this.y() &lt; ey);
                if (sx &lt; this.x() &amp;&amp; this.x() &lt; ex &amp;&amp; sy &lt; this.y() &amp;&amp; this.y() &lt; ey) &#123;
                    if (!this.attr(&quot;picked&quot;)) &#123;
                        this.fire(&quot;pick&quot;);
                    &#125;
                &#125; else if (this.attr(&quot;picked&quot;)) &#123;
                    this.fire(&quot;unPick&quot;);
                &#125;
            &#125;)
        &#125;
        element &amp;&amp; element.remove();
    &#125;
    return false;
&#125;
</code></pre>
<h4 id="Pick拥有背景色"><a href="#Pick拥有背景色" class="headerlink" title="Pick拥有背景色"></a>Pick拥有背景色</h4><p>修改Pick的mousedown方法，独立设置style，不关联颜色选择器</p>
<pre><code>function mousedown(event) &#123;
    console.log(&#39;pick mousedown&#39;);
    if (!drawing) &#123;
        drawing = true;
        startPoint = svgDoc.transformPoint(event);
        element = parent.rect(0, 0).style(&#123;
            &quot;fill-opacity&quot;: &quot;0.0&quot;,
            &quot;stroke-dasharray&quot;: &quot;10&quot;
        &#125;).stroke(&#123;
            width: &quot;1&quot;,
            color: &quot;grey&quot;
        &#125;);
    &#125;
    return false;
&#125;
</code></pre>
<h4 id="mousedown状态鼠标移出画板范围，松开鼠标，再次回到画板范围内，导致状态丢失"><a href="#mousedown状态鼠标移出画板范围，松开鼠标，再次回到画板范围内，导致状态丢失" class="headerlink" title="mousedown状态鼠标移出画板范围，松开鼠标，再次回到画板范围内，导致状态丢失"></a>mousedown状态鼠标移出画板范围，松开鼠标，再次回到画板范围内，导致状态丢失</h4><p>再回到画板时，鼠标已经移开，但是并未执行mouseup方法，因为时间的监听范围为画板内。所以mouseover事件继续执行，导致多生成了一个element。为了避免此问题，在mouse事件中增加drawing状态判断，以Rect为例 </p>
<pre><code>(function() &#123;

    var parent = null;
    var drawing = false;
    var element = null;
    var startPoint = null;

    function mousedown(event) &#123;
        console.log(&#39;rect mousedown&#39;);
        if (!drawing) &#123;
            drawing = true;
            startPoint = svgDoc.transformPoint(event);
            element = parent.rect(0, 0).fill(GlobalStatus.getFillColor()).style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity()).stroke(&#123;
                width: GlobalStatus.getLineSize(),
                color: GlobalStatus.getFontColor()
            &#125;);
        &#125;
        return false;
    &#125;

    function mousemove(event) &#123;
        console.log(&#39;rect mousemove&#39;);
        if (drawing) &#123;
            var svgPoint = svgDoc.transformPoint(event);
            var x = svgPoint.x;
            var y = svgPoint.y;

            var newWidth = x - startPoint.x;
            var newHeight = y - startPoint.y;
            var startX = startPoint.x;
            var startY = startPoint.y;
            if (newWidth &lt; 0) &#123;
                startX += newWidth;
            &#125;

            if (newHeight &lt; 0) &#123;
                startY += newHeight;
            &#125;
            newWidth = Math.abs(newWidth);
            newHeight = Math.abs(newHeight);
            element.x(startX).y(startY).width(newWidth).height(newHeight);
        &#125;
        return false;
    &#125;;

    function mouseup(event) &#123;
        console.log(&#39;rect mouseup &#39; + element);
        if (drawing) &#123;
            drawing = false;
            if (element.attr(&quot;width&quot;) &gt; 0) &#123;
                element.pickable();
            &#125; else &#123;
                parent.removeElement(element);
            &#125;
        &#125;
        return false;
    &#125;

    var listener = &#123;
        mousedown: mousedown,
        mousemove: mousemove,
        mouseup: mouseup,
    &#125;;


    var Rect = function(parentEle) &#123;
        parent = parentEle;
        console.log(parent);
        svgDoc = parent.doc();
        DrawTool.init(svgDoc, listener);
        this.stop = function() &#123;
            DrawTool.stop(svgDoc, listener);
        &#125;;
    &#125;;

    this.DrawTool.Rect = Rect;

&#125;)();
</code></pre>
<p>所有DrawTool类方法都要增加此</p>
<h3 id="bug修复-1"><a href="#bug修复-1" class="headerlink" title="bug修复"></a>bug修复</h3><h4 id="选择其他DrawTool后，选中状态不丢失。"><a href="#选择其他DrawTool后，选中状态不丢失。" class="headerlink" title="选择其他DrawTool后，选中状态不丢失。"></a>选择其他DrawTool后，选中状态不丢失。</h4><p>在GlobalStatus增加清除所有选中状态的方法</p>
<pre><code>unPickAll() &#123;
    $(GlobalStatus.getPickeds()).each(function() &#123;
        this.fire(&quot;unPick&quot;);
    &#125;);
    return this;
&#125;
</code></pre>
<p>在index的resetCurrentDrawTool方法中调用执行</p>
<pre><code>function resetCurrentDrawTool() &#123;
    currentDrawTool &amp;&amp; currentDrawTool.stop();
    GlobalStatus.unPickAll();
    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;default&quot;);
&#125;
</code></pre>
<p>同时给右键的取消按钮增加此方法调用</p>
<pre><code>label: &#39; 取消&#39;,
action: function () &#123;
    GlobalStatus.unPickAll();
    return false;
&#125;
</code></pre>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 11——拖拽</title>
    <url>/2016/09/26/painter-11/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="拖拽"><a href="#拖拽" class="headerlink" title="拖拽"></a>拖拽</h3><p>使用svgjs官方推荐的拖拽插件<a href="https://github.com/wout/svg.draggable.js">https://github.com/wout/svg.draggable.js</a> 实现元素的拖拽效果</p>
<p>暴露了4种事件监听 </p>
<ul>
<li>  beforedrag</li>
<li>  dragstart</li>
<li>  dragmove (you can call preventDefault on this one)</li>
<li>  dragend</li>
</ul>
<p>可以根据需要结合。</p>
<p>在Element 的mouseover事件监听中，执行 _ele.draggable(); 方法，实现元素的可拖拽效果</p>
<p>为了避免拖拽后，触发click事件，导致pick状态变更，在这里监听了dragend事件，并将pick状态设置为未选中，则click事件触发时，一定会处理为选中。</p>
<pre><code>(function() &#123;

    SVG.extend(SVG.Doc, &#123;
        transformPoint: function(event) &#123;
            event = event || window.event;
            var touches = event.changedTouches &amp;&amp; event.changedTouches[0] || event;
            var node = this.node;
            var point = node.createSVGPoint();
            point.x = touches.pageX - window.scrollX;
            point.y = touches.pageY - window.scrollY;
            var matrix = node.getScreenCTM().inverse();
            return point.matrixTransform(matrix);
        &#125;
    &#125;);

    SVG.extend(SVG.Element, &#123;
        pickable: function(enabled) &#123;
            var _ele = this;
            GlobalStatus.pushElements(_ele);
            var color = _ele._stroke;
            var width = _ele.attr(&quot;stroke-width&quot;);
            _ele.on(&quot;mouseover&quot;, function() &#123;
                console.log(&quot;element mouseover&quot;);
                if (GlobalStatus.isPicked()) &#123;
                    _ele.stroke(&#123;
                        width: width * 2,
                        color: &#39;red&#39;
                    &#125;);
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;pointer&quot;);
                    _ele.draggable();
                    return false;
                &#125; else if (GlobalStatus.isPreFilled()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;url(style/img/cur/tool_fill.cur), auto&quot;);
                &#125; else if (GlobalStatus.isRecycle()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;url(style/img/cur/tool_delete.cur), auto&quot;);
                &#125;
                _ele.draggable(false);

            &#125;);
            _ele.on(&quot;mouseout&quot;, function() &#123;
                if (GlobalStatus.isPicked()) &#123;
                    _ele.stroke(&#123;
                        width: width,
                        color: color
                    &#125;);
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;default&quot;);
                &#125; else if (GlobalStatus.isPreFilled()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;default&quot;);
                &#125; else if (GlobalStatus.isRecycle()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;default&quot;);
                &#125;

            &#125;);
            _ele.on(&quot;click&quot;, function() &#123;
                console.log(&quot;click&quot;);
                if (GlobalStatus.isPreFilled()) &#123;
                    if ($(&quot;#fill_color&quot;).hasClass(&quot;active&quot;)) &#123;
                        _ele.fill(GlobalStatus.getFillColor());
                        _ele.style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity());
                    &#125; else &#123;
                        _ele.style(&quot;stroke&quot;, GlobalStatus.getFontColor());
                    &#125;

                &#125; else if (GlobalStatus.isPicked()) &#123;
                    if (_ele.attr(&quot;picked&quot;)) &#123;
                        _ele.fire(&quot;unPick&quot;);
                    &#125; else &#123;
                        _ele.fire(&quot;pick&quot;);
                    &#125;

                &#125; else if (GlobalStatus.isRecycle()) &#123;
                    _ele.remove();
                &#125;
            &#125;);
            _ele.on(&quot;mousedown&quot;, function(event) &#123;
                console.log(&quot;element mousedown&quot;);
                if (GlobalStatus.isPicked()) &#123;
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                &#125;
            &#125;);

            _ele.on(&quot;dragend&quot;, function(event) &#123;
                console.log(&quot;element dragend&quot;);
                _ele.fire(&quot;unPick&quot;);
            &#125;);
            _ele.on(&quot;beforedrag&quot;, function(event) &#123;
                console.log(&quot;element beforedrag&quot;);
            &#125;);
            _ele.on(&quot;pick&quot;, function() &#123;
                console.log(&quot;pick&quot;);
                _ele.attr(&quot;picked&quot;, true);
                _ele.handleBorder = _ele.handleBorder || new HandleBorder(svgDoc);
                _ele.handleBorder.showShade(_ele);
                GlobalStatus.pushPicked(_ele);
            &#125;);
            _ele.on(&quot;unPick&quot;, function() &#123;
                console.log(&quot;unPick&quot;);
                _ele.attr(&quot;picked&quot;, null);
                _ele.handleBorder &amp;&amp; _ele.handleBorder.hideShade(_ele);
                GlobalStatus.removePicked(_ele);

            &#125;);
            return this;
        &#125;

    &#125;);
&#125;)();
</code></pre>
<p>mouseover中的draggable();和 dragend事件中的fire(“unPick”);都不是很好的设计，需要重构。</p>
<h3 id="bug修复"><a href="#bug修复" class="headerlink" title="bug修复"></a>bug修复</h3><h4 id="dragend事件中的fire-“unPick”"><a href="#dragend事件中的fire-“unPick”" class="headerlink" title="dragend事件中的fire(“unPick”)"></a>dragend事件中的fire(“unPick”)</h4><p>针对dragend事件中的fire(“unPick”); 修改设计思路，在element记录开始拖拽时的坐标点数据，和dragend进行比较，如果坐标改变，表示元素发生移动，则按拖拽处理，需要触发fire(“unPick”); 否则，按照click事件处理。</p>
<pre><code>_ele.dragStartPoint = null;
_ele.on(&quot;dragstart&quot;, function(event) &#123;
    console.log(&quot;element dragstart&quot;);
    _ele.dragStartPoint = event.detail.p;
&#125;);
_ele.on(&quot;dragend&quot;, function(event) &#123;
    console.log(&quot;element dragend&quot;);
    if (_ele.dragStartPoint.x == event.detail.p.x &amp;&amp; _ele.dragStartPoint.y == event.detail.p.y) &#123;

    &#125; else &#123;
        _ele.fire(&quot;unPick&quot;);
    &#125;
&#125;);
</code></pre>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 12——变形 (上)</title>
    <url>/2016/09/28/painter-12/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="变形"><a href="#变形" class="headerlink" title="变形"></a>变形</h3><p>既然实现了拖拽效果，就可以在此基础上，实现另一个效果：变形。</p>
<h4 id="HandlerBorder"><a href="#HandlerBorder" class="headerlink" title="HandlerBorder"></a>HandlerBorder</h4><p>在实现变形效果之前，先讲解一下HandlerBorder。这是在pick时，选中元素后，在元素周围出现的4个黑框。 现在将其扩展为8个黑框，拖拽黑框，实现元素的变形效果。</p>
<p>先分析一下HandlerBorder的代码</p>
<pre><code>(function() &#123;

    var sideLength = 8;
    var sideWidth = &#123;
        width: 1
    &#125;;

    var HandleBorder = function(svgDoc) &#123;
        this.init(svgDoc);
    &#125;

    HandleBorder.prototype = &#123;
        constructor: HandleBorder,
        init: function(svgDoc) &#123;
            this.currentSvgDoc = svgDoc;
            this.create();
            return this;
        &#125;,
    &#125;;

    HandleBorder.prototype.create = function() &#123;
        var _this = this;

        _this.handleBorderGroup = _this.currentSvgDoc.group();

        _this.blockGroup = _this.handleBorderGroup.group();

        _this.rectLeftTop = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);
        _this.rectLeftBottom = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);
        _this.rectRightTop = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);
        _this.rectRightBottom = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);

        _this.rectLeftCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);
        _this.rectRightCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);
        _this.rectTopCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);
        _this.rectBottomCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth);

    &#125;;

    HandleBorder.prototype.rebound = function(bbox) &#123;
        var _this = this;

        var x1 = bbox.x;
        var y1 = bbox.y;
        var x2 = bbox.x2;
        var y2 = bbox.y2;
        _this.rectLeftTop.move(x1 - sideLength, y1 - sideLength);
        _this.rectLeftBottom.move(x1 - sideLength, y2);
        _this.rectRightTop.move(x2, y1 - sideLength);
        _this.rectRightBottom.move(x2, y2);

        _this.rectLeftCenter.move(x1 - sideLength, (y2 + y1 - sideLength) / 2);
        _this.rectRightCenter.move(x2, (y2 + y1 - sideLength) / 2);
        _this.rectTopCenter.move((x2 + x1 - sideLength) / 2, y1 - sideLength);
        _this.rectBottomCenter.move((x2 + x1 - sideLength) / 2, y2);

    &#125;;

    HandleBorder.prototype.show = function(svgEle) &#123;
        if (!svgEle) &#123;
            return;
        &#125;
        this.currentElement = svgEle;
        this.handleBorderGroup.show();

        this.rebound(svgEle.bbox());
    &#125;;

    HandleBorder.prototype.hide = function() &#123;
        this.handleBorderGroup.hide();
    &#125;;

    this.HandleBorder = HandleBorder;

&#125;)();
</code></pre>
<ol>
<li>HandleBorder有一个构造函数，调用create方法。create方法中创建了一个group，并在group中创建8个矩形。</li>
<li>在调用HandleBorder时，先new一个实例，然后调用其show方法，先将8个矩形的group显示出来，再重新设定其位置rebound。</li>
<li>rebound方法根据元素边框坐标和小矩形的边长，计算其位置，分布在4个边角与4个边长中点。</li>
</ol>
<h4 id="变形原理"><a href="#变形原理" class="headerlink" title="变形原理"></a>变形原理</h4><ol>
<li>将HandleBorder中的8个小矩形，作为操作框，绑定可拖拽效果。</li>
<li>拖拽时，判断其移动距离与方向，使图形对应改变宽高，达到变形效果。</li>
<li>为了避免拖拽时，操作框移动到任意位置，每次拖拽时，重新设置其位置rebound。</li>
</ol>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><h5 id="实现拖拽"><a href="#实现拖拽" class="headerlink" title="实现拖拽"></a>实现拖拽</h5><p>小矩形增加.draggable()方法调用。</p>
<pre><code>_this.rectLeftTop = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
_this.rectLeftBottom = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
_this.rectRightTop = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
_this.rectRightBottom = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();

_this.rectLeftCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
_this.rectRightCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
_this.rectTopCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
_this.rectBottomCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
</code></pre>
<h5 id="绑定拖拽事件"><a href="#绑定拖拽事件" class="headerlink" title="绑定拖拽事件"></a>绑定拖拽事件</h5><p>以左侧中心点操作框 rectLeftCenter 为例</p>
<p>在dragstart时，获取鼠标所在坐标lastPoint</p>
<pre><code>var lastPoint = null;
_this.rectLeftCenter.on(&quot;dragstart&quot;, function(event) &#123;
    lastPoint = event.detail.p;
&#125;);
</code></pre>
<p>event.detail中包含4个成员变量，可以参考svg.draggable.js中的代码</p>
<pre><code>this.el.fire(&#39;dragstart&#39;, &#123;event: e, p: this.startPoints.point, m: this.m, handler: this&#125;)
</code></pre>
<p>绑定dragmove事件，并重新计算鼠标坐标。</p>
<pre><code>_this.rectLeftCenter.on(&quot;dragmove&quot;, function() &#123;
    var currPoint = event.detail.p;
    lastPoint = currPoint;
&#125;);
</code></pre>
<h5 id="计算图形改变"><a href="#计算图形改变" class="headerlink" title="计算图形改变"></a>计算图形改变</h5><p>dragmove时可以活动当前坐标和上次坐标，计算出x轴移动的距离 </p>
<pre><code>var dx = currPoint.x - lastPoint.x;
</code></pre>
<p>定义一个变量xLeft = 1;表明鼠标移动方向，向左移动，则为1， 否则为-1; 并在拖拽开始时，初始化</p>
<pre><code>_this.rectLeftCenter.on(&quot;dragstart&quot;, function(event) &#123;
    lastPoint = event.detail.p;
    xLeft = 1;
&#125;);
    
</code></pre>
<p>新的元素宽度为 </p>
<pre><code>var width = ele.width() - xLeft * dx;
</code></pre>
<p>判断width是否大于0，如果大于0，则表示正向移动， 则新坐标x为</p>
<pre><code>var newX = ele.x() + xLeft * dx;
</code></pre>
<p>重新设定元素的x坐标和width，即可实现变形效果。</p>
<pre><code>ele.x(newX).width(width);
</code></pre>
<p>如果为反向移动，则width小于 0，此时反转xLeft，坐标原点应为元素的bbox的x2点，并根据x的中点做flip翻转。</p>
<pre><code>xLeft = -xLeft;
ele.x(ele.bbox().x2).width(-width).matrix(new SVG.Matrix(ele).flip(&#39;x&#39;, ele.bbox().cx));
</code></pre>
<h5 id="反转坐标复位"><a href="#反转坐标复位" class="headerlink" title="反转坐标复位"></a>反转坐标复位</h5><p>翻转之后的rebound无法复原，需要在rebound同样执行矩阵。</p>
<pre><code>this.blockGroup.matrix(new SVG.Matrix(_this.currentElement));
</code></pre>
<h5 id="限制拖拽轨迹"><a href="#限制拖拽轨迹" class="headerlink" title="限制拖拽轨迹"></a>限制拖拽轨迹</h5><p>为了避免拖拽时，小矩形可以任意移动，则在拖拽时，执行rebound操作校准。svg.draggable.js默认为提供此事件，扩展svg.draggable.js 增加如下方法。在DragHander.prototype.drag的结尾处增加 </p>
<pre><code>// so we can use it in the end-method, too
this.el.fire(&#39;afterdragmove&#39;, &#123; event: e, p: p, m: this.m, handler: this &#125;);
</code></pre>
<p>并在小矩形中监听次事件，执行复位校准。</p>
<pre><code>_this.rectLeftCenter.on(&quot;afterdragmove&quot;, function() &#123;
    _this.rebound(_this.currentElement.bbox());
&#125;);
</code></pre>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>handle.border.js完整代码如下</p>
<pre><code>(function() &#123;

    var sideLength = 8;
    var sideWidth = &#123;
        width: 1
    &#125;;

    var HandleBorder = function(svgDoc) &#123;
        this.init(svgDoc);
    &#125;

    HandleBorder.prototype = &#123;
        constructor: HandleBorder,
        init: function(svgDoc) &#123;
            this.currentSvgDoc = svgDoc;
            this.create();
            return this;
        &#125;,
    &#125;;

    HandleBorder.prototype.create = function() &#123;
        var _this = this;

        _this.handleBorderGroup = _this.currentSvgDoc.group();

        _this.blockGroup = _this.handleBorderGroup.group();

        _this.rectLeftTop = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
        _this.rectLeftBottom = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
        _this.rectRightTop = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
        _this.rectRightBottom = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();

        _this.rectLeftCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
        _this.rectRightCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
        _this.rectTopCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();
        _this.rectBottomCenter = this.blockGroup.rect(sideLength, sideLength).stroke(sideWidth).draggable();


        var lastPoint = null;
        var xLeft;
        _this.rectLeftCenter.on(&quot;dragstart&quot;, function(event) &#123;
            lastPoint = event.detail.p;
            xLeft = 1;
        &#125;);

        _this.rectLeftCenter.on(&quot;dragmove&quot;, function() &#123;
            var currPoint = event.detail.p;
            var currPoint = event.detail.p;
            var dx = currPoint.x - lastPoint.x;

            var ele = _this.currentElement;
            var width = ele.width() - xLeft * dx;

            if (width &gt; 0) &#123;
                var newX = ele.x() + xLeft * dx;
                ele.x(newX).width(width);
            &#125; else &#123;
                //invert
                xLeft = -xLeft;
                ele.x(ele.bbox().x2).width(-width).matrix(new SVG.Matrix(ele).flip(&#39;x&#39;, ele.bbox().cx));
            &#125;

            lastPoint = currPoint;
        &#125;);
        _this.rectLeftCenter.on(&quot;afterdragmove&quot;, function() &#123;
            _this.rebound(_this.currentElement.bbox());
        &#125;);

    &#125;;


    HandleBorder.prototype.rebound = function(bbox) &#123;
        var _this = this;

        var x1 = bbox.x;
        var y1 = bbox.y;
        var x2 = bbox.x2;
        var y2 = bbox.y2;
        _this.rectLeftTop.move(x1 - sideLength, y1 - sideLength);
        _this.rectLeftBottom.move(x1 - sideLength, y2);
        _this.rectRightTop.move(x2, y1 - sideLength);
        _this.rectRightBottom.move(x2, y2);

        _this.rectLeftCenter.move(x1 - sideLength, (y2 + y1 - sideLength) / 2);
        _this.rectRightCenter.move(x2, (y2 + y1 - sideLength) / 2);
        _this.rectTopCenter.move((x2 + x1 - sideLength) / 2, y1 - sideLength);
        _this.rectBottomCenter.move((x2 + x1 - sideLength) / 2, y2);

        this.blockGroup.matrix(new SVG.Matrix(_this.currentElement));
    &#125;;

    HandleBorder.prototype.show = function(svgEle) &#123;
        if (!svgEle) &#123;
            return;
        &#125;
        this.currentElement = svgEle;
        this.handleBorderGroup.show();

        this.rebound(svgEle.bbox());
    &#125;;

    HandleBorder.prototype.hide = function() &#123;
        this.handleBorderGroup.hide();
    &#125;;

    this.HandleBorder = HandleBorder;

&#125;)();
</code></pre>
<h3 id="附"><a href="#附" class="headerlink" title="附"></a>附</h3><p>涉及到数学思维，总是绕不出去，只能不断的试错。</p>
<p>为每个操作框绑定事件太繁琐，是否可以通用？</p>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 13——变形 (下)</title>
    <url>/2016/09/29/painter-13/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="变形"><a href="#变形" class="headerlink" title="变形"></a>变形</h3><p>变形这部分代码比较多，所以分为上下两部分。在(上)中已经实现了左侧中间点的变形操作。但是一共有8个操作点，为了避免混乱，抽离handle.border.listener.js提供8个点的变形方法。</p>
<h4 id="y轴移动"><a href="#y轴移动" class="headerlink" title="y轴移动"></a>y轴移动</h4><p>之前左侧中间点的操作可以视为x轴移动，现在只需要实现y轴移动的算法，即可实现8个点的移动。因为角落的四个点其实就是同时向2个方向移动。</p>
<p>以topCenter为例，设定Top，以上为正方向，1为向上运动，-1为向下运动。</p>
<p>  var tTop = 1; </p>
<p>计算鼠标y轴移动距离</p>
<p>  var dy = currPoint.y - lastPoint.y;</p>
<p>屏幕左上角为(0,0)点，所以图形的新高度为 </p>
<pre><code>var height = ele.height() - tTop * dy;
</code></pre>
<p>判断height，如果小于0，说明达到图形的y轴0点，要根据y轴进行翻转。</p>
<pre><code>var height = ele.height() - tTop * dy;
if (height &gt; 0) &#123;
    var newY = ele.y() + tTop * dy;
    ele.y(newY).height(height);
&#125; else &#123;
    //invert
    tTop = -tTop;
    ele.height(-height).matrix(new SVG.Matrix(ele).flip(&#39;y&#39;, ele.bbox().cy));
&#125;
</code></pre>
<h4 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h4><p>根据x、y两个方向的移动，推测出需要如下成员变量</p>
<pre><code>var lastPoint;
var xLeft;
var yTop;
var ele;
</code></pre>
<p>ele可以在初始化时完成，为当前操作的元素，lastPoint、xLeft、yTop需要在开始拖拽时初始化。</p>
<h4 id="通用方法"><a href="#通用方法" class="headerlink" title="通用方法"></a>通用方法</h4><p>为了节省代码，抽象了4个通用方法left(dx)、right(dx)、top(dy)、bottom(dy)</p>
<p>8个操作点根据需要，获取当前的鼠标移动距离，并调用其中的1或2个通用方法，即可实现变形效果。</p>
<h4 id="绑定并触发"><a href="#绑定并触发" class="headerlink" title="绑定并触发"></a>绑定并触发</h4><p>在构造函数中，除了初始化ele，还需要给ele绑定对应的事件。</p>
<p>在HandleBorder中，监听8个操作点的dragstart和dragmove事件，调用对应方法。</p>
<pre><code>var HandleBorderListener = function(targetElement) &#123;
    ele = targetElement;
    ele.on(&#39;leftCenterDragStart&#39;, leftCenterDragStart);
    ele.on(&#39;leftCenterDragMove&#39;, leftCenterDragMove);
    ele.on(&#39;rightCenterDragStart&#39;, rightCenterDragStart);
    ele.on(&#39;rightCenterDragMove&#39;, rightCenterDragMove);
    ele.on(&#39;topCenterDragStart&#39;, topCenterDragStart);
    ele.on(&#39;topCenterDragMove&#39;, topCenterDragMove);
    ele.on(&#39;bottomCenterDragStart&#39;, bottomCenterDragStart);
    ele.on(&#39;bottomCenterDragMove&#39;, bottomCenterDragMove);
    ele.on(&#39;leftTopDragStart&#39;, leftTopDragStart);
    ele.on(&#39;leftTopDragMove&#39;, leftTopDragMove);
    ele.on(&#39;leftBottomDragStart&#39;, leftBottomDragStart);
    ele.on(&#39;leftBottomDragMove&#39;, leftBottomDragMove);
    ele.on(&#39;rightTopDragStart&#39;, rightTopDragStart);
    ele.on(&#39;rightTopDragMove&#39;, rightTopDragMove);
    ele.on(&#39;rightBottomDragStart&#39;, rightBottomDragStart);
    ele.on(&#39;rightBottomDragMove&#39;, rightBottomDragMove);
&#125;
</code></pre>
<p>在HandleBorder中，在create方法中 </p>
<pre><code>_this.rectLeftCenter.on(&quot;dragstart&quot;, function() &#123;
    _this.currentElement.fire(&quot;leftCenterDragStart&quot;, &#123;
        currPoint: event.detail.p
    &#125;);
&#125;);
_this.rectLeftCenter.on(&quot;dragmove&quot;, function() &#123;
    _this.currentElement.fire(&quot;leftCenterDragMove&quot;, &#123;
        currPoint: event.detail.p
    &#125;);
&#125;);
_this.rectLeftCenter.on(&quot;afterdragmove&quot;, function() &#123;
    _this.rebound(_this.currentElement.bbox());
&#125;);
</code></pre>
<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><p>完整代码如下</p>
<pre><code>(function() &#123;
    var lastPoint;
    var xLeft;
    var yTop;
    var ele;

    function left(dx) &#123;
        var width = ele.width() - xLeft * dx;
        if (width &gt; 0) &#123;
            var newX = ele.x() + xLeft * dx;
            ele.x(newX).width(width);
        &#125; else &#123;
            //invert
            xLeft = -xLeft;
            ele.x(ele.bbox().x2).width(-width).matrix(new SVG.Matrix(ele).flip(&#39;x&#39;, ele.bbox().cx));
        &#125;
    &#125;

    function right(dx) &#123;
        var width = ele.width() - xLeft * dx;
        if (width &gt; 0) &#123;
            ele.width(width);
        &#125; else &#123;
            //invert
            xLeft = -xLeft;
            ele.width(-width).matrix(new SVG.Matrix(ele).flip(&#39;x&#39;, ele.bbox().cx));
        &#125;
    &#125;

    function top(dy) &#123;
        var height = ele.height() - tTop * dy;
        if (height &gt; 0) &#123;
            var newY = ele.y() + tTop * dy;
            ele.y(newY).height(height);
        &#125; else &#123;
            //invert
            tTop = -tTop;
            ele.height(-height).matrix(new SVG.Matrix(ele).flip(&#39;y&#39;, ele.bbox().cy));
        &#125;
    &#125;

    function bottom(dy) &#123;
        var height = ele.height() - tTop * dy;
        if (height &gt; 0) &#123;
            ele.height(height);
        &#125; else &#123;
            //invert
            tTop = -tTop;
            ele.height(-height).matrix(new SVG.Matrix(ele).flip(&#39;y&#39;, ele.bbox().cy));
        &#125;
    &#125;

    function leftCenterDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        xLeft = 1;
    &#125;

    function leftCenterDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dx = currPoint.x - lastPoint.x;
        left(dx);
        lastPoint = currPoint;
    &#125;

    function rightCenterDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        xLeft = -1;
    &#125;

    function rightCenterDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dx = currPoint.x - lastPoint.x;
        right(dx);
        lastPoint = currPoint;
    &#125;

    function topCenterDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        tTop = 1;
    &#125;

    function topCenterDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dy = currPoint.y - lastPoint.y;
        top(dy);
        lastPoint = currPoint;
    &#125;

    function bottomCenterDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        tTop = -1;
    &#125;

    function bottomCenterDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dy = currPoint.y - lastPoint.y;
        bottom(dy);
        lastPoint = currPoint;
    &#125;

    function leftTopDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        xLeft = 1;
        tTop = 1;
    &#125;

    function leftTopDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dx = currPoint.x - lastPoint.x;
        var dy = currPoint.y - lastPoint.y;
        left(dx);
        top(dy);
        lastPoint = currPoint;
    &#125;

    function leftBottomDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        xLeft = 1;
        tTop = -1;
    &#125;

    function leftBottomDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dx = currPoint.x - lastPoint.x;
        var dy = currPoint.y - lastPoint.y;
        left(dx);
        bottom(dy);
        lastPoint = currPoint;
    &#125;

    function rightTopDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        xLeft = -1;
        tTop = 1;
    &#125;

    function rightTopDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dx = currPoint.x - lastPoint.x;
        var dy = currPoint.y - lastPoint.y;
        right(dx);
        top(dy);
        lastPoint = currPoint;
    &#125;

    function rightBottomDragStart(data) &#123;
        lastPoint = data.detail.currPoint;
        xLeft = -1;
        tTop = -1;
    &#125;

    function rightBottomDragMove(data) &#123;
        var currPoint = data.detail.currPoint;
        var dx = currPoint.x - lastPoint.x;
        var dy = currPoint.y - lastPoint.y;
        right(dx);
        bottom(dy);
        lastPoint = currPoint;
    &#125;

    var HandleBorderListener = function(targetElement) &#123;
        ele = targetElement;
        ele.on(&#39;leftCenterDragStart&#39;, leftCenterDragStart);
        ele.on(&#39;leftCenterDragMove&#39;, leftCenterDragMove);
        ele.on(&#39;rightCenterDragStart&#39;, rightCenterDragStart);
        ele.on(&#39;rightCenterDragMove&#39;, rightCenterDragMove);
        ele.on(&#39;topCenterDragStart&#39;, topCenterDragStart);
        ele.on(&#39;topCenterDragMove&#39;, topCenterDragMove);
        ele.on(&#39;bottomCenterDragStart&#39;, bottomCenterDragStart);
        ele.on(&#39;bottomCenterDragMove&#39;, bottomCenterDragMove);
        ele.on(&#39;leftTopDragStart&#39;, leftTopDragStart);
        ele.on(&#39;leftTopDragMove&#39;, leftTopDragMove);
        ele.on(&#39;leftBottomDragStart&#39;, leftBottomDragStart);
        ele.on(&#39;leftBottomDragMove&#39;, leftBottomDragMove);
        ele.on(&#39;rightTopDragStart&#39;, rightTopDragStart);
        ele.on(&#39;rightTopDragMove&#39;, rightTopDragMove);
        ele.on(&#39;rightBottomDragStart&#39;, rightBottomDragStart);
        ele.on(&#39;rightBottomDragMove&#39;, rightBottomDragMove);
    &#125;

    this.HandleBorderListener = HandleBorderListener;
&#125;)();
</code></pre>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 02——抽象并实现图形绘制功能</title>
    <url>/2016/09/21/painter-2/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<p>针对上个版本的基础代码进行抽象和封装</p>
<p>将所有的图形绘制工具，都“继承”一个DrawTool工具类，在此工具类中绑定、解绑事件，代码如下</p>
<pre><code>(function() &#123;
    var defaultListener = &#123;
        mousedown: function() &#123;
            console.log(&#39;mousedown you should implement this function!&#39;);
        &#125;,
        mousemove: function() &#123;
            console.log(&#39;mousemove you should implement this function!&#39;);
        &#125;,
        mouseup: function() &#123;
            console.log(&#39;mouseup   you should implement this function!&#39;);
        &#125;
    &#125;;
    var DrawTool = &#123;
        init: function(svgDoc, listeners) &#123;
            var l = $.extend(&#123;&#125;, defaultListener, listeners);
            svgDoc.on(&#39;mousedown&#39;, l.mousedown);
            svgDoc.on(&#39;mousemove&#39;, l.mousemove);
            svgDoc.on(&#39;mouseup&#39;, l.mouseup);
        &#125;,
        stop: function(svgDoc, listeners) &#123;
            var l = $.extend(&#123;&#125;, defaultListener, listeners);
            svgDoc.off(&#39;mousemove&#39;, l.mousemove);
            svgDoc.off(&#39;mousedown&#39;, l.mousedown);
            svgDoc.off(&#39;mouseup&#39;, l.mouseup);
        &#125;
    &#125;;


    this.DrawTool = DrawTool;
&#125;)();
</code></pre>
<p>所有js独立代码都采用闭包形式，避免的参数污染。 拆分后的目录结构如下</p>
<p><img src="http://img.yuheng.wang/painter-2-0.png" alt="painter-2-0"></p>
<p>还是以矩形为例，Rect在构造函数中继承使用了DrawTool的init方法，并重写stop方法，暴露出去。</p>
<pre><code>var Rect = function(parentEle) &#123;
    parent = parentEle;
    svgDoc = parent.doc();
    DrawTool.init(svgDoc, listener);
    this.stop = function () &#123;
        DrawTool.stop(svgDoc, listener);
    &#125;;
&#125;;

this.DrawTool.Rect = Rect;
</code></pre>
<p>通过在Rect类内部定义mousedown、mousemove、mouseup事件方法，调用svgjs提供的绘制方法，实现图形的绘制工作。完整代码如下：</p>
<pre><code>(function() &#123;

    var parent = null;
    var drawing = false;
    var element = null;
    var startPoint = null;

    function mousedown(event) &#123;
        console.log(&#39;rect mousedown&#39;);
        drawing = true;
        startPoint = svgDoc.transformPoint(event);
        element = parent.rect(0, 0).style(&quot;fill-opacity&quot;, &#39;0.0&#39;).stroke(&#123;
            width: &#39;2&#39;,
            color: &#39;#000000&#39;
        &#125;);
    &#125;

    function mousemove(event) &#123;
        console.log(&#39;rect mousemove&#39;);
        if (drawing) &#123;
            var svgPoint = svgDoc.transformPoint(event);
            var x = svgPoint.x;
            var y = svgPoint.y;

            var newWidth = x - startPoint.x;
            var newHeight = y - startPoint.y;
            var startX = startPoint.x;
            var startY = startPoint.y;
            if (newWidth &lt; 0) &#123;
                startX += newWidth;
            &#125;

            if (newHeight &lt; 0) &#123;
                startY += newHeight;
            &#125;
            newWidth = Math.abs(newWidth);
            newHeight = Math.abs(newHeight);
            element.x(startX).y(startY).width(newWidth).height(newHeight);
        &#125;
    &#125;;

    function mouseup(event) &#123;
        console.log(&#39;rect mouseup &#39; + element);
        drawing = false;
    &#125;

    var listener = &#123;
        mousedown: mousedown,
        mousemove: mousemove,
        mouseup: mouseup,
    &#125;;


    var Rect = function(parentEle) &#123;
        parent = parentEle;
        svgDoc = parent.doc();
        DrawTool.init(svgDoc, listener);
        this.stop = function () &#123;
            DrawTool.stop(svgDoc, listener);
        &#125;;
    &#125;;

    this.DrawTool.Rect = Rect;

&#125;)();
</code></pre>
<p>有一个特殊的类为折线polyline工具类，此图形为连续绘制，需要记录上一个element，并且在stop方法中清空之前的element，并且监听鼠标右键点击事件，结束图形绘制。<br>阻止鼠标右键方法为</p>
<pre><code>function mousedown(event) &#123;
    if (event.button == 2) &#123;
        document.oncontextmenu=function()&#123;return false;&#125;
        drawing=false;
        points  = [];
        element = null;
        return;
    &#125;
    if (!drawing) &#123;
        drawing = true;
        var currPoint = svgDoc.transformPoint(event);
        points.push([currPoint.x, currPoint.y]);
    &#125;
&#125;
</code></pre>
<p>至此，已完成图形的基本绘制功能</p>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 03——选中元素</title>
    <url>/2016/09/21/painter-3/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<p>为了针对某个元素进行操作，增加了一个选中操作的按钮。点击此按钮后，鼠标变为手指选择，滑动到元素上方时，元素特殊显示，单击后即为选中状态。</p>
<p>首先，增加一个全局的状态位，判断选择按钮是否被选中 </p>
<pre><code>SVG.isPicked = function()&#123;
    return $(&quot;#tool_pick&quot;).hasClass(&quot;active&quot;);
&#125;
</code></pre>
<p>单击 pick 按钮时，鼠标变为手指</p>
<pre><code>$(&quot;#tool_pick&quot;).on(&quot;click&quot;, function()&#123;
    if (SVG.isPicked()) &#123;
        $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;,&quot;pointer&quot;);
    &#125;
&#125;);
</code></pre>
<p>因为要清空当前drawtool的事件监听，同时也要重置鼠标样式，所以抽离函数resetCurrentDrawTool，在现有handle btn点击时，进行调用</p>
<pre><code>function resetCurrentDrawTool() &#123;
    currentDrawTool &amp;&amp; currentDrawTool.stop();
    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;,&quot;default&quot;);
&#125;
</code></pre>
<p>针对选择元素操作，通过监听mouseover、mouseout、click事件，通过样式以及线框宽度标识。 为了方便调用，将此事件绑定，抽象为Element元素的扩展方法</p>
<pre><code>SVG.extend(SVG.Element, &#123;
    pickable: function(enabled) &#123;
        var _ele = this;
        elementList.push(_ele);
        var color = _ele._stroke;
        var width = _ele.attr(&quot;stroke-width&quot;);
        _ele.on(&quot;mouseover&quot;, function() &#123;
            if (SVG.isPicked() &amp;&amp; !_ele.attr(&quot;picked&quot;)) &#123;
                _ele.stroke(&#123;
                    width: width * 2,
                    color: &#39;red&#39;
                &#125;);
            &#125;
        &#125;);
        _ele.on(&quot;mouseout&quot;, function() &#123;
            if (SVG.isPicked() &amp;&amp; !_ele.attr(&quot;picked&quot;)) &#123;
                _ele.stroke(&#123;
                    width: width,
                    color: color
                &#125;);
            &#125;
        &#125;);
        _ele.on(&quot;click&quot;, function() &#123;
            if (SVG.isPicked()) &#123;
                if (!_ele.attr(&quot;picked&quot;)) &#123;
                    _ele.attr(&quot;picked&quot;, true);
                    _ele.stroke(&#123;
                        width: width * 2,
                        color: &#39;yellow&#39;
                    &#125;);
                &#125; else &#123;
                    _ele.attr(&quot;picked&quot;, null);
                    _ele.stroke(&#123;
                        width: width,
                        color: color
                    &#125;);
                &#125;
            &#125;
        &#125;);
        return this;
    &#125;

&#125;);
</code></pre>
<p>在DrawTool的具体实现的mouseup方法中，独立判断并执行。以Rect为例，则为</p>
<pre><code>function mouseup(event) &#123;
    drawing = false;
    if (element.attr(&quot;width&quot;) &gt; 0) &#123;
        element.pickable();
    &#125;
&#125;
</code></pre>
<p>首页增加elementList数据，记录所有函数，方便操作。</p>
<p>TODO 选中元素，现在为修改边框颜色，应该修改为其他方式。<br>TODO 针对所有选中元素，应该存在统一数据内，方便批量操作。</p>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 04——增加操作框（矩阵变化）</title>
    <url>/2016/09/22/painter-4/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<p>针对元素进行操作时，如果采用更改边框颜色的形式，会和修改边框冲突。所以采用增加4个操作边框的形式，既能表示元素被选中，又能在后续增加拖拽，变形等操作。</p>
<p>增加了一个HandleBorder类，并扩展其prototype属性对象，增加方法</p>
<ol>
<li>createShade 用于创建4个边框</li>
<li>judgeShade 用于将4个小矩形，放至所选元素的4个边角</li>
<li>showShade 显示操作边框</li>
<li>隐藏操作边框</li>
</ol>
<p>加入了一些距离计算和矩阵，详细代码如下 </p>
<pre><code>(function() &#123;

    var sbw = 6;
    var bw = &#123;
        width: 1
    &#125;;

    var HandleBorder = function(svgDoc) &#123;
        this.init(svgDoc);
    &#125;

    HandleBorder.prototype = &#123;
        constructor: HandleBorder,
        init: function(svgDoc) &#123;
            this.currentSvgDoc = svgDoc;
            this.createShade();
            return this;
        &#125;,
    &#125;;

    HandleBorder.prototype.createShade = function() &#123;
        var _this = this;

        _this.transformerGroup = _this.currentSvgDoc.group();

        _this.blockGroup = _this.transformerGroup.group();

        _this.rectLT = this.blockGroup.rect(sbw, sbw).stroke(bw).attr(&#123;
            &#39;_operate-type&#39;: &#39;scale&#39;,
            &#39;_direction&#39;: &#39;lt&#39;
        &#125;);
        _this.rectLB = this.blockGroup.rect(sbw, sbw).stroke(bw).attr(&#123;
            &#39;_operate-type&#39;: &#39;scale&#39;,
            &#39;_direction&#39;: &#39;lb&#39;
        &#125;);
        _this.rectRT = this.blockGroup.rect(sbw, sbw).stroke(bw).attr(&#123;
            &#39;_operate-type&#39;: &#39;scale&#39;,
            &#39;_direction&#39;: &#39;rt&#39;
        &#125;);
        _this.rectRB = this.blockGroup.rect(sbw, sbw).stroke(bw).attr(&#123;
            &#39;_operate-type&#39;: &#39;scale&#39;,
            &#39;_direction&#39;: &#39;rb&#39;
        &#125;);

    &#125;;

    HandleBorder.prototype.judgeShade = function(bbox, matrix) &#123;
        var x1 = bbox.x;
        var y1 = bbox.y;
        var x2 = bbox.x2;
        var y2 = bbox.y2;


        this.rectLT.move(x1 - sbw, y1 - sbw);
        this.rectLB.move(x1 - sbw, y2);
        this.rectRT.move(x2, y1 - sbw);
        this.rectRB.move(x2, y2);

        this.blockGroup.matrix(matrix);

    &#125;;

    HandleBorder.prototype.showShade = function(svgEle) &#123;
        if (!svgEle) &#123;
            return;
        &#125;
        this.currentElement = svgEle;
        this.transformerGroup.show();

        this.judgeShade(svgEle.bbox(), new SVG.Matrix(svgEle));
    &#125;;

    HandleBorder.prototype.hideShade = function() &#123;
        this.transformerGroup.hide();
    &#125;;

    this.HandleBorder = HandleBorder;

&#125;)();
</code></pre>
<p>在Element的扩展方法中，利用HandleBorder替换边框颜色变更操作，并将new的HandleBorder对象绑定到元素中 </p>
<pre><code>_ele.on(&quot;click&quot;, function() &#123;
    if (SVG.isPicked()) &#123;
        if (!_ele.attr(&quot;picked&quot;)) &#123;
            _ele.attr(&quot;picked&quot;, true);
            console.log(_ele.handleBorder);
            _ele.handleBorder = _ele.handleBorder || new HandleBorder(svgDoc);
            _ele.handleBorder.showShade(_ele);
            pickedElementList.push(_ele);
        &#125; else &#123;
            _ele.attr(&quot;picked&quot;, null);
            _ele.handleBorder &amp;&amp; _ele.handleBorder.hideShade(_ele);
            pickedElementList.remove(_ele);
        &#125;
    &#125;
&#125;);
</code></pre>
<p>扩展了一个pickedElementList数组，并在SVG扩展中提供获取方法 </p>
<pre><code>    getPickedElementList: function()&#123;
        return pickedElementList;
    &#125;
    
</code></pre>
<p>为了方便移除操作，强化了数组操作，提供了remove方法 </p>
<pre><code>Array.prototype.indexOf = function(val) &#123;
    for (var i = 0; i &lt; this.length; i++) &#123;
        if (this[i] == val) return i;
    &#125;
    return -1;
&#125;;
Array.prototype.remove = function(val) &#123;
    var index = this.indexOf(val);
    if (index &gt; -1) &#123;
        this.splice(index, 1);
    &#125;
&#125;;
</code></pre>
<p>选择元素操作已经完成，可以在此基础上绑定颜色操作，以及拖拽及变形操作。</p>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 05——设置图形边框颜色与背景色（喷枪）</title>
    <url>/2016/09/23/painter-5/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="边框与背景色"><a href="#边框与背景色" class="headerlink" title="边框与背景色"></a>边框与背景色</h3><p>首先，使用了开源的 <a href="https://github.com/bgrins/spectrum">spectrum.js</a> 作为颜色选择器，<br>之前以SVG对象保存全局方法与对象，现在通过新定义一个GlobalStatus，存在全局属性，并通过按钮状态判断状态</p>
<pre><code>var GlobalStatus = &#123;
    defaultFontColor:&quot;#0073c6&quot;,
    defaultFillColor:&quot;#ececec&quot;,
    defaultLineSize:&quot;2&quot;,
    isPicked:function()&#123;
        return $(&quot;#tool_pick&quot;).hasClass(&quot;active&quot;);
    &#125;,
    isPreFilled:function()&#123;
        return $(&quot;#tool_fill&quot;).hasClass(&quot;active&quot;);
    &#125;,
    getFontColor:function()&#123;
        return $(&quot;#font_color&quot;).attr(&quot;data-color&quot;);
    &#125;,
    getFillColor:function()&#123;
        return $(&quot;#fill_color&quot;).attr(&quot;data-color&quot;);
    &#125;,
    getLineSize:function()&#123;
        return this.defaultLineSize;
    &#125;,
    getFillOpacity:function()&#123;
        var fillOpacity = &quot;0.0&quot;;
        if (this.getFillColor() != this.defaultFillColor) &#123;
            fillOpacity = &quot;1.0&quot;;
        &#125;
        return fillOpacity;
    &#125;
&#125;
</code></pre>
<p>在首页给默认线条颜色及背景颜色赋值，并设置状态data-color保存颜色值</p>
<pre><code>    $(&quot;#font_color span&quot;).css(&quot;background&quot;, GlobalStatus.defaultFontColor);
    $(&quot;#font_color&quot;).attr(&quot;data-color&quot;, GlobalStatus.defaultFontColor);
    $(&quot;#fill_color span&quot;).css(&quot;background&quot;, GlobalStatus.defaultFillColor);
    $(&quot;#fill_color&quot;).attr(&quot;data-color&quot;, GlobalStatus.defaultFillColor);
</code></pre>
<p>颜色选择器发生变化时，同时变更颜色与data-color属性值</p>
<pre><code>    $(&quot;#colorPalettes&quot;).spectrum(&#123;
        flat: true,
        showPaletteOnly: true,
        color: &#39;#0073c6&#39;,
        move: function(tinycolor) &#123;
            console.log(&quot;color move&quot;);
            console.log(tinycolor.toHexString())
            if ($(&quot;#fill_color&quot;).hasClass(&quot;active&quot;)) &#123;
                $(&quot;#fill_color&quot;).attr(&quot;data-color&quot;, tinycolor.toHexString());
                $(&quot;#fill_color span&quot;).eq(0).css(&quot;background&quot;, tinycolor.toHexString());

            &#125; else if ($(&quot;#font_color&quot;).hasClass(&quot;active&quot;)) &#123;
                $(&quot;#font_color&quot;).attr(&quot;data-color&quot;, tinycolor.toHexString());
                $(&quot;#font_color span&quot;).eq(0).css(&quot;background&quot;, tinycolor.toHexString());
            &#125;

        &#125;,

        palette: spectrumColors
    &#125;);
    
</code></pre>
<p>这里有一个取巧的地方，为了让背景颜色透明显示，规定ececec为透明颜色。选择此颜色时，将透明度opacity设置为全透明。</p>
<p>这样做有一个问题，如果用户自定义此颜色，可以将自定义的颜色修改为ececed，不会在视觉上有较大影响。</p>
<p>在绘制元素时，通过GlobalStatus设置元素的边框、颜色、及透明度。已rect为例</p>
<pre><code>function mousedown(event) &#123;
    console.log(&#39;rect mousedown&#39;);
    drawing = true;
    startPoint = svgDoc.transformPoint(event);
    element = parent.rect(0, 0).fill(GlobalStatus.getFillColor()).style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity()).stroke(&#123;
        width: GlobalStatus.getLineSize(),
        color: GlobalStatus.getFontColor()
    &#125;);
&#125;
</code></pre>
<p>此时，绘制的颜色就会根据设置的颜色及背景色发生变化。</p>
<h3 id="喷枪"><a href="#喷枪" class="headerlink" title="喷枪"></a>喷枪</h3><p>在GlobalStatus中增加了isPreFilled()方法，判断喷枪是否被选中。在Element的扩展方法中，监听click事件。<br>如果为选中喷枪的点击，则修改元素的对应属性值即可。</p>
<pre><code>_ele.on(&quot;click&quot;, function() &#123;
    if (GlobalStatus.isPreFilled()) &#123;
        if ($(&quot;#fill_color&quot;).hasClass(&quot;active&quot;)) &#123;
            _ele.fill(GlobalStatus.getFillColor());
            _ele.style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity());
        &#125; else &#123;
            _ele.style(&quot;stroke&quot;, GlobalStatus.getFontColor());
        &#125;

    &#125; else if (GlobalStatus.isPicked()) &#123;
        if (!_ele.attr(&quot;picked&quot;)) &#123;
            _ele.attr(&quot;picked&quot;, true);
            console.log(_ele.handleBorder);
            _ele.handleBorder = _ele.handleBorder || new HandleBorder(svgDoc);
            _ele.handleBorder.showShade(_ele);
            pickedElementList.push(_ele);
        &#125; else &#123;
            _ele.attr(&quot;picked&quot;, null);
            _ele.handleBorder &amp;&amp; _ele.handleBorder.hideShade(_ele);
            pickedElementList.remove(_ele);
        &#125;
    &#125;
&#125;);
</code></pre>
<p>这里有一个用户体验的问题，喷枪是同时修改边框色和背景色，还是分别修改？</p>
<p>现在的实现方法为分别修改。用户需要点击线条与背景色，然后再用喷枪工具分别修改元素颜色。</p>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 06——铅笔与自定义鼠标图标</title>
    <url>/2016/09/24/painter-6/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="自定义鼠标图标"><a href="#自定义鼠标图标" class="headerlink" title="自定义鼠标图标"></a>自定义鼠标图标</h3><p>可以通过css设置cursor的方式指定鼠标图标样式</p>
<p>| default | 默认光标（通常是一个箭头） |<br>| auto | 默认。浏览器设置的光标。 |<br>| crosshair | 光标呈现为十字线。 |<br>| pointer | 光标呈现为指示链接的指针（一只手） |<br>| move | 此光标指示某对象可被移动。 |<br>| e-resize | 此光标指示矩形框的边缘可被向右（东）移动。 |<br>| ne-resize | 此光标指示矩形框的边缘可被向上及向右移动（北/东）。 |<br>| nw-resize | 此光标指示矩形框的边缘可被向上及向左移动（北/西）。 |<br>| n-resize | 此光标指示矩形框的边缘可被向上（北）移动。 |<br>| se-resize | 此光标指示矩形框的边缘可被向下及向右移动（南/东）。 |<br>| sw-resize | 此光标指示矩形框的边缘可被向下及向左移动（南/西）。 |<br>| s-resize | 此光标指示矩形框的边缘可被向下移动（南）。 |<br>| w-resize | 此光标指示矩形框的边缘可被向左移动（西）。 |<br>| text | 此光标指示文本。 |<br>| wait | 此光标指示程序正忙（通常是一只表或沙漏）。 |<br>| help | 此光标指示可用的帮助（通常是一个问号或一个气球）。 |</p>
<p>也可以通过url指定自定义的图标样式，通常为.cur文件。</p>
<pre><code>$(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;url(style/img/cur/tool_pencil.cur), auto&quot;);
</code></pre>
<p>auto为指定图标不存在时，鼠标显示的样式。</p>
<h3 id="铅笔"><a href="#铅笔" class="headerlink" title="铅笔"></a>铅笔</h3><p>通过svg的path属性，可以绘制出鼠标移动轨迹，实现铅笔画图效果。svgjs提供了path()函数，值为</p>
<ul>
<li>  M = moveto</li>
<li>  L = lineto</li>
<li>  H = horizontal lineto</li>
<li>  V = vertical lineto</li>
<li>  C = curveto</li>
<li>  S = smooth curveto</li>
<li>  Q = quadratic Belzier curve</li>
<li>  T = smooth quadratic Belzier curveto</li>
<li>  A = elliptical Arc</li>
<li>  Z = closepath</li>
</ul>
<p>所以mousedown时做 M+坐标点，mousemove时，为L+坐标点，可以指定不同的路径数据以达到不同的绘制效果，所以在构造函数中增加了一个prefix字段。</p>
<p>pencil.js 代码如下</p>
<pre><code>(function() &#123;

    var parent = null;
    var drawing = false;
    var element = null;
    var startPoint = null;

    var plot = null;
    var plotPrefix = null;
    var defaultPlotPrefix = &#39;L&#39;;

    function mousedown(event) &#123;
        console.log(&#39;pencil mousedown&#39;);
        drawing = true;
        startPoint = svgDoc.transformPoint(event);
        plot = &#39;M&#39; + startPoint.x + &#39; &#39; + startPoint.y;
        element = parent.path(plot).fill(GlobalStatus.getFillColor()).style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity()).stroke(&#123;
            width: GlobalStatus.getLineSize(),
            color: GlobalStatus.getFontColor()
        &#125;);
        return false;
    &#125;

    function mousemove(event) &#123;
        console.log(&#39;pencil mousemove&#39;);
        if (drawing) &#123;
            var startPoint = svgDoc.transformPoint(event);
            console.log(plot);
            plot += plotPrefix + startPoint.x + &#39; &#39; + startPoint.y;
            element.plot(plot);
        &#125;
        return false;
    &#125;;

    function mouseup(event) &#123;
        console.log(&#39;pencil mouseup &#39; + element);
        drawing = false;
        if (element.attr(&quot;d&quot;).split(plotPrefix).length &gt; 2) &#123;
            element.pickable();
        &#125;
        return false;
    &#125;

    var listener = &#123;
        mousedown: mousedown,
        mousemove: mousemove,
        mouseup: mouseup,
    &#125;;


    var Pencil = function(parentEle, prefix) &#123;
        parent = parentEle;
        svgDoc = parent.doc();
        DrawTool.init(svgDoc, listener);
        plotPrefix = prefix || defaultPlotPrefix;
        this.stop = function() &#123;
            DrawTool.stop(svgDoc, listener);
        &#125;;
    &#125;;

    this.DrawTool.Pencil = Pencil;

&#125;)();
</code></pre>
<p>在首页监听铅笔的点击事件，并在页面加载完成后默认调用 $(“#tool_pencil”).click();</p>
<pre><code>    $(&quot;#tool_pencil&quot;).on(&quot;click&quot;, function() &#123;
        resetCurrentDrawTool();
        currentDrawTool = new DrawTool.Pencil(svgDoc);
        $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;url(style/img/cur/tool_pencil.cur), auto&quot;);
    &#125;);
    
</code></pre>
<p>加了一个彩蛋，监听铅笔按钮的双击事件，可以绘制映射线。</p>
<pre><code>    $(&quot;#tool_pencil&quot;).on(&quot;dblclick&quot;, function() &#123;
        resetCurrentDrawTool();
        currentDrawTool = new DrawTool.Pencil(svgDoc, &#39;T&#39;);
        $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;url(style/img/cur/tool_pencil.cur), auto&quot;);
    &#125;);
</code></pre>
<h3 id="附"><a href="#附" class="headerlink" title="附"></a>附</h3><p>在Tools的listener方法中，都加了一个return false; 避免事件向上传递。</p>
<p>在模拟的下拉列表lizeSize中，通过属性data-line-size记录width值，在GlobalStatus.getLineSize()中调用。</p>
<p>将已选择元素抽象到在GlobalStatus中，并提供管理方法。</p>
<pre><code>pickedElementList: [],
pushPicked: function(o)&#123;
    return this.pickedElementList.push(o);
&#125;,
removePicked: function(o) &#123;
    return this.pickedElementList.remove(o);
&#125;,
getPickeds: function()&#123;
    return this.pickedElementList;
&#125;
</code></pre>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 07——图层移动</title>
    <url>/2016/09/24/painter-7/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="图层移动"><a href="#图层移动" class="headerlink" title="图层移动"></a>图层移动</h3><p>svgjs提供了图层移动的方法，实现方式如下</p>
<pre><code>, forward: function() &#123;
    var i = this.position() + 1
  , p = this.parent()

    // move node one step forward
  p.removeElement(this).add(this, i)

    // make sure defs node is always at the top
  if (p instanceof SVG.Doc)
      p.node.appendChild(p.defs().node)

    return this
  &#125;
  // Send given element one step backward
, backward: function() &#123;
    var i = this.position()

    if (i &gt; 0)
      this.parent().removeElement(this).add(this, i - 1)

    return this
  &#125;
  // Send given element all the way to the front
, front: function() &#123;
    var p = this.parent()

    // Move node forward
  p.node.appendChild(this.node)

    // Make sure defs node is always at the top
  if (p instanceof SVG.Doc)
      p.node.appendChild(p.defs().node)

    return this
  &#125;
  // Send given element all the way to the back
, back: function() &#123;
    if (this.position() &gt; 0)
      this.parent().removeElement(this).add(this, 0)

    return this
  &#125;
 
</code></pre>
<p>在按钮上绑定对应函数，并结合已选中元素，即可实现图层移动效果。此时需要注意，避免g元素，并且判断是否为最上(下)层元素，因为源码种只是执行+1 -1操作，如果最上层继续向上移动多次后，需要向下移动多次，才可以实现图层的切换效果。g元素的判断为偷懒方法，需要考虑是否考虑白名单的数组，以及改用迭代的方式进行</p>
<pre><code>    $(&quot;#tool_layer_front&quot;).on(&quot;click&quot;, function() &#123;
        var elements = GlobalStatus.getPickeds();
        if (elements.length &gt; 0) &#123;
            $(elements).each(function()&#123;
                this
                this.front();
            &#125;);
        &#125;
    &#125;);
    $(&quot;#tool_layer_back&quot;).on(&quot;click&quot;, function() &#123;
        var elements = GlobalStatus.getPickeds();
        if (elements.length &gt; 0) &#123;
            $(elements).each(function()&#123;
                this.back();
            &#125;);
        &#125;
    &#125;);
    $(&quot;#tool_layer_backward&quot;).on(&quot;click&quot;, function() &#123;
        var elements = GlobalStatus.getPickeds();
        if (elements.length &gt; 0) &#123;
            $(elements).each(function()&#123;
                if (this.previous()) &#123;
                    //TODO 迭代 且使用白名单数组
                    if (this.previous().type == &quot;g&quot;) &#123;
                        this.backward();
                    &#125;
                    this.backward();
                &#125;
            &#125;);
        &#125;
    &#125;);
    $(&quot;#tool_layer_forward&quot;).on(&quot;click&quot;, function() &#123;
        var elements = GlobalStatus.getPickeds();
        if (elements.length &gt; 0) &#123;
            $(elements).each(function()&#123;
                if (this.next()) &#123;
                    if (this.next().type == &quot;g&quot;) &#123;
                        this.forward();
                    &#125;
                    this.forward();
                &#125;
            &#125;);
        &#125;
    &#125;);
    
</code></pre>
<h3 id="附"><a href="#附" class="headerlink" title="附"></a>附</h3><p>这里发现了一个bug。在图层移动的时候，单步移动有时会失效。排查后发现，是因为mousedown时，已经生成了一个element，但在页面中看不出来。为了解决此bug，在mouseup时，增加了一个判断，如果页面不可见，则将此element在parent中移除。parent为svgDoc</p>
<pre><code>function mouseup(event) &#123;
    console.log(&#39;rect mouseup &#39; + element);
    drawing = false;
    if (element.attr(&quot;width&quot;) &gt; 0) &#123;
        element.pickable();
    &#125; else &#123;
        parent.removeElement(element);
    &#125;
    return false;
&#125;
</code></pre>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 09——自定义右键菜单</title>
    <url>/2016/09/26/painter-9/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="自定义右键菜单"><a href="#自定义右键菜单" class="headerlink" title="自定义右键菜单"></a>自定义右键菜单</h3><p>使用开源的jquery插件<a href="https://github.com/joewalnes/jquery-simple-context-menu">jquery-simple-context-menu.js-1.3.2</a> 实现自定义右键菜单的效果。<br>插件内容比较简单，方便进行二次开发和定制。</p>
<p>插件的设计思路主要是基于jquery，监听contextmenu事件，并append自定义的div菜单列表。</p>
<p>新增mouse_action.js，用于监听鼠标事件。给svg区域设置插件自定义的contextPopup事件。</p>
<pre><code>(function()&#123;
    $(&#39;#svgPanel&#39;).contextPopup(&#123;
    items: [
        &#123;
            label: &#39; 取消&#39;,
            action: function () &#123;
            &#125;
        &#125;,
        &#123;
            label: &#39; 选择&#39;,
            action: function () &#123;
                $(&quot;#tool_pick&quot;).click();
            &#125;
        &#125;,
        &#123;
            label: &#39; 清屏&#39;,
            action: function () &#123;
                $(&quot;#clear_all&quot;).click();
            &#125;
        &#125;
    ]
&#125;);
&#125;)();
</code></pre>
<h3 id="附"><a href="#附" class="headerlink" title="附"></a>附</h3><p>修改了js文件的命名规则，用’.’替换了’_’</p>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>绘画板 08——删除与清屏</title>
    <url>/2016/09/25/painter-8/</url>
    <content><![CDATA[<p>github地址： <a href="https://github.com/wangyuheng/painter">https://github.com/wangyuheng/painter</a></p>
<p>DEMO地址： <a href="http://painter.crick.wang/">http://painter.crick.wang/</a></p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>GlobalStatus增加isRecycle()方法，用来判断删除按钮是否被点击</p>
<pre><code>isRecycle: function()&#123;
    return $(&quot;#tool_delete&quot;).hasClass(&quot;active&quot;);
&#125;,
</code></pre>
<p>在Element扩展的click方法中，增加删除判断，执行remove()方法。并在mouseover时修改鼠标图标显示</p>
<pre><code>(function() &#123;

    SVG.extend(SVG.Doc, &#123;
        transformPoint: function(event) &#123;
            event = event || window.event;
            var touches = event.changedTouches &amp;&amp; event.changedTouches[0] || event;
            var node = this.node;
            var point = node.createSVGPoint();
            point.x = touches.pageX - window.scrollX;
            point.y = touches.pageY - window.scrollY;
            var matrix = node.getScreenCTM().inverse();
            return point.matrixTransform(matrix);
        &#125;
    &#125;);

    SVG.extend(SVG.Element, &#123;
        pickable: function(enabled) &#123;
            var _ele = this;
            GlobalStatus.pushElements(_ele);
            var color = _ele._stroke;
            var width = _ele.attr(&quot;stroke-width&quot;);
            _ele.on(&quot;mouseover&quot;, function() &#123;
                if (GlobalStatus.isPicked()) &#123;
                    _ele.stroke(&#123;
                        width: width * 2,
                        color: &#39;red&#39;
                    &#125;);
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;pointer&quot;);
                &#125; else if (GlobalStatus.isPreFilled()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;url(style/img/cur/tool_fill.cur), auto&quot;);
                &#125; else if (GlobalStatus.isRecycle()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;url(style/img/cur/tool_delete.cur), auto&quot;);
                &#125;


            &#125;);
            _ele.on(&quot;mouseout&quot;, function() &#123;
                if (GlobalStatus.isPicked()) &#123;
                    _ele.stroke(&#123;
                        width: width,
                        color: color
                    &#125;);
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;default&quot;);
                &#125; else if (GlobalStatus.isPreFilled()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;default&quot;);
                &#125; else if (GlobalStatus.isRecycle()) &#123;
                    $(&quot;#svgPanel&quot;).css(&quot;cursor&quot;, &quot;default&quot;);
                &#125;

            &#125;);
            _ele.on(&quot;click&quot;, function() &#123;
                if (GlobalStatus.isPreFilled()) &#123;
                    if ($(&quot;#fill_color&quot;).hasClass(&quot;active&quot;)) &#123;
                        _ele.fill(GlobalStatus.getFillColor());
                        _ele.style(&quot;fill-opacity&quot;, GlobalStatus.getFillOpacity());
                    &#125; else &#123;
                        _ele.style(&quot;stroke&quot;, GlobalStatus.getFontColor());
                    &#125;

                &#125; else if (GlobalStatus.isPicked()) &#123;
                    if (!_ele.attr(&quot;picked&quot;)) &#123;
                        _ele.attr(&quot;picked&quot;, true);
                        _ele.handleBorder = _ele.handleBorder || new HandleBorder(svgDoc);
                        _ele.handleBorder.showShade(_ele);
                        GlobalStatus.pushPicked(_ele);
                    &#125; else &#123;
                        _ele.attr(&quot;picked&quot;, null);
                        _ele.handleBorder &amp;&amp; _ele.handleBorder.hideShade(_ele);
                        GlobalStatus.removePicked(_ele);
                    &#125;
                &#125; else if (GlobalStatus.isRecycle()) &#123;
                    _ele.remove();
                &#125;
            &#125;);
            return this;
        &#125;

    &#125;);
&#125;)();
</code></pre>
<h3 id="清屏"><a href="#清屏" class="headerlink" title="清屏"></a>清屏</h3><p>单击清屏按钮时，清空所有的element元素，不需要按钮被点击状态。</p>
<p>此时有一个思考，是遍历所有的元素执行删除操作，还是重新设置svg doc。</p>
<p>先用遍历方法执行。</p>
<p>将elementList抽象到GlobalStatus方法中管理，并在元素完成后执行添加操作。</p>
<pre><code>elementList : [],
pushElements: function(o)&#123;
    return this.elementList.push(o);
&#125;,
removeElements: function(o) &#123;
    return this.elementList.remove(o);
&#125;,
getAllElements: function()&#123;
    return this.elementList;
&#125;
</code></pre>
<p>监听清屏按钮，遍历删除element</p>
<pre><code>    $(&quot;#clear_all&quot;).on(&quot;click&quot;, function() &#123;
        $(GlobalStatus.getAllElements()).each(function()&#123;
            this.remove();
        &#125;);
    &#125;);
</code></pre>
]]></content>
      <categories>
        <category>painter</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>painter</tag>
      </tags>
  </entry>
  <entry>
    <title>js获取script参数</title>
    <url>/2016/06/29/project-listen/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<h1 id="Listen"><a href="#Listen" class="headerlink" title="Listen"></a>Listen</h1><h2 id="初心"><a href="#初心" class="headerlink" title="初心"></a>初心</h2><p>个人网站，会让朋友随便点点，试用一下，并提一些建议。如果通过聊天工具，比较麻烦，不方便整理。<br>打算开发一个意见反馈的js插件，加载到页面之中，可以让用户第一时间输入意见，并在页面中能看到意见列表，及解决状态。</p>
<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>由3部分构成</p>
<ol>
<li>前台输入页面</li>
<li>数据中心</li>
<li>意见解决页面</li>
</ol>
<h3 id="前台输入页面"><a href="#前台输入页面" class="headerlink" title="前台输入页面"></a>前台输入页面</h3><p>面向网站浏览用户，负责意见输入、采集工作。<br>采用js插件的形式，方便集成到不同的web页面中。<br>通过js控制HTML元素，设置样式，布局在页面的某个角落，不影响原页面。<br>通过json格式与数据中心进行通信，利用原生ajax形式，不依赖任何第三方库。</p>
<h3 id="数据中心"><a href="#数据中心" class="headerlink" title="数据中心"></a>数据中心</h3><p>存储意见数据。<br>根据域名区分不同租户。<br>通过restful，以json格式传递数据。<br>可跨域访问。</p>
<h3 id="意见解决页面"><a href="#意见解决页面" class="headerlink" title="意见解决页面"></a>意见解决页面</h3><p>可查看不同租户下意见。<br>解决或者输入不解决原因。<br>通过json格式与数据中心进行通信。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="前台输入页面-1"><a href="#前台输入页面-1" class="headerlink" title="前台输入页面"></a>前台输入页面</h3><pre><code>var Listen = &#123;
    submitUrl: &#39;&#39;,
    listUrl: &#39;&#39;,
    submit: function()&#123;&#125;,
    list: function()&#123;&#125;
&#125;
</code></pre>
]]></content>
      <categories>
        <category>project</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>listen</tag>
        <tag>project</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Cloud Data Flow 入门</title>
    <url>/2020/10/25/scdf/</url>
    <content><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><blockquote>
<p>Microservice based Streaming and Batch data processing for Cloud Foundry and Kubernetes</p>
</blockquote>
<span id="more"></span>

<p>简单解释一下<code>Streaming</code>和<code>Batch</code>处理的区别</p>
<ul>
<li><code>Streaming</code>: 应用始终处于启动状态，有数据就处理。通过消息传递中间件消耗或生成无限量的数据。</li>
<li><code>Batch(Task)</code>: 需要处理数据时启动应用，处理完成后关闭应用，只处理有限量的数据​。</li>
</ul>
<p>思考一个问题。<strong>如何动态启动一个未启动的Spring项目？</strong></p>
<p>答案是配置了一个<code>maven jar</code>包地址，或者是一个<code>docker image</code>地址，在任务触发时，下载对应的程序(镜像)并启动。</p>
<p><img src="https://img.yuheng.wang/mweb/SCDF-event-driven-applications.gif" alt="SCDF-event-driven-applications"></p>
<h3 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h3><ul>
<li><strong>Application</strong>: 指向某一个<strong>jar</strong>或<strong>docker</strong>的<code>Stream</code>或<code>Batch</code>程序</li>
<li><strong>Task</strong>: 通过<strong>DSL</strong>组装多个<code>Application</code>，定义处理任务</li>
<li><strong>Stream</strong>: 通过<strong>DSL</strong>组装多个<code>Application</code>，按照<code>source-&gt;processor-&gt;sink</code>定义数据处理流</li>
<li><strong>Job</strong>: 每个<code>Task</code>的执行记录，包括入参及结果记录</li>
</ul>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p><img src="https://img.yuheng.wang/mweb/16030161223482.jpg"></p>
<ul>
<li><strong>Data Flow Server</strong>: 定义、校验并执行 <code>Stream</code>和<code>Batch</code>，监听应用状态，记录执行记录。<ul>
<li>基于 <strong>DSL</strong> 定义<code>Stream</code>和<code>Batch</code></li>
<li>通过 <strong>jar包</strong> 或者 <strong>docker镜像</strong> 注册应用</li>
<li>执行<code>Stream</code>和<code>Batch</code>并记录执行记录，监听应用状态</li>
</ul>
</li>
<li><strong>Skipper Server</strong>: 负责流处理发布<ul>
<li>部署<code>Streams</code>到一或多个平台</li>
<li>基于蓝绿更新策略升级或回滚<code>Stream</code></li>
<li>持久化<code>Stream</code>的描述信息，包括历史版本</li>
</ul>
</li>
<li><strong>Database</strong>: <strong>Data Flow Server</strong>和<strong>Skipper Server</strong>依赖关系数据库。<ul>
<li>默认通过内嵌的<code>H2</code>数据库启动，支持多种关系型数据库</li>
<li>在服务启动时自动创建表结构</li>
<li>Task可以通过配置共享外部数据库作为持久化</li>
</ul>
</li>
<li><strong>Messaging Middleware</strong>: 用于消息驱动模型的消息中间件。<ul>
<li>支持<code>Kafka</code>、<code>RabbitMQ</code></li>
<li><code>Stream</code>必须通过消息中间件驱动</li>
</ul>
</li>
<li><strong>Monitor</strong>: 监控系统运行指标。<ul>
<li>通过<code>Prometheus</code>或<code>InfluxDB</code>存储</li>
<li>通过<code>Grafana</code>展示</li>
</ul>
</li>
</ul>
<p><img src="https://img.yuheng.wang/mweb/16035425320745.jpg"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>上面的概念和组件有点复杂？我们先快速启动一个应用，通过界面看一下如何使用</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>可以通过一句docker命令启动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run --rm -it -p 9393:9393 springcloud&#x2F;spring-cloud-dataflow-server:2.6.3</span><br></pre></td></tr></table></figure>

<p>通过 <a href="http://localhost:9393/dashboard/#/about">http://localhost:9393/dashboard/#/about</a> 访问管理界面</p>
<p><img src="https://img.yuheng.wang/mweb/16035229504390.jpg"></p>
<p>注: <code>Schedules</code>未开启的原因是单机版的安装方式不支持定时任务。</p>
<h3 id="创建-Application"><a href="#创建-Application" class="headerlink" title="创建 Application"></a>创建 Application</h3><p>提供了三种方式，但是要注意，<strong>不支持直接上传jar包或者发现运行中的应用，只能指定maven仓库地址(或者docker地址)进行拉取</strong></p>
<p><img src="https://img.yuheng.wang/mweb/16035232360718.jpg"></p>
<p>选用第二种(import from an HTTP URI location)，并选择官方<strong>Task Apps Maven</strong>示例，本质上是从官方拉取下列配置，在 第三种(import from properties) 中输入下列信息也是同样的效果。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">task.timestamp&#x3D;maven:&#x2F;&#x2F;org.springframework.cloud.task.app:timestamp-task:2.1.1.RELEASE</span><br><span class="line">task.timestamp.metadata&#x3D;maven:&#x2F;&#x2F;org.springframework.cloud.task.app:timestamp-task:jar:metadata:2.1.1.RELEASE</span><br><span class="line">task.composed-task-runner&#x3D;maven:&#x2F;&#x2F;org.springframework.cloud.task.app:composedtaskrunner-task:2.1.4.RELEASE</span><br><span class="line">task.composed-task-runner.metadata&#x3D;maven:&#x2F;&#x2F;org.springframework.cloud.task.app:composedtaskrunner-task:jar:metadata:2.1.4.RELEASE</span><br><span class="line">task.timestamp-batch&#x3D;maven:&#x2F;&#x2F;org.springframework.cloud.task.app:timestamp-batch-task:2.1.1.RELEASE</span><br><span class="line">task.timestamp-batch.metadata&#x3D;maven:&#x2F;&#x2F;org.springframework.cloud.task.app:timestamp-batch-task:jar:metadata:2.1.1.RELEASE</span><br></pre></td></tr></table></figure>

<p>每个<code>application</code>需要指定应用地址和<code>metadata</code>信息地址。<code>metadata</code>会在使用过程中明确参数输入表单。如果未指定<code>metadata</code>地址，会尝试通过应用进行提取。</p>
<p>导入的应用可以在应用列表中查看，可以通过<strong>show details</strong>查看应用的<code>metadata</code></p>
<p><img src="https://img.yuheng.wang/mweb/16035445690603.jpg" alt="-w1439"></p>
<p><code>metadata</code>通过KV形式展示</p>
<p><img src="https://img.yuheng.wang/mweb/16035443539633.jpg" alt="-w1437"></p>
<p><strong>注意: 这里有一个坑。</strong>如果你按照官方示例 <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/timestamp">https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/timestamp</a> 新建了一个<code>Spring Cloud Task</code>, 会发现没办法查看<code>metadata</code>信息，原因是因为官方项目中缺少配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">classpath*:&#x2F;META-INF&#x2F;dataflow-configuration-metadata.properties</span><br></pre></td></tr></table></figure>

<p>内容为<code>configuration-properties.classes</code>执行配置类</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">configuration-properties.classes&#x3D;wang.yuheng.SyncPrestoProperties</span><br></pre></td></tr></table></figure>

<p><code>Spring Cloud Data Flow</code> 对<code>metadata</code>解析过程如下:</p>
<p><img src="https://img.yuheng.wang/mweb/16035236462403.jpg"><br><img src="https://img.yuheng.wang/mweb/16035236677036.jpg"></p>
<p><strong>另一个坑</strong>是，如果是<code>maven</code>地址，会先从**localRepository(.m2)**获取<code>jar</code>文件解析<code>metadata</code>。而如果你设置的是<code>docker</code>，每次都会通过网络进行<code>docker</code>鉴权并下载，无法直接判断本地是否存在，所以速度会比<code>maven</code>慢很多。</p>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><p><img src="https://img.yuheng.wang/mweb/dataflow-task-lifecycle.gif" alt="dataflow-task-lifecycle"></p>
<h4 id="创建-Task"><a href="#创建-Task" class="headerlink" title="创建 Task"></a>创建 Task</h4><p>可以通过页面或者DSL定义Task</p>
<p><img src="https://img.yuheng.wang/mweb/16035444946051.jpg" alt="-w1425"></p>
<p>创建好的<code>Task</code>会存在于<code>Tasks</code>列表中，可以在列表页查看<code>Task</code>详情或者执行任务(生成<code>job</code>)</p>
<p><img src="https://img.yuheng.wang/mweb/16035449417864.jpg" alt="-w1435"></p>
<p>如果通过<strong>Cloud</strong>方式进行部署，可以指定定时任务，相比普通任务，可以通过<code>cron expression</code>设置定时</p>
<p><img src="https://img.yuheng.wang/mweb/16035451713208.jpg"><br><img src="https://img.yuheng.wang/mweb/16035451761383.jpg"></p>
<h4 id="运行-Task"><a href="#运行-Task" class="headerlink" title="运行 Task"></a>运行 Task</h4><p>可以在<strong>Task</strong>列表中选择要执行的<strong>Task</strong>，并通过<strong>KV List</strong>的方式指定入参及properties。明确一下这2个概念</p>
<ul>
<li>properties: 配置参数，比如数据库配置</li>
<li>Arguments: 方法入参，即 <code>String[] args</code></li>
</ul>
<p><img src="https://img.yuheng.wang/mweb/16035454202663.jpg" alt="-w1084"></p>
<p>每次执行会生成一个<code>Job</code>记录，可以在<code>Task</code>或者<code>Job</code>列表中查看执行状态、日志等信息</p>
<p><img src="https://img.yuheng.wang/mweb/16035454870024.jpg" alt="-w1421"></p>
<h3 id="审计留痕"><a href="#审计留痕" class="headerlink" title="审计留痕"></a>审计留痕</h3><p><strong>Audit Records</strong>页面会看到触发数据及执行记录等信息，包括不同方式(Restful、Shell、WebUI)触发的行为。开启登录验证后可以查看操作人信息。</p>
<p><img src="https://img.yuheng.wang/mweb/16036282823075.jpg" alt="-w1437"></p>
<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p><img src="https://img.yuheng.wang/mweb/16029993900615.jpg"></p>
<p>使用<code>Stream</code>需要依赖<code>skipper-server</code>和消息中间件，通过<strong>docker-compose</strong>启动</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7.25</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dataflow-mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">dataflow</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">rootpw</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka-broker:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">confluentinc/cp-kafka:5.3.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dataflow-kafka</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9092&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka-broker:9092</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_ADVERTISED_HOST_NAME=kafka-broker</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zookeeper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">confluentinc/cp-zookeeper:5.3.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dataflow-kafka-zookeeper</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2181&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ZOOKEEPER_CLIENT_PORT=2181</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">dataflow-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">springcloud/spring-cloud-dataflow-server:2.6.3</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dataflow-server</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9393:9393&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">spring.cloud.dataflow.applicationProperties.stream.spring.cloud.stream.kafka.binder.brokers=PLAINTEXT://kafka-broker:9092</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">spring.cloud.dataflow.applicationProperties.stream.spring.cloud.stream.kafka.streams.binder.brokers=PLAINTEXT://kafka-broker:9092</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">spring.cloud.dataflow.applicationProperties.stream.spring.cloud.stream.kafka.binder.zkNodes=zookeeper:2181</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">spring.cloud.dataflow.applicationProperties.stream.spring.cloud.stream.kafka.streams.binder.zkNodes=zookeeper:2181</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">spring.cloud.skipper.client.serverUri=http://skipper-server:7577/api</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/dataflow</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=rootpw</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.mariadb.jdbc.Driver</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka-broker</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">&quot;./wait-for-it.sh mysql:3306 -- java -jar /maven/spring-cloud-dataflow-server.jar&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;HOST_MOUNT_PATH:-.&#125;:$&#123;DOCKER_MOUNT_PATH:-/root/scdf&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">app-import:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">springcloud/openjdk:2.0.0.RELEASE</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dataflow-app-import</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dataflow-server</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line">      <span class="string">/bin/sh</span> <span class="string">-c</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">        ./wait-for-it.sh -t 180 dataflow-server:9393;</span></span><br><span class="line"><span class="string">        wget -qO- &#x27;http://dataflow-server:9393/apps&#x27; --post-data=&#x27;uri=$&#123;STREAM_APPS_URI:-https://dataflow.spring.io/kafka-maven-latest&amp;force=true&#125;&#x27;;</span></span><br><span class="line"><span class="string">        echo &#x27;Stream apps imported&#x27;</span></span><br><span class="line"><span class="string">        wget -qO- &#x27;http://dataflow-server:9393/apps&#x27; --post-data=&#x27;uri=$&#123;TASK_APPS_URI:-https://dataflow.spring.io/task-maven-latest&amp;force=true&#125;&#x27;;</span></span><br><span class="line"><span class="string">        echo &#x27;Task apps imported&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">skipper-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">springcloud/spring-cloud-skipper-server:2.5.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">skipper</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7577:7577&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;20000-20105:20000-20105&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_SKIPPER_SERVER_PLATFORM_LOCAL_ACCOUNTS_DEFAULT_PORTRANGE_LOW=20000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_SKIPPER_SERVER_PLATFORM_LOCAL_ACCOUNTS_DEFAULT_PORTRANGE_HIGH=20100</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/dataflow</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=rootpw</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.mariadb.jdbc.Driver</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">&quot;./wait-for-it.sh mysql:3306 -- java -jar /maven/spring-cloud-skipper-server.jar&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$&#123;HOST_MOUNT_PATH:-.&#125;:$&#123;DOCKER_MOUNT_PATH:-/root/scdf&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建-Stream"><a href="#创建-Stream" class="headerlink" title="创建 Stream"></a>创建 Stream</h4><p>同样可以通过页面或者<strong>DSL</strong>按照<code>source-&gt;processor-&gt;sink</code>定义<strong>Stream</strong>。每个<code>source-&gt;processor-&gt;sink</code>是一个Stream，可以同时创建多个独立的<strong>Stream</strong></p>
<p><img src="https://img.yuheng.wang/mweb/16035457542560.jpg" alt="-w1429"></p>
<p><img src="https://img.yuheng.wang/mweb/16035457847721.jpg" alt="-w1343"></p>
<h4 id="发布-Stream"><a href="#发布-Stream" class="headerlink" title="发布 Stream"></a>发布 Stream</h4><p><strong>Stream</strong> 创建成功后，需要通过<code>skipper-server</code>发布至<strong>Runtime</strong>，基于消息队列进行驱动并执行数据处理</p>
<p><strong>注意</strong>: 如果要使用流，需要找一个支持流的持久化，如 <code>Redis</code></p>
<p>在列表页可以查看<code>Stream</code>详情，或者发布<code>Stream</code>。</p>
<p><img src="https://img.yuheng.wang/mweb/16036292349065.jpg" alt="-w1430"></p>
<p>发布时需要指定每个<strong>Application</strong>的<strong>properties</strong>，并且指定资源限制。如果是发布至k8s环境，会根据集群配置进行分配。</p>
<p><img src="https://img.yuheng.wang/mweb/%E6%88%AA%E5%B1%8F2020-10-24%20%E4%B8%8B%E5%8D%889.24.09.png" alt="截屏2020-10-24 下午9.24.09"></p>
<p><strong>细节</strong>: 会按照<strong>label</strong>在<code>kafka</code>中创建对应的<strong>topic</strong></p>
<p><img src="https://img.yuheng.wang/mweb/16035788009803.jpg" alt="-w1438"></p>
<p>发布后可以在<strong>Runtime</strong>查看对应的<code>Stream</code>状态及详情</p>
<p><img src="https://img.yuheng.wang/mweb/16035461293459.jpg"></p>
<p><img src="https://img.yuheng.wang/mweb/16035763569958.jpg" alt="-w1357"></p>
<p>通过<strong>docker-compose</strong>启动，所以会在<code>skipper-server</code>这台机器上运行相关Jar包作为<strong>消息Consumer</strong></p>
<p><img src="https://img.yuheng.wang/mweb/16035781241462.jpg" alt="-w1427"></p>
<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><p>上述操作均可通过<code>命令行</code> or <code>Restful</code>进行调用，并且配置都可以导出为对应的配置文件(<code>DSL</code>、<code>Task</code>、<code>Stream</code>等)</p>
<p><img src="https://img.yuheng.wang/mweb/16035799973264.jpg" alt="-w1434"></p>
<p>基于此就可配合当前使用的<code>CICD</code>完成<code>devops</code>。</p>
<p>想象一个场景，在你提交代码后，自动发布至某个环境等待运行。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. push code</span><br><span class="line">2. maven package</span><br><span class="line">3. deploy maven repository</span><br><span class="line">4. create application</span><br><span class="line">5. create task</span><br><span class="line">6. run task</span><br></pre></td></tr></table></figure>

<h2 id="观点"><a href="#观点" class="headerlink" title="观点"></a>观点</h2><p>现实骨感，未来部分期待，如果你正在 All in Spring Cloud。<br>整体基于<strong>Spring Cloud</strong>，但是又拥抱<strong>docker</strong>。如果只是<strong>docker</strong>就可以去掉很多限制，就像是<strong>k8s</strong>和 <strong>Spring Cloud</strong> 组件本身就存在诸多重复</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>基于Spring微服务，无切换成本，可独立开发、测试</li>
<li>完整的闭环，提供了从服务定制、管理、运行、监控全生命周期解决方案</li>
<li>拖拽式UI操作界面，配合DSL，配置简单，页面看起来很现代(你知道我在讽刺谁)</li>
</ol>
<h3 id="中立"><a href="#中立" class="headerlink" title="中立"></a>中立</h3><ol>
<li>未提供特定的计算引擎集群，类似 Flink、Spark 等</li>
<li>不能覆盖工作流场景</li>
<li>稳定性，目测现阶段上生产可以很快成为<strong>contributors</strong></li>
<li>资源占用(看到有吐槽，但是未测试，不发表评论)</li>
<li>前端使用页面angularjs编写</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>仅基于Spring微服务，比如一行命令 or 一句sql 必须通过Spring Cloud Task(or Stream) 编写。通过Java编写job，你需要一个高版本的JDK</li>
<li>依赖<strong>maven repo</strong> (可能提供了http、ftp等其他方式，但是笔者没找到。。)</li>
<li>如果涉及到大数据处理，还是要依靠Hadoop中的模块。那么为什么混用，而不是直接使用全家桶呢？</li>
</ol>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul>
<li><a href="https://dataflow.spring.io/docs/concepts/tooling/">https://dataflow.spring.io/docs/concepts/tooling/</a></li>
<li><a href="https://www.springcloud.cc/spring-cloud-dataflow.html#_launching_a_task_externally_from_spring_cloud_data_flow">https://www.springcloud.cc/spring-cloud-dataflow.html#_launching_a_task_externally_from_spring_cloud_data_flow</a></li>
</ul>
]]></content>
      <categories>
        <category>springcloud</category>
      </categories>
      <tags>
        <tag>springcloud</tag>
        <tag>大数据</tag>
      </tags>
  </entry>
  <entry>
    <title>原生js实现Ajax</title>
    <url>/2016/06/30/skill-javascript-native-ajax/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>传统的表单提交方式，在提交之后，会跳转到一个新页面。<br>采用ajax的方式，可以在页面不发生跳转的前提条件下，与服务器进行数据通信（提交表单，并获取服务器端的返回数据），从而实现局部刷新。<br>不仅仅是提高了性能，更重要的是，提供了一种强大的灵活性。</p>
<p>Asynchronous javascript and XML</p>
<p>尽管名称中的x表示了xml，其实现在更通用的一种方式是通过json格式进行数据通信。<br>原因是json格式更加小巧，且支持更好。js自带。</p>
]]></content>
      <categories>
        <category>skill</category>
      </categories>
      <tags>
        <tag>skill</tag>
        <tag>javascript</tag>
        <tag>ajax</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis 源码浅入浅出（草稿）</title>
    <url>/2018/03/23/soucecode-mybatis/</url>
    <content><![CDATA[<h2 id="1-关于阅读源码"><a href="#1-关于阅读源码" class="headerlink" title="1. 关于阅读源码"></a>1. 关于阅读源码</h2><p>工作中使用到的框架容易成为最熟悉的陌生代码，可以熟练使用，但是并不知道其中原理。阅读源码可以帮助我们知其然，亦知其所以然，既可以在工作中更好的使用框架特性，也可以借鉴其中优秀的设计思想。</p>
<p>但是面对框架庞大的代码量，往往不知如何下手。总结了一些方法，可以帮助coder战胜恐惧，顺利的开始阅读源码。</p>
<span id="more"></span>

<h3 id="1-1-屏蔽干扰"><a href="#1-1-屏蔽干扰" class="headerlink" title="1.1. 屏蔽干扰"></a>1.1. 屏蔽干扰</h3><p>简单粗暴的减法，根据包名猜测作用，排除主流程外代码<br>如MyBatis的包结构如下</p>
<ul>
<li><del>annotations</del> 注解类，流程实现无关</li>
<li>binding 代理 *</li>
<li>builder 构造 *</li>
<li><del>cache</del> 缓存相关，后续独立阅读</li>
<li>datasource 数据源</li>
<li><del>exceptions</del> 异常封装</li>
<li>executor 具体的执行 **</li>
<li><del>io</del> 文件流</li>
<li><del>jdbc</del> </li>
<li><del>logging</del> 日志，后续独立阅读</li>
<li>mapping 映射，sql映射，参数映射，结果映射</li>
<li>parsing sql解析</li>
<li><del>plugin</del> 插件</li>
<li><del>reflection</del> 反射</li>
<li>scripting 脚本</li>
<li>session 会话请求 *</li>
<li><del>transaction</del> 事务管理，后续独立阅读</li>
<li><del>type</del> 类型转换，后续独立阅读</li>
</ul>
<p>需要阅读的包列表如下</p>
<ul>
<li>binding 代理 *</li>
<li>builder 构造 *</li>
<li>datasource 数据源</li>
<li>executor 具体的执行 **</li>
<li>mapping 映射，sql映射，参数映射，结果映射</li>
<li>parsing sql解析</li>
<li>scripting 脚本</li>
<li>session 会话请求 *</li>
</ul>
<h3 id="1-2-找到入口"><a href="#1-2-找到入口" class="headerlink" title="1.2. 找到入口"></a>1.2. 找到入口</h3><p>代码是逻辑的实现，找到入口，根据功能逻辑逐步阅读。入口一般为</p>
<ol>
<li>启动类</li>
<li>根据具体的使用方法debug跟踪</li>
</ol>
<h3 id="1-3-不纠结细节，不扩散思维"><a href="#1-3-不纠结细节，不扩散思维" class="headerlink" title="1.3. 不纠结细节，不扩散思维"></a>1.3. 不纠结细节，不扩散思维</h3><p>根据方法名明确其作用，熟悉整体流程时，不过分纠结具体实现细节（如：锁），明确作用主线，不要扩散到其他实现中</p>
<h2 id="2-基础知识点"><a href="#2-基础知识点" class="headerlink" title="2. 基础知识点"></a>2. 基础知识点</h2><p>阅读源码前先补充两个知识点</p>
<h3 id="2-1-代理"><a href="#2-1-代理" class="headerlink" title="2.1. 代理"></a>2.1. 代理</h3><p>代理(Proxy)是一种设计模式,提供了对目标对象另外的访问方式;即通过代理对象访问目标对象.这样做的好处是:可以在目标对象实现的基础上,增强额外的功能操作,即扩展目标对象的功能. 不破坏开闭原则的前提下，实现了功能的修改。AOP也是采用了这种设计模式。</p>
<p><img src="http://img.yuheng.wang/sourcecode-mybatis-0.jpg" alt="sourcecode-mybatis-0"></p>
<h3 id="2-1-1-静态代理"><a href="#2-1-1-静态代理" class="headerlink" title="2.1.1. 静态代理"></a>2.1.1. 静态代理</h3><p>需求(issue)需要编码(coding)实现，程序员(Coder)负责编码，但是issue不应该直接找coder，产品经理(PM)负责在coding前后进行需求梳理、需求验收。但是PM不应该直接修改程序员的coding过程，所以PM就是一层代理，在coder无感知的情况下增加了功能与访问控制。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Issue client = <span class="keyword">new</span> PM();</span><br><span class="line">        client.coding();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">Issue</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">coding</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Coder</span> <span class="keyword">implements</span> <span class="title">Issue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">coding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;coding&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PM</span> <span class="keyword">implements</span> <span class="title">Issue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Issue issue = <span class="keyword">new</span> Coder();</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">coding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.beforeDoing();</span><br><span class="line">            issue.coding();</span><br><span class="line">            <span class="keyword">this</span>.afterDoing();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">beforeDoing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;需求梳理&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">afterDoing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;需求验收&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2-动态代理"><a href="#2-1-2-动态代理" class="headerlink" title="2.1.2. 动态代理"></a>2.1.2. 动态代理</h3><p>上面的代码有两个bug，</p>
<ol>
<li>如果我有多个程序员，如JavaCoder、PythonCoder，那么是不是也需要多个PM吗？</li>
<li>PM不会coding。。。</li>
</ol>
<p>为了解决这两个问题，需要用到动态代理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        PM pmWithPython = <span class="keyword">new</span> PM(<span class="keyword">new</span> PythonCoder());</span><br><span class="line">        PM pmWithJava = <span class="keyword">new</span> PM(<span class="keyword">new</span> JavaCoder());</span><br><span class="line">        Issue pythonIssue = (Issue) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;Issue.class&#125;,</span><br><span class="line">                pmWithPython);</span><br><span class="line">        pythonIssue.coding();</span><br><span class="line"></span><br><span class="line">        Issue javaIssue = (Issue) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;Issue.class&#125;,</span><br><span class="line">                pmWithJava);</span><br><span class="line">        javaIssue.coding();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Issue</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">coding</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaCoder</span> <span class="keyword">implements</span> <span class="title">Issue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">coding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;coding by java&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonCoder</span> <span class="keyword">implements</span> <span class="title">Issue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">coding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;coding by python&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PM</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Issue issue;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PM</span><span class="params">(Issue issue)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.issue = issue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            beforeDoing();</span><br><span class="line">            proxy = method.invoke(issue, args);</span><br><span class="line">            afterDoing();</span><br><span class="line">            <span class="keyword">return</span> proxy;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">beforeDoing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;需求梳理&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">afterDoing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;需求验收&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很多人会纠结，代理模式和装饰模式有什么区别，网上大多数的文章说装饰模式是为了增强功能，代理模式是为了控制访问，这是不能赞同的一种说法。我认为区别在于思想，装饰模式是你明确知道要把某个对象做哪些扩展，而代理则是你不和对象直接交互，而是通过第三者沟通。 动态代理，则是可以选择无关的第三者，不需要有共同的接口或父类。</p>
<h3 id="2-2-JDBC"><a href="#2-2-JDBC" class="headerlink" title="2.2. JDBC"></a>2.2. JDBC</h3><p>简单的实现代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcApp</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url = <span class="string">&quot;jdbc:mysql://localhost:3306/mysql&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        Connection connection = DriverManager.getConnection(url, username, password);</span><br><span class="line">        Statement statement = connection.createStatement();</span><br><span class="line"></span><br><span class="line">        ResultSet resultSet = statement.executeQuery(<span class="string">&quot;select * from user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (resultSet.next()) &#123;</span><br><span class="line">            String Host = resultSet.getString(<span class="string">&quot;Host&quot;</span>);</span><br><span class="line">            String User = resultSet.getString(<span class="string">&quot;User&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Host: &quot;</span> + Host + <span class="string">&quot;, User: &quot;</span> + User);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-1-JDBC做了哪些事"><a href="#2-2-1-JDBC做了哪些事" class="headerlink" title="2.2.1 JDBC做了哪些事"></a>2.2.1 JDBC做了哪些事</h4><p><img src="http://img.yuheng.wang/sourcecode-mybatis-1-1.png" alt="sourcecode-mybatis-1"></p>
<h4 id="2-2-2-Class-forName做了什么？"><a href="#2-2-2-Class-forName做了什么？" class="headerlink" title="2.2.2 Class.forName做了什么？"></a>2.2.2 Class.forName做了什么？</h4><p>通过反射将驱动注册进DriverManager中，用于创建connection时使用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mysql.cj.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Driver</span> <span class="keyword">extends</span> <span class="title">NonRegisteringDriver</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">sql</span>.<span class="title">Driver</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Driver</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException var1) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Can&#x27;t register driver!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DriverManager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        String url, java.util.Properties info, Class&lt;?&gt; caller)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ClassLoader callerCL = caller != <span class="keyword">null</span> ? caller.getClassLoader() : <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">synchronized</span>(DriverManager.class) &#123;</span><br><span class="line">            <span class="comment">// synchronize loading of the correct classloader.</span></span><br><span class="line">            <span class="keyword">if</span> (callerCL == <span class="keyword">null</span>) &#123;</span><br><span class="line">                callerCL = Thread.currentThread().getContextClassLoader();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(url == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">&quot;The url cannot be null&quot;</span>, <span class="string">&quot;08001&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        println(<span class="string">&quot;DriverManager.getConnection(\&quot;&quot;</span> + url + <span class="string">&quot;\&quot;)&quot;</span>);</span><br><span class="line"></span><br><span class="line">        SQLException reason = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(DriverInfo aDriver : registeredDrivers) &#123;</span><br><span class="line">            <span class="comment">// If the caller does not have permission to load the driver then</span></span><br><span class="line">            <span class="comment">// skip it.</span></span><br><span class="line">            <span class="keyword">if</span>(isDriverAllowed(aDriver.driver, callerCL)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    println(<span class="string">&quot;    trying &quot;</span> + aDriver.driver.getClass().getName());</span><br><span class="line">                    Connection con = aDriver.driver.connect(url, info);</span><br><span class="line">                    <span class="keyword">if</span> (con != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// Success!</span></span><br><span class="line">                        println(<span class="string">&quot;getConnection returning &quot;</span> + aDriver.driver.getClass().getName());</span><br><span class="line">                        <span class="keyword">return</span> (con);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (reason == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        reason = ex;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                println(<span class="string">&quot;    skipping: &quot;</span> + aDriver.getClass().getName());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if we got here nobody could connect.</span></span><br><span class="line">        <span class="keyword">if</span> (reason != <span class="keyword">null</span>)    &#123;</span><br><span class="line">            println(<span class="string">&quot;getConnection failed: &quot;</span> + reason);</span><br><span class="line">            <span class="keyword">throw</span> reason;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        println(<span class="string">&quot;getConnection: no suitable driver found for &quot;</span>+ url);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">&quot;No suitable driver found for &quot;</span>+ url, <span class="string">&quot;08001&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反射运行静态块，但是不会生成实例。</p>
<h4 id="2-2-3-可以不写Class-forName吗？"><a href="#2-2-3-可以不写Class-forName吗？" class="headerlink" title="2.2.3 可以不写Class.forName吗？"></a>2.2.3 可以不写Class.forName吗？</h4><p>可以，因为DriverManager中通过spi初始化了驱动。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DriverManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> CopyOnWriteArrayList&lt;DriverInfo&gt; registeredDrivers = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        loadInitialDrivers();</span><br><span class="line">        println(<span class="string">&quot;JDBC DriverManager initialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadInitialDrivers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String drivers;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            drivers = AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;String&gt;() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> System.getProperty(<span class="string">&quot;jdbc.drivers&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            drivers = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);</span><br><span class="line">                Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">while</span>(driversIterator.hasNext()) &#123;</span><br><span class="line">                        driversIterator.next();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Throwable t) &#123;</span><br><span class="line">                <span class="comment">// Do nothing</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        println(<span class="string">&quot;DriverManager.initialize: jdbc.drivers = &quot;</span> + drivers);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (drivers == <span class="keyword">null</span> || drivers.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] driversList = drivers.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">        println(<span class="string">&quot;number of Drivers:&quot;</span> + driversList.length);</span><br><span class="line">        <span class="keyword">for</span> (String aDriver : driversList) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                println(<span class="string">&quot;DriverManager.Initialize: loading &quot;</span> + aDriver);</span><br><span class="line">                Class.forName(aDriver, <span class="keyword">true</span>,</span><br><span class="line">                        ClassLoader.getSystemClassLoader());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                println(<span class="string">&quot;DriverManager.Initialize: load failed: &quot;</span> + ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对spi做一个简单的介绍</p>
<blockquote>
<p>SPI 简介SPI 全称为(Service Provider Interface) ,是JDK内置的一种服务提供发现机制。</p>
</blockquote>
<p>简单来说，我们定义了一个服务interface，jar包可以编写实现，并通过文件声明实现类，让服务发现并动态替换。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpiDemoApi</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpiDemoImplA</span> <span class="keyword">implements</span> <span class="title">SpiDemoApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;spi A impl&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpiDemoImplB</span> <span class="keyword">implements</span> <span class="title">SpiDemoApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;spi B impl&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在META-INF/services目录下以接口全路径名命名的文件，并在其中声明实现类的全路径名。声明的方法可以通过ServiceLoader发现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ServiceLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpiApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ServiceLoader&lt;SpiDemoApi&gt; serviceLoader = ServiceLoader.load(SpiDemoApi.class);</span><br><span class="line">        <span class="keyword">for</span> (SpiDemoApi service : serviceLoader) &#123;</span><br><span class="line">            service.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dubbo、log、jdbc都使用了spi相关技术。</p>
<p>spi<br>dubbo log jdbc</p>
<p>SpringFactoriesLoader</p>
<h3 id="2-3-反射"><a href="#2-3-反射" class="headerlink" title="2.3. 反射"></a>2.3. 反射</h3><h4 id="2-3-1-类"><a href="#2-3-1-类" class="headerlink" title="2.3.1 类"></a>2.3.1 类</h4><h2 id="3-MyBatis"><a href="#3-MyBatis" class="headerlink" title="3. MyBatis"></a>3. MyBatis</h2><blockquote>
<p>MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p>
</blockquote>
<h3 id="3-1-入口"><a href="#3-1-入口" class="headerlink" title="3.1. 入口"></a>3.1. 入口</h3><p>因为springboot给我们带来开发便利的同时，隐藏了太多细节，已经忘记了MyBatis的启动方式。</p>
<h3 id="3-2-driver-connection"><a href="#3-2-driver-connection" class="headerlink" title="3.2. driver + connection"></a>3.2. driver + connection</h3><p>在实际应用的过程中，每次都创建一次connection会极大的影响性能，所以我们会选择连接池技术，简单来说就是维护一个connection的list，每次请求从list中取出一个connection。Mybatis提供了3中方式实现数据源初始化。</p>
<p><img src="http://img.yuheng.wang/sourcecode-mybatis-2-1.png" alt="sourcecode-mybatis-2"></p>
<p>每次获取connection都会判断driver是否已注册 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Connection <span class="title">doGetConnection</span><span class="params">(Properties properties)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  initializeDriver();</span><br><span class="line">  Connection connection = DriverManager.getConnection(url, properties);</span><br><span class="line">  configureConnection(connection);</span><br><span class="line">  <span class="keyword">return</span> connection;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">initializeDriver</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!registeredDrivers.containsKey(driver)) &#123;</span><br><span class="line">    Class&lt;?&gt; driverType;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (driverClassLoader != <span class="keyword">null</span>) &#123;</span><br><span class="line">        driverType = Class.forName(driver, <span class="keyword">true</span>, driverClassLoader);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        driverType = Resources.classForName(driver);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// DriverManager requires the driver to be loaded via the system ClassLoader.</span></span><br><span class="line">      <span class="comment">// http://www.kfu.com/~nsayer/Java/dyn-jdbc.html</span></span><br><span class="line">      Driver driverInstance = (Driver)driverType.newInstance();</span><br><span class="line">      DriverManager.registerDriver(<span class="keyword">new</span> DriverProxy(driverInstance));</span><br><span class="line">      registeredDrivers.put(driver, driverInstance);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">&quot;Error setting driver on UnpooledDataSource. Cause: &quot;</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PooledConnection 使用了动态代理，在不改变Connection的前提下，使关闭的connection加入到闲置连接池内。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PooledConnection</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    String methodName = method.getName();</span><br><span class="line">    <span class="keyword">if</span> (CLOSE.hashCode() == methodName.hashCode() &amp;&amp; CLOSE.equals(methodName)) &#123;</span><br><span class="line">      dataSource.pushConnection(<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!Object.class.equals(method.getDeclaringClass())) &#123;</span><br><span class="line">          <span class="comment">// issue #579 toString() should never fail</span></span><br><span class="line">          <span class="comment">// throw an SQLException instead of a Runtime</span></span><br><span class="line">          checkConnection();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> method.invoke(realConnection, args);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="keyword">throw</span> </span><br><span class="line">ExceptionUtil.unwrapThrowable(t);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-statement-query"><a href="#3-3-statement-query" class="headerlink" title="3.3. statement + query"></a>3.3. statement + query</h3><p>mybatis项目中有statement这个包，直接看其中的类。</p>
<p><img src="http://img.yuheng.wang/sourcecode-mybatis-3.png" alt="sourcecode-mybatis-3"></p>
<p>StatementHandler定义了获取Statement的接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StatementHandler</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">  &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">  <span class="function">Statement <span class="title">prepare</span><span class="params">(Connection connection)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BaseStatementHandler实现了prepare接口，并留了一个钩子函数instantiateStatement</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseStatementHandler</span> <span class="keyword">implements</span> <span class="title">StatementHandler</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Statement <span class="title">prepare</span><span class="params">(Connection connection)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ErrorContext.instance().sql(boundSql.getSql());</span><br><span class="line">    Statement statement = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      statement = instantiateStatement(connection);</span><br><span class="line">      setStatementTimeout(statement);</span><br><span class="line">      setFetchSize(statement);</span><br><span class="line">      <span class="keyword">return</span> statement;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">      closeStatement(statement);</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      closeStatement(statement);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">&quot;Error preparing statement.  Cause: &quot;</span> + e, e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Statement <span class="title">instantiateStatement</span><span class="params">(Connection connection)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SimpleStatementHandler继承BaseStatementHandler并重写instantiateStatement</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleStatementHandler</span> <span class="keyword">extends</span> <span class="title">BaseStatementHandler</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    String sql = boundSql.getSql();</span><br><span class="line">    statement.execute(sql);</span><br><span class="line">    <span class="keyword">return</span> resultSetHandler.&lt;E&gt;handleResultSets(statement);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Statement <span class="title">instantiateStatement</span><span class="params">(Connection connection)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mappedStatement.getResultSetType() != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> connection.createStatement(mappedStatement.getResultSetType().getValue(), ResultSet.CONCUR_READ_ONLY);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> connection.createStatement();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有一个两个成员变量，我们先mark一下，稍后再去阅读。</p>
<ol>
<li>MappedStatement 现在知道它可以获取resultSetType。</li>
<li>BoundSql 获取sql</li>
</ol>
<p>SimpleStatementHandler实现了StatementHandler提供的query接口方法，通过statement.execute执行。</p>
<h3 id="3-4-ResultSet"><a href="#3-4-ResultSet" class="headerlink" title="3.4. ResultSet"></a>3.4. ResultSet</h3><p>MyBatis被称为半个ORM系统，就是因为它对ResultSet的映射。我们来看一下实现，同样有一个包名叫resultset。。</p>
<p><img src="http://img.yuheng.wang/sourcecode-mybatis-4.png" alt="sourcecode-mybatis-4"></p>
]]></content>
      <categories>
        <category>soucecode</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
        <tag>soucecode</tag>
      </tags>
  </entry>
  <entry>
    <title>spring-boot 自定义 endpoint，让运行时的 java 应用不再是黑盒</title>
    <url>/2017/11/26/springboot-endpoint/</url>
    <content><![CDATA[<p>本文项目已发布到github，后续学习项目也会添加到此工程下，欢迎fork点赞。<br><a href="https://github.com/wangyuheng/spring-boot-sample">https://github.com/wangyuheng/spring-boot-sample</a></p>
<p>你的java应用在运行时对你来说是黑盒吗？你可以查看到springboot运行时的各种信息吗？</p>
<h3 id="Spring-Boot-Actuator"><a href="#Spring-Boot-Actuator" class="headerlink" title="Spring Boot Actuator"></a>Spring Boot Actuator</h3><p>springboot提供了用于健康检测的endpoint，提供了查看系统信息、内存、环境等。</p>
<h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-访问链接"><a href="#2-访问链接" class="headerlink" title="2. 访问链接"></a>2. 访问链接</h4><p>应用启动后访问 <a href="http://localhost:8080/health">http://localhost:8080/health</a> 查看应用启动状态。<br>端口号可以通过配置文件<code>management.port=9527</code>变更</p>
<p>常用endpoint</p>
<ol>
<li><a href="http://localhost:8080/env">http://localhost:8080/env</a> 环境变量</li>
<li><a href="http://localhost:8080/info">http://localhost:8080/info</a> 应用信息</li>
<li><a href="http://localhost:8080/metrics">http://localhost:8080/metrics</a> 内存等应用基本指标</li>
<li><a href="http://localhost:8080/dump">http://localhost:8080/dump</a> 线程栈</li>
<li><a href="http://localhost:8080/configprops">http://localhost:8080/configprops</a> 配置项</li>
</ol>
<h4 id="3-开启全部endpoint-amp-关闭验权"><a href="#3-开启全部endpoint-amp-关闭验权" class="headerlink" title="3. 开启全部endpoint &amp; 关闭验权"></a>3. 开启全部endpoint &amp; 关闭验权</h4><p>部分请求会返回<strong>401</strong>， 这是因为endpoint未开启，或者开启了登录验权，可以通过配置文件进行配置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">management.security.enabled&#x3D;false</span><br><span class="line">endpoints.enabled&#x3D;true</span><br></pre></td></tr></table></figure>

<h3 id="自定义endpoint"><a href="#自定义endpoint" class="headerlink" title="自定义endpoint"></a>自定义endpoint</h3><h4 id="一、实现Endpoint接口"><a href="#一、实现Endpoint接口" class="headerlink" title="一、实现Endpoint接口"></a>一、实现Endpoint接口</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Endpoint</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="function">String <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isSensitive</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">T <span class="title">invoke</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>getId()， 指定了endpoint访问url</li>
<li>isEnabled()， 表示是否启用</li>
<li>isSensitive()， 表示是否验权</li>
<li>invoke()， 页面返回值</li>
</ol>
<p>实现类通过@Bean的形式注入后，再次启动应用，即可通过url访问，并返回invoke返回值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomEndpoint</span> <span class="keyword">implements</span> <span class="title">Endpoint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;custom&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSensitive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello endpoint&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EndpointApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EndpointApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomEndpoint <span class="title">customEndpoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomEndpoint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问<a href="http://localhost:8080/custom">http://localhost:8080/custom</a> 可以看到invoke返回的内容。</p>
<p>但是这样，每个endpoint都需要单独注入，且没有层级、通配符，不方便管理，为满足需求，尝试做了如下改造</p>
<h4 id="二、继承EndpointMvcAdapter"><a href="#二、继承EndpointMvcAdapter" class="headerlink" title="二、继承EndpointMvcAdapter"></a>二、继承EndpointMvcAdapter</h4><h5 id="2-1-自定义-EndpointAction-接口"><a href="#2-1-自定义-EndpointAction-接口" class="headerlink" title="2.1 自定义 EndpointAction 接口"></a>2.1 自定义 EndpointAction 接口</h5><p>用于定制endpoint处理行为，可以理解为invoke方法的具体实施者，名称用来管理访问路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EndpointAction</span> <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="function">Object <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-EndpointAction的多种实现"><a href="#2-2-EndpointAction的多种实现" class="headerlink" title="2.2 EndpointAction的多种实现"></a>2.2 EndpointAction的多种实现</h5><p>需要实现的功能，如：读取配置文件、查看内存信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesAction</span> <span class="keyword">implements</span> <span class="title">EndpointAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> PropertiesLoaderUtils.loadAllProperties(<span class="string">&quot;application.properties&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;read application fail! error: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;properties&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VMAction</span> <span class="keyword">implements</span> <span class="title">EndpointAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> VMAction INSTANCE = <span class="keyword">new</span> VMAction();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line">    <span class="keyword">private</span> String startTime;</span><br><span class="line">    <span class="keyword">private</span> String initHeap;</span><br><span class="line">    <span class="keyword">private</span> String maxHeap;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; arguments;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        INSTANCE.version = System.getProperty(<span class="string">&quot;java.runtime.version&quot;</span>);</span><br><span class="line">        INSTANCE.startTime = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(ManagementFactory.getRuntimeMXBean().getStartTime());</span><br><span class="line">        INSTANCE.initHeap = String.valueOf(ManagementFactory.getMemoryMXBean().getHeapMemoryUsage().getInit() / <span class="number">1024</span> / <span class="number">1024</span>).concat(<span class="string">&quot;MB&quot;</span>);</span><br><span class="line">        INSTANCE.maxHeap = String.valueOf(ManagementFactory.getMemoryMXBean().getHeapMemoryUsage().getMax() / <span class="number">1024</span> / <span class="number">1024</span>).concat(<span class="string">&quot;MB&quot;</span>);</span><br><span class="line">        INSTANCE.arguments = <span class="keyword">new</span> HashSet&lt;&gt;(ManagementFactory.getRuntimeMXBean().getInputArguments());</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;vm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> version;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStartTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> startTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInitHeap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> initHeap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMaxHeap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxHeap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getArguments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arguments;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultAction</span> <span class="keyword">implements</span> <span class="title">EndpointAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultAction INSTANCE = <span class="keyword">new</span> DefaultAction();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DefaultAction <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;try /help for action list&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;default&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-3-继承EndpointMvcAdapter"><a href="#2-3-继承EndpointMvcAdapter" class="headerlink" title="2.3 继承EndpointMvcAdapter"></a>2.3 继承EndpointMvcAdapter</h5><ol>
<li>注入action map，根据name获取bean实现</li>
<li>通过url mapping匹配action</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomEndpointAdapter</span> <span class="keyword">extends</span> <span class="title">EndpointMvcAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, EndpointAction&gt; endpointActionMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEndpointActionMap</span><span class="params">(List&lt;EndpointAction&gt; endpointActionList)</span> </span>&#123;</span><br><span class="line">        endpointActionList.forEach(endpointAction -&gt; endpointActionMap.put(endpointAction.getName(), endpointAction));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomEndpointAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> CustomEndpoint());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;name:.*&#125;&quot;,</span></span><br><span class="line"><span class="meta">            method = RequestMethod.GET, produces = &#123;</span></span><br><span class="line"><span class="meta">            ActuatorMediaTypes.APPLICATION_ACTUATOR_V1_JSON_VALUE,</span></span><br><span class="line"><span class="meta">            MediaType.APPLICATION_JSON_VALUE&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@HypermediaDisabled</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">dispatcher</span><span class="params">(<span class="meta">@PathVariable</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;help&quot;</span>.equalsIgnoreCase(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> endpointActionMap.keySet().stream().map(key -&gt; getName() + <span class="string">&quot;/&quot;</span> + key).collect(toSet());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> endpointActionMap.getOrDefault(name, DefaultAction.getInstance()).execute();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-4-定制endpoint作为入口"><a href="#2-4-定制endpoint作为入口" class="headerlink" title="2.4 定制endpoint作为入口"></a>2.4 定制endpoint作为入口</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomEndpoint</span> <span class="keyword">implements</span> <span class="title">Endpoint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;custom&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSensitive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DefaultAction.getInstance().execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-5-启动时注入"><a href="#2-5-启动时注入" class="headerlink" title="2.5 启动时注入"></a>2.5 启动时注入</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EndpointApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EndpointApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(CustomEndpoint.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomEndpointAdapter <span class="title">customEndpointAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomEndpointAdapter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>揪心的测试环节，启动webEnvironment环境，通过<strong>TestRestTemplate</strong>访问endpoint的mapping，比对返回值即可</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesActionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TestRestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;management.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String managementPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupMockMvc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        restTemplate = <span class="keyword">new</span> TestRestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_properties_action</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">&quot;http://localhost:&quot;</span> + managementPort + <span class="string">&quot;/custom/properties&quot;</span>;</span><br><span class="line">        Map&lt;String, String&gt; result = restTemplate.getForObject(path, HashMap.class);</span><br><span class="line">        assertEquals(result.get(<span class="string">&quot;management.port&quot;</span>), managementPort);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_help</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">&quot;http://localhost:&quot;</span> + managementPort + <span class="string">&quot;/custom/help&quot;</span>;</span><br><span class="line">        Set&lt;String&gt; result = restTemplate.getForObject(path, Set.class);</span><br><span class="line">        assertTrue(result.contains(<span class="string">&quot;custom/properties&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_rand</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">&quot;http://localhost:&quot;</span> + managementPort + <span class="string">&quot;/custom/&quot;</span> + <span class="keyword">new</span> Random().nextInt();</span><br><span class="line">        String result = restTemplate.getForObject(path, String.class);</span><br><span class="line">        assertEquals(<span class="string">&quot;try /help for action list&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>endpoint</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot全局异常捕获处理</title>
    <url>/2017/11/26/springboot-global-exception/</url>
    <content><![CDATA[<h2 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h2><p>本文项目已发布到github，后续学习项目也会添加到此工程下，欢迎fork点赞。<br><a href="https://github.com/wangyuheng/spring-boot-sample">https://github.com/wangyuheng/spring-boot-sample</a></p>
<h3 id="偷懒代码"><a href="#偷懒代码" class="headerlink" title="偷懒代码"></a>偷懒代码</h3><p>偷懒是程序员的美德，但是有些偷懒是为了少写代码，有些则是少思考，直接copy。</p>
<p>不知道你有没有见过这种代码，在最外层<strong>catch Exception</strong>，避免抛出异常信息。。。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> userService.getUsernameById(id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UserException) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;用户id异常&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;服务异常,请稍后再试!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>UserService</strong>用于模拟异常抛出</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsernameById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == id % <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;error param!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UserException(<span class="string">&quot;custom exception!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="全局异常处理-1"><a href="#全局异常处理-1" class="headerlink" title="全局异常处理"></a>全局异常处理</h3><h4 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h4><p>通过自定义异常，区分业务异常，并增加errorCode支持，返回给接口调用方。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ErrorCode</span> </span>&#123;</span><br><span class="line">    Error(<span class="number">10000</span>, <span class="string">&quot;服务异常&quot;</span>),</span><br><span class="line">    UserIdError(<span class="number">10001</span>, <span class="string">&quot;用户id异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    ErrorCode(<span class="keyword">int</span> code, String message) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> errorCode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(<span class="keyword">int</span> errorCode, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.errorCode = errorCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getErrorCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> errorCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserException</span> <span class="keyword">extends</span> <span class="title">CustomException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(ErrorCode.UserIdError.getCode(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(ErrorCode.UserIdError.getCode(), ErrorCode.UserIdError.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h4><p>会应用到所有的Controller中的@RequestMapping注解的方法中，通过<strong>annotations = RestController.class</strong>指定代理的Controller类中。</p>
<h4 id="ExceptionHandler"><a href="#ExceptionHandler" class="headerlink" title="@ExceptionHandler"></a>@ExceptionHandler</h4><p>用于捕获异常，@ExceptionHandler本身只能捕获当前类的异常信息，结合@ControllerAdvice可以捕获全部controller异常。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice(annotations = RestController.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">getErrorObject</span><span class="params">(<span class="keyword">int</span> code, String message)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; error = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        error.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        error.put(<span class="string">&quot;message&quot;</span>, message);</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">exceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getErrorObject(ErrorCode.Error.getCode(), ErrorCode.Error.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(CustomException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">customException</span><span class="params">(CustomException e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getErrorObject(e.getErrorCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="优化代码"><a href="#优化代码" class="headerlink" title="优化代码"></a>优化代码</h4><p>优化后的代码简洁了，无需每次try…catch，统一管理异常信息。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getUsernameById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>mockMvc请求api接口，判断返回值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApiTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserApi userApi;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(context).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> JSONObject <span class="title">getUserApiResult</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">&quot;/user/&quot;</span> + id;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JSONObject(mockMvc.perform(MockMvcRequestBuilders.get(path))</span><br><span class="line">                .andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">                .andDo(MockMvcResultHandlers.print())</span><br><span class="line">                .andReturn()</span><br><span class="line">                .getResponse()</span><br><span class="line">                .getContentAsString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_exception_handler</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        assertTrue(ErrorCode.UserIdError.getCode() == getUserApiResult(i).getInt(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">        i++;</span><br><span class="line">        assertTrue(ErrorCode.Error.getCode() == getUserApiResult(i).getInt(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>exception</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot使用kafka</title>
    <url>/2017/06/25/springboot-kafka/</url>
    <content><![CDATA[<h1 id="spring-boot-Kafka"><a href="#spring-boot-Kafka" class="headerlink" title="spring-boot Kafka"></a>spring-boot Kafka</h1><p>基于springboot和kafka开发消息通信系统，提供消息发送、接收功能。<br>本文需要对kafka有基础的了解，且存在可访问的kafka服务。如果缺乏相关知识，请先阅读<a href="http://kafka.apache.org/quickstart">kafka官方文档</a></p>
<span id="more"></span>

<h2 id="环境工具"><a href="#环境工具" class="headerlink" title="环境工具"></a>环境工具</h2><ul>
<li>jdk 1.8</li>
<li>maven 3</li>
<li>apache-kafka 2.11-0.10.1.0</li>
</ul>
<h2 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h2><ul>
<li>spring-boot 1.4.3.RELEASE</li>
<li>spring-kafka 1.1.1.RELEASE</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><p>利用<strong>spring-kafka</strong>提供的<strong>KafkaTemplate</strong>模板实现发送消息的功能，因为<strong>KafkaTemplate</strong>不是springbean，所以在Config中手动创建实例Bean。<br>看一下<strong>KafkaTemplate</strong>构造函数相关源码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create an instance using the supplied producer factory and autoFlush false.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> producerFactory the producer factory.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">KafkaTemplate</span><span class="params">(ProducerFactory&lt;K, V&gt; producerFactory)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>(producerFactory, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create an instance using the supplied producer factory and autoFlush setting.</span></span><br><span class="line"><span class="comment"> * Set autoFlush to true if you wish to synchronously interact with Kafaka, calling</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Future#get()&#125; on the result.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> producerFactory the producer factory.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> autoFlush true to flush after each send.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">KafkaTemplate</span><span class="params">(ProducerFactory&lt;K, V&gt; producerFactory, <span class="keyword">boolean</span> autoFlush)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.producerFactory = producerFactory;</span><br><span class="line">	<span class="keyword">this</span>.autoFlush = autoFlush;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造函数需要参数<strong>ProducerFactory</strong>参数，<strong>ProducerFactory</strong>接口一个有一个默认实现<strong>DefaultKafkaProducerFactory</strong>。再看一下<strong>DefaultKafkaProducerFactory</strong>构造函数相关源码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DefaultKafkaProducerFactory</span><span class="params">(Map&lt;String, Object&gt; configs)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>(configs, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DefaultKafkaProducerFactory</span><span class="params">(Map&lt;String, Object&gt; configs, Serializer&lt;K&gt; keySerializer,</span></span></span><br><span class="line"><span class="function"><span class="params">		Serializer&lt;V&gt; valueSerializer)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.configs = <span class="keyword">new</span> HashMap&lt;&gt;(configs);</span><br><span class="line">	<span class="keyword">this</span>.keySerializer = keySerializer;</span><br><span class="line">	<span class="keyword">this</span>.valueSerializer = valueSerializer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要的configs参数，在创建<strong>KafkaProducer</strong>时用于初始化参数，所以可以再创建一个configMap用于配制<strong>KafkaProducer</strong>相关配置项</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> KafkaProducer&lt;K, V&gt; <span class="title">createKafkaProducer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> KafkaProducer&lt;K, V&gt;(<span class="keyword">this</span>.configs, <span class="keyword">this</span>.keySerializer, <span class="keyword">this</span>.valueSerializer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相关参数项参考<strong>org.apache.kafka.clients.producer.ProducerConfig</strong>，这里只配置最必需参数，包括kafka地址、keyValue序列化。<br>发送端配置类如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pro.hemo.study.kafka;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.IntegerSerializer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.DefaultKafkaProducerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.KafkaTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.ProducerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaProducerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">configs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; configMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        configMap.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,</span><br><span class="line">                <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">        configMap.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, IntegerSerializer.class);</span><br><span class="line">        configMap.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);</span><br><span class="line">        <span class="keyword">return</span> configMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ProducerFactory <span class="title">producerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultKafkaProducerFactory(configs());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KafkaTemplate <span class="title">kafkaTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KafkaTemplate(producerFactory());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发送消息工具类方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pro.hemo.study.kafka.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.KafkaTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaSendService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String topic, String message)</span> </span>&#123;</span><br><span class="line">        kafkaTemplate.send(topic, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以通过测试用例测试消息发送，通过命令行模式监听对应的topic，查看是否能够接收消息。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pro.hemo.study.kafka;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> pro.hemo.study.kafka.producer.KafkaSendService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudyKafkaApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaSendService kafkaSendService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        kafkaSendService.sendMessage(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;Hello SpringBoot Kafka!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h3><p>接收端的配置项代码和发送端类似，不同的事，接收端需要指定一个<strong>KafkaListenerContainerFactory</strong>，用于注册监听。先看代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pro.hemo.study.kafka;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.IntegerDeserializer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringDeserializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.annotation.EnableKafka;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.config.ConcurrentKafkaListenerContainerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.config.KafkaListenerContainerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.ConsumerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.DefaultKafkaConsumerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableKafka</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaConsumerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">configs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; configMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        configMap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,</span><br><span class="line">                <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">        configMap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG,</span><br><span class="line">                IntegerDeserializer.class);</span><br><span class="line">        configMap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG,</span><br><span class="line">                StringDeserializer.class);</span><br><span class="line">        configMap.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="string">&quot;groupTest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> configMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ConsumerFactory <span class="title">consumerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultKafkaConsumerFactory&lt;&gt;(configs());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KafkaListenerContainerFactory <span class="title">kafkaListenerContainerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ConcurrentKafkaListenerContainerFactory factory = <span class="keyword">new</span> ConcurrentKafkaListenerContainerFactory&lt;&gt;();</span><br><span class="line">        factory.setConsumerFactory(consumerFactory());</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结合接收消息工具类一起看</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pro.hemo.study.kafka.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.annotation.KafkaHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.annotation.KafkaListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;topicTest&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaReceiveService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;receive:&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>消息接收端代码核心在于注解**@KafkaListener<strong>，查看源码，重点为两个属性</strong>containerFactory<strong>和</strong>topics**。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.kafka.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Repeatable;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> org.springframework.kafka.listener.MessageListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.MessageMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123; ElementType.TYPE, ElementType.METHOD, ElementType.ANNOTATION_TYPE &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@MessageMapping</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Repeatable(KafkaListeners.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> KafkaListener &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The unique identifier of the container managing for this endpoint.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;If none is specified an auto-generated one is provided.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the &#123;<span class="doctag">@code</span> id&#125; for the container managing for this endpoint.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.kafka.config.KafkaListenerEndpointRegistry#getListenerContainer(String)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">id</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The bean name of the &#123;<span class="doctag">@link</span> org.springframework.kafka.config.KafkaListenerContainerFactory&#125;</span></span><br><span class="line"><span class="comment">	 * to use to create the message listener container responsible to serve this endpoint.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;If not specified, the default container factory is used, if any.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the container factory bean name.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">containerFactory</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The topics for this listener.</span></span><br><span class="line"><span class="comment">	 * The entries can be &#x27;topic name&#x27;, &#x27;property-placeholder keys&#x27; or &#x27;expressions&#x27;.</span></span><br><span class="line"><span class="comment">	 * Expression must be resolved to the topic name.</span></span><br><span class="line"><span class="comment">	 * Mutually exclusive with &#123;<span class="doctag">@link</span> #topicPattern()&#125; and &#123;<span class="doctag">@link</span> #topicPartitions()&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the topic names or expressions (SpEL) to listen to.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] topics() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The topic pattern for this listener.</span></span><br><span class="line"><span class="comment">	 * The entries can be &#x27;topic name&#x27;, &#x27;property-placeholder keys&#x27; or &#x27;expressions&#x27;.</span></span><br><span class="line"><span class="comment">	 * Expression must be resolved to the topic pattern.</span></span><br><span class="line"><span class="comment">	 * Mutually exclusive with &#123;<span class="doctag">@link</span> #topics()&#125; and &#123;<span class="doctag">@link</span> #topicPartitions()&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the topic pattern or expression (SpEL).</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">topicPattern</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The topicPartitions for this listener.</span></span><br><span class="line"><span class="comment">	 * Mutually exclusive with &#123;<span class="doctag">@link</span> #topicPattern()&#125; and &#123;<span class="doctag">@link</span> #topics()&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the topic names or expressions (SpEL) to listen to.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	TopicPartition[] topicPartitions() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * If provided, the listener container for this listener will be added to a bean</span></span><br><span class="line"><span class="comment">	 * with this value as its name, of type &#123;<span class="doctag">@code</span> Collection&lt;MessageListenerContainer&gt;&#125;.</span></span><br><span class="line"><span class="comment">	 * This allows, for example, iteration over the collection to start/stop a subset</span></span><br><span class="line"><span class="comment">	 * of containers.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the bean name for the group.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">group</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>topics、topicPattern、topicPartitions都是用于指定监听的topic，而<strong>containerFactory</strong>需要指明监听仓库<strong>KafkaListenerContainerFactory</strong>，所以在<strong>KafkaConsumerConfig</strong>配置类中创建对应的Bean对象，并根据构造函数添加相应的参数配置。</p>
<h4 id="EnableKafka"><a href="#EnableKafka" class="headerlink" title="@EnableKafka"></a>@EnableKafka</h4><p>用于扫描对应的listener。</p>
<h4 id="KafkaHandler"><a href="#KafkaHandler" class="headerlink" title="@KafkaHandler"></a>@KafkaHandler</h4><p>指明消息接收处理方法。</p>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot+swagger 自动生成 restful 文档及在线调试</title>
    <url>/2017/10/28/springboot-swagger/</url>
    <content><![CDATA[<h3 id="spring-boot-swagger-starter"><a href="#spring-boot-swagger-starter" class="headerlink" title="spring-boot-swagger-starter"></a>spring-boot-swagger-starter</h3><p>本文项目已发布到github，欢迎fork点赞。<br><a href="https://github.com/wangyuheng/spring-boot-swagger-starter">https://github.com/wangyuheng/spring-boot-swagger-starter</a><br>已发布maven中央仓库，欢迎使用。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.wangyuheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="swagger"><a href="#swagger" class="headerlink" title="swagger"></a>swagger</h3><p>swagger可以快速生成restful接口文档，并提供在线调试功能。通过springboot开发微服务时，swagger文档可以极大的提高协作效率。</p>
<h3 id="springfox"><a href="#springfox" class="headerlink" title="springfox"></a>springfox</h3><p><strong><a href="https://github.com/springfox/springfox">springfox</a></strong> 将swagger整合到spring</p>
<h2 id="定制starter"><a href="#定制starter" class="headerlink" title="定制starter"></a>定制starter</h2><h3 id="1-定义swagger属性"><a href="#1-定义swagger属性" class="headerlink" title="1. 定义swagger属性"></a>1. 定义swagger属性</h3><p>用于文档页面显示及接口扫描路径，并使用@ConfigurationProperties读取属性</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="attr">groupName:</span> <span class="string">分类(groupName)</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">标题(title)</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">介绍(description)</span></span><br><span class="line">  <span class="attr">termsOfServiceUrl:</span> <span class="string">服务URL(termsOfServiceUrl)</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">版本(version)</span></span><br><span class="line">  <span class="attr">contactName:</span> <span class="string">作者名(contactName)</span></span><br><span class="line">  <span class="attr">contactUrl:</span> <span class="string">作者主页(contactUrl)</span></span><br><span class="line">  <span class="attr">contactEmail:</span> <span class="string">作者邮箱(contactEmail)</span></span><br><span class="line">  <span class="attr">paths:</span> <span class="string">/upload.*,/category.*</span></span><br><span class="line">  <span class="attr">license:</span></span><br><span class="line">  <span class="attr">licenseUrl:</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;swagger&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerProperty</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> String termsOfServiceUrl;</span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line">    <span class="keyword">private</span> String license;</span><br><span class="line">    <span class="keyword">private</span> String licenseUrl;</span><br><span class="line">    <span class="comment">//Contact</span></span><br><span class="line">    <span class="keyword">private</span> String contactName;</span><br><span class="line">    <span class="keyword">private</span> String contactUrl;</span><br><span class="line">    <span class="keyword">private</span> String contactEmail;</span><br><span class="line">    <span class="keyword">private</span> String[] paths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-设置swagger自动配置类"><a href="#2-设置swagger自动配置类" class="headerlink" title="2.设置swagger自动配置类"></a>2.设置swagger自动配置类</h3><p>重点在于**@EnableSwagger2<strong>及声明</strong>Docket**</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.base.Predicate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> pro.hemo.swagger.config.SwaggerProperty;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.common.base.Predicates.or;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> springfox.documentation.builders.PathSelectors.regex;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(SwaggerProperty.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerAutoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SwaggerProperty swaggerProperty;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        checkValid(swaggerProperty);</span><br><span class="line">        Predicate&lt;String&gt;[] selector = <span class="keyword">new</span> Predicate[]&#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != swaggerProperty.getPaths() &amp;&amp; swaggerProperty.getPaths().length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            selector = <span class="keyword">new</span> Predicate[swaggerProperty.getPaths().length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; selector.length; i++) &#123;</span><br><span class="line">                selector[i] = regex(swaggerProperty.getPaths()[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(swaggerProperty.getGroupName())</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .paths(or(selector))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkValid</span><span class="params">(SwaggerProperty swaggerProperty)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(swaggerProperty.getTitle())</span><br><span class="line">                .description(swaggerProperty.getDescription())</span><br><span class="line">                .termsOfServiceUrl(swaggerProperty.getTermsOfServiceUrl())</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(swaggerProperty.getContactName(), swaggerProperty.getContactUrl(), swaggerProperty.getContactEmail()))</span><br><span class="line">                .license(swaggerProperty.getLicense())</span><br><span class="line">                .licenseUrl(swaggerProperty.getLicenseUrl())</span><br><span class="line">                .version(swaggerProperty.getVersion())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-创建spring-factories"><a href="#3-创建spring-factories" class="headerlink" title="3. 创建spring.factories"></a>3. 创建spring.factories</h3><p>用于指定springboot自动配置文件路径，目录为<strong>src/main/resources/META-INF/spring.factories</strong></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="attr">pro.hemo.swagger.SwaggerAutoApplication</span></span><br></pre></td></tr></table></figure>
<h2 id="使用starter"><a href="#使用starter" class="headerlink" title="使用starter"></a>使用starter</h2><h3 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h3><p>通过maven添加starter</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>pro.hemo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因为没有发布到仓库，需要先将starter项目发布到本地仓库<br>在<strong>SwaggerStarter</strong>目录执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mvn clean install </span><br></pre></td></tr></table></figure>

<h3 id="2-编写Restful接口"><a href="#2-编写Restful接口" class="headerlink" title="2. 编写Restful接口"></a>2. 编写Restful接口</h3><p>Spring可以很方便的编写Restful接口，可以添加**@Api**等注解，用于生成文档。注解在io.swagger.annotations包下，后续会介绍常用注解。</p>
<h3 id="3-添加配置文件"><a href="#3-添加配置文件" class="headerlink" title="3. 添加配置文件"></a>3. 添加配置文件</h3><p>通过<strong>path</strong>指定接口扫描目录</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="attr">groupName:</span></span><br><span class="line">  <span class="attr">title:</span></span><br><span class="line">  <span class="attr">description:</span></span><br><span class="line">  <span class="attr">termsOfServiceUrl:</span></span><br><span class="line">  <span class="attr">version:</span></span><br><span class="line">  <span class="attr">contactName:</span></span><br><span class="line">  <span class="attr">contactUrl:</span></span><br><span class="line">  <span class="attr">contactEmail:</span></span><br><span class="line">  <span class="attr">paths:</span> <span class="string">/upload.*,</span> <span class="string">/category.*</span></span><br><span class="line">  <span class="attr">license:</span></span><br><span class="line">  <span class="attr">licenseUrl:</span></span><br></pre></td></tr></table></figure>

<h3 id="4-启动项目"><a href="#4-启动项目" class="headerlink" title="4. 启动项目"></a>4. 启动项目</h3><p>启动springboot项目，访问<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a> 可以看到接口列表。<br><img src="/uploads/springboot-swagger-00.png" alt="springboot-swagger-00.png"> </p>
<p>这里有几点需要注意</p>
<ol>
<li>swagger-ui.html 为自动生成映射</li>
<li>注意静态资源不要被拦截</li>
<li>swagger-ui.html为页面，接口以json格式通过加载并渲染。json地址为<a href="http://localhost:8080/v2/api-docs?group">http://localhost:8080/v2/api-docs?group</a></li>
</ol>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot 控制台输出调试</title>
    <url>/2017/06/25/springboot-terminal/</url>
    <content><![CDATA[<h1 id="控制台输出调试"><a href="#控制台输出调试" class="headerlink" title="控制台输出调试"></a>控制台输出调试</h1><p>为了方便测试，在启动springboot项目后，期望通过控制台输出，查看运行。<br>此时可以通过让**@SpringBootApplication<strong>类implements <strong>CommandLineRunner</strong>或者</strong>ApplicationRunner**接口，并实现run方法。</p>
<span id="more"></span>

<h2 id="CommandLineRunner"><a href="#CommandLineRunner" class="headerlink" title="CommandLineRunner"></a>CommandLineRunner</h2><p>CommandLineRunner接口的run方法会传递SpringApplication.run()方法中的字符数组参数args。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;main before run&quot;</span>);</span><br><span class="line">        SpringApplication.run(Main.class, <span class="string">&quot;param1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;main after run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;args[0]: &quot;</span> + args[<span class="number">0</span>]);</span><br><span class="line">        System.out.println(<span class="string">&quot;CommandLineRunner.run()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果有多个@SpringBootApplication注解类且均实现了<strong>CommandLineRunner</strong>接口，可以通过**@Order<strong>注解指定run方法的执行顺序，或者通过实现</strong>Ordered<strong>接口的</strong>getOrder()**方法。<br>qQ320491</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> crick.wang.springbootstudy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;main before run&quot;</span>);</span><br><span class="line">        SpringApplication.run(Main.class, <span class="string">&quot;param1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;main after run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;first args[0]: &quot;</span> + args[<span class="number">0</span>]);</span><br><span class="line">        System.out.println(<span class="string">&quot;first CommandLineRunner.run()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecondMain</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;second args[0]: &quot;</span> + args[<span class="number">0</span>]);</span><br><span class="line">        System.out.println(<span class="string">&quot;second CommandLineRunner.run()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThirdMain</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;third args[0]: &quot;</span> + args[<span class="number">0</span>]);</span><br><span class="line">        System.out.println(<span class="string">&quot;third CommandLineRunner.run()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果为</p>
<ol>
<li>main before run</li>
<li>second args[0]: param1</li>
<li>second CommandLineRunner.run()</li>
<li>first args[0]: param1</li>
<li>first CommandLineRunner.run()</li>
<li>third args[0]: param1</li>
<li>third CommandLineRunner.run()</li>
<li>main after run<h2 id="ApplicationRunner"><a href="#ApplicationRunner" class="headerlink" title="ApplicationRunner"></a>ApplicationRunner</h2>ApplicationRunner接口和CommandLineRunner功能用法一致，唯一不同是对args参数进行了封装，run方法传递参数为ApplicationArguments，可以通过**ApplicationArguments.getSourceArgs()**获取字符数组参数args。</li>
</ol>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>terminal</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot 参数校验</title>
    <url>/2017/12/10/springboot-valid/</url>
    <content><![CDATA[<p>本文项目已发布到github，后续学习项目也会添加到此工程下，欢迎fork点赞。<br><a href="https://github.com/wangyuheng/spring-boot-sample">https://github.com/wangyuheng/spring-boot-sample</a></p>
<p>http接口开发过程中的常用场景为，根据提交的表单数据进行格式校验，包括字段长度、数据类型、范围等等。。如果每次都写一堆if…else if… 太傻了，所以java提供了一套标准化校验方案<strong>JSR 303</strong>，而标准的最佳实践为<strong>Hibernate Validator</strong>。</p>
<p>一句话为，通过注解对bean进行校验，并返回标准文案。</p>
<span id="more"></span>

<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>spring-boot-starter-web已经集成了hibernate-validator, 无需重复引用。</p>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p>JSR303定义了一套，在<code>javax.validation.constraints</code>包目录下，hibernate-validator扩展了一套，在<code>org.hibernate.validator.constraints</code>包下，下文会介绍如何自定义注解。</p>
<p>在Bean的字段中增加注解，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Min(1)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="meta">@Length(min = 6, max = 36)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><ol>
<li>@Validated 声明对参数进行校验</li>
<li>MessageSource 用来分离错误提示，也可以实现国际化</li>
<li>BindingResult 绑定参数校验结果</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getInfo</span><span class="params">(<span class="meta">@Validated</span> User user, BindingResult bindingResult)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">            List&lt;FieldError&gt; fieldErrors = bindingResult.getFieldErrors();</span><br><span class="line">            Locale locale = LocaleContextHolder.getLocale();</span><br><span class="line">            StringBuilder errorMessage = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            fieldErrors.forEach(fieldError -&gt; &#123;</span><br><span class="line">                errorMessage.append(fieldError.getField())</span><br><span class="line">                        .append(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">                        .append(messageSource.getMessage(fieldError, locale))</span><br><span class="line">                        .append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            result.put(<span class="string">&quot;code&quot;</span>, <span class="number">10001</span>);</span><br><span class="line">            result.put(<span class="string">&quot;message&quot;</span>, errorMessage);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.put(<span class="string">&quot;code&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">            result.put(<span class="string">&quot;data&quot;</span>, user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义错误提示"><a href="#自定义错误提示" class="headerlink" title="自定义错误提示"></a>自定义错误提示</h3><p>框架本身做了错误提示，但是为了友好，通常会自定义提示。</p>
<h4 id="硬编码"><a href="#硬编码" class="headerlink" title="硬编码"></a>硬编码</h4><p>可以在 注解中硬编码提示语，如</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Email(message = &quot;用户名必须是邮箱&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br></pre></td></tr></table></figure>

<h4 id="ValidationMessages-properties"><a href="#ValidationMessages-properties" class="headerlink" title="ValidationMessages.properties"></a>ValidationMessages.properties</h4><p>不过不够灵活。在使用spring-boot的过程中，我们都熟悉了约定大于配置。可以在resources目录下增加<strong>ValidationMessages.properties</strong>文件，并在其中复写</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">javax.validation.constraints.Min.message</span>=<span class="string">参数最小为&#123;1&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以实现自定义提示，注意properties中文编码问题。@注1 propertiesEditor</p>
<h4 id="messages-properties"><a href="#messages-properties" class="headerlink" title="messages.properties"></a>messages.properties</h4><p>springboot提供的消息文件默认路径为resources下messages.properties，可以把ValidationMessages.properties和messages.properties指定为自定义配置文件</p>
<ul>
<li>在<strong>application.properties</strong>中配置属性 </li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.messages.basename</span>=<span class="string">valid</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在resources目录下创建校验提示文件<strong>valid.properties</strong></li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">org.hibernate.validator.constraints.NotBlank.message</span>=<span class="string">&#123;0&#125; can&#x27;t be blank</span></span><br><span class="line"><span class="meta">user.id.error</span>=<span class="string">&#123;0&#125; error</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置messageSource</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidatorConf</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(MessageSource.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalValidatorFactoryBean <span class="title">localValidatorFactoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LocalValidatorFactoryBean bean = <span class="keyword">new</span> LocalValidatorFactoryBean();</span><br><span class="line">        bean.setProviderClass(HibernateValidator.class);</span><br><span class="line">        bean.setValidationMessageSource(messageSource);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="简化"><a href="#简化" class="headerlink" title="简化"></a>简化</h3><p>需要的校验功能实现了，但是每个restful接口都需要增加这些校验代码？每个参数后面都加一个BindingResult？ 显然不合理。懒惰是美德，试着做一次简化。</p>
<p>通过<code>@RestControllerAdvice</code>和<code>@ExceptionHandler</code>全局捕获restapi的<code>BindException</code>异常，在controller代码中，在需要校验的参数前增加<code>@Validated</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalValidator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(BindException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">bindError</span><span class="params">(BindException e)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        List&lt;FieldError&gt; fieldErrors = e.getFieldErrors();</span><br><span class="line">        Locale locale = LocaleContextHolder.getLocale();</span><br><span class="line">        StringBuilder errorMessage = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        fieldErrors.forEach(fieldError -&gt; &#123;</span><br><span class="line">            errorMessage.append(fieldError.getField())</span><br><span class="line">                    .append(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">                    .append(messageSource.getMessage(fieldError, locale))</span><br><span class="line">                    .append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, <span class="number">10001</span>);</span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, errorMessage);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/simpleuser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleUserApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getInfo</span><span class="params">(<span class="meta">@Validated</span> User user)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">        result.put(<span class="string">&quot;data&quot;</span>, user);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>mockMvc请求api接口，判断返回值code</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidatorApiTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(context).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> JSONObject <span class="title">requestApi</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JSONObject(mockMvc.perform(MockMvcRequestBuilders.get(path))</span><br><span class="line">                .andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">                .andDo(MockMvcResultHandlers.print())</span><br><span class="line">                .andReturn()</span><br><span class="line">                .getResponse()</span><br><span class="line">                .getContentAsString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_user_param_valid</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String rightPath = <span class="string">&quot;/user/&quot;</span> + <span class="string">&quot;12?id=123&quot;</span> + <span class="string">&quot;&amp;password=123456&quot;</span>;</span><br><span class="line">        assertTrue(<span class="number">10000</span> == requestApi(rightPath).getInt(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">        String errorPath = <span class="string">&quot;/user/&quot;</span> + <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        assertTrue(<span class="number">10001</span> == requestApi(errorPath).getInt(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_simpleuser_param_valid</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String rightPath = <span class="string">&quot;/simpleuser/&quot;</span> + <span class="string">&quot;12?id=123&quot;</span> + <span class="string">&quot;&amp;password=123456&quot;</span>;</span><br><span class="line">        assertTrue(<span class="number">10000</span> == requestApi(rightPath).getInt(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">        String errorPath = <span class="string">&quot;/simpleuser/&quot;</span> + <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        assertTrue(<span class="number">10001</span> == requestApi(errorPath).getInt(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>validator</tag>
      </tags>
  </entry>
  <entry>
    <title>学习log4j</title>
    <url>/2016/06/17/study-java-log4j/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>工作几年，发现并不了解log日志，只会简单的log.info()，并不知道如何配置以及更多的用法，每次遇到线上问题时，都是连蒙带猜，或者临时再加log。<br>这次下定决心，学习一下log，并在之后的项目中，保持良好的log习惯。</p>
<p>本次学习以log4j为主。在2015年8月，官方宣布停止对log4j 1.x版本的维护，并推荐只用log4j 2。但本文仍基于现有大多数项目所使用的1.x版本，并会在日后专门写一篇文章比较1.x 和2.x。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>log4j = log for java，是apache维护的一个强大的java日志记录模块。</p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ol>
<li>log4j是一个通用接口，可以在不改变语法的前提下，在多种程序语言中使用。</li>
<li>通过配置文件，在不改变程序的前提下，变更日志。</li>
<li>指定输出目录和输出格式。</li>
<li>通过级别控制，使log记录更灵活。</li>
</ol>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="引入包"><a href="#引入包" class="headerlink" title="引入包"></a>引入包</h3><p>通过maven引入log4j包，版本为1.2.16</p>
<pre><code>&lt;dependencies&gt;
        &lt;!-- Logging --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;log4j&lt;/groupId&gt;
        &lt;artifactId&gt;log4j&lt;/artifactId&gt;
        &lt;version&gt;1.2.16&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<h3 id="代码配置"><a href="#代码配置" class="headerlink" title="代码配置"></a>代码配置</h3><p>个人习惯，在学习一个东西之前，能让我用最少的代码运行一遍，并看到效果。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>log</tag>
        <tag>log4j</tag>
      </tags>
  </entry>
  <entry>
    <title>稳定的静态swagger接口服务</title>
    <url>/2018/06/27/swagger-nginx/</url>
    <content><![CDATA[<blockquote>
<p>“swagger接口服务是我本机，如果我下班关机回家，对方如何进行联调？”</p>
</blockquote>
<p>如果你有类似的疑问，这篇文章可以帮助你。</p>
<p>项目源码地址: <a href="https://github.com/wangyuheng/static-swagger-api">github</a></p>
<span id="more"></span>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>多方协作，尤其是前后端分离、微服务化之后，接口文档变得愈发重要。在技术评审后，约定接口，之后即可各司其责。</p>
<ol>
<li>客户端，基于文档mock进行开发</li>
<li>服务端，实现接口</li>
<li>QA，基于文档，编写接口测试脚本</li>
</ol>
<p>那么接口文档其实包含两个作用</p>
<ol>
<li>签字画押，信而有证。约定之后不能轻易变动，变动需要通知到多方，并可以看到变动版本。</li>
<li>提供mock功能，基于schema提供返回。</li>
</ol>
<p>swagger作为一款接口文档框架，可以方便服务端开发人员基于代码编写文档，并提供ui页面以及mock请求返回。但是在实际使用过程中存在一些缺陷</p>
<ol>
<li>测试环境无法直接访问，如spring cloud基于eureka访问，而不会暴露8080端口。</li>
<li>依赖接口开发者本机环境，不够稳定。</li>
<li>变动成本低，接口开发者可自行变动接口。</li>
</ol>
<p>以下方案期望用最少的成本，提供一个稳定的swagger接口服务。</p>
<h2 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h2><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0NTlweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjM2MHB4O2hlaWdodDo0NTlweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzNjAgNDU5IiB3aWR0aD0iMzYwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZyBpZD0iY2x1c3Rlcl8jIzUiPjxwYXRoIGQ9Ik0xMTQuMDAyNywxMzguMDM5MiBDMTE4LjA2MjQsMTMwLjY0MjUgMTIyLjc2MjUsMTI5Ljg2MDIgMTI5LjA1ODIsMTM1LjQ0NjEgQzEzNC43MzgsMTI2LjU4MjEgMTM5LjY0ODIsMTI3LjQ2MDQgMTQ1LjM4NTIsMTM1LjM5MDUgQzE0OS41MjIsMTI3Ljg3MzggMTU1LjYwOTMsMTI3LjMwMjggMTYxLjA2MzcsMTMzLjkyOTkgQzE2Ni44MTQ3LDEyNS4zMjk0IDE3My45MTc5LDEyNC41MDA5IDE3OS45MjIxLDEzMy42NjEgQzE4NC4yNjk1LDEyNy4wODU2IDE5MC41NzUzLDEyNi45MTQxIDE5NS40Nzg3LDEzMi45NzY1IEMxOTkuNDMyOCwxMjQuNzcyIDIwNi4zNTg3LDEyNC4xNTEgMjExLjMwMTMsMTMyLjAwMjMgQzIxNS43MTAxLDEyNS42NzEyIDIyMS44NTQ3LDEyNC4zMjY5IDIyNi4xNDgzLDEzMi4xMjMzIEMyMzEuNTI3NCwxMjUuNjA0OSAyMzguNTQyMSwxMjQuNDY0MyAyNDMuMTEwMywxMzMuMDM0OSBDMjQ4Ljc0MjIsMTI2LjI4NTEgMjU1Ljg1ODEsMTI2LjM2MzMgMjYwLjYyMTMsMTM0LjA4NTkgQzI2NS4wMDM4LDEyNy40MDU3IDI3Mi41Mzg1LDEyNi4zMDQ0IDI3Ni4zNTg0LDEzNC42NzQyIEMyODEuNjUyMywxMjYuNTYwNyAyODcuMzM4LDEyNy42MjkgMjkxLjczMzQsMTM1LjUzNjUgQzMwMS45MzQzLDEyNi44OTE1IDMxMC43ODUxLDEzMS42ODM0IDMxMy41LDE0My41IEMzMTMuNzYwNywxNDMuNTM0MiAzMTMuODgwNywxNDMuNjQ3MSAzMTMuNzQyMiwxNDMuOTE0NiBDMzIzLjcxNSwxNDguMjg4NiAzMjIuMjk0NywxNTMuNjc2OCAzMTYuMzg4NSwxNjAuNTczMiBDMzI1LjA0NDQsMTY0LjMxNjcgMzIzLjk3MTIsMTcwLjY1MTkgMzE3Ljc4NDksMTc1Ljc2MDIgQzMyNS43Njg5LDE3OS42OTM1IDMyNC4yMTgsMTg2LjA5NiAzMTguNDAyNSwxOTAuNjAzNCBDMzI2LjQ5NDYsMTk1LjQ5MTYgMzI2LjM3MDEsMjAxLjcyNDQgMzE5Ljg1ODcsMjA3Ljg0NTggQzMyOS4xNzc4LDIxMi4zMDkzIDMyOS40NjM1LDIxNy45MjIgMzIyLjE3MjIsMjI0LjY2OTcgQzMyOC44ODYxLDIzMS4zMzI0IDMyOC4wMzU1LDIzNi44OTM2IDMxOC42OTQ3LDIzOS44ODc2IEMzMjYuMDI5MSwyNDQuOTM2NyAzMjUuODc3LDI1MC40NTIxIDMxOS4xNjgxLDI1NS45MTYgQzMyNS4wNzEzLDI2MS40OTIyIDMyMy43ODM1LDI2Ni4xMjM2IDMxNy40MTg2LDI3MC4xOTcgQzMyNC44ODczLDI3NS43MDQ2IDMyMy43NjA4LDI4MS44OTU3IDMxNS44OTU2LDI4NS45MTc4IEMzMjMuMjU0MywyOTYuOTk1NCAzMjAuNDk1NiwzMDUuNzE4OCAzMDYuNSwzMDcuNSBDMzA2LjcyNTMsMzA3LjU0NzQgMzA2LjgxMzcsMzA3LjcxMDEgMzA2LjY0MTIsMzA3Ljg5ODUgQzMwNC44MzUyLDMxNi4xMTIyIDI5OC43NDk1LDMxOC4wMTgyIDI5Mi44MjY4LDMxMS44NTM4IEMyODcuMzU4NCwzMTkuMTE2IDI4Mi4yNTI1LDMyMC4zODU5IDI3Ni41MTMsMzEyLjEzODkgQzI3Mi45MzYyLDMyMS4xNDQ5IDI2NC41NDk0LDMyMS42OTQ2IDI1OS4xODc2LDMxMy45ODk2IEMyNTUuNTY5NywzMjMuMjI1NSAyNDguODAzOCwzMjQuNDYyOSAyNDIuMTc4OCwzMTcuMDY0NCBDMjM4LjE1NzgsMzI0LjM0ODMgMjMwLjY0MTEsMzIzLjY2MzIgMjI2LjgxNDIsMzE2Ljg1MjkgQzIyMy42ODEzLDMyNC44MDcgMjE3LjYxOTgsMzI2LjgzNzEgMjEwLjk0NjYsMzIwLjg5NTcgQzIwNC4xNjQxLDMyOC45MzkgMTk4LjcwNjUsMzI3LjY2MDUgMTkzLjQzNjUsMzE5LjI4MjggQzE4OC4wMTQ5LDMyNC4yMzc3IDE4MS44MDY4LDMyMy40MzM1IDE3OC45NjU5LDMxNi4yMTUgQzE3My4zMTQ4LDMyNC4wNjUyIDE2Ny41NTk2LDMyMy40MTY5IDE2Mi40ODUsMzE1LjYwODIgQzE1Ni4wODQyLDMyMy4zNTMgMTUwLjI2MzksMzIxLjI2ODEgMTQ1LjYyMDMsMzEzLjY3NiBDMTM5LjIxOTMsMzE5LjYxMjggMTMzLjkzODYsMzE4LjUxMzYgMTMwLjg0NzIsMzEwLjIzNjMgQzExNy4xNDU5LDMxOS42MDczIDEwOS4xNjEyLDMxNy4yNjczIDEwNS41LDMwMC41IEMxMDUuNzcwMSwzMDAuNTU4NiAxMDUuODU1NSwzMDAuNjgzNSAxMDUuNjgxNiwzMDAuOTI5NyBDOTcuMzExMywyOTUuMTgyMiA5Ny40MjgzLDI4OS45MTQ0IDEwNi4zNDU0LDI4NC44ODIgQzk4LjU1NDUsMjgyLjI5NTIgOTcuNDIxOCwyNzUuNDQwNSAxMDQuMTIzMiwyNzAuNTk4OSBDOTYuNzI0NywyNjYuNzY5NSA5NC41ODY2LDI2MC44MDEyIDEwMi4yNDM2LDI1NS4xNDExIEM5NC40ODUxLDI1Mi4wOTAzIDkzLjQ0NjYsMjQ1LjIyMjUgOTkuMjIxMSwyMzkuNTQ4NCBDOTEuMzIyNiwyMzUuNzAyIDkwLjE5MywyMjkuMDc5OCA5Ny42NzQxLDIyMy43MjkzIEM5MS4wMTgxLDIxNy42MzkgOTMuMTE5OCwyMTAuNzk2MyAxMDEuNzAxOSwyMDguODIzNyBDOTQuMDIwNSwyMDQuMjQ5IDkzLjg3NDYsMTk3LjE4MzMgMTAyLjM0NzgsMTkzLjI3OTggQzk0LjUwMjUsMTg4LjEzODYgOTYuNTI2MywxNzkuOTc0NiAxMDQuMDIxMiwxNzYuMzQ5NyBDOTUuMzgwOCwxNzAuNTY1MyA5Ni42NzM0LDE2NC44Njk0IDEwNC42MTczLDE1OS42NzggQzk2LjQwMjIsMTQ4LjU3MSA5Ny40MjIsMTM5LjY4NTEgMTEyLjUsMTM2LjUgQzExMy42NDQ1LDEzNi40MDg3IDExNC4zMDQ3LDEzNi43MTgzIDExNC4wMDI3LDEzOC4wMzkyICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1lbnRpdHkgbmdpbngtLT48ZyBpZD0iZWxlbV9uZ2lueCI+PGVsbGlwc2UgY3g9IjI4NS41IiBjeT0iMTYwLjUiIGZpbGw9IiNGMUYxRjEiIHJ4PSIxMiIgcnk9IjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI4MS41LDE0OC41LDI4Ny41LDE0My41LDI4NS41LDE0OC41LDI4Ny41LDE1My41LDI4MS41LDE0OC41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOSIgeD0iMjY2IiB5PSIxODkuNDk1MSI+bmdpbng8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3dhZ2dlci0tPjxnIGlkPSJlbGVtX3N3YWdnZXIiPjxwb2x5Z29uIGZpbGw9IiMwMDgwMDAiIHBvaW50cz0iMTE0LDE1NS41LDEyNCwxNDUuNSwyMzEsMTQ1LjUsMjMxLDE4MS43OTY5LDIyMSwxOTEuNzk2OSwxMTQsMTkxLjc5NjksMTE0LDE1NS41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMjEiIHgyPSIyMzEiIHkxPSIxNTUuNSIgeTI9IjE0NS41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTE0IiB4Mj0iMjIxIiB5MT0iMTU1LjUiIHkyPSIxNTUuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIyMSIgeDI9IjIyMSIgeTE9IjE1NS41IiB5Mj0iMTkxLjc5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NyIgeD0iMTI5IiB5PSIxNzguNDk1MSI+c3dhZ2dlci11aTwvdGV4dD48L2c+PCEtLWVudGl0eSBqc29uLS0+PGcgaWQ9ImVsZW1fanNvbiI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIxNzEuNSwyNjMuNSwxODEuNSwyNTMuNSwzMDUuNSwyNTMuNSwzMDUuNSwyODkuNzk2OSwyOTUuNSwyOTkuNzk2OSwxNzEuNSwyOTkuNzk2OSwxNzEuNSwyNjMuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjk1LjUiIHgyPSIzMDUuNSIgeTE9IjI2My41IiB5Mj0iMjUzLjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNzEuNSIgeDI9IjI5NS41IiB5MT0iMjYzLjUiIHkyPSIyNjMuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI5NS41IiB4Mj0iMjk1LjUiIHkxPSIyNjMuNSIgeTI9IjI5OS43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQiIHg9IjE4Ni41IiB5PSIyODYuNDk1MSI+c3dhZ2dlci1qc29uPC90ZXh0PjwvZz48IS0tZW50aXR5IGphdmFfcHJvZHVjZXJfY29kZXItLT48ZyBpZD0iZWxlbV9qYXZhX3Byb2R1Y2VyX2NvZGVyIj48ZWxsaXBzZSBjeD0iMjM4LjUiIGN5PSIzODciIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTIzOC41LDM5NSBMMjM4LjUsNDIyIE0yMjUuNSw0MDMgTDI1MS41LDQwMyBNMjM4LjUsNDIyIEwyMjUuNSw0MzcgTTIzOC41LDQyMiBMMjUxLjUsNDM3ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ4IiB4PSIxNjQuNSIgeT0iNDUxLjQ5NTEiPmphdmFfcHJvZHVjZXJfY29kZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgamF2YV9jb25zdW1lcl9jb2Rlci0tPjxnIGlkPSJlbGVtX2phdmFfY29uc3VtZXJfY29kZXIiPjxlbGxpcHNlIGN4PSI4Mi41IiBjeT0iMTQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTgyLjUsMjIgTDgyLjUsNDkgTTY5LjUsMzAgTDk1LjUsMzAgTTgyLjUsNDkgTDY5LjUsNjQgTTgyLjUsNDkgTDk1LjUsNjQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTMiIHg9IjYiIHk9Ijc4LjQ5NTEiPmphdmFfY29uc3VtZXJfY29kZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkganNfY29uc3VtZXJfY29kZXItLT48ZyBpZD0iZWxlbV9qc19jb25zdW1lcl9jb2RlciI+PGVsbGlwc2UgY3g9IjI2Mi41IiBjeT0iMTQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTI2Mi41LDIyIEwyNjIuNSw0OSBNMjQ5LjUsMzAgTDI3NS41LDMwIE0yNjIuNSw0OSBMMjQ5LjUsNjQgTTI2Mi41LDQ5IEwyNzUuNSw2NCAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNiIgeD0iMTk0LjUiIHk9Ijc4LjQ5NTEiPmpzX2NvbnN1bWVyX2NvZGVyPC90ZXh0PjwvZz48IS0tbGluayBqYXZhX2NvbnN1bWVyX2NvZGVyIHRvIHN3YWdnZXItLT48ZyBpZD0ibGlua19qYXZhX2NvbnN1bWVyX2NvZGVyX3N3YWdnZXIiPjxwYXRoIGQ9Ik0xMDkuNzQ3LDgxLjczOCBDMTI0Ljk1OCwxMDIuNTI2IDEzOS44NDc5LDEyMi44NzU5IDE1Mi43ODc5LDE0MC41NTk5ICIgZmlsbD0ibm9uZSIgaWQ9ImphdmFfY29uc3VtZXJfY29kZXItdG8tc3dhZ2dlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTYuMzMxLDE0NS40MDIsMTU0LjI0NDQsMTM1Ljc3NjcsMTUzLjM3ODQsMTQxLjM2NjksMTQ3Ljc4ODIsMTQwLjUwMDksMTU2LjMzMSwxNDUuNDAyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsganNfY29uc3VtZXJfY29kZXIgdG8gc3dhZ2dlci0tPjxnIGlkPSJsaW5rX2pzX2NvbnN1bWVyX2NvZGVyX3N3YWdnZXIiPjxwYXRoIGQ9Ik0yMzUuMjUzLDgxLjczOCBDMjIwLjA0MiwxMDIuNTI2IDIwNS4xNTIxLDEyMi44NzU5IDE5Mi4yMTIxLDE0MC41NTk5ICIgZmlsbD0ibm9uZSIgaWQ9ImpzX2NvbnN1bWVyX2NvZGVyLXRvLXN3YWdnZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTg4LjY2OSwxNDUuNDAyLDE5Ny4yMTE4LDE0MC41MDA5LDE5MS42MjE2LDE0MS4zNjY5LDE5MC43NTU2LDEzNS43NzY3LDE4OC42NjksMTQ1LjQwMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHN3YWdnZXIgdG8gbmdpbngtLT48ZyBpZD0ibGlua19zd2FnZ2VyX25naW54Ij48cGF0aCBkPSJNMjMxLjIwNywxNjguNSBDMjQyLjgwMSwxNjguNSAyNDguMzk1LDE2OC41IDI1OS45ODgsMTY4LjUgIiBmaWxsPSJub25lIiBpZD0ic3dhZ2dlci10by1uZ2lueCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNjUuOTg4LDE2OC41LDI1Ni45ODgsMTY0LjUsMjYwLjk4OCwxNjguNSwyNTYuOTg4LDE3Mi41LDI2NS45ODgsMTY4LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBuZ2lueCB0byBqc29uLS0+PGcgaWQ9ImxpbmtfbmdpbnhfanNvbiI+PHBhdGggZD0iTTI3NS4zMDIsMTkyLjUgQzI2Ny4zMSwyMTAuNTI0IDI1OC42OTExLDIyOS45NjMgMjUwLjc4ODEsMjQ3Ljc4NiAiIGZpbGw9Im5vbmUiIGlkPSJuZ2lueC10by1qc29uIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI0OC4zNTYsMjUzLjI3MSwyNTUuNjYwOCwyNDYuNjY1LDI1MC4zODI4LDI0OC43MDAyLDI0OC4zNDc1LDI0My40MjIxLDI0OC4zNTYsMjUzLjI3MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsganNvbiB0byBqYXZhX3Byb2R1Y2VyX2NvZGVyLS0+PGcgaWQ9ImxpbmtfanNvbl9qYXZhX3Byb2R1Y2VyX2NvZGVyIj48cGF0aCBkPSJNMjM4LjUsMzA1LjY3MiBDMjM4LjUsMzI2Ljg1MyAyMzguNSwzNTMuMTgxIDIzOC41LDM3OC4zMDU4ICIgZmlsbD0ibm9uZSIgaWQ9Impzb24tYmFja3RvLWphdmFfcHJvZHVjZXJfY29kZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM4LjUsMjk5LjY3MiwyMzQuNSwzMDguNjcyLDIzOC41LDMwNC42NzIsMjQyLjUsMzA4LjY3MiwyMzguNSwyOTkuNjcyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTMiIHg9IjIzOS41IiB5PSIzNDQuNTY2OSI+cHVzaCAmIzI1NTA5OyYjMjE0NzU7anNvbiYjMjU5OTE7JiMyMDIxNDs8L3RleHQ+PC9nPjwhLS1TUkM9W0lxbWtvSXpJbzRlaUl1bWxBQ2ZGQUtyRUJPZkZwYXo5QlU5QUhDV2F2LVNMYi1RWW9uSVpZdENidi1JTmZZWEtTb2EwMEwya2YyV19IbzRsRkpFbDBZb0kxcklhZTVIU2RmWVVkYmdhTXZnZmZFME9oMDNiQVlZZDV3TWN2YzVIYnJNU2RtVE0yTTltck45bk9ONkhXZ3drN1NtYUJXbnRlU1oyeERDam9hcEZBMDVBR0RtNzlYTHFLX0JCeXUxWU9Ba21YOGMyUmNhMUxEZkFlUTJxRTRGWE1UX0lmX3NCR0dCRmZoS19zUnFEMDAwMF0tLT48L2c+PC9zdmc+'>

<ol>
<li>搭建swagger-ui服务</li>
<li>nginx划分静态目录(swagger-json)，并允许跨域</li>
<li>接口owner将swagger json文件上传至nginx静态目录(swagger-json)，经过各方review后，方可merged</li>
</ol>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>基于dockerfile实现，在安装了docker的机器，通过<code>run.sh</code>可以执行镜像build及容器运行。</p>
<h3 id="docker搭建swagger-ui服务"><a href="#docker搭建swagger-ui服务" class="headerlink" title="docker搭建swagger-ui服务"></a>docker搭建swagger-ui服务</h3><p>使用swagger官方提供的swagger-ui镜像</p>
<p><strong>Dockerfile</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from swaggerapi&#x2F;swagger-ui</span><br></pre></td></tr></table></figure>

<h3 id="docker搭建swagger-json服务"><a href="#docker搭建swagger-json服务" class="headerlink" title="docker搭建swagger-json服务"></a>docker搭建swagger-json服务</h3><p>其实就是一个<strong>nginx</strong>服务，提供了http访问静态json的能力。</p>
<p><strong>Dockerfile</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM nginx</span><br><span class="line"></span><br><span class="line">COPY .&#x2F;conf&#x2F;nginx.conf &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class="line">COPY .&#x2F;api&#x2F;*.json &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</span><br></pre></td></tr></table></figure>

<p><code>nginx.conf</code>中配置允许跨域操作<code>Access-Control-Allow-Origin *</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn;</span><br><span class="line">pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">	add_header Access-Control-Allow-Origin *;</span><br><span class="line"> 	add_header Access-Control-Allow-Headers X-Requested-With;</span><br><span class="line"> 	add_header Access-Control-Allow-Methods GET,POST,OPTIONS;</span><br><span class="line"></span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>api</strong>目录下是接口json文件</p>
<h3 id="发布接口"><a href="#发布接口" class="headerlink" title="发布接口"></a>发布接口</h3><p>通过 <a href="http://localhost:8080/v2/api-docs">http://localhost:8080/v2/api-docs</a> 获取json文件，命名后push到swagger-json项目<strong>api</strong>目录下</p>
<h3 id="访问swagger"><a href="#访问swagger" class="headerlink" title="访问swagger"></a>访问swagger</h3><p>浏览器访问swagger-ui服务，并在窗口输入json文件访问路径 <a href="https://localhost:8080/demo_api_2.json">https://localhost:8080/demo_api_2.json</a> ，然后就可以看到swagger接口定义。</p>
<p><img src="http://img.yuheng.wang/s1.jpg" alt="s1"></p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>看了一下<strong>swagger-ui</strong>的镜像实现，内部也是一个nginx，运行js。所以没必要自己搞一套nginx，直接把json文件copy到<strong>swagger-ui</strong>即可。</p>
<p>更新后到swagger服务Dockerfile如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from swaggerapi&#x2F;swagger-ui</span><br><span class="line"></span><br><span class="line">ENV API_URL&#x3D;http:&#x2F;&#x2F;localhost:8080&#x2F;demo_api_1.json</span><br><span class="line"></span><br><span class="line">COPY .&#x2F;api&#x2F;*.json &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h2><ol>
<li>不能根据代码动态更新，需要owner手动push接口json文件。</li>
<li>需要手动输入json访问url。</li>
</ol>
<p>关于<strong>缺陷2</strong>可以考虑使用<code>API_URLS</code>环境变量实现，但是设置后，不能自定义输入jsonUrl</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from swaggerapi&#x2F;swagger-ui</span><br><span class="line"></span><br><span class="line">ENV API_URLS&#x3D;&quot;[&#123;url: &#39;http:&#x2F;&#x2F;localhost:8080&#x2F;demo_api_1.json&#39;, name : &#39;接口一&#39;&#125;, &#123;url: &#39;http:&#x2F;&#x2F;localhost:8080&#x2F;demo_api_2.json&#39;, name : &#39;接口二&#39;&#125;]&quot;</span><br><span class="line"></span><br><span class="line">COPY .&#x2F;api&#x2F;*.json &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</span><br></pre></td></tr></table></figure>

<p>效果图如下<br><img src="http://img.yuheng.wang/s2.png" alt="s2"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>领导说做个设计评审吧。</title>
    <url>/2021/03/17/tech-design-review/</url>
    <content><![CDATA[<p>作为开发人员，你一定被老板要求过“做个设计评审吧”。那么问题来了，要怎么做设计评审呢？<br>答案非常简单：<strong>问你的老板。</strong><br>因为公司风格不同、个人喜好差异，因此一定要先明确预期，不要自己猜测这种“一句话需求”。可以先咨询是否有相关的文档和模版，或者他人做的参考。<br>新人往往惧怕沟通，担心这是能力不足的体现。其实，追根刨底才是一种专业性的体现。</p>
<span id="more"></span>

<h2 id="为什么要做设计评审"><a href="#为什么要做设计评审" class="headerlink" title="为什么要做设计评审"></a>为什么要做设计评审</h2><p>客观来说，因为不信任。<br>当你作为一个新手时，领导需要确认你理解了需求并采用合适的设计思路，保障质量与扩展性的同时还需要确认安全性、可维护性等方面没有缺陷。<br>而资深人员，也需要确认了解现有团队整体架构规范。<br>当团队结果一段时间的配合后，会达到一些默契，就可以简化相关流程。<br>同时，涉及多方合作时，也可以在设计评审时，说明配合方式，以及为什么要这样配合。<br>作为干饭人，每一次发声都是一次个人的分享展示。</p>
<h2 id="我认为的设计评审流程"><a href="#我认为的设计评审流程" class="headerlink" title="我认为的设计评审流程"></a>我认为的设计评审流程</h2><p>软件工程的课程中有着标准的设计评审参考标准，这里仅谈一下我认为的设计评审流程。</p>
<h3 id="0-组织会议"><a href="#0-组织会议" class="headerlink" title="0. 组织会议"></a>0. 组织会议</h3><ol>
<li>确定参与人员</li>
<li>确认时间、地点</li>
<li>发送相关资料文档</li>
</ol>
<h3 id="1-需求背景介绍。"><a href="#1-需求背景介绍。" class="headerlink" title="1. 需求背景介绍。"></a>1. 需求背景介绍。</h3><p>不要直接贴PRD，要基于分析理解来精简、提炼。尽量通过2、3句话交代清楚背景、目标。<br>比如</p>
<p>WHAT: 账号管理系统，维护账号信息、密码管理以及登陆需求。<br>WHY: 满足关键信息登录控制需求，引导用户完成注册及后续转化。<br>INDICATOR: 2W+历史账户待迁移，预期每日新增100+<br>LIMIT: 安全性隔离，无法与LDAP直接通信</p>
<h3 id="2-逻辑视图-依赖关系"><a href="#2-逻辑视图-依赖关系" class="headerlink" title="2. 逻辑视图(依赖关系)"></a>2. 逻辑视图(依赖关系)</h3><p>用于明确当前功能在整个平台中的位置和职责，以及和不同功能模块之间的依赖关系。</p>
<p>可能有2个纬度 </p>
<ol>
<li>如果是微服务架构，则描述系统间依赖及调用方式(同步rpc/异步mq)，包括基础中间件的引用关系</li>
<li>如果是已有项目内模块，则描述不同模块间的关系</li>
</ol>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI2ODFweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjczOXB4O2hlaWdodDo2ODFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA3MzkgNjgxIiB3aWR0aD0iNzM5cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciBtcy0tPjxnIGlkPSJjbHVzdGVyX21zIj48cGF0aCBkPSJNOC41LDI0My41IEw1NC41LDI0My41IEEzLjc1LDMuNzUgMCAwIDEgNTcsMjQ2IEw2NCwyNjUuNzk2OSBMMzA4LjUsMjY1Ljc5NjkgQTIuNSwyLjUgMCAwIDEgMzExLDI2OC4yOTY5IEwzMTEsNTIyIEEyLjUsMi41IDAgMCAxIDMwOC41LDUyNC41IEw4LjUsNTI0LjUgQTIuNSwyLjUgMCAwIDEgNiw1MjIgTDYsMjQ2IEEyLjUsMi41IDAgMCAxIDguNSwyNDMuNSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjYiIHgyPSI2NCIgeTE9IjI2NS43OTY5IiB5Mj0iMjY1Ljc5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDUiIHg9IjEwIiB5PSIyNTguNDk1MSI+JiMyNDQ5NDsmIzI2MzgxOyYjMjExNTM7PC90ZXh0PjwvZz48IS0tY2x1c3RlciB1Yy0tPjxnIGlkPSJjbHVzdGVyX3VjIj48cGF0aCBkPSJNNDQ4LjcxNjIsNDEzLjIzNzYgQzQ1NC41NzE2LDQwNC41NDg2IDQ2My42MTQsNDAzLjE3OTUgNDY4LjY4NDksNDE0LjAzODkgQzQ3Mi42NDUxLDQwNS4xMTEyIDQ3OC41MDQ5LDQwNC4zNDgyIDQ4NS4zNzMyLDQxMC45MDQ2IEM0OTEuOTc3Nyw0MDIuOTk5IDQ5OC41NTQ2LDQwNC4wNTYzIDUwNC4xNjQ2LDQxMi4wNzc4IEM1MDguMTg0MSw0MDIuNTA5NyA1MTguNjcyOCw0MDEuMTIwOCA1MjUuMjM1MSw0MDkuMDA4NCBDNTI5Ljk0MDYsNDAwLjYwOTMgNTM3LjY4MTIsNDAxLjQ0NjggNTQyLjY2NjUsNDA4LjY5NjYgQzU0OC44MTU3LDM5OS4yOTM3IDU1Ny45NzksNDAwLjExOTcgNTYyLjMzNjIsNDEwLjQ4IEM1NjUuNTc2Myw0MDEuMTM4OCA1NzQuNDAyMiwzOTkuNTAyOSA1ODAuNDg3OSw0MDcuNTAxMSBDNTg2LjYwNjgsMzk4LjcyOTIgNTkzLjAyMzksMzk5Ljg0MjIgNTk5LjE1Niw0MDcuNDg2IEM2MDYuMTc4OSwzOTguMjUzNyA2MTQuMjA4LDQwMC4xNjY5IDYxOC4zOTQ5LDQxMC4zMDMxIEM2MjIuNzU5OSw0MDAuNzU1MiA2MzIuNjMwNiwzOTkuNTI1OCA2MzguMjc0NCw0MDguOTY0MSBDNjQ0LjgzNzksNDAyLjAzOTkgNjUyLjMxMTksNDAzLjc5MzkgNjU2LjAxOTcsNDEyLjI1NzQgQzY2MC45OTk4LDQwMy4xMzQzIDY3MC45MzA4LDQwMy4xMTc1IDY3Ni4wMzM1LDQxMi4xMjIxIEM2ODEuOTMyNyw0MDMuNTQ2NSA2ODkuMTg3NSw0MDUuNzE5NSA2OTMuNDE2Nyw0MTMuODU4OCBDNzAyLjYxOTIsNDAyLjExOTMgNzEzLjIxMDQsNDA2Ljg2NTkgNzE4LDQxOC41IEM3MTkuMzQ4Nyw0MTguOTE0NyA3MTkuOTEzMyw0MjAuMTEyOCA3MTguODUwNSw0MjEuMjY4MyBDNzI3LjUzMTYsNDI1Ljg0OTYgNzMwLjc1MSw0MzIuNzk3IDcyMS45ODUxLDQ0MC4yNTgyIEM3MjkuMjk4LDQ0NS45NzE1IDcyNy45NjQyLDQ1NC44NTgyIDcxOS44NDIyLDQ1OC43ODYzIEM3MjkuODkxMyw0NjMuNzg5MyA3MjguNTk5NSw0NzAuMzg0NiA3MjEuNzAxLDQ3Ny4xMDcyIEM3MzEuNDQ1MSw0ODEuNzQ0NCA3MzIuODk3Miw0OTEuNjA4IDcyMi43NzA0LDQ5Ny4yOTc3IEM3MzEuMDY4Niw1MDUuNzQwNCA3MzAuNDEyLDUxMi4xNDQ5IDcyMC4zOTY1LDUxOC41NDExIEM3MjkuNzUyNyw1MjIuMjI1MyA3MzAuNjMxOSw1MjkuOTE3IDcyMi41NDA5LDUzNS43NzI2IEM3MzIuMjY3Niw1NDIuMjQzNiA3MzEuNTQyMiw1NDkuNjg2NSA3MjEuODIxMSw1NTUuNDQ2IEM3MzIuNTM1Miw1NjAuNjc3MyA3MzEuNTE4Nyw1NzAuNTM1OSA3MjIuNjIzNiw1NzYuNTE0MiBDNzMxLjgzOTEsNTgxLjkyOTMgNzMwLjYyNTIsNTkwLjg4NzMgNzIxLjE2MzIsNTk0LjgxMTcgQzczMC45NDM1LDYwMi4xNDc1IDcyOS4zNjI4LDYwOS42MDQ4IDcxOS4yNDYxLDYxNS4wNTYzIEM3MjguOTQ3Miw2MTkuMDY5NCA3MjcuNjcyLDYyNy43NzQ5IDcyMC4xNjMsNjMyLjY4MzIgQzcyOS41MzYzLDY0NS42NTU2IDcyNS40NDQzLDY1My4zMjE3IDcxMSw2NTcuNSBDNzEyLjc0MzYsNjU2LjM5NzcgNzE0LjAzMjcsNjU3LjIxNDQgNzEzLjk2NDEsNjU5LjIyNTQgQzcwOC4yMzM3LDY2OC41NDU5IDcwMC4zNDE0LDY2OS4yMzYgNjkzLjQwMTgsNjYwLjYxMDkgQzY4OC42MjIsNjY4LjUyMTggNjgyLjExNDQsNjY5LjQwNDYgNjc1LjkyOTIsNjYyLjIzOTcgQzY2OC42MjY5LDY3My4yMTc3IDY2Mi4zMDQ1LDY3MS42NjE1IDY1NS4xODQ4LDY2Mi4wNTU2IEM2NTAuNjY4OSw2NzEuNzYyNSA2NDMuMzQ1Niw2NzEuNzc3MyA2MzcuMjU5Nyw2NjMuNjMyMSBDNjMyLjM2LDY3Mi42NTYxIDYyMy40NDQxLDY3Mi44OTQzIDYxNy41NDc3LDY2NC43Nzg0IEM2MTEuMzg4LDY3MS4xMDU5IDYwNC44NjI3LDY3MC40MjUyIDYwMC45MTg2LDY2Mi4yMzk4IEM1OTUuODczNSw2NzMuNzU5NCA1ODcuNTcxOSw2NzQuODQzMyA1NzkuMjY5OCw2NjUuNjQyOCBDNTc0LjIxMTUsNjcyLjE4MzIgNTY2LjUxODIsNjcyLjU0ODYgNTYyLjMzODQsNjY0LjYxNTIgQzU1Ny4zNDU3LDY3My4wNjIyIDU0OC4yNTE3LDY3My44NzE1IDU0My4xMzEzLDY2NC43NTQ4IEM1MzYuMTg2Nyw2NzEuNDk5NSA1MjkuMTc1NSw2NjkuMTcxMiA1MjUuNzQ4OSw2NjAuNzI4NCBDNTE5LjQ4MDksNjY5LjczNzcgNTA5LjU5OTksNjcwLjk3MDggNTA0LjEwNzgsNjU5Ljg5MjQgQzQ5OS45NDE3LDY2Ny40ODY0IDQ5Mi42OTM4LDY2OC4zMDY1IDQ4Ny44NDY1LDY2MC42MTcyIEM0ODIuMjMxNSw2NzAuMzY0MSA0NzQuNjc0NSw2NzEuMjYgNDY4LjIxNzEsNjYxLjQ2MzIgQzQ1NS40NjI3LDY3MS4yNzA5IDQ0Mi4yNzM5LDY2Ny42NjcgNDQwLDY1MC41IEM0NDAuNjQwNSw2NDkuNTIxNCA0NDEuMzU3Myw2NDkuNzM0NSA0NDEuODk0Nyw2NTAuNjA1NiBDNDMzLjI4NDMsNjQ1LjA2NDggNDMxLjY2MTcsNjM4LjgwNTIgNDM5LjY5NjQsNjMxLjM2MjkgQzQzMC43OTM1LDYyNS41NjUxIDQzMC44Nzc4LDYxNi44NTE2IDQ0MC44MzM0LDYxMi4xNzExIEM0MjkuODY2OCw2MDguNjM1MyA0MjguMzQ0Myw2MDAuMTQyNiA0MzcuMzc0MSw1OTIuOTk4OSBDNDI4Ljk1NDEsNTg3LjU4MjIgNDI5LjU2MTEsNTc4LjM2MzkgNDM4LjIxMTIsNTczLjY4NzIgQzQyNy44OTM0LDU2OS4yMTk5IDQyOS41NDI0LDU1OS42ODU5IDQzNy41NjUsNTU0LjU5NzcgQzQyOC4xNTk3LDU1MS40NjQ5IDQyNS4zMTEsNTQyLjY3MDQgNDM0LjQ2Miw1MzYuMzc3NCBDNDI1LjI3NTYsNTI5LjI5NjUgNDI1LjMyNjksNTE5LjgyMTkgNDM3LjM4ODMsNTE1Ljc1NjMgQzQyOS44MjU1LDUxMC40NDA2IDQzMC4wNzIsNTAyLjgzNTcgNDM5LjEwMiw0OTkuMjQxOCBDNDI4LjE2MzYsNDkxLjYxODQgNDMwLjE5NjQsNDg0LjQ5NDUgNDQwLjA3ODUsNDc3LjgyMDMgQzQzMC44OTMzLDQ3MS44NDgzIDQzMC41Mzk3LDQ2Ni4yMTI4IDQzOS45MjE3LDQ2MC4wNzY4IEM0MzAuNDg2NCw0NTQuMTQ5MyA0MzAuMjI5Niw0NDYuMzczNSA0MzkuODU1NCw0NDAuMzgxOCBDNDI2LjQxNjEsNDI4Ljg2ODUgNDMyLjY0NTYsNDE2LjEzNzkgNDQ3LDQxMS41IEM0NDguMjk0LDQxMS4wOTMzIDQ0OC45OTgzLDQxMi4wODc1IDQ0OC43MTYyLDQxMy4yMzc2ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwIiB4PSI1NDkiIHk9IjQyOS40OTUxIj4mIzI5OTkyOyYjMjUxNDM7JiMyMDAxMzsmIzI0NTE1OzwvdGV4dD48L2c+PCEtLWVudGl0eSBzMS0tPjxnIGlkPSJlbGVtX3MxIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjIxMiwyOTYuNSwyMjIsMjg2LjUsMjY4LDI4Ni41LDI2OCwzMjIuNzk2OSwyNTgsMzMyLjc5NjksMjEyLDMzMi43OTY5LDIxMiwyOTYuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjU4IiB4Mj0iMjY4IiB5MT0iMjk2LjUiIHkyPSIyODYuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIxMiIgeDI9IjI1OCIgeTE9IjI5Ni41IiB5Mj0iMjk2LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNTgiIHgyPSIyNTgiIHkxPSIyOTYuNSIgeTI9IjMzMi43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYiIHg9IjIyNyIgeT0iMzE5LjQ5NTEiPnMxPC90ZXh0PjwvZz48IS0tZW50aXR5IHMyLS0+PGcgaWQ9ImVsZW1fczIiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTIxLjUsMjk2LjUsMTMxLjUsMjg2LjUsMTc2LjUsMjg2LjUsMTc2LjUsMzIyLjc5NjksMTY2LjUsMzMyLjc5NjksMTIxLjUsMzMyLjc5NjksMTIxLjUsMjk2LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE2Ni41IiB4Mj0iMTc2LjUiIHkxPSIyOTYuNSIgeTI9IjI4Ni41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTIxLjUiIHgyPSIxNjYuNSIgeTE9IjI5Ni41IiB5Mj0iMjk2LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNjYuNSIgeDI9IjE2Ni41IiB5MT0iMjk2LjUiIHkyPSIzMzIuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1IiB4PSIxMzYuNSIgeT0iMzE5LjQ5NTEiPnMyPC90ZXh0PjwvZz48IS0tZW50aXR5IHMzLS0+PGcgaWQ9ImVsZW1fczMiPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMzAsMjk2LjUsNDAsMjg2LjUsODYsMjg2LjUsODYsMzIyLjc5NjksNzYsMzMyLjc5NjksMzAsMzMyLjc5NjksMzAsMjk2LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijc2IiB4Mj0iODYiIHkxPSIyOTYuNSIgeTI9IjI4Ni41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzAiIHgyPSI3NiIgeTE9IjI5Ni41IiB5Mj0iMjk2LjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3NiIgeDI9Ijc2IiB5MT0iMjk2LjUiIHkyPSIzMzIuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2IiB4PSI0NSIgeT0iMzE5LjQ5NTEiPnMzPC90ZXh0PjwvZz48IS0tZW50aXR5IGRiMS0tPjxnIGlkPSJlbGVtX2RiMSI+PHBhdGggZD0iTTEwOSw0NDguNSBDMTA5LDQzOC41IDE0OSw0MzguNSAxNDksNDM4LjUgQzE0OSw0MzguNSAxODksNDM4LjUgMTg5LDQ0OC41IEwxODksNDkwLjA5MzggQzE4OSw1MDAuMDkzOCAxNDksNTAwLjA5MzggMTQ5LDUwMC4wOTM4IEMxNDksNTAwLjA5MzggMTA5LDUwMC4wOTM4IDEwOSw0OTAuMDkzOCBMMTA5LDQ0OC41ICIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTEwOSw0NDguNSBDMTA5LDQ1OC41IDE0OSw0NTguNSAxNDksNDU4LjUgQzE0OSw0NTguNSAxODksNDU4LjUgMTg5LDQ0OC41ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MCIgeD0iMTE5IiB5PSI0NzUuNDk1MSI+JiMxNzE7bXlzcWwmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjEzNSIgeT0iNDkxLjc5MiI+ZGIxPC90ZXh0PjwvZz48IS0tZW50aXR5IHVzZXItLT48ZyBpZD0iZWxlbV91c2VyIj48cmVjdCBmaWxsPSIjQUREOEU2IiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijk2IiB4PSI2MDYiIHk9IjQ0Ni41Ii8+PHJlY3QgZmlsbD0iI0FERDhFNiIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjY4MiIgeT0iNDUxLjUiLz48cmVjdCBmaWxsPSIjQUREOEU2IiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjY4MCIgeT0iNDUzLjUiLz48cmVjdCBmaWxsPSIjQUREOEU2IiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjY4MCIgeT0iNDU3LjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iNjIxIiB5PSI0NzkuNDk1MSI+JiMyOTk5MjsmIzI1MTQzOyYjMzE2NDk7JiMyOTcwMjs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgcm9sZS0tPjxnIGlkPSJlbGVtX3JvbGUiPjxyZWN0IGZpbGw9IiNBREQ4RTYiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTYiIHg9IjQ3NSIgeT0iNDQ2LjUiLz48cmVjdCBmaWxsPSIjQUREOEU2IiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iNTUxIiB5PSI0NTEuNSIvPjxyZWN0IGZpbGw9IiNBREQ4RTYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNTQ5IiB5PSI0NTMuNSIvPjxyZWN0IGZpbGw9IiNBREQ4RTYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNTQ5IiB5PSI0NTcuNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSI0OTAiIHk9IjQ3OS40OTUxIj4mIzM1MjgyOyYjMzMzOTQ7JiMzMTY0OTsmIzI5NzAyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBkYjItLT48ZyBpZD0iZWxlbV9kYjIiPjxwYXRoIGQ9Ik01NTEuNSw1ODkuNSBDNTUxLjUsNTc5LjUgNTg4LDU3OS41IDU4OCw1NzkuNSBDNTg4LDU3OS41IDYyNC41LDU3OS41IDYyNC41LDU4OS41IEw2MjQuNSw2MzEuMDkzOCBDNjI0LjUsNjQxLjA5MzggNTg4LDY0MS4wOTM4IDU4OCw2NDEuMDkzOCBDNTg4LDY0MS4wOTM4IDU1MS41LDY0MS4wOTM4IDU1MS41LDYzMS4wOTM4IEw1NTEuNSw1ODkuNSAiIGZpbGw9IiM5MEVFOTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik01NTEuNSw1ODkuNSBDNTUxLjUsNTk5LjUgNTg4LDU5OS41IDU4OCw1OTkuNSBDNTg4LDU5OS41IDYyNC41LDU5OS41IDYyNC41LDU4OS41ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MyIgeD0iNTYxLjUiIHk9IjYxNi40OTUxIj4mIzE3MTtyZWRpcyYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNyIgeD0iNTc0LjUiIHk9IjYzMi43OTIiPmRiMjwvdGV4dD48L2c+PCEtLWVudGl0eSBBUFAtLT48ZyBpZD0iZWxlbV9BUFAiPjxlbGxpcHNlIGN4PSI0MjYiIGN5PSIxNCIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNDI2LDIyIEw0MjYsNDkgTTQxMywzMCBMNDM5LDMwIE00MjYsNDkgTDQxMyw2NCBNNDI2LDQ5IEw0MzksNjQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iNDEyIiB5PSI3OC40OTUxIj5BUFA8L3RleHQ+PC9nPjwhLS1lbnRpdHkgSDUtLT48ZyBpZD0iZWxlbV9INSI+PGVsbGlwc2UgY3g9IjQ4OSIgY3k9IjE0IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00ODksMjIgTDQ4OSw0OSBNNDc2LDMwIEw1MDIsMzAgTTQ4OSw0OSBMNDc2LDY0IE00ODksNDkgTDUwMiw2NCAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5IiB4PSI0NzkuNSIgeT0iNzguNDk1MSI+SDU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZmpzLS0+PGcgaWQ9ImVsZW1fZmpzIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjM5OS41LDE1Mi41LDQwOS41LDE0Mi41LDUxNC41LDE0Mi41LDUxNC41LDE3OC43OTY5LDUwNC41LDE4OC43OTY5LDM5OS41LDE4OC43OTY5LDM5OS41LDE1Mi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1MDQuNSIgeDI9IjUxNC41IiB5MT0iMTUyLjUiIHkyPSIxNDIuNSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM5OS41IiB4Mj0iNTA0LjUiIHkxPSIxNTIuNSIgeTI9IjE1Mi41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTA0LjUiIHgyPSI1MDQuNSIgeTE9IjE1Mi41IiB5Mj0iMTg4Ljc5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NSIgeD0iNDE0LjUiIHk9IjE3NS40OTUxIj4mIzIxMDY5OyYjMjE0ODg7bm9kZWpzPC90ZXh0PjwvZz48IS0tbGluayBBUFAgdG8gZmpzLS0+PGcgaWQ9ImxpbmtfQVBQX2ZqcyI+PHBhdGggZD0iTTQzNS42MzksODEuODExIEM0NDAuNzU3LDEwMS42MjYgNDQ1LjM3NTEsMTE5LjUwMjggNDQ5Ljc1MDEsMTM2LjQzNTggIiBmaWxsPSJub25lIiBpZD0iQVBQLXRvLWZqcyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NTEuMjUxLDE0Mi4yNDUsNDUyLjg3MjQsMTMyLjUzMDUsNDUwLjAwMDIsMTM3LjQwNCw0NDUuMTI2OCwxMzQuNTMxOCw0NTEuMjUxLDE0Mi4yNDUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBINSB0byBmanMtLT48ZyBpZD0ibGlua19INV9manMiPjxwYXRoIGQ9Ik00NzkuMDUsODEuODExIEM0NzMuNzY2LDEwMS42MjYgNDY4Ljk5NTgsMTE5LjUxNDYgNDY0LjQ4MDgsMTM2LjQ0NzYgIiBmaWxsPSJub25lIiBpZD0iSDUtdG8tZmpzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ2Mi45MzUsMTQyLjI0NSw0NjkuMTE4NywxMzQuNTc5NCw0NjQuMjIzMiwxMzcuNDEzOCw0NjEuMzg4OCwxMzIuNTE4Myw0NjIuOTM1LDE0Mi4yNDUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBzMSB0byBkYjEtLT48ZyBpZD0ibGlua19zMV9kYjEiPjxwYXRoIGQ9Ik0yMjcuMTU1LDMzMi44MDIgQzIxMS4yMzIsMzYwLjQ0OCAxODcuMDI3NSw0MDIuNDczNyAxNjkuMjgzNSw0MzMuMjgyNyAiIGZpbGw9Im5vbmUiIGlkPSJzMS10by1kYjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTY2LjI4OSw0MzguNDgyLDE3NC4yNDY5LDQzMi42NzkzLDE2OC43ODQ0LDQzNC4xNDkyLDE2Ny4zMTQ1LDQyOC42ODY3LDE2Ni4yODksNDM4LjQ4MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHMyIHRvIGRiMS0tPjxnIGlkPSJsaW5rX3MyX2RiMSI+PHBhdGggZD0iTTE0OSwzMzIuODAyIEMxNDksMzYwLjQ0OCAxNDksNDAxLjY3MyAxNDksNDMyLjQ4MiAiIGZpbGw9Im5vbmUiIGlkPSJzMi10by1kYjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQ5LDQzOC40ODIsMTUzLDQyOS40ODIsMTQ5LDQzMy40ODIsMTQ1LDQyOS40ODIsMTQ5LDQzOC40ODIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayBzMyB0byBkYjEtLT48ZyBpZD0ibGlua19zM19kYjEiPjxwYXRoIGQ9Ik03MC44NDUxLDMzMi44MDIgQzg2Ljc2OCwzNjAuNDQ4IDExMC45NzI1LDQwMi40NzM3IDEyOC43MTY1LDQzMy4yODI3ICIgZmlsbD0ibm9uZSIgaWQ9InMzLXRvLWRiMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzEuNzExLDQzOC40ODIsMTMwLjY4NTUsNDI4LjY4NjcsMTI5LjIxNTYsNDM0LjE0OTIsMTIzLjc1MzEsNDMyLjY3OTMsMTMxLjcxMSw0MzguNDgyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZmpzIHRvIG1zLS0+PGcgaWQ9ImxpbmtfZmpzX21zIj48cGF0aCBkPSJNNDMyLjkzOCwxODguNjg4IEM0MTEuNjIsMjA4LjM0NDUgMzc5LjgwOTUsMjM3LjY3NiAzNTIuOTk5NCwyNjIuMzk2OSBDMzM5LjU5NDMsMjc0Ljc1NzMgMzI3LjQzOTMsMjg1Ljk2NTEgMzE4LjQ3MTEsMjk0LjIzNDUgQzMxNi4yMjksMjk2LjMwMTkgMzE0LjE4NjEsMjk4LjE4NTYgMzEyLjM3MjYsMjk5Ljg1NzcgQzMxMS45MTkzLDMwMC4yNzU4IDMxNS44OTEzLDI5Ni42MTMzIDMxNS40NjcxLDI5Ny4wMDQ1ICIgZmlsbD0ibm9uZSIgaWQ9ImZqcy10by1tcyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTEuMDU2LDMwMS4wNzE4LDMyMC4zODQxLDI5Ny45MTE1LDMxNC43MzE5LDI5Ny42ODIzLDMxNC45NjEsMjkyLjAzMDEsMzExLjA1NiwzMDEuMDcxOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1saW5rIHVzZXIgdG8gZGIyLS0+PGcgaWQ9ImxpbmtfdXNlcl9kYjIiPjxwYXRoIGQ9Ik02NDMuNTQyLDQ5Mi41MjUgQzYzMi40Miw1MTUuOTUgNjE3LjMyNjUsNTQ3LjczNyA2MDQuOTEwNSw1NzMuODg2ICIgZmlsbD0ibm9uZSIgaWQ9InVzZXItdG8tZGIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYwMi4zMzcsNTc5LjMwNiw2MDkuODEwNyw1NzIuODkxNiw2MDQuNDgxNiw1NzQuNzg5Myw2MDIuNTgzOSw1NjkuNDYwMiw2MDIuMzM3LDU3OS4zMDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tbGluayByb2xlIHRvIGRiMi0tPjxnIGlkPSJsaW5rX3JvbGVfZGIyIj48cGF0aCBkPSJNNTMzLjI5OSw0OTIuNTI1IEM1NDQuMjUzLDUxNS45NSA1NTkuMTExNiw1NDcuNzIxOCA1NzEuMzM4Niw1NzMuODcwOCAiIGZpbGw9Im5vbmUiIGlkPSJyb2xlLXRvLWRiMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NzMuODgsNTc5LjMwNiw1NzMuNjkxMyw1NjkuNDU5LDU3MS43NjIxLDU3NC43NzY3LDU2Ni40NDQ0LDU3Mi44NDc1LDU3My44OCw1NzkuMzA2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLWxpbmsgZmpzIHRvIHVjLS0+PGcgaWQ9ImxpbmtfZmpzX3VjIj48cGF0aCBkPSJNNDcxLjk0MSwxODguNjQgQzQ5OC4zNDQsMjMwLjc3NiA1NDYuMjkzLDMyMy4zMDIgNTAwLDM3OS41IEM0ODguMTk2LDM5My44MyA0NzIuMzczLDM3NC42MjIgNDU5LDM4Ny41IEM0NTUuNzc0NiwzOTAuNjA2IDQ1My4wNTE4LDM5NC4xNDc1IDQ1MC43NTcxLDM5Ny45NzM2IEM0NTAuMTgzNCwzOTguOTMwMSA0NDkuNjM2NSwzOTkuOTA0NCA0NDkuMTE1MSw0MDAuODk0MSBDNDQ4Ljg1NDUsNDAxLjM4ODkgNDQ4LjYwMDIsNDAxLjg4NzYgNDQ4LjM1MjIsNDAyLjM4OTkgQzQ0OC4yMjgyLDQwMi42NDExIDQ1MC42OTM3LDM5Ny40Nzk5IDQ1MC41NzI4LDM5Ny43MzI4ICIgZmlsbD0ibm9uZSIgaWQ9ImZqcy10by11YyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NDcuOTg0OCw0MDMuMTQ2LDQ1NS40NzU2LDM5Ni43NTE1LDQ1MC4xNDE1LDM5OC42MzUsNDQ4LjI1OCwzOTMuMzAwOSw0NDcuOTg0OCw0MDMuMTQ2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzgiIHg9IjUyMCIgeT0iMzE0LjA2NjkiPmdldCB1c2VyIGJhc2ljIGluZm8gYnk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0IiB4PSI2NjIiIHk9IjMxNC4wNjY5Ij5odHRwPC90ZXh0PjwvZz48IS0tbGluayBtcyB0byB1Yy0tPjxnIGlkPSJsaW5rX21zX3VjIj48cGF0aCBkPSJNMzExLjEwNSwzNTIuMDIzNyBDMzExLjE3OTYsMzUyLjI1NjggMzExLjI1NDksMzUyLjQ4OTkgMzExLjMzMDgsMzUyLjcyMzEgQzMxMS45MzgzLDM1NC41ODkgMzEyLjU4ODYsMzU2LjQ2MDUgMzEzLjI4NDMsMzU4LjMyNDUgQzMxNi4wNjczLDM2NS43ODA5IDMxOS41Nzg4LDM3My4xMTg1IDMyNCwzNzkuNSBDMzQyLjIxNDUsNDA1Ljc5IDM3MC42LDQyNy43NjEgMzk0LjczMiw0NDMuMjk1OCBDNDA2Ljc5OCw0NTEuMDYzMSA0MTcuODAwNiw0NTcuMjIxNCA0MjUuOTM2OCw0NjEuNTA2IEM0MjcuOTcwOSw0NjIuNTc3MiA0MjkuODI1OCw0NjMuNTMxMiA0MzEuNDczMyw0NjQuMzY0IEM0MzEuNTc2Myw0NjQuNDE2MSA0MjYuMzIxLDQ2MS43NjYzIDQyNi40MjIzLDQ2MS44MTc0ICIgZmlsbD0ibm9uZSIgaWQ9Im1zLXRvLXVjIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQzMS43Nzk4LDQ2NC41MTg3LDQyNS41NDQ1LDQ1Ni44OTUsNDI3LjMxNTIsNDYyLjI2NzYsNDIxLjk0MjcsNDY0LjAzODMsNDMxLjc3OTgsNDY0LjUxODciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMCIgeD0iMzI1IiB5PSIzNzUuNTY2OSI+Z2V0IHVzZXIgaW5mbyBkZXRhaWw8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ2IiB4PSI0NDkiIHk9IjM3NS41NjY5Ij5kdWJibzwvdGV4dD48L2c+PCEtLVNSQz1bVFAwekl5RDA3Q1J0LW5IX3dibWFBTHFhNzdKaE1GMEp0NWxKcjJHTlNuVWFZOUNXTFlZQUVCZnFxaUtZQlpoUEJzRVFWV25wYnNaSlkzU3p6enBsLVJ5U09MZ2NDMVlENEI1Z3M0U2ViYm4wOXZ5bHlqak5ld1VnMHFKMVVBZTBlSEE1QmZUZFNIU1IxbXR4VXJVSzQ3UDJWMDd2dnNocGtDWGxiWU9RQUpYN0sxdlJNWmFEeEpQcXBzZkVEQTU0MlUzS3lSbmVmYXYzWkVzQlNkdnhiTS1MdlZ3clVkbE0xSzljeVh5aEFjVGFlU211NTBfRmMtbHRodS1OVjdyZlhpbk9GSUlKS0k5WjRVaVFBTFJCdWt1QTFpVUdBUDcyR0hadTRxdDNKQkpleFRGelRsd3NlckNQWVpSVE1DeHJsNUptRzY1U0d0dWdINm1mc3NVdEhGTDdqYnBKUjZzTWlJRm1YUXgyUE8tMEdIMkY5VDBQVTFIRmo0d3lHdWZIejRfMmlibmU0ZUk2dm5jYnFXSS0wRzAwXS0tPjwvZz48L3N2Zz4='>

<h3 id="3-过程视图"><a href="#3-过程视图" class="headerlink" title="3. 过程视图"></a>3. 过程视图</h3><p>列出核心流程的时序图，讲解用户故事</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyNDk0cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDoxMjIxcHg7aGVpZ2h0OjI0OTRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjIxIDI0OTQiIHdpZHRoPSIxMjIxcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzcxIiB4PSI0MjEiIHk9IjI3Ljk5NTEiPkNBUyBCcm93c2VyIFNpbmdsZS1TaWdub24gU2VxdWVuY2UgRGlhZ3JhbTwvdGV4dD48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQ0LjI2NTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIxOCIgeT0iNTkyLjY0ODQiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjEyNzQuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjE1NSIgeT0iMTkyLjg1OTQiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQxNC42NTYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTYwIiB5PSI0NTIuNzE4OCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTk2LjA2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIxNTUiIHk9IjE1NjcuNjI1Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI1MzEuNzg5MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjE1NSIgeT0iMTg2My45NTMxIi8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI5Ni45NjQ4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTYwIiB5PSIxOTk2Ljc1Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI2Mi4zOTg0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNTA4IiB5PSI0NTIuNzE4OCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTYwLjQ5NjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI1MDgiIHk9IjcwNi44Nzg5Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI5NS42NjQxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNTA4IiB5PSIxMDA3LjMwNDciLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9Ijk2Ljk2NDgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI1MDgiIHk9IjE5OTYuNzUiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI1MDgiIHk9IjIxOTIuODEyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTE1LjM2MzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI4NjMiIHk9IjIyMS45OTIyIi8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIzMzYuOTU3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iODYzIiB5PSI5MjkuNzczNCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNzEuMjY1NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9Ijg2MyIgeT0iMTM2Ni45NjA5Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI5Ni45NjQ4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iODYzIiB5PSIxNjM3LjU4OTgiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQ0LjI2NTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIxMDM2IiB5PSIxODkzLjA4NTkiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjEzMi43OTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTAzNiIgeT0iMjEzMy40MTQxIi8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI3MS4yNjU2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTAzNiIgeT0iMjI5NS4zNDM4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjIzIiB4Mj0iMjMiIHkxPSIxMTguNTkzOCIgeTI9IjE0NzUuMzU5NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDQuMDsiIHgxPSIyMyIgeDI9IjIzIiB5MT0iMTQ3NS4zNTk0IiB5Mj0iMTUwMy4zNTk0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjIzIiB4Mj0iMjMiIHkxPSIxNTAzLjM1OTQiIHkyPSIxNzcxLjY4NzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCw0LjA7IiB4MT0iMjMiIHgyPSIyMyIgeTE9IjE3NzEuNjg3NSIgeTI9IjE3OTkuNjg3NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIyMyIgeDI9IjIzIiB5MT0iMTc5OS42ODc1IiB5Mj0iMjQxMy43NDIyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjE2MCIgeDI9IjE2MCIgeTE9IjExOC41OTM4IiB5Mj0iMTQ3NS4zNTk0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToxLjAsNC4wOyIgeDE9IjE2MCIgeDI9IjE2MCIgeTE9IjE0NzUuMzU5NCIgeTI9IjE1MDMuMzU5NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIxNjAiIHgyPSIxNjAiIHkxPSIxNTAzLjM1OTQiIHkyPSIxNzcxLjY4NzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCw0LjA7IiB4MT0iMTYwIiB4Mj0iMTYwIiB5MT0iMTc3MS42ODc1IiB5Mj0iMTc5OS42ODc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjE2MCIgeDI9IjE2MCIgeTE9IjE3OTkuNjg3NSIgeTI9IjI0MTMuNzQyMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSI1MTMiIHgyPSI1MTMiIHkxPSIxMTguNTkzOCIgeTI9IjE0NzUuMzU5NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDQuMDsiIHgxPSI1MTMiIHgyPSI1MTMiIHkxPSIxNDc1LjM1OTQiIHkyPSIxNTAzLjM1OTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iNTEzIiB4Mj0iNTEzIiB5MT0iMTUwMy4zNTk0IiB5Mj0iMTc3MS42ODc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToxLjAsNC4wOyIgeDE9IjUxMyIgeDI9IjUxMyIgeTE9IjE3NzEuNjg3NSIgeTI9IjE3OTkuNjg3NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSI1MTMiIHgyPSI1MTMiIHkxPSIxNzk5LjY4NzUiIHkyPSIyNDEzLjc0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iODY3LjUiIHgyPSI4NjcuNSIgeTE9IjExOC41OTM4IiB5Mj0iMTQ3NS4zNTk0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToxLjAsNC4wOyIgeDE9Ijg2Ny41IiB4Mj0iODY3LjUiIHkxPSIxNDc1LjM1OTQiIHkyPSIxNTAzLjM1OTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iODY3LjUiIHgyPSI4NjcuNSIgeTE9IjE1MDMuMzU5NCIgeTI9IjE3NzEuNjg3NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDQuMDsiIHgxPSI4NjcuNSIgeDI9Ijg2Ny41IiB5MT0iMTc3MS42ODc1IiB5Mj0iMTc5OS42ODc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9Ijg2Ny41IiB4Mj0iODY3LjUiIHkxPSIxNzk5LjY4NzUiIHkyPSIyNDEzLjc0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMTA0MC41IiB4Mj0iMTA0MC41IiB5MT0iMTE4LjU5MzgiIHkyPSIxNDc1LjM1OTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCw0LjA7IiB4MT0iMTA0MC41IiB4Mj0iMTA0MC41IiB5MT0iMTQ3NS4zNTk0IiB5Mj0iMTUwMy4zNTk0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjEwNDAuNSIgeDI9IjEwNDAuNSIgeTE9IjE1MDMuMzU5NCIgeTI9IjE3NzEuNjg3NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDQuMDsiIHgxPSIxMDQwLjUiIHgyPSIxMDQwLjUiIHkxPSIxNzcxLjY4NzUiIHkyPSIxNzk5LjY4NzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMTA0MC41IiB4Mj0iMTA0MC41IiB5MT0iMTc5OS42ODc1IiB5Mj0iMjQxMy43NDIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzAiIHg9IjUiIHk9IjExNS4yOTIiPnVzZXI8L3RleHQ+PGVsbGlwc2UgY3g9IjIzIiBjeT0iNTAuNzk2OSIgZmlsbD0iI0UyRTJGMCIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjMsNTguNzk2OSBMMjMsODUuNzk2OSBNMTAsNjYuNzk2OSBMMzYsNjYuNzk2OSBNMjMsODUuNzk2OSBMMTAsMTAwLjc5NjkgTTIzLDg1Ljc5NjkgTDM2LDEwMC43OTY5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzAiIHg9IjUiIHk9IjI0MjUuNzM3MyI+dXNlcjwvdGV4dD48ZWxsaXBzZSBjeD0iMjMiIGN5PSIyNDM3LjUzOTEiIGZpbGw9IiNFMkUyRjAiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTIzLDI0NDUuNTM5MSBMMjMsMjQ3Mi41MzkxIE0xMCwyNDUzLjUzOTEgTDM2LDI0NTMuNTM5MSBNMjMsMjQ3Mi41MzkxIEwxMCwyNDg3LjUzOTEgTTIzLDI0NzIuNTM5MSBMMzYsMjQ4Ny41MzkxICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3MiIgeD0iMTI0IiB5PSI4Ny4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTgiIHg9IjEzMSIgeT0iMTA3LjI5MiI+QnJvd3NlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjcyIiB4PSIxMjQiIHk9IjI0MTIuNzQyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU4IiB4PSIxMzEiIHk9IjI0MzIuNzM3MyI+QnJvd3NlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijk0IiB4PSI0NjYiIHk9Ijg3LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MCIgeD0iNDczIiB5PSIxMDcuMjkyIj5DQVMgU2VydmVyPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTQiIHg9IjQ2NiIgeT0iMjQxMi43NDIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODAiIHg9IjQ3MyIgeT0iMjQzMi43MzczIj5DQVMgU2VydmVyPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIxIiB4PSI4MDcuNSIgeT0iODcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNyIgeD0iODE0LjUiIHk9IjEwNy4yOTIiPlByb3RlY3RlZCBBcHA8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEiIHg9IjgwNy41IiB5PSIyNDEyLjc0MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDciIHg9IjgxNC41IiB5PSIyNDMyLjczNzMiPlByb3RlY3RlZCBBcHA8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDUiIHg9Ijk2OC41IiB5PSI4Ny4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMxIiB4PSI5NzUuNSIgeT0iMTA3LjI5MiI+UHJvdGVjdGVkIEFwcCAjMjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0NSIgeD0iOTY4LjUiIHk9IjI0MTIuNzQyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMSIgeD0iOTc1LjUiIHk9IjI0MzIuNzM3MyI+UHJvdGVjdGVkIEFwcCAjMjwvdGV4dD48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQ0LjI2NTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIxOCIgeT0iNTkyLjY0ODQiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjEyNzQuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjE1NSIgeT0iMTkyLjg1OTQiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQxNC42NTYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTYwIiB5PSI0NTIuNzE4OCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTk2LjA2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIxNTUiIHk9IjE1NjcuNjI1Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI1MzEuNzg5MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjE1NSIgeT0iMTg2My45NTMxIi8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI5Ni45NjQ4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTYwIiB5PSIxOTk2Ljc1Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI2Mi4zOTg0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNTA4IiB5PSI0NTIuNzE4OCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTYwLjQ5NjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI1MDgiIHk9IjcwNi44Nzg5Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI5NS42NjQxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNTA4IiB5PSIxMDA3LjMwNDciLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9Ijk2Ljk2NDgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI1MDgiIHk9IjE5OTYuNzUiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI1MDgiIHk9IjIxOTIuODEyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTE1LjM2MzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI4NjMiIHk9IjIyMS45OTIyIi8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIzMzYuOTU3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iODYzIiB5PSI5MjkuNzczNCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNzEuMjY1NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9Ijg2MyIgeT0iMTM2Ni45NjA5Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI5Ni45NjQ4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iODYzIiB5PSIxNjM3LjU4OTgiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQ0LjI2NTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIxMDM2IiB5PSIxODkzLjA4NTkiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjEzMi43OTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTAzNiIgeT0iMjEzMy40MTQxIi8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI3MS4yNjU2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iMTAzNiIgeT0iMjI5NS4zNDM4Ii8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIzIiBzdHlsZT0ic3Ryb2tlOiNFRUVFRUU7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMjE0IiB4PSIwIiB5PSIxNDkuMTYwMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjAiIHgyPSIxMjE0IiB5MT0iMTQ5LjE2MDIiIHkyPSIxNDkuMTYwMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjAiIHgyPSIxMjE0IiB5MT0iMTUyLjE2MDIiIHkyPSIxNTIuMTYwMiIvPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMjMuMTMyOCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjA7IiB3aWR0aD0iMTExIiB4PSI1NTEuNSIgeT0iMTM4LjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTIiIHg9IjU1Ny41IiB5PSIxNTQuNjYwNiI+Rmlyc3QgQWNjZXNzPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQzLDE4OC44NTk0LDE1MywxOTIuODU5NCwxNDMsMTk2Ljg1OTQsMTQ3LDE5Mi44NTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMyIgeDI9IjE0OSIgeTE9IjE5Mi44NTk0IiB5Mj0iMTkyLjg1OTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OSIgeD0iMzAiIHk9IjE4Ny43OTM1Ij5Hb3RvICJhcHAiPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODUxLDIxNy45OTIyLDg2MSwyMjEuOTkyMiw4NTEsMjI1Ljk5MjIsODU1LDIyMS45OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjUiIHgyPSI4NTciIHkxPSIyMjEuOTkyMiIgeTI9IjIyMS45OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk2IiB4PSIxNzIiIHk9IjIxNi45MjYzIj5HRVQgaHR0cHM6Ly9hcHAuZXhhbXBsZS5jb20vPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc2LDMzMy4zNTU1LDE2NiwzMzcuMzU1NSwxNzYsMzQxLjM1NTUsMTcyLDMzNy4zNTU1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjIuMCwyLjA7IiB4MT0iMTcwIiB4Mj0iODY3IiB5MT0iMzM3LjM1NTUiIHkyPSIzMzcuMzU1NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMxOCIgeD0iMTgyIiB5PSIzMTcuMTU2NyI+MzAyIExvY2F0aW9uOiBodHRwczovL2Nhcy5leGFtcGxlLmNvbS9jYXMvbG9naW4/PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSIxODIiIHk9IjMzMi4yODk2Ij5zZXJ2aWNlPTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2MCIgeD0iMjM4IiB5PSIzMzIuMjg5NiI+aHR0cHMlM0ElMkYlMkZhcHAuZXhhbXBsZS5jb20lMkY8L3RleHQ+PHBhdGggZD0iTTg3OCwyMzQuOTkyMiBMODc4LDQxMC45OTIyIEwxMTE4LDQxMC45OTIyIEwxMTE4LDI0NC45OTIyIEwxMTA4LDIzNC45OTIyIEw4NzgsMjM0Ljk5MjIgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTEwOCwyMzQuOTkyMiBMMTEwOCwyNDQuOTkyMiBMMTExOCwyNDQuOTkyMiBMMTEwOCwyMzQuOTkyMiAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9Ijg4NCIgeT0iMjUyLjA1OTEiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODciIHg9Ijg4NCIgeT0iMjY3LjE5MTkiPkFjY2VzcyBpcyB1bmF1dGhlbnRpY2F0ZWQgc288L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iODg0IiB5PSIyODIuMzI0NyI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxOSIgeD0iODg0IiB5PSIyOTcuNDU3NSI+Zm9yd2FyZCB0byBDQVMgZm9yIGF1dGhlbnRpY2F0aW9uLjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI4ODQiIHk9IjMxMi41OTAzIj4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY5IiB4PSI4ODQiIHk9IjMyNy43MjMxIj4ic2VydmljZSIgcXVlcnkgcGFyYW1ldGVyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9Ijg4NCIgeT0iMzQyLjg1NiI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NiIgeD0iODg0IiB5PSIzNTcuOTg4OCI+aHR0cHM6Ly9hcHAuZXhhbXBsZS5jb20vPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9Ijg4NCIgeT0iMzczLjEyMTYiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OCIgeD0iODg0IiB5PSIzODguMjU0NCI+aXMgVVJMIGVuY29kZWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iODg0IiB5PSI0MDMuMzg3MiI+JiMxNjA7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDk2LDQ0OC43MTg4LDUwNiw0NTIuNzE4OCw0OTYsNDU2LjcxODgsNTAwLDQ1Mi43MTg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNzAiIHgyPSI1MDIiIHkxPSI0NTIuNzE4OCIgeTI9IjQ1Mi43MTg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU3IiB4PSIxNzciIHk9IjQzMi41MiI+R0VUIGh0dHBzOi8vY2FzLmV4YW1wbGUuY29tL2Nhcy9sb2dpbj88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTYiIHg9IjE3NyIgeT0iNDQ3LjY1MjgiPnNlcnZpY2U9PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYwIiB4PSIyMzMiIHk9IjQ0Ny42NTI4Ij5odHRwcyUzQSUyRiUyRmFwcC5leGFtcGxlLmNvbSUyRjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE4MSw1MTEuMTE3MiwxNzEsNTE1LjExNzIsMTgxLDUxOS4xMTcyLDE3Nyw1MTUuMTE3MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToyLjAsMi4wOyIgeDE9IjE3NSIgeDI9IjUxMiIgeTE9IjUxNS4xMTcyIiB5Mj0iNTE1LjExNzIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDEiIHg9IjE4NyIgeT0iNTEwLjA1MTMiPkNBUyBMb2dpbiBGb3JtPC90ZXh0PjxwYXRoIGQ9Ik01MjMsNDY1LjcxODggTDUyMyw1NTAuNzE4OCBMNzkxLDU1MC43MTg4IEw3OTEsNDc1LjcxODggTDc4MSw0NjUuNzE4OCBMNTIzLDQ2NS43MTg4ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTc4MSw0NjUuNzE4OCBMNzgxLDQ3NS43MTg4IEw3OTEsNDc1LjcxODggTDc4MSw0NjUuNzE4OCAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9IjUyOSIgeT0iNDgyLjc4NTYiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDciIHg9IjUyOSIgeT0iNDk3LjkxODUiPlVzZXIgZG9lcyBub3QgaGF2ZSBhbiBTU08gU2Vzc2lvbiBzbzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI1MjkiIHk9IjUxMy4wNTEzIj4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE4IiB4PSI1MjkiIHk9IjUyOC4xODQxIj5wcmVzZW50IGxvZ2luIGZvcm08L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iNTI5IiB5PSI1NDMuMzE2OSI+JiMxNjA7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzksNTg4LjY0ODQsMjksNTkyLjY0ODQsMzksNTk2LjY0ODQsMzUsNTkyLjY0ODQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjMzIiB4Mj0iMTU5IiB5MT0iNTkyLjY0ODQiIHkyPSI1OTIuNjQ4NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc3IiB4PSI0NSIgeT0iNTcyLjQ0OTciPkRpc3BsYXkgQ0FTPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcxIiB4PSI0NSIgeT0iNTg3LjU4MjUiPkxvZ2luIEZvcm08L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDgsNjMyLjkxNDEsMTU4LDYzNi45MTQxLDE0OCw2NDAuOTE0MSwxNTIsNjM2LjkxNDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIyMyIgeDI9IjE1NCIgeTE9IjYzNi45MTQxIiB5Mj0iNjM2LjkxNDEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NSIgeD0iMzAiIHk9IjYxNi43MTUzIj5TdWJtaXQgQ0FTPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcxIiB4PSIzMCIgeT0iNjMxLjg0ODEiPkxvZ2luIEZvcm08L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OTYsNzAyLjg3ODksNTA2LDcwNi44Nzg5LDQ5Niw3MTAuODc4OSw1MDAsNzA2Ljg3ODkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE3MCIgeDI9IjUwMiIgeTE9IjcwNi44Nzg5IiB5Mj0iNzA2Ljg3ODkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjUiIHg9IjE3NyIgeT0iNjg2LjY4MDIiPlBPU1QgaHR0cHM6Ly9jYXMuZXhhbXBsZS5jb20vY2FzL2xvZ2luPzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iMTc3IiB5PSI3MDEuODEzIj5zZXJ2aWNlPTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2MCIgeD0iMjMzIiB5PSI3MDEuODEzIj5odHRwcyUzQSUyRiUyRmFwcC5leGFtcGxlLmNvbSUyRjwvdGV4dD48cGF0aCBkPSJNNTIzLDY0OS45MTQxIEw1MjMsNzM0LjkxNDEgTDc4NCw3MzQuOTE0MSBMNzg0LDY1OS45MTQxIEw3NzQsNjQ5LjkxNDEgTDUyMyw2NDkuOTE0MSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03NzQsNjQ5LjkxNDEgTDc3NCw2NTkuOTE0MSBMNzg0LDY1OS45MTQxIEw3NzQsNjQ5LjkxNDEgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI1MjkiIHk9IjY2Ni45ODEiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDAiIHg9IjUyOSIgeT0iNjgyLjExMzgiPnVzZXJuYW1lLCBwYXNzd29yZCwgYW5kIGxvZ2luIHRpY2tldDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI1MjkiIHk9IjY5Ny4yNDY2Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUxIiB4PSI1MjkiIHk9IjcxMi4zNzk0Ij5hcmUgUE9TVGVkIGluIHRoZSBib2R5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9IjUyOSIgeT0iNzI3LjUxMjIiPiYjMTYwOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1MTgiIHgyPSI1NjAiIHkxPSI3NjEuNzEwOSIgeTI9Ijc2MS43MTA5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTYwIiB4Mj0iNTYwIiB5MT0iNzYxLjcxMDkiIHkyPSI3NzQuNzEwOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjUxOSIgeDI9IjU2MCIgeTE9Ijc3NC43MTA5IiB5Mj0iNzc0LjcxMDkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUyOSw3NzAuNzEwOSw1MTksNzc0LjcxMDksNTI5LDc3OC43MTA5LDUyNSw3NzQuNzEwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0IiB4PSI1MjUiIHk9Ijc1Ni42NDUiPkF1dGhlbnRpY2F0ZSB1c2VyPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc2LDg2My4zNzUsMTY2LDg2Ny4zNzUsMTc2LDg3MS4zNzUsMTcyLDg2Ny4zNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIxNzAiIHgyPSI1MTIiIHkxPSI4NjcuMzc1IiB5Mj0iODY3LjM3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyOCIgeD0iMTgyIiB5PSI4MzIuMDQzNSI+U2V0LUNvb2tpZTogQ0FTVEdDPVRHVC0yMzQ1Njc4PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2NCIgeD0iMTgyIiB5PSI4NDcuMTc2MyI+MzAyIExvY2F0aW9uOiBodHRwczovL2FwcC5leGFtcGxlLmNvbS8/PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMCIgeD0iMTgyIiB5PSI4NjIuMzA5MSI+dGlja2V0PVNULTEyMzQ1Njc4PC90ZXh0PjxwYXRoIGQ9Ik01MjMsNzg3LjcxMDkgTDUyMyw5MDIuNzEwOSBMOTI1LDkwMi43MTA5IEw5MjUsNzk3LjcxMDkgTDkxNSw3ODcuNzEwOSBMNTIzLDc4Ny43MTA5ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTkxNSw3ODcuNzEwOSBMOTE1LDc5Ny43MTA5IEw5MjUsNzk3LjcxMDkgTDkxNSw3ODcuNzEwOSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9IjUyOSIgeT0iODA0Ljc3NzgiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzODEiIHg9IjUyOSIgeT0iODE5LjkxMDYiPlVzZXIgaXMgYXV0aGVudGljYXRlZCBzbyBjcmVhdGUgU2luZ2xlLXNpZ25vbiAoU1NPKSBzZXNzaW9uPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9IjUyOSIgeT0iODM1LjA0MzUiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNjQiIHg9IjUyOSIgeT0iODUwLjE3NjMiPkNBU1RHQyBjb29raWUgY29udGFpbnMgdGhlIFRpY2tldCBHcmFudGluZyBUaWNrZXQgKFRHVCk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iNTI5IiB5PSI4NjUuMzA5MSI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0MCIgeD0iNTI5IiB5PSI4ODAuNDQxOSI+VGhlIFRHVCBpcyB0aGUgc2Vzc2lvbiBrZXkgZm9yIHRoZSB1c2VycyBTU08gc2Vzc2lvbjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI1MjkiIHk9Ijg5NS41NzQ3Ij4mIzE2MDs8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4NTEsOTI1Ljc3MzQsODYxLDkyOS43NzM0LDg1MSw5MzMuNzczNCw4NTUsOTI5Ljc3MzQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2NSIgeDI9Ijg1NyIgeTE9IjkyOS43NzM0IiB5Mj0iOTI5Ljc3MzQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMzMiIHg9IjE3MiIgeT0iOTI0LjcwNzUiPkdFVCBodHRwczovL2FwcC5leGFtcGxlLmNvbS8/dGlja2V0PVNULTEyMzQ1Njc4PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTI5LDEwMDMuMzA0Nyw1MTksMTAwNy4zMDQ3LDUyOSwxMDExLjMwNDcsNTI1LDEwMDcuMzA0NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTIzIiB4Mj0iODYyIiB5MT0iMTAwNy4zMDQ3IiB5Mj0iMTAwNy4zMDQ3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjk5IiB4PSI1MzUiIHk9Ijk3MS45NzMxIj5HRVQgaHR0cHM6Ly9jYXMuZXhhbXBsZS5jb20vc2VydmljZVZhbGlkYXRlPzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iNTM1IiB5PSI5ODcuMTA2Ij5zZXJ2aWNlPTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3MCIgeD0iNTkxIiB5PSI5ODcuMTA2Ij5odHRwcyUzQSUyRiUyRmFwcC5leGFtcGxlLmNvbSUyRiZhbXA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1NyIgeD0iNTM1IiB5PSIxMDAyLjIzODgiPnRpY2tldD1TVC0xMjM0NTY3OCZsdDsvaSZndDs8L3RleHQ+PHBhdGggZD0iTTg3OCw5NDIuNzczNCBMODc4LDEwMjcuNzczNCBMMTEyOSwxMDI3Ljc3MzQgTDExMjksOTUyLjc3MzQgTDExMTksOTQyLjc3MzQgTDg3OCw5NDIuNzczNCAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMTE5LDk0Mi43NzM0IEwxMTE5LDk1Mi43NzM0IEwxMTI5LDk1Mi43NzM0IEwxMTE5LDk0Mi43NzM0ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iODg0IiB5PSI5NTkuODQwMyI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwMyIgeD0iODg0IiB5PSI5NzQuOTczMSI+UHJvdGVjdGVkIGFwcCB2YWxpZGF0ZXMgU2VydmljZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI4ODQiIHk9Ijk5MC4xMDYiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzAiIHg9Ijg4NCIgeT0iMTAwNS4yMzg4Ij5UaWNrZXQgKFNUKSBhdCBDQVMgc2VydmVyIG92ZXIgaHR0cHM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iODg0IiB5PSIxMDIwLjM3MTYiPiYjMTYwOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg1MSwxMDk4Ljk2ODgsODYxLDExMDIuOTY4OCw4NTEsMTEwNi45Njg4LDg1NSwxMTAyLjk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSI1MTMiIHgyPSI4NTciIHkxPSIxMTAyLjk2ODgiIHkyPSIxMTAyLjk2ODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkiIHg9IjUyMCIgeT0iMTA5Ny45MDI4Ij4yMDAgW1hNTCBDb250ZW50XTwvdGV4dD48cGF0aCBkPSJNMTkwLDEwMzguNDM3NSBMMTkwLDExNTMuNDM3NSBMNTAzLDExNTMuNDM3NSBMNTAzLDEwNDguNDM3NSBMNDkzLDEwMzguNDM3NSBMMTkwLDEwMzguNDM3NSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00OTMsMTAzOC40Mzc1IEw0OTMsMTA0OC40Mzc1IEw1MDMsMTA0OC40Mzc1IEw0OTMsMTAzOC40Mzc1ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iMTk2IiB5PSIxMDU1LjUwNDQiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOTIiIHg9IjE5NiIgeT0iMTA3MC42MzcyIj5DQVMgcmV0dXJucyBhbiBYTUwgZG9jdW1lbnQgd2hpY2ggaW5jbHVkZXM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iMTk2IiB5PSIxMDg1Ljc3Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjc1IiB4PSIxOTYiIHk9IjExMDAuOTAyOCI+YW4gaW5kaWNhdGlvbiBvZiBzdWNjZXNzLCB0aGUgYXV0aGVudGljYXRlZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSIxOTYiIHk9IjExMTYuMDM1NiI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxMCIgeD0iMTk2IiB5PSIxMTMxLjE2ODUiPnN1YmplY3QsIGFuZCBvcHRpb25hbGx5IGF0dHJpYnV0ZXM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iMTk2IiB5PSIxMTQ2LjMwMTMiPiYjMTYwOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3NiwxMjYyLjczMDUsMTY2LDEyNjYuNzMwNSwxNzYsMTI3MC43MzA1LDE3MiwxMjY2LjczMDUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIxNzAiIHgyPSI4NjciIHkxPSIxMjY2LjczMDUiIHkyPSIxMjY2LjczMDUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDEiIHg9IjE4MiIgeT0iMTI0Ni41MzE3Ij5TZXQtQ29va2llOiBKU0VTU0lPTklEPUFCQzEyMzQ1Njc8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU3IiB4PSIxODIiIHk9IjEyNjEuNjY0NiI+MzAyIExvY2F0aW9uOiBodHRwczovL2FwcC5leGFtcGxlLmNvbS88L3RleHQ+PHBhdGggZD0iTTg3OCwxMTY0LjM2NzIgTDg3OCwxMzQwLjM2NzIgTDExNTYsMTM0MC4zNjcyIEwxMTU2LDExNzQuMzY3MiBMMTE0NiwxMTY0LjM2NzIgTDg3OCwxMTY0LjM2NzIgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTE0NiwxMTY0LjM2NzIgTDExNDYsMTE3NC4zNjcyIEwxMTU2LDExNzQuMzY3MiBMMTE0NiwxMTY0LjM2NzIgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI4ODQiIHk9IjExODEuNDM0MSI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNSIgeD0iODg0IiB5PSIxMTk2LjU2NjkiPlNldCB0aGUgc2Vzc2lvbiBjb29raWUgYW5kIGZvcndhcmQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iODg0IiB5PSIxMjExLjY5OTciPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNTciIHg9Ijg4NCIgeT0iMTIyNi44MzI1Ij50aGUgYnJvd3NlciBiYWNrIHRvIHRoZSBhcHBsaWNhdGlvbiB3aXRoPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9Ijg4NCIgeT0iMTI0MS45NjUzIj4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg4IiB4PSI4ODQiIHk9IjEyNTcuMDk4MSI+dGhlIHNlcnZpY2UgdGlja2V0IHN0cmlwcGVkIG9mZjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI4ODQiIHk9IjEyNzIuMjMxIj4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU1IiB4PSI4ODQiIHk9IjEyODcuMzYzOCI+VGhpcyBvcHRpb25hbCBzdGVwIHByZXZlbnRzIHRoZSBicm93c2VyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9Ijg4NCIgeT0iMTMwMi40OTY2Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjI0IiB4PSI4ODQiIHk9IjEzMTcuNjI5NCI+YWRkcmVzcyBiYXIgZnJvbSBkaXNwbGF5aW5nIHRoZSBTVDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI4ODQiIHk9IjEzMzIuNzYyMiI+JiMxNjA7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODUxLDEzNjIuOTYwOSw4NjEsMTM2Ni45NjA5LDg1MSwxMzcwLjk2MDksODU1LDEzNjYuOTYwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTY1IiB4Mj0iODU3IiB5MT0iMTM2Ni45NjA5IiB5Mj0iMTM2Ni45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDE1IiB4PSIxNzIiIHk9IjEzNjEuODk1Ij5Db29raWU6IEpTRVNTSU9OSUQ9QUJDMTIzNDU2NyBHRVQgaHR0cHM6Ly9hcHAuZXhhbXBsZS5jb20vPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9Ijg3MyIgeDI9IjkxNSIgeTE9IjEzOTYuMDkzOCIgeTI9IjEzOTYuMDkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjkxNSIgeDI9IjkxNSIgeTE9IjEzOTYuMDkzOCIgeTI9IjE0MDkuMDkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9Ijg3NCIgeDI9IjkxNSIgeTE9IjE0MDkuMDkzOCIgeTI9IjE0MDkuMDkzOCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODg0LDE0MDUuMDkzOCw4NzQsMTQwOS4wOTM4LDg4NCwxNDEzLjA5MzgsODgwLDE0MDkuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ5IiB4PSI4ODAiIHk9IjEzOTEuMDI3OCI+VmFsaWRhdGUgc2Vzc2lvbiBjb29raWU8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNzYsMTQzNC4yMjY2LDE2NiwxNDM4LjIyNjYsMTc2LDE0NDIuMjI2NiwxNzIsMTQzOC4yMjY2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjIuMCwyLjA7IiB4MT0iMTcwIiB4Mj0iODY3IiB5MT0iMTQzOC4yMjY2IiB5Mj0iMTQzOC4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjc2IiB4PSIxODIiIHk9IjE0MzMuMTYwNiI+MjAwIFtDb250ZW50IG9mIGh0dHBzOi8vYXBwLmV4YW1wbGUuY29tL108L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNCwxNDYzLjM1OTQsMjQsMTQ2Ny4zNTk0LDM0LDE0NzEuMzU5NCwzMCwxNDY3LjM1OTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIyOCIgeDI9IjE1OSIgeTE9IjE0NjcuMzU5NCIgeTI9IjE0NjcuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg1IiB4PSI0MCIgeT0iMTQ2Mi4yOTM1Ij5EaXNwbGF5ICJhcHAiPC90ZXh0PjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTIxNCIgeD0iMCIgeT0iMTUyMy45MjU4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMCIgeDI9IjEyMTQiIHkxPSIxNTIzLjkyNTgiIHkyPSIxNTIzLjkyNTgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIwIiB4Mj0iMTIxNCIgeTE9IjE1MjYuOTI1OCIgeTI9IjE1MjYuOTI1OCIvPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMjMuMTMyOCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjA7IiB3aWR0aD0iMjkwIiB4PSI0NjIiIHk9IjE1MTMuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNzEiIHg9IjQ2OCIgeT0iMTUyOS40MjYzIj5TZWNvbmQgQWNjZXNzIFRvIFNhbWUgQXBwbGljYXRpb248L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDMsMTU2My42MjUsMTUzLDE1NjcuNjI1LDE0MywxNTcxLjYyNSwxNDcsMTU2Ny42MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjIzIiB4Mj0iMTQ5IiB5MT0iMTU2Ny42MjUiIHkyPSIxNTY3LjYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMyIgeD0iMzAiIHk9IjE1NjIuNTU5MSI+UmVxdWVzdCByZXNvdXJjZTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg1MSwxNjMzLjU4OTgsODYxLDE2MzcuNTg5OCw4NTEsMTY0MS41ODk4LDg1NSwxNjM3LjU4OTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2NSIgeDI9Ijg1NyIgeTE9IjE2MzcuNTg5OCIgeTI9IjE2MzcuNTg5OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxNSIgeD0iMTcyIiB5PSIxNjE3LjM5MTEiPkNvb2tpZTogSlNFU1NJT05JRD1BQkMxMjM0NTY3PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1MiIgeD0iMTcyIiB5PSIxNjMyLjUyMzkiPkdFVCBodHRwczovL2FwcC5leGFtcGxlLmNvbS9yZXNvdXJjZTwvdGV4dD48cGF0aCBkPSJNODc4LDE1ODAuNjI1IEw4NzgsMTY2NS42MjUgTDEwNDMsMTY2NS42MjUgTDEwNDMsMTU5MC42MjUgTDEwMzMsMTU4MC42MjUgTDg3OCwxNTgwLjYyNSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMDMzLDE1ODAuNjI1IEwxMDMzLDE1OTAuNjI1IEwxMDQzLDE1OTAuNjI1IEwxMDMzLDE1ODAuNjI1ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iODg0IiB5PSIxNTk3LjY5MTkiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDIiIHg9Ijg4NCIgeT0iMTYxMi44MjQ3Ij5TZXNzaW9uIENvb2tpZSBpcyBzZW50PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQiIHg9Ijg4NCIgeT0iMTYyNy45NTc1Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ0IiB4PSI4ODQiIHk9IjE2NDMuMDkwMyI+YWxvbmcgd2l0aCB0aGUgcmVxdWVzdDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0IiB4PSI4ODQiIHk9IjE2NTguMjIzMSI+JiMxNjA7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9Ijg3MyIgeDI9IjkxNSIgeTE9IjE2OTIuNDIxOSIgeTI9IjE2OTIuNDIxOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjkxNSIgeDI9IjkxNSIgeTE9IjE2OTIuNDIxOSIgeTI9IjE3MDUuNDIxOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9Ijg3NCIgeDI9IjkxNSIgeTE9IjE3MDUuNDIxOSIgeTI9IjE3MDUuNDIxOSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODg0LDE3MDEuNDIxOSw4NzQsMTcwNS40MjE5LDg4NCwxNzA5LjQyMTksODgwLDE3MDUuNDIxOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ5IiB4PSI4ODAiIHk9IjE2ODcuMzU2Ij5WYWxpZGF0ZSBzZXNzaW9uIGNvb2tpZTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3NiwxNzMwLjU1NDcsMTY2LDE3MzQuNTU0NywxNzYsMTczOC41NTQ3LDE3MiwxNzM0LjU1NDciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIxNzAiIHgyPSI4NjciIHkxPSIxNzM0LjU1NDciIHkyPSIxNzM0LjU1NDciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjMiIHg9IjE4MiIgeT0iMTcyOS40ODg4Ij4iMjAwIFtSZXNvdXJjZSBDb250ZW50XSI8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNCwxNzU5LjY4NzUsMjQsMTc2My42ODc1LDM0LDE3NjcuNjg3NSwzMCwxNzYzLjY4NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIyOCIgeDI9IjE1OSIgeTE9IjE3NjMuNjg3NSIgeTI9IjE3NjMuNjg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNyIgeD0iNDAiIHk9IjE3NTguNjIxNiI+RGlzcGxheSByZXNvdXJjZTwvdGV4dD48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjMiIHN0eWxlPSJzdHJva2U6I0VFRUVFRTtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEyMTQiIHg9IjAiIHk9IjE4MjAuMjUzOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjAiIHgyPSIxMjE0IiB5MT0iMTgyMC4yNTM5IiB5Mj0iMTgyMC4yNTM5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMCIgeDI9IjEyMTQiIHkxPSIxODIzLjI1MzkiIHkyPSIxODIzLjI1MzkiLz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjIzLjEzMjgiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6Mi4wOyIgd2lkdGg9IjI4NSIgeD0iNDY0LjUiIHk9IjE4MDkuNjg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjYiIHg9IjQ3MC41IiB5PSIxODI1Ljc1NDQiPkZpcnN0IEFjY2VzcyBUbyBTZWNvbmQgQXBwbGljYXRpb248L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDMsMTg1OS45NTMxLDE1MywxODYzLjk1MzEsMTQzLDE4NjcuOTUzMSwxNDcsMTg2My45NTMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMyIgeDI9IjE0OSIgeTE9IjE4NjMuOTUzMSIgeTI9IjE4NjMuOTUzMSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc3IiB4PSIzMCIgeT0iMTg1OC44ODcyIj5Hb3RvICJhcHAyIjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMjQsMTg4OS4wODU5LDEwMzQsMTg5My4wODU5LDEwMjQsMTg5Ny4wODU5LDEwMjgsMTg5My4wODU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjUiIHgyPSIxMDMwIiB5MT0iMTg5My4wODU5IiB5Mj0iMTg5My4wODU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjA0IiB4PSIxNzIiIHk9IjE4ODguMDIiPkdFVCBodHRwczovL2FwcDIuZXhhbXBsZS5jb20vPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc2LDE5MzMuMzUxNiwxNjYsMTkzNy4zNTE2LDE3NiwxOTQxLjM1MTYsMTcyLDE5MzcuMzUxNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToyLjAsMi4wOyIgeDE9IjE3MCIgeDI9IjEwNDAiIHkxPSIxOTM3LjM1MTYiIHkyPSIxOTM3LjM1MTYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMTgiIHg9IjE4MiIgeT0iMTkxNy4xNTI4Ij4zMDIgTG9jYXRpb246IGh0dHBzOi8vY2FzLmV4YW1wbGUuY29tL2Nhcy9sb2dpbj88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTYiIHg9IjE4MiIgeT0iMTkzMi4yODU2Ij5zZXJ2aWNlPTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2OCIgeD0iMjM4IiB5PSIxOTMyLjI4NTYiPmh0dHBzJTNBJTJGJTJGYXBwMi5leGFtcGxlLmNvbSUyRjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ5NiwxOTkyLjc1LDUwNiwxOTk2Ljc1LDQ5NiwyMDAwLjc1LDUwMCwxOTk2Ljc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNzAiIHgyPSI1MDIiIHkxPSIxOTk2Ljc1IiB5Mj0iMTk5Ni43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwMiIgeD0iMTc3IiB5PSIxOTYxLjQxODUiPkNvb2tpZTogQ0FTVEdDPVRHVC0yMzQ1Njc4PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1NyIgeD0iMTc3IiB5PSIxOTc2LjU1MTMiPkdFVCBodHRwczovL2Nhcy5leGFtcGxlLmNvbS9jYXMvbG9naW4/PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSIxNzciIHk9IjE5OTEuNjg0MSI+c2VydmljZT08L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjgiIHg9IjIzMyIgeT0iMTk5MS42ODQxIj5odHRwcyUzQSUyRiUyRmFwcDIuZXhhbXBsZS5jb20lMkY8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTE4IiB4Mj0iNTYwIiB5MT0iMjAyNS44ODI4IiB5Mj0iMjAyNS44ODI4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTYwIiB4Mj0iNTYwIiB5MT0iMjAyNS44ODI4IiB5Mj0iMjAzOC44ODI4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTE5IiB4Mj0iNTYwIiB5MT0iMjAzOC44ODI4IiB5Mj0iMjAzOC44ODI4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MjksMjAzNC44ODI4LDUxOSwyMDM4Ljg4MjgsNTI5LDIwNDIuODgyOCw1MjUsMjAzOC44ODI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MiIgeD0iNTI1IiB5PSIyMDIwLjgxNjkiPlZhbGlkYXRlIFRHVDwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3NiwyMDg5LjcxNDgsMTY2LDIwOTMuNzE0OCwxNzYsMjA5Ny43MTQ4LDE3MiwyMDkzLjcxNDgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIxNzAiIHgyPSI1MTIiIHkxPSIyMDkzLjcxNDgiIHkyPSIyMDkzLjcxNDgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDQiIHg9IjE4MiIgeT0iMjA3My41MTYxIj5Mb2NhdGlvbjogaHR0cHM6Ly9hcHAyLmV4YW1wbGUuY29tLz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0IiB4PSIxODIiIHk9IjIwODguNjQ4OSI+dGlja2V0PVNULTM0NTY3ODwvdGV4dD48cGF0aCBkPSJNNTIzLDIwNTEuODgyOCBMNTIzLDIxMDYuODgyOCBMODMxLDIxMDYuODgyOCBMODMxLDIwNjEuODgyOCBMODIxLDIwNTEuODgyOCBMNTIzLDIwNTEuODgyOCAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik04MjEsMjA1MS44ODI4IEw4MjEsMjA2MS44ODI4IEw4MzEsMjA2MS44ODI4IEw4MjEsMjA1MS44ODI4ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iNTI5IiB5PSIyMDY4Ljk0OTciPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyODciIHg9IjUyOSIgeT0iMjA4NC4wODI1Ij5DQVMgdmFsaWRhdGVzIHRoZSBUR1Qgc28gbm8gbG9naW4gaXMgcmVxdWlyZWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNCIgeD0iNTI5IiB5PSIyMDk5LjIxNTMiPiYjMTYwOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMjQsMjEyOS40MTQxLDEwMzQsMjEzMy40MTQxLDEwMjQsMjEzNy40MTQxLDEwMjgsMjEzMy40MTQxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjUiIHgyPSIxMDMwIiB5MT0iMjEzMy40MTQxIiB5Mj0iMjEzMy40MTQxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQxIiB4PSIxNzIiIHk9IjIxMjguMzQ4MSI+R0VUIGh0dHBzOi8vYXBwMi5leGFtcGxlLmNvbS8/dGlja2V0PVNULTEyMzQ1Njc4PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTI5LDIxODguODEyNSw1MTksMjE5Mi44MTI1LDUyOSwyMTk2LjgxMjUsNTI1LDIxOTIuODEyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTIzIiB4Mj0iMTAzNSIgeTE9IjIxOTIuODEyNSIgeTI9IjIxOTIuODEyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI5OSIgeD0iNTM1IiB5PSIyMTU3LjQ4MSI+R0VUIGh0dHBzOi8vY2FzLmV4YW1wbGUuY29tL3NlcnZpY2VWYWxpZGF0ZT88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTYiIHg9IjUzNSIgeT0iMjE3Mi42MTM4Ij5zZXJ2aWNlPTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3OCIgeD0iNTkxIiB5PSIyMTcyLjYxMzgiPmh0dHBzJTNBJTJGJTJGYXBwMi5leGFtcGxlLmNvbSUyRiZhbXA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1NyIgeD0iNTM1IiB5PSIyMTg3Ljc0NjYiPnRpY2tldD1TVC0xMjM0NTY3OCZsdDsvaSZndDs8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDI0LDIyMTcuOTQ1MywxMDM0LDIyMjEuOTQ1MywxMDI0LDIyMjUuOTQ1MywxMDI4LDIyMjEuOTQ1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToyLjAsMi4wOyIgeDE9IjUxMyIgeDI9IjEwMzAiIHkxPSIyMjIxLjk0NTMiIHkyPSIyMjIxLjk0NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkiIHg9IjUyMCIgeT0iMjIxNi44Nzk0Ij4yMDAgW1hNTCBDb250ZW50XTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3NiwyMjYyLjIxMDksMTY2LDIyNjYuMjEwOSwxNzYsMjI3MC4yMTA5LDE3MiwyMjY2LjIxMDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIxNzAiIHgyPSIxMDQwIiB5MT0iMjI2Ni4yMTA5IiB5Mj0iMjI2Ni4yMTA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjkxIiB4PSIxODIiIHk9IjIyNDYuMDEyMiI+U2V0LUNvb2tpZTogTU9EX0FVVEhfQ0FTX1M9WFlaMTIzNDU2NzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjUiIHg9IjE4MiIgeT0iMjI2MS4xNDUiPjMwMiBMb2NhdGlvbjogaHR0cHM6Ly9hcHAyLmV4YW1wbGUuY29tLzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMjQsMjI5MS4zNDM4LDEwMzQsMjI5NS4zNDM4LDEwMjQsMjI5OS4zNDM4LDEwMjgsMjI5NS4zNDM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjUiIHgyPSIxMDMwIiB5MT0iMjI5NS4zNDM4IiB5Mj0iMjI5NS4zNDM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDczIiB4PSIxNzIiIHk9IjIyOTAuMjc3OCI+Q29va2llOiBNT0RfQVVUSF9DQVNfUz1YWVoxMjM0NTY3IEdFVCBodHRwczovL2FwcDIuZXhhbXBsZS5jb20vPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEwNDYiIHgyPSIxMDg4IiB5MT0iMjMyNC40NzY2IiB5Mj0iMjMyNC40NzY2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTA4OCIgeDI9IjEwODgiIHkxPSIyMzI0LjQ3NjYiIHkyPSIyMzM3LjQ3NjYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMDQ3IiB4Mj0iMTA4OCIgeTE9IjIzMzcuNDc2NiIgeTI9IjIzMzcuNDc2NiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTA1NywyMzMzLjQ3NjYsMTA0NywyMzM3LjQ3NjYsMTA1NywyMzQxLjQ3NjYsMTA1MywyMzM3LjQ3NjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0OSIgeD0iMTA1MyIgeT0iMjMxOS40MTA2Ij5WYWxpZGF0ZSBzZXNzaW9uIGNvb2tpZTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3NiwyMzYyLjYwOTQsMTY2LDIzNjYuNjA5NCwxNzYsMjM3MC42MDk0LDE3MiwyMzY2LjYwOTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIxNzAiIHgyPSIxMDQwIiB5MT0iMjM2Ni42MDk0IiB5Mj0iMjM2Ni42MDk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjg0IiB4PSIxODIiIHk9IjIzNjEuNTQzNSI+MjAwIFtDb250ZW50IG9mIGh0dHBzOi8vYXBwMi5leGFtcGxlLmNvbS9dPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzQsMjM5MS43NDIyLDI0LDIzOTUuNzQyMiwzNCwyMzk5Ljc0MjIsMzAsMjM5NS43NDIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjIuMCwyLjA7IiB4MT0iMjgiIHgyPSIxNTkiIHkxPSIyMzk1Ljc0MjIiIHkyPSIyMzk1Ljc0MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MyIgeD0iNDAiIHk9IjIzOTAuNjc2MyI+RGlzcGxheSAiYXBwMiI8L3RleHQ+PCEtLVNSQz1bbExUX0otRDY0RnRWZHNBS3dqZjM4ZTZRX2I5NEUyTS04eHFBSWVJVHdqZm9HWGp4R19QbWxFeGtFZkhsdHpkcm5oNFRubzRqQWE4NG5wbGhzVlZVcDNuXzhuelAwZ0N1ZXpTeWVZOW43Q0xLSkZsVzNOcU8yVnVhZ0cyVjlHeW54VmhpOFU0OS1GSWxaMk9YWFZVQ0YwWW9UMW1JQVl1V3FxazlYQWRaZjRHZTVoQUs5MGV3VGZVRWxaVWd0VERGeVFiT3NUalV4VlA0UzRMM0hJQ09mZ2JQQ01iUjBMLXYtSUJOU0dPM2s2SDJBWFk2OFBLSTFXRjdjS0J0MGFSRzd0RjVlS0RtSXlTUFhlZ2pZQTh3alA2LUZ1NC1aM3k0aTUwZ2JWc0o0cnBNZXQtSlBIaEpOaVlOOS1RdVVTWDRYdm50a29SY3hESTVBbnVJbk5aSUJ3OTM4WWxIVTdxSXltVU1sQmpCNDlHTDItZFdkNXNPdk1fRVhjX1NJX29qRkhBX0VKelg1dXdKdTViMWk4VTVTWG9lX1RYWkNXYlBHWkFyZTBjMkgzR21hYy1sZGRGbkg0RzRZOEVjMDItWDU4R2R3NnQ3VDZvLTdLMy1uSkNXM3NIOTVITlJJdFRaTHItOS1LdmxobTNyWEZBQjc4U2M0UFhaN2wzWkUxNmpTZThxVWJLTU52SzdLajlDeVItdDVlRU41eS1MdFhxa2tMWXM0cFZMUEhEbkFsTXZPSzVNNTBXTWNOLTNYSTRiS2o1OE8yZ2VIQlIwZDQ3cGp6bldMeTczcXg4X3h5QWVaX0tncXZXeXctcGthZDl3blVBZmdINVQ5N3RtaXpjSWdVdDVmUnNkNndtZER0eG1fdWpVanZtNEhOWUNPZkpvWU9sZTZDNkJCMmdldktWUTQ0SzREVmJZUlVYTDJtZXA3WnRfTS1zTGFWT2k2aURJMFBlYUl6aG1nVWZ3ZDMtb2xDYTZPc3lHWjhFa1VfUlR6cF95LUREVHFqbjd3Zk00SUVSNzZfWDF6cmlSXzBBWE9SdExrbUU0V2tleVJQVU5VUFRfWW1leTBmYkJTN2twRjdDOHBLN204cjY0OVRBMDZQWXlPMm9tR1VFTXcta3RVQ2daeE9xMjdKNEVUNjh3czN1RzdrY3B3S2h3RW1zV0QxTEhmQkRCd2dNaGVmLXRqX0R0SkoyTWt5ZGExVHQ0WWxldDRoQzhtbXdKLVRURExFeE5fY1JvdVBRbWllLU1QZnBZYW5rR2pacHVtSDRHS3pXV3BVVzVobC1PRENsOGJkNlRoRE5oZGZ4MmR2LWtoeTEzb2I1NWRzc0lDUHNoSGZNMGUyZUpBMHJpUVpla3VjNnNyOXRoUVM3MjFIUFc2NlNIYkdyTGNrM0RvOHVadTdFR2NIYm5ucU9KNUg1bDF5aml6V04xb1JpMUpfS005OHdWeVRuQWk1Y2NnRG9qOEpsSWd2TndZX18xenBfVV9GaG5fTTB1eVluQkJvdE1UWUJuQ0hOZnN2aEljVGlubEhyWmNmUHJQcENJRmtmMVJjMTlxdFdEc0hESlktUDhBcXhSODQ0WTljY0FHa0JwVUxFMU9jY2s4U0lyREROM1B1TldvdDhRM0dINmFUMk1QNE80cDBMVkdmSkY3enFKVEEwVnhFMVdpZ2RTTGxXRmk2YUprei13R2NqV2JxV3QwaFZZcmdoUmpWX2RVaWZKaXFEZnA1ZzNNTXI5RTMxd2xQeHZIOFZnSy1vU3FUZ3gxSG55NzZSUW9IT2FRamtBUXdWdkpCeExyWGl6QlVCQUNuN0lnWEtmeEVpVXFSUjFqamN2TlI4dlVsYzNURV9NUGdIMTBaNTdpaEtHM1VDWUpfeV9KemUzMjRLcUVlUklNdGttZWQ1clRYMDg2bU90T0JJSE03ZERxMW5RS1hqT2hCel9rOHFsOEV4czZ1WXhLemprU0xKdHJMejJ0NFAzTGFSRERVVFFjeTBzTV9DUVBqbXpvOHNscExXWDRTb2R2Q0NRc3hReHNzSXpuNkJmVVJVUG5DZlE2eEhPMlJVVTU0ajVMbTRKdlBVVFRYUzNYSXhzbzZBRmJLNmtLMkVsUk1SU2J4a1BZZzVtTW5uNXVwbnNnbUZ2LWtSel9OMFFfN29GY0RfeFdxLV9feDVfQURVaGdBUmEwa016cHBZZUYyVGt6cUJsa2d6TGtRdDNuc3NSRmt3RXlVRk12aXlfXS0tPjwvZz48L3N2Zz4='>

<p>如果流程中有某个复杂逻辑判断，可以单独添加活动图描述条件分支</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0NThweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQ1NnB4O2hlaWdodDo0NThweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0NTYgNDU4IiB3aWR0aD0iNDU2cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTIiIHg9IjIwNS42MjUiIHk9IjExIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIiIHg9IjIxNS42MjUiIHk9IjMyLjEzODciPiYjMzYxMzQ7JiMyMTQ5NTsmIzIzNDk0OyYjMzA3MjE7JiMzMDMzMTsmIzM4NDcwOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjIyNC4xMjUsNjQuOTY4OCwyNzkuMTI1LDY0Ljk2ODgsMjkxLjEyNSw3Ni45Njg4LDI3OS4xMjUsODguOTY4OCwyMjQuMTI1LDg4Ljk2ODgsMjEyLjEyNSw3Ni45Njg4LDIyNC4xMjUsNjQuOTY4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUiIHg9IjIyNC4xMjUiIHk9IjgwLjc3NjkiPiYjMzYxMzQ7JiMyMTQ5NTsmIzE5OTgxOyYjMjMzODQ7JiMyMjMxMjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjE5MS4xMjUiIHk9Ijc0LjM3NDUiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNCIgeD0iMjkxLjEyNSIgeT0iNzQuMzc0NSI+bm88L3RleHQ+PHBhdGggZD0iTTEwLDk4Ljk2ODggTDEwLDEyNC4xMDE2IEEwLDAgMCAwIDAgMTAsMTI0LjEwMTYgTDE0MiwxMjQuMTAxNiBBMCwwIDAgMCAwIDE0MiwxMjQuMTAxNiBMMTQyLDExNi45Njg4IEwxNjIsMTExLjUzNTIgTDE0MiwxMDguOTY4OCBMMTQyLDEwOC45Njg4IEwxMzIsOTguOTY4OCBMMTAsOTguOTY4OCBBMCwwIDAgMCAwIDEwLDk4Ljk2ODggIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTMyLDk4Ljk2ODggTDEzMiwxMDguOTY4OCBMMTQyLDEwOC45Njg4IEwxMzIsOTguOTY4OCAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMSIgeD0iMTYiIHk9IjExNi4wMzU2Ij4mIzM4NjU2OyYjMzUyMDE7JiMzNTc2MDsmIzI0NDA1OyYjMjI4MzM7JiMzNjEzMzsmIzI3NDI1OyYjMjU5Njg7PzwvdGV4dD48ZWxsaXBzZSBjeD0iMTczIiBjeT0iMTExLjUzNTIiIGZpbGw9Im5vbmUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjEuMDsiLz48ZWxsaXBzZSBjeD0iMTczIiBjeT0iMTExLjUzNTIiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMTExMTExO3N0cm9rZS13aWR0aDoxLjA7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkyIiB4PSIyODQuMjUiIHk9Ijk4Ljk2ODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MiIgeD0iMjk0LjI1IiB5PSIxMjAuMTA3NCI+JiMzNjEzNDsmIzIxNDk1OyYjMjM0OTQ7JiMzMDcyMTsmIzIxMzA1OyYjMzcxOTc7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MSIgeD0iMjg5Ljc1IiB5PSIyMDEuMzM5OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3IiB4PSIzMDMuNzUiIHk9IjIyMi40Nzg1Ij4mIzMzNzE5OyYjMjE0NjI7JiMyNDQwMzsmIzIxMDY5O0lQPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMzAzLjc1LDI1NS4zMDg2LDM1Ni43NSwyNTUuMzA4NiwzNjguNzUsMjY3LjMwODYsMzU2Ljc1LDI3OS4zMDg2LDMwMy43NSwyNzkuMzA4NiwyOTEuNzUsMjY3LjMwODYsMzAzLjc1LDI1NS4zMDg2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MyIgeD0iMzAzLjc1IiB5PSIyNzEuMTE2NyI+JiMyNDEyMDsmIzI5OTkyO0lQJiMyMjMyMDsmIzIyMzM2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMSIgeD0iMjcwLjc1IiB5PSIyNjQuNzE0NCI+eWVzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0IiB4PSIzNjguNzUiIHk9IjI2NC43MTQ0Ij5ubzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTIiIHg9IjIyNCIgeT0iMjg5LjMwODYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MiIgeD0iMjM0IiB5PSIzMTAuNDQ3MyI+JiMzMDMzMTsmIzM4NDcwOyYjMjYwODU7JiMyNDUzNTsmIzM1NzYwOyYjMjQ0MDU7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDkiIHg9IjMzNiIgeT0iMjg5LjMwODYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OSIgeD0iMzQ2IiB5PSIzMTAuNDQ3MyI+JiMyNTE2MzsmIzI2NDI2OyYjMjE0OTU7JiMyMDQ0OTsmIzI0Njg3OyYjMzk1NjQ7JiMzNTc3NzshPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMzMwLjI1LDMyOS4yNzczLDM0Mi4yNSwzNDEuMjc3MywzMzAuMjUsMzUzLjI3NzMsMzE4LjI1LDM0MS4yNzczLDMzMC4yNSwzMjkuMjc3MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY4IiB4PSIyOTYuMjUiIHk9IjM3My4yNzczIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDgiIHg9IjMwNi4yNSIgeT0iMzk0LjQxNiI+JiMzMDMzMTsmIzM4NDcwOyYjMjUxMDQ7JiMyMTE1MTs8L3RleHQ+PGVsbGlwc2UgY3g9IjMzMC4yNSIgY3k9IjQzNy4yNDYxIiBmaWxsPSJub25lIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoyLjU7IiB4MT0iMzI0LjA2MjgiIHgyPSIzMzYuNDM3MiIgeTE9IjQzMS4wNTg5IiB5Mj0iNDQzLjQzMzMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjIuNTsiIHgxPSIzMzYuNDM3MiIgeDI9IjMyNC4wNjI4IiB5MT0iNDMxLjA1ODkiIHkyPSI0NDMuNDMzMyIvPjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMzAyLjc1LDE1Mi45Mzc1LDM1Ny43NSwxNTIuOTM3NSwzNjkuNzUsMTY0LjkzNzUsMzU3Ljc1LDE3Ni45Mzc1LDMwMi43NSwxNzYuOTM3NSwyOTAuNzUsMTY0LjkzNzUsMzAyLjc1LDE1Mi45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNCIgeD0iMzM0LjI1IiB5PSIxODcuMTQ3OSI+bm88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUiIHg9IjMwMi43NSIgeT0iMTY4Ljc0NTYiPiYjMzYxMzQ7JiMyMTQ5NTsmIzI0MDUwOyYjMjA1NzI7JiMyOTk5Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjM2OS43NSIgeT0iMTYyLjM0MzMiPnllczwvdGV4dD48ZWxsaXBzZSBjeD0iNDEyLjc1IiBjeT0iMTY0LjkzNzUiIGZpbGw9Im5vbmUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjEuMDsiLz48ZWxsaXBzZSBjeD0iNDEyLjc1IiBjeT0iMTY0LjkzNzUiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMTExMTExO3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjkxLjc1IiB4Mj0iMjcwIiB5MT0iMjY3LjMwODYiIHkyPSIyNjcuMzA4NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI3MCIgeDI9IjI3MCIgeTE9IjI2Ny4zMDg2IiB5Mj0iMjg5LjMwODYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI2NiwyNzkuMzA4NiwyNzAsMjg5LjMwODYsMjc0LDI3OS4zMDg2LDI3MCwyODMuMzA4NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzY4Ljc1IiB4Mj0iMzkwLjUiIHkxPSIyNjcuMzA4NiIgeTI9IjI2Ny4zMDg2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzkwLjUiIHgyPSIzOTAuNSIgeTE9IjI2Ny4zMDg2IiB5Mj0iMjg5LjMwODYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM4Ni41LDI3OS4zMDg2LDM5MC41LDI4OS4zMDg2LDM5NC41LDI3OS4zMDg2LDM5MC41LDI4My4zMDg2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNzAiIHgyPSIyNzAiIHkxPSIzMjMuMjc3MyIgeTI9IjM0MS4yNzczIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjcwIiB4Mj0iMzE4LjI1IiB5MT0iMzQxLjI3NzMiIHkyPSIzNDEuMjc3MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA4LjI1LDMzNy4yNzczLDMxOC4yNSwzNDEuMjc3MywzMDguMjUsMzQ1LjI3NzMsMzEyLjI1LDM0MS4yNzczIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzOTAuNSIgeDI9IjM5MC41IiB5MT0iMzIzLjI3NzMiIHkyPSIzNDEuMjc3MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM5MC41IiB4Mj0iMzQyLjI1IiB5MT0iMzQxLjI3NzMiIHkyPSIzNDEuMjc3MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzUyLjI1LDMzNy4yNzczLDM0Mi4yNSwzNDEuMjc3MywzNTIuMjUsMzQ1LjI3NzMsMzQ4LjI1LDM0MS4yNzczIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzMzAuMjUiIHgyPSIzMzAuMjUiIHkxPSIyMzUuMzA4NiIgeTI9IjI1NS4zMDg2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMjYuMjUsMjQ1LjMwODYsMzMwLjI1LDI1NS4zMDg2LDMzNC4yNSwyNDUuMzA4NiwzMzAuMjUsMjQ5LjMwODYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjMzMC4yNSIgeDI9IjMzMC4yNSIgeTE9IjM1My4yNzczIiB5Mj0iMzczLjI3NzMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMyNi4yNSwzNjMuMjc3MywzMzAuMjUsMzczLjI3NzMsMzM0LjI1LDM2My4yNzczLDMzMC4yNSwzNjcuMjc3MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzMwLjI1IiB4Mj0iMzMwLjI1IiB5MT0iNDA3LjI0NjEiIHkyPSI0MjcuMjQ2MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzI2LjI1LDQxNy4yNDYxLDMzMC4yNSw0MjcuMjQ2MSwzMzQuMjUsNDE3LjI0NjEsMzMwLjI1LDQyMS4yNDYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzMzAuMjUiIHgyPSIzMzAuMjUiIHkxPSIxNzYuOTM3NSIgeTI9IjIwMS4zMzk4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMjYuMjUsMTkxLjMzOTgsMzMwLjI1LDIwMS4zMzk4LDMzNC4yNSwxOTEuMzM5OCwzMzAuMjUsMTk1LjMzOTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM2OS43NSIgeDI9IjQwMS43NSIgeTE9IjE2NC45Mzc1IiB5Mj0iMTY0LjkzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM5MS43NSwxNjAuOTM3NSw0MDEuNzUsMTY0LjkzNzUsMzkxLjc1LDE2OC45Mzc1LDM5NS43NSwxNjQuOTM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzMwLjI1IiB4Mj0iMzMwLjI1IiB5MT0iMTMyLjkzNzUiIHkyPSIxNTIuOTM3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzI2LjI1LDE0Mi45Mzc1LDMzMC4yNSwxNTIuOTM3NSwzMzQuMjUsMTQyLjkzNzUsMzMwLjI1LDE0Ni45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMTIuMTI1IiB4Mj0iMTczIiB5MT0iNzYuOTY4OCIgeTI9Ijc2Ljk2ODgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNzMiIHgyPSIxNzMiIHkxPSI3Ni45Njg4IiB5Mj0iMTAwLjUzNTIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2OSw5MC41MzUyLDE3MywxMDAuNTM1MiwxNzcsOTAuNTM1MiwxNzMsOTQuNTM1MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjkxLjEyNSIgeDI9IjMzMC4yNSIgeTE9Ijc2Ljk2ODgiIHkyPSI3Ni45Njg4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzMwLjI1IiB4Mj0iMzMwLjI1IiB5MT0iNzYuOTY4OCIgeTI9Ijk4Ljk2ODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMyNi4yNSw4OC45Njg4LDMzMC4yNSw5OC45Njg4LDMzNC4yNSw4OC45Njg4LDMzMC4yNSw5Mi45Njg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNTEuNjI1IiB4Mj0iMjUxLjYyNSIgeTE9IjQ0Ljk2ODgiIHkyPSI2NC45Njg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDcuNjI1LDU0Ljk2ODgsMjUxLjYyNSw2NC45Njg4LDI1NS42MjUsNTQuOTY4OCwyNTEuNjI1LDU4Ljk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1TUkM9W2l0Z25QVGRKX2tyRnJ4U3pOejN1VkVSa2JwRlJoQmFvcW5HcThFOUZUbEctTkpsWndQbUxjV2ViNlFidjJYZ0xnU01RTjBmMEs1b0lObTFjdkVNTmYyaGFmQVFMVzdhQTJZX2REQm5PcmxYWXRPUWRVd1MtTlJCbm5QUWJwek9pVjNQcldwck9GWktsMVFvM0FwTWRFNUwxOG95Vk9mZUxpWkVVemtueXNUZmgzUFAwRUVOZnphckY2LVN5ZHVCN0FNWGNBaHBlc193cVZ6aEpsUEVWVGxQdzFZMENWQmZaMXowU3B1MmRTcE95ZFRrME9Idk9Db0dpZGFyVi1kSl9UOFhkaEI3TzBMUndoQkZ4c1BuVGVEM1FsXzFQdV9nTmd0ZlVoNnpLajhSdkRwRUQyemQ0WldiRmstUFJTbTRiMDAwMF0tLT48L2c+PC9zdmc+'>

<h3 id="4-DB设计"><a href="#4-DB设计" class="headerlink" title="4. DB设计"></a>4. DB设计</h3><p>一般情况是通过关系行数据库实现数据持久化，需要给出数据库表结构并描述清楚关联关系。如果没有DB规范校验工具，则此环节会review数据库结构是否符合规范。反之，则将DB校验结果列出。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI0NTJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjg1OXB4O2hlaWdodDo0NTJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA4NTkgNDUyIiB3aWR0aD0iODU5cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2xhc3MgdGFibGVfMS0tPjxnIGlkPSJlbGVtX3RhYmxlXzEiPjxyZWN0IGNvZGVMaW5lPSI3IiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIxMy41NjI1IiBpZD0idGFibGVfMSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMzQ1IiB4PSIyNTciIHk9IjciLz48ZWxsaXBzZSBjeD0iMzcwLjc1IiBjeT0iMjguMjk2OSIgZmlsbD0iI0ZGQUFBQSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik0zNzEuMTg3NSwyNS44MjgxIEwzNzMuMDMxMywyNS44MjgxIEwzNzMuMDMxMywyNy40MjE5IEMzNzMuMDMxMywyNy44MTI1IDM3My4wNjI1LDI3Ljk4NDQgMzczLjE1NjMsMjguMTI1IEMzNzMuMzEyNSwyOC4zNzUgMzczLjU5MzgsMjguNTMxMyAzNzMuODkwNiwyOC41MzEzIEMzNzQuMTU2MywyOC41MzEzIDM3NC40MDYzLDI4LjQwNjMgMzc0LjU3ODEsMjguMTg3NSBDMzc0LjcxODgsMjguMDE1NiAzNzQuNzM0NCwyNy44OTA2IDM3NC43MzQ0LDI3LjQyMTkgTDM3NC43MzQ0LDI0LjE0MDYgTDM2NS45Njg4LDI0LjE0MDYgTDM2NS45Njg4LDI3LjQyMTkgQzM2NS45Njg4LDI3LjgxMjUgMzY2LDI3Ljk4NDQgMzY2LjA3ODEsMjguMTI1IEMzNjYuMjM0NCwyOC4zOTA2IDM2Ni41MzEzLDI4LjUzMTMgMzY2LjgxMjUsMjguNTMxMyBDMzY3LjA5MzgsMjguNTMxMyAzNjcuMzQzOCwyOC40MDYzIDM2Ny41MTU2LDI4LjE4NzUgQzM2Ny42MjUsMjguMDE1NiAzNjcuNjU2MywyNy44NzUgMzY3LjY1NjMsMjcuNDIxOSBMMzY3LjY1NjMsMjUuODI4MSBMMzY5LjQ4NDQsMjUuODI4MSBMMzY5LjQ4NDQsMzIuMzQzOCBMMzY4LjM3NSwzMi4zNDM4IEMzNjcuOTM3NSwzMi4zNDM4IDM2Ny44MTI1LDMyLjM1OTQgMzY3LjY1NjMsMzIuNDY4OCBDMzY3LjQwNjMsMzIuNjI1IDM2Ny4yNSwzMi45MDYzIDM2Ny4yNSwzMy4yMDMxIEMzNjcuMjUsMzMuNDUzMSAzNjcuMzkwNiwzMy43MTg4IDM2Ny42MDk0LDMzLjg3NSBDMzY3Ljc2NTYsMzQgMzY3Ljk4NDQsMzQuMDQ2OSAzNjguMzc1LDM0LjA0NjkgTDM3Mi4zMTI1LDM0LjA0NjkgQzM3Mi42NDA2LDM0LjA0NjkgMzcyLjkwNjMsMzQgMzczLjAxNTYsMzMuOTIxOSBDMzczLjI4MTMsMzMuNzgxMyAzNzMuNDIxOSwzMy40ODQ0IDM3My40MjE5LDMzLjIwMzEgQzM3My40MjE5LDMyLjkyMTkgMzczLjI5NjksMzIuNjcxOSAzNzMuMDYyNSwzMi41IEMzNzIuOTA2MywzMi4zNzUgMzcyLjc2NTYsMzIuMzQzOCAzNzIuMzEyNSwzMi4zNDM4IEwzNzEuMTg3NSwzMi4zNDM4IEwzNzEuMTg3NSwyNS44MjgxIFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQiIHg9IjQxOC43NSIgeT0iMjQuOTk1MSI+dGFibGVfMTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkiIHg9IjM5MS4yNSIgeT0iNDEuMjkyIj4oVGhpcyBpcyB0YWJsZSAxKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyNTgiIHgyPSI2MDEiIHkxPSI0OS41OTM4IiB5Mj0iNDkuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMyIgeD0iMjYzIiB5PSI2Ni41ODg5Ij5pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkiIHg9IjI4MCIgeT0iNjYuNTg4OSI+YmlnaW50ICBjb2x1bW5fMTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iODEiIHg9IjI2MyIgeT0iODIuODg1NyI+cHJvZF9uYW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyOCIgeD0iMzQ4IiB5PSI4Mi44ODU3Ij52YXJjaGFyICBjb2x1bW5fMjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNzUiIHg9IjI2MyIgeT0iOTkuMTgyNiI+cHJvZF90eXBlPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzMyIgeD0iMzQyIiB5PSI5OS4xODI2Ij50aW55aW50ICcwJyBjb2x1bW5fMyAwOiYjMjc5NjM7JiMyNjM5OTsgMTomIzIzNDUwOyYjMjYzOTk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI3NiIgeD0iMjYzIiB5PSIxMTUuNDc5NSI+c3RhcnRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTQiIHg9IjM0MyIgeT0iMTE1LjQ3OTUiPnRpbWUgICYjMjA1NzI7JiMyNzQ5MDsmIzIwMTMyOyYjMjYxMzE7JiMyNDMyMDsmIzIyOTg3OyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjY4IiB4PSIyNjMiIHk9IjEzMS43NzY0Ij5lbmRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTQiIHg9IjMzNSIgeT0iMTMxLjc3NjQiPnRpbWUgICYjMjA1NzI7JiMyNzQ5MDsmIzIwMTMyOyYjMjYxMzE7JiMzMjQ2NzsmIzI2NDYzOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijg1IiB4PSIyNjMiIHk9IjE0OC4wNzMyIj5vbmxpbmVfdHlwZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzUiIHg9IjM1MiIgeT0iMTQ4LjA3MzIiPnRpbnlpbnQgJzAnIDA6JiMxOTk3ODsmIzMyNDQ3OyAxOiYjMjY0MTA7JiMxOTk3ODsmIzMyNDQ3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNjkiIHg9IjI2MyIgeT0iMTY0LjM3MDEiPnByb2RfaW5mbzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUiIHg9IjMzNiIgeT0iMTY0LjM3MDEiPnZhcmNoYXIgJycgJiMyMDEzNTsmIzIxNjk3OyYjMjAxNzE7JiMzMjQ2MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjcyIiB4PSIyNjMiIHk9IjE4MC42NjciPm92ZXJfbGltaXQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjM1IiB4PSIzMzkiIHk9IjE4MC42NjciPnRpbnlpbnQgJzAnICYjMzYyMjk7JiMzOTA2OTsmIzM4NDgwOyYjMjEwNDY7IDA6JiMzODQ4MDsmIzIxMDQ2OyAxOiYjMTk5ODE7JiMzODQ4MDsmIzIxMDQ2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iOTciIHg9IjI2MyIgeT0iMTk2Ljk2MzkiPmNyZWF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjgiIHg9IjM2NCIgeT0iMTk2Ljk2MzkiPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMDEiIHg9IjI2MyIgeT0iMjEzLjI2MDciPnVwZGF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjgiIHg9IjM2OCIgeT0iMjEzLjI2MDciPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QPC90ZXh0PjwvZz48IS0tY2xhc3MgdGFibGVfMi0tPjxnIGlkPSJlbGVtX3RhYmxlXzIiPjxyZWN0IGNvZGVMaW5lPSIyMCIgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxNjQuNjcxOSIgaWQ9InRhYmxlXzIiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQwNSIgeD0iNDQ3IiB5PSIyODEiLz48ZWxsaXBzZSBjeD0iNTkxLjI1IiBjeT0iMzAyLjI5NjkiIGZpbGw9IiNGRkFBQUEiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNTkxLjY4NzUsMjk5LjgyODEgTDU5My41MzEzLDI5OS44MjgxIEw1OTMuNTMxMywzMDEuNDIxOSBDNTkzLjUzMTMsMzAxLjgxMjUgNTkzLjU2MjUsMzAxLjk4NDQgNTkzLjY1NjMsMzAyLjEyNSBDNTkzLjgxMjUsMzAyLjM3NSA1OTQuMDkzOCwzMDIuNTMxMyA1OTQuMzkwNiwzMDIuNTMxMyBDNTk0LjY1NjMsMzAyLjUzMTMgNTk0LjkwNjMsMzAyLjQwNjMgNTk1LjA3ODEsMzAyLjE4NzUgQzU5NS4yMTg4LDMwMi4wMTU2IDU5NS4yMzQ0LDMwMS44OTA2IDU5NS4yMzQ0LDMwMS40MjE5IEw1OTUuMjM0NCwyOTguMTQwNiBMNTg2LjQ2ODgsMjk4LjE0MDYgTDU4Ni40Njg4LDMwMS40MjE5IEM1ODYuNDY4OCwzMDEuODEyNSA1ODYuNSwzMDEuOTg0NCA1ODYuNTc4MSwzMDIuMTI1IEM1ODYuNzM0NCwzMDIuMzkwNiA1ODcuMDMxMywzMDIuNTMxMyA1ODcuMzEyNSwzMDIuNTMxMyBDNTg3LjU5MzgsMzAyLjUzMTMgNTg3Ljg0MzgsMzAyLjQwNjMgNTg4LjAxNTYsMzAyLjE4NzUgQzU4OC4xMjUsMzAyLjAxNTYgNTg4LjE1NjMsMzAxLjg3NSA1ODguMTU2MywzMDEuNDIxOSBMNTg4LjE1NjMsMjk5LjgyODEgTDU4OS45ODQ0LDI5OS44MjgxIEw1ODkuOTg0NCwzMDYuMzQzOCBMNTg4Ljg3NSwzMDYuMzQzOCBDNTg4LjQzNzUsMzA2LjM0MzggNTg4LjMxMjUsMzA2LjM1OTQgNTg4LjE1NjMsMzA2LjQ2ODggQzU4Ny45MDYzLDMwNi42MjUgNTg3Ljc1LDMwNi45MDYzIDU4Ny43NSwzMDcuMjAzMSBDNTg3Ljc1LDMwNy40NTMxIDU4Ny44OTA2LDMwNy43MTg4IDU4OC4xMDk0LDMwNy44NzUgQzU4OC4yNjU2LDMwOCA1ODguNDg0NCwzMDguMDQ2OSA1ODguODc1LDMwOC4wNDY5IEw1OTIuODEyNSwzMDguMDQ2OSBDNTkzLjE0MDYsMzA4LjA0NjkgNTkzLjQwNjMsMzA4IDU5My41MTU2LDMwNy45MjE5IEM1OTMuNzgxMywzMDcuNzgxMyA1OTMuOTIxOSwzMDcuNDg0NCA1OTMuOTIxOSwzMDcuMjAzMSBDNTkzLjkyMTksMzA2LjkyMTkgNTkzLjc5NjksMzA2LjY3MTkgNTkzLjU2MjUsMzA2LjUgQzU5My40MDYzLDMwNi4zNzUgNTkzLjI2NTYsMzA2LjM0MzggNTkyLjgxMjUsMzA2LjM0MzggTDU5MS42ODc1LDMwNi4zNDM4IEw1OTEuNjg3NSwyOTkuODI4MSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzIiB4PSI2MzkuMjUiIHk9IjI5OC45OTUxIj50YWJsZV8yPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOCIgeD0iNjExLjc1IiB5PSIzMTUuMjkyIj4oVGhpcyBpcyB0YWJsZSAyKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NDgiIHgyPSI4NTEiIHkxPSIzMjMuNTkzOCIgeTI9IjMyMy41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjEzIiB4PSI0NTMiIHk9IjM0MC41ODg5Ij5pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MyIgeD0iNDcwIiB5PSIzNDAuNTg4OSI+YmlnaW50PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1MCIgeD0iNDUzIiB5PSIzNTYuODg1NyI+dXNlcl9pZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MiIgeD0iNTA3IiB5PSIzNTYuODg1NyI+YmlnaW50ICAmIzI5OTkyOyYjMjUxNDM7aWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijc3IiB4PSI0NTMiIHk9IjM3My4xODI2Ij51c2VyX25hbWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3IiB4PSI1MzQiIHk9IjM3My4xODI2Ij52YXJjaGFyICAmIzI5OTkyOyYjMjUxNDM7JiMyMTUxNzsmIzMxMjE2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iNTQiIHg9IjQ1MyIgeT0iMzg5LjQ3OTUiPnByb2RfaWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTIiIHg9IjUxMSIgeT0iMzg5LjQ3OTUiPmJpZ2ludCAgJiMyMDEzNTsmIzIxNjk3O2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNiIgeD0iNDUzIiB5PSI0MDUuNzc2NCI+aW50ZXJlc3RfZGF0ZSBkYXRlTlVMTCYjMzU3NDU7JiMyNDY4NzsmIzI2MDg1OyYjMjYzOTk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI5NyIgeD0iNDUzIiB5PSI0MjIuMDczMiI+Y3JlYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iNTU0IiB5PSI0MjIuMDczMiI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyMTAxOTsmIzI0MzE0OyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9IjEwMSIgeD0iNDUzIiB5PSI0MzguMzcwMSI+dXBkYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iNTU4IiB5PSI0MzguMzcwMSI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyNjM1NjsmIzI2MDMyOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PC9nPjwhLS1jbGFzcyB0YWJsZV8zLS0+PGcgaWQ9ImVsZW1fdGFibGVfMyI+PHJlY3QgY29kZUxpbmU9IjMxIiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE2NC42NzE5IiBpZD0idGFibGVfMyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDA1IiB4PSI3IiB5PSIyODEiLz48ZWxsaXBzZSBjeD0iMTUwLjc1IiBjeT0iMzAyLjI5NjkiIGZpbGw9IiNGRkFBQUEiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMTUxLjE4NzUsMjk5LjgyODEgTDE1My4wMzEzLDI5OS44MjgxIEwxNTMuMDMxMywzMDEuNDIxOSBDMTUzLjAzMTMsMzAxLjgxMjUgMTUzLjA2MjUsMzAxLjk4NDQgMTUzLjE1NjMsMzAyLjEyNSBDMTUzLjMxMjUsMzAyLjM3NSAxNTMuNTkzOCwzMDIuNTMxMyAxNTMuODkwNiwzMDIuNTMxMyBDMTU0LjE1NjMsMzAyLjUzMTMgMTU0LjQwNjMsMzAyLjQwNjMgMTU0LjU3ODEsMzAyLjE4NzUgQzE1NC43MTg4LDMwMi4wMTU2IDE1NC43MzQ0LDMwMS44OTA2IDE1NC43MzQ0LDMwMS40MjE5IEwxNTQuNzM0NCwyOTguMTQwNiBMMTQ1Ljk2ODgsMjk4LjE0MDYgTDE0NS45Njg4LDMwMS40MjE5IEMxNDUuOTY4OCwzMDEuODEyNSAxNDYsMzAxLjk4NDQgMTQ2LjA3ODEsMzAyLjEyNSBDMTQ2LjIzNDQsMzAyLjM5MDYgMTQ2LjUzMTMsMzAyLjUzMTMgMTQ2LjgxMjUsMzAyLjUzMTMgQzE0Ny4wOTM4LDMwMi41MzEzIDE0Ny4zNDM4LDMwMi40MDYzIDE0Ny41MTU2LDMwMi4xODc1IEMxNDcuNjI1LDMwMi4wMTU2IDE0Ny42NTYzLDMwMS44NzUgMTQ3LjY1NjMsMzAxLjQyMTkgTDE0Ny42NTYzLDI5OS44MjgxIEwxNDkuNDg0NCwyOTkuODI4MSBMMTQ5LjQ4NDQsMzA2LjM0MzggTDE0OC4zNzUsMzA2LjM0MzggQzE0Ny45Mzc1LDMwNi4zNDM4IDE0Ny44MTI1LDMwNi4zNTk0IDE0Ny42NTYzLDMwNi40Njg4IEMxNDcuNDA2MywzMDYuNjI1IDE0Ny4yNSwzMDYuOTA2MyAxNDcuMjUsMzA3LjIwMzEgQzE0Ny4yNSwzMDcuNDUzMSAxNDcuMzkwNiwzMDcuNzE4OCAxNDcuNjA5NCwzMDcuODc1IEMxNDcuNzY1NiwzMDggMTQ3Ljk4NDQsMzA4LjA0NjkgMTQ4LjM3NSwzMDguMDQ2OSBMMTUyLjMxMjUsMzA4LjA0NjkgQzE1Mi42NDA2LDMwOC4wNDY5IDE1Mi45MDYzLDMwOCAxNTMuMDE1NiwzMDcuOTIxOSBDMTUzLjI4MTMsMzA3Ljc4MTMgMTUzLjQyMTksMzA3LjQ4NDQgMTUzLjQyMTksMzA3LjIwMzEgQzE1My40MjE5LDMwNi45MjE5IDE1My4yOTY5LDMwNi42NzE5IDE1My4wNjI1LDMwNi41IEMxNTIuOTA2MywzMDYuMzc1IDE1Mi43NjU2LDMwNi4zNDM4IDE1Mi4zMTI1LDMwNi4zNDM4IEwxNTEuMTg3NSwzMDYuMzQzOCBMMTUxLjE4NzUsMjk5LjgyODEgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMTk4Ljc1IiB5PSIyOTguOTk1MSI+dGFibGVfMzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkiIHg9IjE3MS4yNSIgeT0iMzE1LjI5MiI+KFRoaXMgaXMgdGFibGUgMyk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjQxMSIgeTE9IjMyMy41OTM4IiB5Mj0iMzIzLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249InVuZGVybGluZSIgdGV4dExlbmd0aD0iMTMiIHg9IjEzIiB5PSIzNDAuNTg4OSI+aWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDMiIHg9IjMwIiB5PSIzNDAuNTg4OSI+YmlnaW50PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1MCIgeD0iMTMiIHk9IjM1Ni44ODU3Ij51c2VyX2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSI2NyIgeT0iMzU2Ljg4NTciPmJpZ2ludCAgJiMyOTk5MjsmIzI1MTQzO2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI3NyIgeD0iMTMiIHk9IjM3My4xODI2Ij51c2VyX25hbWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3IiB4PSI5NCIgeT0iMzczLjE4MjYiPnZhcmNoYXIgICYjMjk5OTI7JiMyNTE0MzsmIzIxNTE3OyYjMzEyMTY7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSI1NCIgeD0iMTMiIHk9IjM4OS40Nzk1Ij5wcm9kX2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSI3MSIgeT0iMzg5LjQ3OTUiPmJpZ2ludCAgJiMyMDEzNTsmIzIxNjk3O2lkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyNiIgeD0iMTMiIHk9IjQwNS43NzY0Ij5pbnRlcmVzdF9kYXRlIGRhdGVOVUxMJiMzNTc0NTsmIzI0Njg3OyYjMjYwODU7JiMyNjM5OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dC1kZWNvcmF0aW9uPSJ1bmRlcmxpbmUiIHRleHRMZW5ndGg9Ijk3IiB4PSIxMyIgeT0iNDIyLjA3MzIiPmNyZWF0ZWRfdGltZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyODgiIHg9IjExNCIgeT0iNDIyLjA3MzIiPmRhdGV0aW1lIENVUlJFTlRfVElNRVNUQU1QICYjMjEwMTk7JiMyNDMxNDsmIzI2MTAyOyYjMzgzODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHQtZGVjb3JhdGlvbj0idW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIxMDEiIHg9IjEzIiB5PSI0MzguMzcwMSI+dXBkYXRlZF90aW1lPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4OCIgeD0iMTE4IiB5PSI0MzguMzcwMSI+ZGF0ZXRpbWUgQ1VSUkVOVF9USU1FU1RBTVAgJiMyNjM1NjsmIzI2MDMyOyYjMjYxMDI7JiMzODM4ODs8L3RleHQ+PC9nPjwhLS1saW5rIHRhYmxlXzEgdG8gdGFibGVfMi0tPjxnIGlkPSJsaW5rX3RhYmxlXzFfdGFibGVfMiI+PHBhdGggY29kZUxpbmU9IjQxIiBkPSJNNTIzLjc1NywyMjEuMDM5IEM1NDEuNjAxLDI0MS4xMTMgNTU2LjAyMjksMjU3LjMzNzUgNTczLjA2MzksMjc2LjUwOTUgIiBmaWxsPSJub25lIiBpZD0idGFibGVfMS10by10YWJsZV8yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Ny4wNSwyODAuOTk0LDU3NC4wNjA2LDI3MS42MDk4LDU3My43MjgzLDI3Ny4yNTY5LDU2OC4wODEyLDI3Ni45MjQ2LDU3Ny4wNSwyODAuOTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4IiB4PSI1MjEuNTM5MSIgeT0iMjQwLjQ2MTgiPjE8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjUiIHg9IjU0NC40ODQxIiB5PSIyNzAuMDY1MyI+MC4uTjwvdGV4dD48L2c+PCEtLWxpbmsgdGFibGVfMSB0byB0YWJsZV8zLS0+PGcgaWQ9ImxpbmtfdGFibGVfMV90YWJsZV8zIj48cGF0aCBjb2RlTGluZT0iNDIiIGQ9Ik0zMzUuMjQzLDIyMS4wMzkgQzMxNy4zOTksMjQxLjExMyAzMDIuOTc3MSwyNTcuMzM3NSAyODUuOTM2MSwyNzYuNTA5NSAiIGZpbGw9Im5vbmUiIGlkPSJ0YWJsZV8xLXRvLXRhYmxlXzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjgxLjk1LDI4MC45OTQsMjkwLjkxODgsMjc2LjkyNDYsMjg1LjI3MTcsMjc3LjI1NjksMjg0LjkzOTQsMjcxLjYwOTgsMjgxLjk1LDI4MC45OTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgiIHg9IjMyMC45NDg0IiB5PSIyNDAuNDYxOCI+MTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNSIgeD0iMjYyLjI4OTMiIHk9IjI3MC4wNjUzIj4wLi5OPC90ZXh0PjwvZz48IS0tbGluayB0YWJsZV8zIHRvIHRhYmxlXzItLT48ZyBpZD0ibGlua190YWJsZV8zX3RhYmxlXzIiPjxwYXRoIGNvZGVMaW5lPSI0MyIgZD0iTTQxOC4zMTIsMzYzLjUgQzQyOS43NCwzNjMuNSA0MjkuMTY3LDM2My41IDQ0MC41OTQsMzYzLjUgIiBmaWxsPSJub25lIiBpZD0idGFibGVfMy10YWJsZV8yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQxMi4zMTIsMzYzLjUsNDIxLjMxMiwzNjcuNSw0MTcuMzEyLDM2My41LDQyMS4zMTIsMzU5LjUsNDEyLjMxMiwzNjMuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NDYuNTk0LDM2My41LDQzNy41OTQsMzU5LjUsNDQxLjU5NCwzNjMuNSw0MzcuNTk0LDM2Ny41LDQ0Ni41OTQsMzYzLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgiIHg9IjQxOS43NDQzIiB5PSIzNjAuMzA1NiI+MTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4IiB4PSI0MzEuMTU4MyIgeT0iMzYwLjMwNTYiPjE8L3RleHQ+PC9nPjwhLS1TUkM9W3hMSlZRemZHNTd4dGhwWkQ3WklXaFQ0dDJPNG9NWFlxQ1poeERXWkhORWpib09yQlJhZmIzRVIzZUFtODFTVlNMYWpQc04wQ3JsTDF0RDMxX1hhSnd0LW5jdlo2UUJPWXg3Tlg5Zm54cF9VVDdyekVpZ1FZQVlPOElhZlBHb2NZdzJZajhnbDJHcUxKQjBreTByMGl1Qm4zM2FHSEtnTnFsVXRqSk5Sbjg0YzlqTzFWRHg2a2MwdHYyTWdhWmRXR0F1UGNjMEtKZ1A5T2JleDRaUjhhUmxYZFN1ZkR5NUNSSFQwNzlhQjQwb3kxWUs1Yk9ja1EzeEt6VzJxYlFiWDVlMkRRQ3JIaGpoNGVDZjUxNnRMYTlNUmpLRXlmMnNkVzBraW5JUExnczBBc18xQ0dVOHZfMWVhbTByUHZBRUMzSjJXMGd5Qk1ZSW4wT2J2MXRKSEtzSEU1WHFGNWhER0tDeUpiT1pZbDUxdWU5V3FsTlpBUmw4TmM4TGptLW9FdFVtNTJtUmJ3eG5hSGlhS0xheWVLd3B3UmxHMW1jYnR0dy1MdS1ENXpzdFAtbGQxdzlzdmRDRXRxZW9uNHJCem85Z0VzVXR1SHZuWDRPbUJfZVQxaU9WcFpyTUp1WXpOZFRoeTR6ZDlfYzVJRGtHeDk5OG83RlFWVDc4ekU5Z0ZNR2ZmM1BDZVFyWjVUcDc4cFUzY3pGOS0gLUV0TUUxb25iTzBXaVRva204cTRnOWI4ZWtrckhQUlJWdl90emxSc2pPYWFrRlRaVFViSlF0N3E4S1A5VExyU2NGTVN0TXo3SG9PTVphdWtESmt3RXFMYWVtTUJESHZzSnJ2X1R1LXpPWk82TXZjZzZTcXZSYXp2ck5GajhtOWRpVmEyc1BuLTFITU1sTFJfVnVseEVwaXRMMXhWdnBVcnlNWGdxYklMclppLVNxSjAtRm9sQnd2eHJ0SlZOT0cwY1RLcGhWQVhyRmdQcl9oX01fd0hyeUZpM0prMG82T2RCaGd5TkVHVzYtb3ZkRmQzY0ZBVU9xTDJMQ2VHR2tkeTNdLS0+PC9nPjwvc3ZnPg=='>

<h3 id="5-数据推演"><a href="#5-数据推演" class="headerlink" title="5. 数据推演"></a>5. 数据推演</h3><p>通过用例数据，结合过程视图中的流程对DB操作进行推演，以此反证DB设计的合理性</p>
<h3 id="6-api设计"><a href="#6-api设计" class="headerlink" title="6. api设计"></a>6. api设计</h3><p>可能是http接口(可以通过swagger等工具编写)，或者相关interface。</p>
<p>除了确保接口设计符合规范外，这个环节最重要的点其实是各合作方达成一份契约，认可后就可以按照此设计分别进行开发实现。比如:前端通过mock页面开发，测试团队开始编写接口测试脚本。</p>
<p><img src="https://img.yuheng.wang/mweb/tech-review-00.jpg" alt="tech-review-00"></p>
<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p>一般不做强制要求，针对资历较浅的同学会增加把控。如果应用了复杂设计模式，可以特殊说明</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzOTRweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjY0MXB4O2hlaWdodDozOTRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2NDEgMzk0IiB3aWR0aD0iNjQxcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tY2x1c3RlciBjbGFzcyBPYnNlcnZlcig/Pz8/PyktLT48ZyBpZD0iY2x1c3Rlcl9jbGFzcyBPYnNlcnZlcigmIzM1MjY2OyYjMjM1MTk7JiMzMjc3MzsmIzI3MTY5OyYjMjQzMzU7KSI+PHBhdGggZD0iTTguNSw2IEwyMTYuNSw2IEEzLjc1LDMuNzUgMCAwIDEgMjE5LDguNSBMMjI2LDI4LjI5NjkgTDYzMS41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgNjM0LDMwLjc5NjkgTDYzNCwzODQuNSBBMi41LDIuNSAwIDAgMSA2MzEuNSwzODcgTDguNSwzODcgQTIuNSwyLjUgMCAwIDEgNiwzODQuNSBMNiw4LjUgQTIuNSwyLjUgMCAwIDEgOC41LDYgIiBmaWxsPSIjREREREREIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2IiB4Mj0iMjI2IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjA3IiB4PSIxMCIgeT0iMjAuOTk1MSI+Y2xhc3MgT2JzZXJ2ZXIoJiMzNTI2NjsmIzIzNTE5OyYjMzI3NzM7JiMyNzE2OTsmIzI0MzM1Oyk8L3RleHQ+PC9nPjwhLS1jbGFzcyBTdWJqZWN0LS0+PGcgaWQ9ImVsZW1fU3ViamVjdCI+PHJlY3QgY29kZUxpbmU9IjQiIGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNzIuNTYyNSIgaWQ9IlN1YmplY3QiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5OCIgeD0iMTY2IiB5PSI0MSIvPjxlbGxpcHNlIGN4PSIyMzAuNzUiIGN5PSI2MS4xMzI4IiBmaWxsPSIjRkY3NzAwIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTIzMi44MjgxLDYyLjk0NTMgTDIzMy4yMTg4LDYzLjkyOTcgTDIzMi44MjgxLDYzLjkyOTcgQzIzMi4zNzUsNjMuOTI5NyAyMzIuMjY1Niw2My45NDUzIDIzMi4xMDk0LDY0LjA1NDcgQzIzMS44NTk0LDY0LjIxMDkgMjMxLjcwMzEsNjQuNDkyMiAyMzEuNzAzMSw2NC43ODkxIEMyMzEuNzAzMSw2NS4wNTQ3IDIzMS44NDM4LDY1LjMwNDcgMjMyLjA2MjUsNjUuNDYwOSBDMjMyLjIwMzEsNjUuNTg1OSAyMzIuNDA2Myw2NS42MzI4IDIzMi44MjgxLDY1LjYzMjggTDIzNS4xODc1LDY1LjYzMjggQzIzNS41NDY5LDY1LjYzMjggMjM1Ljc2NTYsNjUuNjAxNiAyMzUuOTA2Myw2NS41MDc4IEMyMzYuMTU2Myw2NS4zNjcyIDIzNi4zMTI1LDY1LjA3MDMgMjM2LjMxMjUsNjQuNzg5MSBDMjM2LjMxMjUsNjQuNTA3OCAyMzYuMTcxOSw2NC4yNTc4IDIzNS45NTMxLDY0LjEwMTYgQzIzNS43ODEzLDYzLjk2MDkgMjM1LjYyNSw2My45Mjk3IDIzNS4xNTYzLDYzLjkyOTcgTDIzMS43NjU2LDU1LjcyNjYgTDIyOC4wOTM4LDU1LjcyNjYgQzIyNy42NDA2LDU1LjcyNjYgMjI3LjUxNTYsNTUuNzQyMiAyMjcuMzU5NCw1NS44MzU5IEMyMjcuMTA5NCw1Ni4wMDc4IDIyNi45NTMxLDU2LjI4OTEgMjI2Ljk1MzEsNTYuNTcwMyBDMjI2Ljk1MzEsNTYuODUxNiAyMjcuMDkzOCw1Ny4xMDE2IDIyNy4zMTI1LDU3LjI3MzQgQzIyNy40ODQ0LDU3LjM4MjggMjI3LjY1NjMsNTcuNDE0MSAyMjguMDkzOCw1Ny40MTQxIEwyMjkuMTcxOSw1Ny40MTQxIEwyMjYuNTMxMyw2My45Mjk3IEMyMjYuMTA5NCw2My45Mjk3IDIyNS45NTMxLDYzLjk0NTMgMjI1Ljc5NjksNjQuMDU0NyBDMjI1LjU0NjksNjQuMjEwOSAyMjUuMzkwNiw2NC40OTIyIDIyNS4zOTA2LDY0Ljc4OTEgQzIyNS4zOTA2LDY1LjM1MTYgMjI1Ljc2NTYsNjUuNjMyOCAyMjYuNTE1Niw2NS42MzI4IEwyMjguNzgxMyw2NS42MzI4IEMyMjkuMTQwNiw2NS42MzI4IDIyOS4zNTk0LDY1LjYwMTYgMjI5LjQ4NDQsNjUuNTA3OCBDMjI5Ljc1LDY1LjM2NzIgMjI5Ljg5MDYsNjUuMDcwMyAyMjkuODkwNiw2NC43ODkxIEMyMjkuODkwNiw2NC41MDc4IDIyOS43NjU2LDY0LjI1NzggMjI5LjU0NjksNjQuMDg1OSBDMjI5LjM3NSw2My45NjA5IDIyOS4yMzQ0LDYzLjkyOTcgMjI4Ljc4MTMsNjMuOTI5NyBMMjI4LjM5MDYsNjMuOTI5NyBMMjI4Ljc4MTMsNjIuOTQ1MyBMMjMyLjgyODEsNjIuOTQ1MyBaIE0yMzIuMTI1LDYxLjI0MjIgTDIyOS40NTMxLDYxLjI0MjIgTDIzMC43OTY5LDU3Ljk3NjYgTDIzMi4xMjUsNjEuMjQyMiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjQiIHg9IjI0OS4yNSIgeT0iNTcuMTM4NyI+JiMxNzE7YWJzdHJhY3QmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUiIHg9IjI1My43NSIgeT0iNzIuOTYzOSI+U3ViamVjdDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNjciIHgyPSIzNjMiIHkxPSI4MS4yNjU2IiB5Mj0iODEuMjY1NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE2NyIgeDI9IjM2MyIgeTE9Ijg5LjI2NTYiIHkyPSI4OS4yNjU2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg2IiB4PSIxNzIiIHk9IjEwNi4yNjA3Ij4rbm90aWZ5T2JzZXJ2ZXJzKE9iamVjdCk8L3RleHQ+PC9nPjxnIGlkPSJlbGVtX0dNTjQiPjxwYXRoIGQ9Ik0zOTkuNSw2NSBMMzk5LjUsNzMuNSBMMzY0LjE5Myw3Ny41IEwzOTkuNSw4MS41IEwzOTkuNSw5MC4xMzI4IEEwLDAgMCAwIDAgMzk5LjUsOTAuMTMyOCBMNDcyLjUsOTAuMTMyOCBBMCwwIDAgMCAwIDQ3Mi41LDkwLjEzMjggTDQ3Mi41LDc1IEw0NjIuNSw2NSBMMzk5LjUsNjUgQTAsMCAwIDAgMCAzOTkuNSw2NSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NjIuNSw2NSBMNDYyLjUsNzUgTDQ3Mi41LDc1IEw0NjIuNSw2NSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyIiB4PSI0MDUuNSIgeT0iODIuMDY2OSI+JiMyNTI3NzsmIzM1OTM3OyYjMjAwMjc7JiMzOTA2NDs8L3RleHQ+PC9nPjwhLS1jbGFzcyBDb25jcmV0ZVN1YmplY3QtLT48ZyBpZD0iZWxlbV9Db25jcmV0ZVN1YmplY3QiPjxyZWN0IGNvZGVMaW5lPSIxMCIgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI2NC4yOTY5IiBpZD0iQ29uY3JldGVTdWJqZWN0IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxOTgiIHg9IjIyIiB5PSIxNzguNSIvPjxlbGxpcHNlIGN4PSI1Ni44IiBjeT0iMTk0LjUiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNTkuMTQzOCwxOTAuMTcxOSBDNTguMjA2MywxODkuNzM0NCA1Ny42MTI1LDE4OS41OTM4IDU2LjczNzUsMTg5LjU5MzggQzU0LjExMjUsMTg5LjU5MzggNTIuMTEyNSwxOTEuNjcxOSA1Mi4xMTI1LDE5NC4zOTA2IEw1Mi4xMTI1LDE5NS41MTU2IEM1Mi4xMTI1LDE5OC4wOTM4IDU0LjIyMTksMTk5Ljk4NDQgNTcuMTEyNSwxOTkuOTg0NCBDNTguMzMxMywxOTkuOTg0NCA1OS40ODc1LDE5OS42ODc1IDYwLjIzNzUsMTk5LjE0MDYgQzYwLjgxNTYsMTk4LjczNDQgNjEuMTQzOCwxOTguMjgxMyA2MS4xNDM4LDE5Ny44OTA2IEM2MS4xNDM4LDE5Ny40Mzc1IDYwLjc1MzEsMTk3LjA0NjkgNjAuMjg0NCwxOTcuMDQ2OSBDNjAuMDY1NiwxOTcuMDQ2OSA1OS44NjI1LDE5Ny4xMjUgNTkuNjc1LDE5Ny4zMTI1IEM1OS4yMjE5LDE5Ny43OTY5IDU5LjIyMTksMTk3Ljc5NjkgNTkuMDM0NCwxOTcuODkwNiBDNTguNjEyNSwxOTguMTU2MyA1Ny45MjUsMTk4LjI4MTMgNTcuMTU5NCwxOTguMjgxMyBDNTUuMTEyNSwxOTguMjgxMyA1My44MTU2LDE5Ny4xODc1IDUzLjgxNTYsMTk1LjQ4NDQgTDUzLjgxNTYsMTk0LjM5MDYgQzUzLjgxNTYsMTkyLjYwOTQgNTUuMDY1NiwxOTEuMjk2OSA1Ni44LDE5MS4yOTY5IEM1Ny4zNzgxLDE5MS4yOTY5IDU3Ljk4NzUsMTkxLjQ1MzEgNTguNDU2MywxOTEuNzAzMSBDNTguOTQwNiwxOTEuOTg0NCA1OS4xMTI1LDE5Mi4yMDMxIDU5LjIwNjMsMTkyLjYwOTQgQzU5LjI2ODgsMTkzLjAxNTYgNTkuMywxOTMuMTQwNiA1OS40NDA2LDE5My4yNjU2IEM1OS41ODEzLDE5My40MDYzIDU5LjgxNTYsMTkzLjUxNTYgNjAuMDM0NCwxOTMuNTE1NiBDNjAuMywxOTMuNTE1NiA2MC41NjU2LDE5My4zNzUgNjAuNzM3NSwxOTMuMTU2MyBDNjAuODQ2OSwxOTMgNjAuODc4MSwxOTIuODEyNSA2MC44NzgxLDE5Mi4zOTA2IEw2MC44NzgxLDE5MC45Njg4IEM2MC44NzgxLDE5MC41MzEzIDYwLjg2MjUsMTkwLjQwNjMgNjAuNzY4OCwxOTAuMjUgQzYwLjYxMjUsMTg5Ljk4NDQgNjAuMzMxMywxODkuODQzOCA2MC4wMzQ0LDE4OS44NDM4IEM1OS43Mzc1LDE4OS44NDM4IDU5LjUzNDQsMTg5LjkzNzUgNTkuMzE1NiwxOTAuMjUgTDU5LjE0MzgsMTkwLjE3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjIiIHg9Ijc1LjIiIHk9IjE5OS4zNDY3Ij5Db25jcmV0ZVN1YmplY3Q8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjMiIHgyPSIyMTkiIHkxPSIyMTAuNSIgeTI9IjIxMC41Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjMiIHgyPSIyMTkiIHkxPSIyMTguNSIgeTI9IjIxOC41Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg2IiB4PSIyOCIgeT0iMjM1LjQ5NTEiPitub3RpZnlPYnNlcnZlcnMoT2JqZWN0KTwvdGV4dD48L2c+PGcgaWQ9ImVsZW1fR01OOCI+PHBhdGggZD0iTTI1NS41LDE5OCBMMjU1LjUsMjA2LjUgTDIyMC4xOTMsMjEwLjUgTDI1NS41LDIxNC41IEwyNTUuNSwyMjMuMTMyOCBBMCwwIDAgMCAwIDI1NS41LDIyMy4xMzI4IEwzMjguNSwyMjMuMTMyOCBBMCwwIDAgMCAwIDMyOC41LDIyMy4xMzI4IEwzMjguNSwyMDggTDMxOC41LDE5OCBMMjU1LjUsMTk4IEEwLDAgMCAwIDAgMjU1LjUsMTk4ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTMxOC41LDE5OCBMMzE4LjUsMjA4IEwzMjguNSwyMDggTDMxOC41LDE5OCAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyIiB4PSIyNjEuNSIgeT0iMjE1LjA2NjkiPiYjMjA4NTU7JiMyMDMwNzsmIzIwMDI3OyYjMzkwNjQ7PC90ZXh0PjwvZz48IS0tY2xhc3MgT2JzZXJ2ZXItLT48ZyBpZD0iZWxlbV9PYnNlcnZlciI+PHJlY3QgY29kZUxpbmU9IjE2IiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjcyLjU2MjUiIGlkPSJPYnNlcnZlciIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMzIiB4PSIzNjMuNSIgeT0iMTc0Ii8+PGVsbGlwc2UgY3g9IjM5NC4yNSIgY3k9IjE5NC4xMzI4IiBmaWxsPSIjRkY3NzAwIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTM5NS4yMDMxLDE5MC45MTQxIEwzOTYuOTIxOSwxOTAuOTE0MSBDMzk3LjMxMjUsMTkwLjkxNDEgMzk3LjUsMTkwLjg4MjggMzk3LjYyNSwxOTAuODA0NyBDMzk3Ljg5MDYsMTkwLjY0ODQgMzk4LjAzMTMsMTkwLjM2NzIgMzk4LjAzMTMsMTkwLjA3MDMgQzM5OC4wMzEzLDE4OS44MDQ3IDM5Ny45MjE5LDE4OS41MzkxIDM5Ny42ODc1LDE4OS4zNjcyIEMzOTcuNTE1NiwxODkuMjU3OCAzOTcuMzc1LDE4OS4yMjY2IDM5Ni45MjE5LDE4OS4yMjY2IEwzOTEuNzgxMywxODkuMjI2NiBDMzkxLjM0MzgsMTg5LjIyNjYgMzkxLjIxODgsMTg5LjI0MjIgMzkxLjA2MjUsMTg5LjMzNTkgQzM5MC44MTI1LDE4OS40OTIyIDM5MC42NTYzLDE4OS43ODkxIDM5MC42NTYzLDE5MC4wNzAzIEMzOTAuNjU2MywxOTAuMzUxNiAzOTAuNzk2OSwxOTAuNjAxNiAzOTEuMDE1NiwxOTAuNzczNCBDMzkxLjE3MTksMTkwLjg4MjggMzkxLjM1OTQsMTkwLjkxNDEgMzkxLjc4MTMsMTkwLjkxNDEgTDM5My41LDE5MC45MTQxIEwzOTMuNSwxOTcuNDI5NyBMMzkxLjc4MTMsMTk3LjQyOTcgQzM5MS4zNDM4LDE5Ny40Mjk3IDM5MS4yMTg4LDE5Ny40NDUzIDM5MS4wNjI1LDE5Ny41NTQ3IEMzOTAuODEyNSwxOTcuNzEwOSAzOTAuNjU2MywxOTcuOTkyMiAzOTAuNjU2MywxOTguMjg5MSBDMzkwLjY1NjMsMTk4LjUzOTEgMzkwLjc5NjksMTk4LjgwNDcgMzkxLjAxNTYsMTk4Ljk2MDkgQzM5MS4xNzE5LDE5OS4wODU5IDM5MS4zNzUsMTk5LjEzMjggMzkxLjc4MTMsMTk5LjEzMjggTDM5Ni45MjE5LDE5OS4xMzI4IEMzOTcuNjcxOSwxOTkuMTMyOCAzOTguMDMxMywxOTguODUxNiAzOTguMDMxMywxOTguMjg5MSBDMzk4LjAzMTMsMTk4LjAwNzggMzk3LjkyMTksMTk3Ljc1NzggMzk3LjY4NzUsMTk3LjU4NTkgQzM5Ny41MTU2LDE5Ny40NjA5IDM5Ny4zNzUsMTk3LjQyOTcgMzk2LjkyMTksMTk3LjQyOTcgTDM5NS4yMDMxLDE5Ny40Mjk3IEwzOTUuMjAzMSwxOTAuOTE0MSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjciIHg9IjQxMS4yNSIgeT0iMTkwLjEzODciPiYjMTcxO2ludGVyZmFjZSYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NiIgeD0iNDExLjc1IiB5PSIyMDUuOTYzOSI+T2JzZXJ2ZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzY0LjUiIHgyPSI0OTUuNSIgeTE9IjIxNC4yNjU2IiB5Mj0iMjE0LjI2NTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNjQuNSIgeDI9IjQ5NS41IiB5MT0iMjIyLjI2NTYiIHkyPSIyMjIuMjY1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMSIgeD0iMzY5LjUiIHk9IjIzOS4yNjA3Ij4rdXBkYXRlKE9iamVjdCk8L3RleHQ+PC9nPjxnIGlkPSJlbGVtX0dNTjEyIj48cGF0aCBkPSJNNTMyLDE5OCBMNTMyLDIwNi41IEw0OTYuNTUzLDIxMC41IEw1MzIsMjE0LjUgTDUzMiwyMjMuMTMyOCBBMCwwIDAgMCAwIDUzMiwyMjMuMTMyOCBMNjE4LDIyMy4xMzI4IEEwLDAgMCAwIDAgNjE4LDIyMy4xMzI4IEw2MTgsMjA4IEw2MDgsMTk4IEw1MzIsMTk4IEEwLDAgMCAwIDAgNTMyLDE5OCAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik02MDgsMTk4IEw2MDgsMjA4IEw2MTgsMjA4IEw2MDgsMTk4ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUiIHg9IjUzOCIgeT0iMjE1LjA2NjkiPiYjMjUyNzc7JiMzNTkzNzsmIzM1MjY2OyYjMjM1MTk7JiMzMjc3Mzs8L3RleHQ+PC9nPjwhLS1jbGFzcyBDb25jcmV0ZU9ic2VydmVyLS0+PGcgaWQ9ImVsZW1fQ29uY3JldGVPYnNlcnZlciI+PHJlY3QgY29kZUxpbmU9IjIyIiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjY0LjI5NjkiIGlkPSJDb25jcmV0ZU9ic2VydmVyIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjUiIHg9IjMzMS41IiB5PSIzMDciLz48ZWxsaXBzZSBjeD0iMzQ2LjUiIGN5PSIzMjMiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMzQ4Ljg0MzgsMzE4LjY3MTkgQzM0Ny45MDYzLDMxOC4yMzQ0IDM0Ny4zMTI1LDMxOC4wOTM4IDM0Ni40Mzc1LDMxOC4wOTM4IEMzNDMuODEyNSwzMTguMDkzOCAzNDEuODEyNSwzMjAuMTcxOSAzNDEuODEyNSwzMjIuODkwNiBMMzQxLjgxMjUsMzI0LjAxNTYgQzM0MS44MTI1LDMyNi41OTM4IDM0My45MjE5LDMyOC40ODQ0IDM0Ni44MTI1LDMyOC40ODQ0IEMzNDguMDMxMywzMjguNDg0NCAzNDkuMTg3NSwzMjguMTg3NSAzNDkuOTM3NSwzMjcuNjQwNiBDMzUwLjUxNTYsMzI3LjIzNDQgMzUwLjg0MzgsMzI2Ljc4MTMgMzUwLjg0MzgsMzI2LjM5MDYgQzM1MC44NDM4LDMyNS45Mzc1IDM1MC40NTMxLDMyNS41NDY5IDM0OS45ODQ0LDMyNS41NDY5IEMzNDkuNzY1NiwzMjUuNTQ2OSAzNDkuNTYyNSwzMjUuNjI1IDM0OS4zNzUsMzI1LjgxMjUgQzM0OC45MjE5LDMyNi4yOTY5IDM0OC45MjE5LDMyNi4yOTY5IDM0OC43MzQ0LDMyNi4zOTA2IEMzNDguMzEyNSwzMjYuNjU2MyAzNDcuNjI1LDMyNi43ODEzIDM0Ni44NTk0LDMyNi43ODEzIEMzNDQuODEyNSwzMjYuNzgxMyAzNDMuNTE1NiwzMjUuNjg3NSAzNDMuNTE1NiwzMjMuOTg0NCBMMzQzLjUxNTYsMzIyLjg5MDYgQzM0My41MTU2LDMyMS4xMDk0IDM0NC43NjU2LDMxOS43OTY5IDM0Ni41LDMxOS43OTY5IEMzNDcuMDc4MSwzMTkuNzk2OSAzNDcuNjg3NSwzMTkuOTUzMSAzNDguMTU2MywzMjAuMjAzMSBDMzQ4LjY0MDYsMzIwLjQ4NDQgMzQ4LjgxMjUsMzIwLjcwMzEgMzQ4LjkwNjMsMzIxLjEwOTQgQzM0OC45Njg4LDMyMS41MTU2IDM0OSwzMjEuNjQwNiAzNDkuMTQwNiwzMjEuNzY1NiBDMzQ5LjI4MTMsMzIxLjkwNjMgMzQ5LjUxNTYsMzIyLjAxNTYgMzQ5LjczNDQsMzIyLjAxNTYgQzM1MCwzMjIuMDE1NiAzNTAuMjY1NiwzMjEuODc1IDM1MC40Mzc1LDMyMS42NTYzIEMzNTAuNTQ2OSwzMjEuNSAzNTAuNTc4MSwzMjEuMzEyNSAzNTAuNTc4MSwzMjAuODkwNiBMMzUwLjU3ODEsMzE5LjQ2ODggQzM1MC41NzgxLDMxOS4wMzEzIDM1MC41NjI1LDMxOC45MDYzIDM1MC40Njg4LDMxOC43NSBDMzUwLjMxMjUsMzE4LjQ4NDQgMzUwLjAzMTMsMzE4LjM0MzggMzQ5LjczNDQsMzE4LjM0MzggQzM0OS40Mzc1LDMxOC4zNDM4IDM0OS4yMzQ0LDMxOC40Mzc1IDM0OS4wMTU2LDMxOC43NSBMMzQ4Ljg0MzgsMzE4LjY3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMiIHg9IjM2MC41IiB5PSIzMjcuODQ2NyI+Q29uY3JldGVPYnNlcnZlcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzMzIuNSIgeDI9IjQ5NS41IiB5MT0iMzM5IiB5Mj0iMzM5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzMyLjUiIHgyPSI0OTUuNSIgeTE9IjM0NyIgeTI9IjM0NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMSIgeD0iMzM3LjUiIHk9IjM2My45OTUxIj4rdXBkYXRlKE9iamVjdCk8L3RleHQ+PC9nPjxnIGlkPSJlbGVtX0dNTjE2Ij48cGF0aCBkPSJNNTMyLDMyNi41IEw1MzIsMzM1IEw0OTYuNzAxLDMzOSBMNTMyLDM0MyBMNTMyLDM1MS42MzI4IEEwLDAgMCAwIDAgNTMyLDM1MS42MzI4IEw2MTgsMzUxLjYzMjggQTAsMCAwIDAgMCA2MTgsMzUxLjYzMjggTDYxOCwzMzYuNSBMNjA4LDMyNi41IEw1MzIsMzI2LjUgQTAsMCAwIDAgMCA1MzIsMzI2LjUgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNjA4LDMyNi41IEw2MDgsMzM2LjUgTDYxOCwzMzYuNSBMNjA4LDMyNi41ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUiIHg9IjUzOCIgeT0iMzQzLjU2NjkiPiYjMjA4NTU7JiMyMDMwNzsmIzM1MjY2OyYjMjM1MTk7JiMzMjc3Mzs8L3RleHQ+PC9nPjwhLS1yZXZlcnNlIGxpbmsgU3ViamVjdCB0byBDb25jcmV0ZVN1YmplY3QtLT48ZyBpZD0ibGlua19TdWJqZWN0X0NvbmNyZXRlU3ViamVjdCI+PHBhdGggY29kZUxpbmU9IjI4IiBkPSJNMjEyLjMzNjUsMTI2LjQwODkgQzE5MC4zNTI1LDE0Ni40MDg5IDE3Ni41MzEsMTU4Ljk4MiAxNTUuNCwxNzguMjA1ICIgZmlsbD0ibm9uZSIgaWQ9IlN1YmplY3QtYmFja3RvLUNvbmNyZXRlU3ViamVjdCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSIyMjUuNjUxLDExNC4yOTYsMjA4LjI5ODgsMTIxLjk3MDgsMjE2LjM3NDEsMTMwLjg0NzEsMjI1LjY1MSwxMTQuMjk2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLXJldmVyc2UgbGluayBTdWJqZWN0IHRvIE9ic2VydmVyLS0+PGcgaWQ9ImxpbmtfU3ViamVjdF9PYnNlcnZlciI+PHBhdGggY29kZUxpbmU9IjI5IiBkPSJNMzE5LjQ4NTEsMTIxLjc1NzYgQzM0Mi44NjIxLDE0MC4zMTc2IDM2MS45MjYsMTU1LjQ1MyAzODUuMjUzLDE3My45NzQgIiBmaWxsPSJub25lIiBpZD0iU3ViamVjdC1iYWNrdG8tT2JzZXJ2ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMzEwLjA4NywxMTQuMjk2LDMxMi4yOTg5LDEyMS4xNTk1LDMxOS40ODUxLDEyMS43NTc2LDMxNy4yNzMzLDExNC44OTQxLDMxMC4wODcsMTE0LjI5NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOCIgeD0iMzA4Ljg5MiIgeT0iMTMzLjc0NjYiPjE8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjMiIHg9IjM1MS44ODI1IiB5PSIxNjIuOTc2MiI+MC4uKjwvdGV4dD48L2c+PCEtLXJldmVyc2UgbGluayBPYnNlcnZlciB0byBDb25jcmV0ZU9ic2VydmVyLS0+PGcgaWQ9ImxpbmtfT2JzZXJ2ZXJfQ29uY3JldGVPYnNlcnZlciI+PHBhdGggY29kZUxpbmU9IjMwIiBkPSJNNDIzLjI0MiwyNjQuOTMxNyBDNDIwLjg1NywyODMuNzg1NyA0MjAuMjE0LDI4OC44NjkgNDE3LjkyMiwzMDYuOTkwMSAiIGZpbGw9Im5vbmUiIGlkPSJPYnNlcnZlci1iYWNrdG8tQ29uY3JldGVPYnNlcnZlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheTo3LjAsNy4wOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNDI1LjUwMSwyNDcuMDc0LDQxNy4yODk1LDI2NC4xNzg3LDQyOS4xOTQ2LDI2NS42ODQ3LDQyNS41MDEsMjQ3LjA3NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1TUkM9W0F5eEVwMmo4QjRoQ0xLWkVJSW1rVFltZkFTZkNBWXI5ektwRXBtbEVoNGZMQ0UzWUFhWENwYXZDSnJMRzBZakh5NHlnSllxZ0lvdElVQjZ5d1Vkdy1JeVFNZi1qTUZYcUp4LWNhZUFvMm5XZUw3Q2YwMDU0VU4xZktiUGdTZWNEWk9BNmV1d29jdmt2a082MWZhOVlLZDU5S005b1lQcVRNMmI0V3RQVVZhYmNNWU5DV2M4RFZ4MU1KUjFhQlBXNGdhWExBQ2ZDcG9ZbktkWk1qVlY1bmVMRlRrbi1rTVc2NXZBRHBsYnZvS01mOVFiR2N5Y3R1NmRoellUeDlzRFEwRENGeWZDZG1hLVBVSU1mSE1jOW9RY2VkWWVqSTRhaUlJTkFCXzBHblVPVGNBcWFjbXRuMWZoUHFDMUhpQWRIclNLUU9aMDVJZVBBMmxiMERLZTZVZGZRSVdlZWhlMW5XQVJld000d2oxTzBdLS0+PC9nPjwvc3ZnPg=='>

<h3 id="部署方案"><a href="#部署方案" class="headerlink" title="部署方案"></a>部署方案</h3><ol>
<li>明确各模块依赖关系及发布部署顺序</li>
<li>确认配置项变更</li>
<li>确认数据变更，包括数据库脚本等</li>
<li>预估硬件资源</li>
</ol>
<h3 id="风险项"><a href="#风险项" class="headerlink" title="风险项"></a>风险项</h3><p>提早暴露风险，包括</p>
<ol>
<li>技术风险，比如新技术使用</li>
<li>业务排期</li>
<li>安全性</li>
</ol>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>注意，这里不是抛出问题，讨论答案，而是列出不同选项和优劣性对比，让与会者给予建议。</p>
<h3 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h3><p>分享自己在设计过程中的思考，以及遇到的问题。自己做了哪些判断和取舍。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>会议组织者需要把控进度，做好记录。</p>
]]></content>
      <categories>
        <category>标准动作</category>
      </categories>
      <tags>
        <tag>规范</tag>
      </tags>
  </entry>
  <entry>
    <title>Git常用命令</title>
    <url>/2023/09/10/tool-git/</url>
    <content><![CDATA[<h2 id="1-使用git-rebase合并多次commit"><a href="#1-使用git-rebase合并多次commit" class="headerlink" title="1. 使用git rebase合并多次commit"></a>1. 使用git rebase合并多次commit</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git rebase -i [startpoint] [endpoint]</span><br></pre></td></tr></table></figure>

<p>其中-i的意思是–interactive，即弹出交互式的界面让用户编辑完成合并操作，[startpoint] [endpoint]则指定了一个编辑区间，如果不指定[endpoint]，则该区间的终点默认是当前分支HEAD所指向的commit(注：该区间指定的是一个前开后闭的区间)。<br>在查看到了log日志后，我们运行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git rebase -i 36224db</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git rebase -i HEAD~3 </span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>每一个commit id 前面的pick表示指令类型，git 为我们提供了以下几个命令:</p>
<ul>
<li>pick：保留该commit（缩写:p）</li>
<li>reword：保留该commit，但我需要修改该commit的注释（缩写:r）</li>
<li>edit：保留该commit, 但我要停下来修改该提交(不仅仅修改注释)（缩写:e）</li>
<li>squash：将该commit和前一个commit合并（缩写:s）</li>
<li>fixup：将该commit和前一个commit合并，但我不要保留该提交的注释信息（缩写:f）</li>
<li>exec：执行shell命令（缩写:x）</li>
<li>drop：我要丢弃该commit（缩写:d）</li>
</ul>
<p>根据我们的需求，我们将commit内容编辑如下:</p>
<ul>
<li>pick d2cf1f9 fix: 第一次提交</li>
<li>s 47971f6 fix: 第二次提交</li>
<li>s fb28c8d fix: 第三次提交</li>
</ul>
<p>上面的意思就是把第二次、第三次提交都合并到第一次提交上<br>然后wq保存退出后是注释修改界面:</p>
<blockquote>
<p>可以在浏览态 按下两个dd可以删除一行</p>
</blockquote>
<p>编辑完保存即可完成commit的合并了：<br>最后查看log可以发下提交合并了</p>
<h2 id="2-git远程删除分支后，本地git-branch-a-依然能看到的解决办法"><a href="#2-git远程删除分支后，本地git-branch-a-依然能看到的解决办法" class="headerlink" title="2. git远程删除分支后，本地git branch -a 依然能看到的解决办法"></a>2. git远程删除分支后，本地git branch -a 依然能看到的解决办法</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote prune origin</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>tool</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>还在全网找IDEA激活码？快去官网免费申请JetBrains全家桶License！</title>
    <url>/2020/12/25/tool-jetbrains-open-source-license/</url>
    <content><![CDATA[<h2 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h2><blockquote>
<p>IDEA 全称 IntelliJ IDEA，是java编程语言开发的集成环境。IntelliJ在业界被公认为最好的java开发工具，尤其在智能代码助手、代码自动提示、重构、JavaEE支持、各类版本工具(git、svn等)、JUnit、CVS整合、代码分析、 创新的GUI设计等方面的功能可以说是超常的。IDEA是JetBrains公司的产品，这家公司总部位于捷克共和国的首都布拉格，开发人员以严谨著称的东欧程序员为主。</p>
</blockquote>
<span id="more"></span>

<p>从<strong>jrebel</strong>发布的Java IDE市场占有率报告来看，IDEA是最好的java开发工具已经是不争的事实。</p>
<p><img src="https://img.yuheng.wang/mweb/jrebel-idea.png" alt="jrebel-idea"></p>
<p>然后高昂的售价(1000RMB/年)虽说物有所值，但是对个人开发者而言也是一笔不小的支出。</p>
<p><img src="https://img.yuheng.wang/mweb/16088074993621.jpg" alt="-w841"></p>
<p>虽然也提供了免费的社区版本，但是相应的也阉割了很多功能。</p>
<p><img src="https://img.yuheng.wang/mweb/idea-compare.jpg" alt="idea-compare"></p>
<p>别急着说<strong>JetBrains</strong>奸商，做出好东西值得相应的回报。而且<strong>JetBrains</strong>提供了多种免费模式。</p>
<h2 id="开源项目"><a href="#开源项目" class="headerlink" title="开源项目"></a>开源项目</h2><p><strong>JetBrains</strong>为支持开源事业，如果你参与了一个开源项目，那么你就可以申请免费使用<strong>JetBrains</strong>全部企业版开发工具(IDEA、DataGrip、GoLand、PyCharm等)。有效期为1年，到期后还可以继续申请。</p>
<h3 id="资格要求"><a href="#资格要求" class="headerlink" title="资格要求"></a>资格要求</h3><ol>
<li>申请​项目必须是一个开源项目。可以在 <a href="https://opensource.org/docs/osd">https://opensource.org/docs/osd</a> 看对开源项目的定义，主要是不能收费或者基于商业盈利目的、不给贡献者发工资。。。</li>
<li>申请​人必须是项目的发起人或活跃贡献者。活跃贡献者的定义为: 在过去3个月内经常提交代码，只提交issue不算。</li>
</ol>
<h3 id="可能会担心但是不作为要求"><a href="#可能会担心但是不作为要求" class="headerlink" title="可能会担心但是不作为要求"></a>可能会担心但是不作为要求</h3><ol>
<li>不要求质量</li>
<li>不要求star数量</li>
<li>不要求已发布公共仓库(如: java发布maven中央仓库)</li>
</ol>
<h3 id="如何申请"><a href="#如何申请" class="headerlink" title="如何申请"></a>如何申请</h3><p>通过官网提交表单申请 <a href="https://www.jetbrains.com/shop/eform/opensource?product=ALL">https://www.jetbrains.com/shop/eform/opensource?product=ALL</a></p>
<p><img src="https://img.yuheng.wang/mweb/jetbrains-apply.png" alt="jetbrains-apply"></p>
<h3 id="审核"><a href="#审核" class="headerlink" title="审核"></a>审核</h3><p>提交表单后，会立即收到确认邮件。并在之后的1-2周内对你的开源项目的评估。<br>需要注意，表单中提交的email地址要和github中的email地址一致，并且要在github中公开你的email地址，以此证明你的身份。<br>评估结果同样会通过邮件的形式进行回复。如果未通过，会在邮件中说明原因，并鼓励你继续完善开源项目，已通过评估。如果通过评估，则会将<code>Licenses</code>通过邮件发送给你。此时可以通过邮件中的链接，在官网选择将<code>Licenses</code>授权给哪些<strong>JetBrains</strong>账号，或者直接使用激活码使用。</p>
<p><img src="https://img.yuheng.wang/mweb/jetbrains-license.jpg" alt="jetbrains-license"></p>
<h3 id="感谢支持"><a href="#感谢支持" class="headerlink" title="感谢支持"></a>感谢支持</h3><p>除了回复邮件表达感谢外，也可以按照邮件中的建议，下载对应的logo，并在你的开源项目readme中添加对应的链接指向官网。当然，这些都是自愿的。</p>
<p><img src="https://img.yuheng.wang/mweb/jetbrains-support.jpg" alt="jetbrains-support"></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>我是通过 <a href="https://github.com/YituHealthcare/Arc">https://github.com/YituHealthcare/Arc</a> 申请到的<code>Licenses</code> </li>
<li>如果你拥有<strong>edu</strong>邮箱，或者是<strong>GitHub Student Developer Pack</strong> 可以发起教育用途申请。同样可以申请<strong>JetBrains</strong>全部企业版开发工具，并且可以直接申请多个学年的有效期。<a href="https://www.jetbrains.com/shop/eform/students">https://www.jetbrains.com/shop/eform/students</a> </li>
</ol>
]]></content>
      <categories>
        <category>tool</category>
      </categories>
      <tags>
        <tag>tool</tag>
        <tag>开源</tag>
      </tags>
  </entry>
  <entry>
    <title>朋友，你听说过单元测试吗</title>
    <url>/2021/03/18/ut/</url>
    <content><![CDATA[<blockquote>
<p>以终为始，拆解任务</p>
</blockquote>
<span id="more"></span>

<p>在软件研发过程中，小到一个函数，大到一个平台，都是为了达成某个目标。<br>在达成目标的过程中，分治思想可以帮助我们完成任务的拆解，以终为始则引导我们先确定验收标准，以便明确任务发布者和实施者的理解是一致的，并且保障整体进度可感知。<br>当然，这些只是思想，面对知易行难的困境，<strong>单元测试</strong>可以作为我们落地实践的一个<strong>抓手</strong>。</p>
<p><strong>抓手: 一口锅，如果没有抓手，就会扣在那里。有了抓手，就可以甩出去。</strong></p>
<h2 id="误区"><a href="#误区" class="headerlink" title="误区"></a>误区</h2><h3 id="Q"><a href="#Q" class="headerlink" title="Q"></a>Q</h3><ol>
<li>谁来测试</li>
<li>单测是额外的工作量</li>
<li>代码不好测试</li>
<li>先写代码还是先测试?</li>
</ol>
<h3 id="A"><a href="#A" class="headerlink" title="A"></a>A</h3><ul>
<li>1&amp;2: 测试其实已经在潜移默化的进行了，贯穿整个开发过程。完成的功能一定是测试(运行)过的</li>
<li>3&amp;4: 写好的代码不好补充单测，在编码之前先通过单测明确目标及完成任务拆解</li>
</ul>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p><strong>编写可测试的代码。</strong></p>
<p>理想情况下，我们将任务拆分为独立验收的测试用例，此时运行一次，可以看到所有用例均为RED(Fail)。<br>完成任务的过程就是通过我们的代码实现，一个个将这些用例变绿(Success)。<br>同时，通过红绿比例，可以大致评估任务完成进度。<br>最重要的是，当我们完成一个base版本之后，因为有用例存在，我们可以放心的进行重构，只要保障所有用例都是GREEN即可。</p>
<p>先完成base版本也是另一种任务拆解方式，通过小步快跑来降低复杂性。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzMDNweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjQ5OXB4O2hlaWdodDozMDNweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA0OTkgMzAzIiB3aWR0aD0iNDk5cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZyBpZD0iZWxlbV9BIj48ZWxsaXBzZSBjeD0iMzQzLjE5ODUiIGN5PSIxMDUuNTIzNiIgZmlsbD0iI0ZGMDAwMCIgcng9IjMyLjY5ODUiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjRkZGRkZGIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMCIgeD0iMzI4LjE3MDkiIHk9IjEwOC4zODEiPlJFRDwvdGV4dD48L2c+PGcgaWQ9ImVsZW1fQiI+PGVsbGlwc2UgY3g9IjQxNi4xMjk5IiBjeT0iMTk1LjY1NjIiIGZpbGw9IiMwMDgwMDAiIHJ4PSI0Ni42Mjk5IiByeT0iMTQuNjU2MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iI0ZGRkZGRiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDkiIHg9IjM4OC42Mjk5IiB5PSIxOTkuNDAzOCI+R1JFRU48L3RleHQ+PC9nPjxnIGlkPSJlbGVtX0MiPjxlbGxpcHNlIGN4PSIyNjkuODk2MyIgY3k9IjE5NS4yNzkzIiBmaWxsPSIjODAwMDgwIiByeD0iNjQuMzk2MyIgcnk9IjE1LjI3OTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiNGRkZGRkYiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc3IiB4PSIyMjguMzk2MyIgeT0iMTk5LjAyNjgiPlJFRkFDVE9SPC90ZXh0PjwvZz48ZyBpZD0iZWxlbV9HTU41Ij48cGF0aCBkPSJNMjYzLDYgTDI2MywzMS4xMzI4IEEwLDAgMCAwIDAgMjYzLDMxLjEzMjggTDMzOSwzMS4xMzI4IEwzNDMsOTAuODE0IEwzNDcsMzEuMTMyOCBMNDIzLDMxLjEzMjggQTAsMCAwIDAgMCA0MjMsMzEuMTMyOCBMNDIzLDE2IEw0MTMsNiBMMjYzLDYgQTAsMCAwIDAgMCAyNjMsNiAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00MTMsNiBMNDEzLDE2IEw0MjMsMTYgTDQxMyw2ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5IiB4PSIyNjkiIHk9IjIzLjA2NjkiPldyaXRlIGEgdGVzdCB0aGF0IGZhaWxzLjwvdGV4dD48L2c+PGcgaWQ9ImVsZW1fR01OOCI+PHBhdGggZD0iTTMzOS41LDI3MSBMMzM5LjUsMjk2LjEzMjggQTAsMCAwIDAgMCAzMzkuNSwyOTYuMTMyOCBMNDkyLjUsMjk2LjEzMjggQTAsMCAwIDAgMCA0OTIuNSwyOTYuMTMyOCBMNDkyLjUsMjgxIEw0ODIuNSwyNzEgTDQyMCwyNzEgTDQxNiwyMTAuMzE3NCBMNDEyLDI3MSBMMzM5LjUsMjcxIEEwLDAgMCAwIDAgMzM5LjUsMjcxICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTQ4Mi41LDI3MSBMNDgyLjUsMjgxIEw0OTIuNSwyODEgTDQ4Mi41LDI3MSAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMiIgeD0iMzQ1LjUiIHk9IjI4OC4wNjY5Ij5NYWtlIHRoZSBjb2RlIHdvcmsuPC90ZXh0PjwvZz48ZyBpZD0iZWxlbV9HTU4xMSI+PHBhdGggZD0iTTYsMTgzIEw2LDIwOC4xMzI4IEEwLDAgMCAwIDAgNiwyMDguMTMyOCBMMTcwLDIwOC4xMzI4IEEwLDAgMCAwIDAgMTcwLDIwOC4xMzI4IEwxNzAsMjAxIEwyMDUuMjMsMTk1LjUgTDE3MCwxOTMgTDE3MCwxOTMgTDE2MCwxODMgTDYsMTgzIEEwLDAgMCAwIDAgNiwxODMgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTYwLDE4MyBMMTYwLDE5MyBMMTcwLDE5MyBMMTYwLDE4MyAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MyIgeD0iMTIiIHk9IjIwMC4wNjY5Ij5FbGltaW5hdGUgcmVkdW5kYW5jeS48L3RleHQ+PC9nPjwhLS1saW5rIEEgdG8gQi0tPjxnIGlkPSJsaW5rX0FfQiI+PHBhdGggZD0iTTM1My43NzEsMTE5LjQ4NSBDMzY3LjQ5NCwxMzYuMDI3IDM4Ny4yNTczLDE1OS44NTEgNDAxLjExNDMsMTc2LjU1NiAiIGZpbGw9Im5vbmUiIGlkPSJBLXRvLUIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDA0Ljk0NSwxODEuMTc0LDQwMi4yNzc2LDE3MS42OTMyLDQwMS43NTI4LDE3Ny4zMjU3LDM5Ni4xMjAzLDE3Ni44MDA4LDQwNC45NDUsMTgxLjE3NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgQyB0byBCLS0+PGcgaWQ9ImxpbmtfQ19CIj48cGF0aCBkPSJNMzQwLjczLDE5NS41IEMzNTIuMjY1LDE5NS41IDM1Ny43OTksMTk1LjUgMzY5LjMzNCwxOTUuNSAiIGZpbGw9Im5vbmUiIGlkPSJDLWJhY2t0by1CIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMzNC43MywxOTUuNSwzNDMuNzMsMTk5LjUsMzM5LjczLDE5NS41LDM0My43MywxOTEuNSwzMzQuNzMsMTk1LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEEgdG8gQy0tPjxnIGlkPSJsaW5rX0FfQyI+PHBhdGggZD0iTTMyOC4zOTgsMTI0LjEwMjcgQzMxNC45OTIsMTQwLjI2MTcgMjk1Ljk5OCwxNjMuMTYgMjgyLjAzMSwxNzkuOTk2ICIgZmlsbD0ibm9uZSIgaWQ9IkEtYmFja3RvLUMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzMyLjIyOSwxMTkuNDg1LDMyMy40MDQsMTIzLjg1NzYsMzI5LjAzNjUsMTIzLjMzMzEsMzI5LjU2MSwxMjguOTY1NiwzMzIuMjI5LDExOS40ODUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tU1JDPVtWU18xUWlDbTQwSkdreHZZWUNfRTF2R3NPQWpBSnN0MTE3OU14TkxqZWNZRGpDQmF4eERFVXNybG1fQTZPS2tjdGNWMnhkZGFBRVd2UzdmUGZyZGVxQmRON05uNldvaEhPQ2hWeWdycHhrRFhNckpWWUlaLWZwanRSRXBmaXRpS0JBZ2JmMk1HQ1A2NThCbzBIenJ5bVpjZlhlVEc1aVphMVFFVkd6eF9tMnlNdVVqY014TmxfZ0JUWU5IZThBb1NCaHlpcTJXUmllZlNjQXpwejdoTFZxZVNWRW5sVXNEQ1d0aFdEVE83akFQNWxMS3FNc0RIYnFMSlNtUzBdLS0+PC9nPjwvc3ZnPg=='>

<h2 id="Manual"><a href="#Manual" class="headerlink" title="Manual"></a>Manual</h2><p>测试用例需要一些经验技巧，列举下列非主流场景代码作为参考。</p>
<h3 id="1-是否需要针对外部系统调用编写单测"><a href="#1-是否需要针对外部系统调用编写单测" class="headerlink" title="1. 是否需要针对外部系统调用编写单测?"></a>1. 是否需要针对外部系统调用编写单测?</h3><p>不需要。各系统内部保障鲁棒性，调用方依照接口约定进行mock。<br>开发调试阶段，可以编写 debug 代码。 通过<code>@Ignore</code> ｜ <code>@Disabled</code> 忽略执行。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Ignore</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OuterAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request_for_debug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String result = <span class="keyword">new</span> RestTemplate().getForObject(<span class="string">&quot;http://www.baidu.com&quot;</span>, String.class);</span><br><span class="line">        assertNull(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-依赖方法执行顺序"><a href="#2-依赖方法执行顺序" class="headerlink" title="2. 依赖方法执行顺序"></a>2. 依赖方法执行顺序</h3><p><strong>破坏了独立测试原则！</strong>每个测试case应该彼此独立运行测试，不应该存在顺序依赖。</p>
<p>junit5提供<code>@TestMethodOrder</code>用于控制测试方法执行顺序。包括</p>
<ol>
<li><code>OrderAnnotation</code>: 通过<code>Order</code>指定方法顺序</li>
<li><code>MethodName</code>: 方法名称字母顺序</li>
<li><code>Random</code>: 随机。可能每次运行不一致，不可预期</li>
<li><code>DisplayName</code>: <code>@DisplayName</code>指定显示名称字母顺序</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.api.TestMethodOrder(org.junit.jupiter.api.MethodOrderer.OrderAnnotation.class)</span><br><span class="line"><span class="comment">//@org.junit.jupiter.api.TestMethodOrder(MethodOrderer.Random.class)</span></span><br><span class="line"><span class="comment">//@org.junit.jupiter.api.TestMethodOrder(MethodOrderer.MethodName.class)</span></span><br><span class="line"><span class="comment">//@org.junit.jupiter.api.TestMethodOrder(MethodOrderer.DisplayName.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCaseRequireOrder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.DisplayName(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Order(<span class="number">3</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.DisplayName(<span class="string">&quot;b&quot;</span>)</span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Order(<span class="number">1</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">c</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.DisplayName(<span class="string">&quot;c&quot;</span>)</span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Order(<span class="number">2</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>junit4中为 <code>@FixMethodOrder(MethodSorters.NAME_ASCENDING)</code></p>
<h3 id="3-用例方法执行N次"><a href="#3-用例方法执行N次" class="headerlink" title="3. 用例方法执行N次"></a>3. 用例方法执行N次</h3><p><strong>破坏了可重复性原则！</strong></p>
<p><code>@RepeatedTest</code>可以指定方法执行次数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.api.RepeatedTest(value = <span class="number">3</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">repeat_print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="keyword">new</span> java.util.Random().nextInt());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-用例方法抛出某个异常"><a href="#4-用例方法抛出某个异常" class="headerlink" title="4. 用例方法抛出某个异常"></a>4. 用例方法抛出某个异常</h3><p>junit5中<code>Assertions</code>提供了异常断言</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_throw_exception</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Assertions.assertDoesNotThrow(()-&gt;&#123;Arrays.asList(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>).get(<span class="number">1</span>);&#125;);</span><br><span class="line">    Assertions.assertThrows(IndexOutOfBoundsException.class, ()-&gt;&#123;Arrays.asList(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>).get(<span class="number">10</span>);&#125;, <span class="string">&quot;should over bounds&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>junit4中通过<code>@Rule</code>配合<code>@ExpectedException</code>完成异常断言</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.Rule</span><br><span class="line"><span class="keyword">public</span> org.junit.rules.ExpectedException thrown = org.junit.rules.ExpectedException.none();</span><br><span class="line"></span><br><span class="line"><span class="meta">@org</span>.junit.Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_throw_exception</span><span class="params">()</span></span>&#123;</span><br><span class="line">    thrown.expect(IndexOutOfBoundsException.class);</span><br><span class="line">    Arrays.asList(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>).get(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-N个断言放在一组"><a href="#5-N个断言放在一组" class="headerlink" title="5. N个断言放在一组"></a>5. N个断言放在一组</h3><p>通过<code>Assertions.assertAll</code>将语义相同的多个断言聚合成一组，并指定heading。因为<code>assertAll</code>也是一种<code>Assertions</code>，所以可以嵌套判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assert_collect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; fields = Arrays.asList(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">    Assertions.assertAll(<span class="string">&quot;field check&quot;</span>,</span><br><span class="line">            () -&gt; Assertions.assertTrue(fields.size() &gt; <span class="number">1</span>),</span><br><span class="line">            () -&gt; Assertions.assertAll(<span class="string">&quot;id check&quot;</span>,</span><br><span class="line">                    () -&gt; Assertions.assertTrue(fields.contains(<span class="string">&quot;id&quot;</span>)),</span><br><span class="line">                    () -&gt; Assertions.assertEquals(<span class="string">&quot;id&quot;</span>, fields.get(<span class="number">1</span>))</span><br><span class="line">            )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一种聚合方式则是通过内嵌测试类 <code>Nested</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; fields = Arrays.asList(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_not_empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Assertions.assertTrue(fields.size() &gt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@org</span>.junit.jupiter.api.Nested</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IdChecker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_contains_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Assertions.assertTrue(fields.contains(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">id_by_first</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Assertions.assertEquals(<span class="string">&quot;id&quot;</span>, fields.get(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-方法超时断言"><a href="#6-方法超时断言" class="headerlink" title="6. 方法超时断言"></a>6. 方法超时断言</h3><p><code>assertTimeout</code>和<code>assertTimeoutPreemptively</code>的区别是：<code>assertTimeout</code>会等待方法执行运行结束，而<code>assertTimeoutPreemptively</code>会在超过预期运行时长后立即结束。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_timeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Assertions.assertTimeout(Duration.ofSeconds(<span class="number">1</span>), () -&gt; Thread.sleep(<span class="number">2000</span>), <span class="string">&quot;method execute time over 2 seconds&quot;</span>);</span><br><span class="line">    Assertions.assertTimeoutPreemptively(Duration.ofSeconds(<span class="number">1</span>), () -&gt; Thread.sleep(<span class="number">20000</span>), <span class="string">&quot;method execute time over 2 seconds&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-逻辑相同，数据不同"><a href="#7-逻辑相同，数据不同" class="headerlink" title="7. 逻辑相同，数据不同"></a>7. 逻辑相同，数据不同</h3><p><code>@ParameterizedTest</code> 配合 <code>xxxSource</code> 完成参数化测试。Source包括</p>
<ol>
<li>CsvSource: csv格式数据</li>
<li>CsvFileSource: 远程csv文件</li>
<li>ValueSource: 基本类型</li>
<li>EnumSource: 枚举</li>
<li>MethodSource: 反射调用静态方法，需要满足<ol>
<li>static 方法</li>
<li>无入参</li>
<li>返回值可迭代</li>
</ol>
</li>
<li>ArgumentSource: 自定义参数扩展</li>
</ol>
<p>CsvSource 使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.params.ParameterizedTest</span><br><span class="line"><span class="meta">@org</span>.junit.jupiter.params.provider.CsvSource(&#123;<span class="string">&quot;1,1,2&quot;</span>, <span class="string">&quot;2,4,6&quot;</span>, <span class="string">&quot;3,3,6&quot;</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> total)</span> </span>&#123;</span><br><span class="line">    Assertions.assertEquals(a + b, total);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MethodSource 使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.params.ParameterizedTest</span><br><span class="line"><span class="meta">@org</span>.junit.jupiter.params.provider.MethodSource(&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">even_check</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">    Assertions.assertEquals(<span class="number">0</span>, a % <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> Stream&lt;Integer&gt; <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> List&lt;Integer&gt; <span class="title">b</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span>[] c() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArgumentSource 使用。背景为测试graphql生成多个java文件的代码生成器。</p>
<p>需要实现 <code>ArgumentsProvider</code> 并提供相关Anno及Bean作为信息载体</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CodeGenResourceProvider</span> <span class="keyword">implements</span> <span class="title">ArgumentsProvider</span>, <span class="title">AnnotationConsumer</span>&lt;<span class="title">CodeGenResources</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;CodeGenResourceArgument&gt; arguments = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CodeGenResources codeGenResources)</span> </span>&#123;</span><br><span class="line">        Arrays.stream(codeGenResources.value())</span><br><span class="line">                .map(it -&gt; <span class="keyword">new</span> CodeGenResourceArgument(it.basePackage(),</span><br><span class="line">                        it.generatorClazz(),</span><br><span class="line">                        it.sourceGraphqlSchemaPath(),</span><br><span class="line">                        it.generatedJavaCodePaths()))</span><br><span class="line">                .forEach(it -&gt; arguments.add(it));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Stream&lt;? extends Arguments&gt; provideArguments(ExtensionContext context) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> arguments.stream().map(Arguments::of);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@CodeGenResources(&#123;</span></span><br><span class="line"><span class="meta">        @CodeGenResource(generatorClazz = DataFetcherGenerator.class, sourceGraphqlSchemaPath = &quot;data_fetcher_test.graphqls&quot;, generatedJavaCodePaths = &#123;&quot;data_fetcher_test_ProjectDataFetcher.java&quot;, &quot;data_fetcher_test_MutationDataFetcher.java&quot;, &quot;data_fetcher_test_QueryDataFetcher.java&quot;&#125;),</span></span><br><span class="line"><span class="meta">        @CodeGenResource(generatorClazz = DictionaryGenerator.class, sourceGraphqlSchemaPath = &quot;dictionary_test.graphqls&quot;, generatedJavaCodePaths = &#123;&quot;dictionary_test_E1.java&quot;&#125;),</span></span><br><span class="line"><span class="meta">        @CodeGenResource(generatorClazz = InputGenerator.class, sourceGraphqlSchemaPath = &quot;input_test.graphqls&quot;, generatedJavaCodePaths = &#123;&quot;input_test_I1.java&quot;&#125;),</span></span><br><span class="line"><span class="meta">        @CodeGenResource(generatorClazz = RepositoryGenerator.class, sourceGraphqlSchemaPath = &quot;repository_test.graphqls&quot;, generatedJavaCodePaths = &#123;&quot;repository_test_ProjectRepository.java&quot;&#125;),</span></span><br><span class="line"><span class="meta">        @CodeGenResource(generatorClazz = TypeGenerator.class, sourceGraphqlSchemaPath = &quot;type_test.graphqls&quot;, generatedJavaCodePaths = &#123;&quot;type_test_Milestone.java&quot;, &quot;type_test_Mutation.java&quot;, &quot;type_test_Project.java&quot;, &quot;type_test_Query.java&quot;, &quot;type_test_User.java&quot;&#125;),</span></span><br><span class="line"><span class="meta">        @CodeGenResource(generatorClazz = TypeGenerator.class, sourceGraphqlSchemaPath = &quot;type_union_test.graphqls&quot;, generatedJavaCodePaths = &#123;&quot;type_union_test_Milestone.java&quot;, &quot;type_union_test_Entity.java&quot;, &quot;type_union_test_Project.java&quot;&#125;),</span></span><br><span class="line"><span class="meta">        @CodeGenResource(generatorClazz = TypeGenerator.class, sourceGraphqlSchemaPath = &quot;type_interface_test.graphqls&quot;, generatedJavaCodePaths = &#123;&quot;type_interface_test_Milestone.java&quot;, &quot;type_interface_test_Entity.java&quot;, &quot;type_interface_test_Project.java&quot;&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gen_e2e_test</span><span class="params">(CodeGenResourceArgument argument)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, IOException </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-测试servlet"><a href="#8-测试servlet" class="headerlink" title="8. 测试servlet"></a>8. 测试servlet</h3><p>spring-test提供了相关mock类，包括request、response、cookie、MockMultipartFile等，可以查看<code>org.springframework.mock.web</code>包下的class</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">should_return_true_when_not_enable_and_header_auth_existed</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    MockHttpServletRequest request = <span class="keyword">new</span> MockHttpServletRequest();</span><br><span class="line">    MockHttpServletResponse response = <span class="keyword">new</span> MockHttpServletResponse();</span><br><span class="line">    request.addHeader(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;xxxx&quot;</span>);</span><br><span class="line">    assertTrue(loginInterceptor.preHandle(request, response, <span class="keyword">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-修改私有变量"><a href="#9-修改私有变量" class="headerlink" title="9. 修改私有变量"></a>9. 修改私有变量</h3><p>可以通过反射完成。spring-test提供了相关封装工具类<code>ReflectionTestUtils</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set_private_field</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">org.springframework.test.util.ReflectionTestUtils.setField(a,<span class="string">&quot;b&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">        Assertions.assertEquals(<span class="string">&quot;123&quot;</span>,a.getB());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String b;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-结果可能是A或者B"><a href="#10-结果可能是A或者B" class="headerlink" title="10. 结果可能是A或者B"></a>10. 结果可能是A或者B</h3><p>借助<code>hamcrest</code>提供的<code>anyOf</code>or<code>oneOf</code>完成断言。<br>除此之外，<code>hamcrest</code>还提供了大量声明式的<code>Matchers</code>，提升用例的阅读性。比如: <code>hasProperty</code>、<code>greaterThanOrEqualTo</code>、<code>equalToIgnoringWhiteSpace</code> 等</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.jupiter.api.Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set_private_field</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a = <span class="keyword">new</span> A();</span><br><span class="line">    ReflectionTestUtils.setField(a,<span class="string">&quot;b&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">    org.hamcrest.MatcherAssert.assertThat(a.getB(), isOneOf(<span class="string">&quot;123&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>));</span><br><span class="line">    org.hamcrest.MatcherAssert.assertThat(a.getB(), is(oneOf(<span class="string">&quot;123&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>)));</span><br><span class="line">    org.hamcrest.MatcherAssert.assertThat(a.getB(), anyOf(equalTo(<span class="string">&quot;123&quot;</span>), equalTo(<span class="string">&quot;2&quot;</span>), equalTo(<span class="string">&quot;3&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="流派"><a href="#流派" class="headerlink" title="流派"></a>流派</h2><p>框架体系复杂，但是文档完善。不展开描述，可以直接查阅相关使用。</p>
<h3 id="0-Spring"><a href="#0-Spring" class="headerlink" title="0. Spring"></a>0. Spring</h3><p>通过<code>@SpringBootTest</code>启动Spring容器、完成组件注册</p>
<h3 id="1-持久化"><a href="#1-持久化" class="headerlink" title="1. 持久化"></a>1. 持久化</h3><p>也是反原则的需求。一般通过embedded数据库完成。</p>
<ol>
<li>redis -&gt; it.ozimov.embedded-redis</li>
<li>mysql -&gt; com.h2database.h2</li>
<li>mongodb -&gt; de.flapdoodle.embed.mongo</li>
<li>http -&gt; com.github.dreamhead.moco-core 启动一个http服务，基于json配置response body &amp; header 等。作为非<code>RestTemplate</code> client无法使用<code>MockRestServiceServer</code>的补充</li>
</ol>
<h3 id="2-Mock"><a href="#2-Mock" class="headerlink" title="2. Mock"></a>2. Mock</h3><p>推荐使用的方案。对方法及返回值进行mock，避免对要测试的方法逻辑产生干扰。</p>
<ol>
<li>mockito</li>
<li>PowerMock</li>
</ol>
<p>PowerMock 对 static、private方法进行了增强。 如：统计私有方法被调用次数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(PowerMockRunner.class)</span></span><br><span class="line"><span class="meta">@PrepareForTest(BizService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 私有方法调用 </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">count_handle_private_method_times</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        BizService bizService = PowerMockito.spy(<span class="keyword">new</span> BizService(PowerMockito.mock(CommonRepo.class)));</span><br><span class="line">        bizService.biz(<span class="number">10</span>);</span><br><span class="line">        PowerMockito.verifyPrivate(bizService, <span class="keyword">new</span> Times(<span class="number">10</span>)).invoke(<span class="string">&quot;secret&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BizService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> CommonRepo commonRepo;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BizService</span><span class="params">(CommonRepo commonRepo)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.commonRepo = commonRepo;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">biz</span><span class="params">(<span class="keyword">int</span> times)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (times-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.secret();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">secret</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;do private&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonRepo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>有没有想在下次迭代中，尝试先写一个<code>@Test</code>？</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>知识点</tag>
        <tag>测试</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 通过yum方式安装MongoDB-3.2</title>
    <url>/2016/05/18/virtualbox-mongodb/</url>
    <content><![CDATA[<p>转载请注明出处<a href="http://blog.crick.wang/">WangYuheng’s Blog</a></p>
<p>工作需要，在虚拟机中安装了一个CentOS7的linux环境，用来测试MongoDB。记录一下MongoDB的安装和配置过程。</p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p>安装过程通过yum方式，需要配置repo。</p>
<h3 id="配置repo"><a href="#配置repo" class="headerlink" title="配置repo"></a>配置repo</h3><pre><code>vi /etc/yum.repos.d/mongodb-org-3.2.repo
</code></pre>
<p>通过命令打开文档，输入如下内容</p>
<pre><code>[mongodb-org-3.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-3.2.asc
</code></pre>
<h3 id="执行yum安装"><a href="#执行yum安装" class="headerlink" title="执行yum安装"></a>执行yum安装</h3><pre><code>sudo yum install -y mongodb-org
</code></pre>
<h3 id="设置mongodb监听端口"><a href="#设置mongodb监听端口" class="headerlink" title="设置mongodb监听端口"></a>设置mongodb监听端口</h3><pre><code>semanage port -a -t mongod_port_t -p tcp 27017
</code></pre>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><pre><code>sudo service mongod start
</code></pre>
<h3 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h3><pre><code>chkconfig mongod on
</code></pre>
<p>此时会看到服务启动成功的提示 【OK】</p>
<h2 id="开发调试"><a href="#开发调试" class="headerlink" title="开发调试"></a>开发调试</h2><p>在虚拟机中安装好环境后，如何用本机环境进行开发访问？<br>本机为windows环境并没有安装mongodb客户端程序，无法通过命令行直接访问，全部依赖于java代码访问。<br>此时有个问题，mongodb安装完成后，默认只监听本机ip(localhost)，必须要修改绑定</p>
<h3 id="查看本机ip"><a href="#查看本机ip" class="headerlink" title="查看本机ip"></a>查看本机ip</h3><p>为了让mongodb监听虚拟机的ip(局域网内ip)，必须先将虚拟机的网络连接环境设置为桥接。通过命令查看</p>
<pre><code>ifconfig
</code></pre>
<p>注：因为我的安装镜像为mini.iso，默认并没有安装网络工具，此时可能会报错<br>ifconfig command not found，需要先安装此工具集</p>
<pre><code>yum install net-tools
</code></pre>
<h3 id="修改绑定监听IP"><a href="#修改绑定监听IP" class="headerlink" title="修改绑定监听IP"></a>修改绑定监听IP</h3><pre><code>vi /etc/mongod.conf
</code></pre>
<p>打开文档，并将bind_ip修改为ifconfig查看到的本地ip</p>
<h3 id="重启mongodb服务"><a href="#重启mongodb服务" class="headerlink" title="重启mongodb服务"></a>重启mongodb服务</h3><pre><code>sudo service mongod restart
</code></pre>
<h3 id="创建集合（数据库）"><a href="#创建集合（数据库）" class="headerlink" title="创建集合（数据库）"></a>创建集合（数据库）</h3><p>需要进入mongo后，才可以执行mongo相关命令。进入方式为执行如下命令。默认ip为127.0.0.1，因为修改过bind_ip，所以此处的ip地址为刚配置的bing_ip</p>
<pre><code>mongo ip地址
</code></pre>
<p>创建集合</p>
<pre><code>use zero
</code></pre>
<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>mongodb默认为允许匿名用户访问，可以通过以下命令添加此集合的管理员账户</p>
<pre><code>db.createUser(&#123;user:&#39;zero_admin&#39;,pwd:&#39;zero_123456&#39;,roles:[&#123;role:&#39;dbOwner&#39;,db:&#39;zero&#39;&#125;]&#125;) 
</code></pre>
<p>至此，已完成在虚拟机中搭建mongodb服务，并可在本机程序访问调试。下篇文章将介绍如何通过java程序连接mongodb</p>
]]></content>
      <categories>
        <category>NoSql</category>
      </categories>
      <tags>
        <tag>NoSql</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>监控告警 http 代理企业微信服务</title>
    <url>/2018/04/06/wechat-message-proxy/</url>
    <content><![CDATA[<h2 id="1-项目背景"><a href="#1-项目背景" class="headerlink" title="1. 项目背景"></a>1. 项目背景</h2><p>朋友在一家日企，运维工具老旧，希望增加一款系统告警工具。我提议通过微信企业号（改版为企业微信）或者短信推送告警信息。提出两点要求：</p>
<ol>
<li>可以群发给企业微信中的多个人</li>
<li>监测健康检测服务是否存活（绕嘴。。）</li>
</ol>
<p>做了第一版demo，定位为通信渠道的http代理。贴出企业微信相关代码，如果有需要的同学可以拿去用，记得点个star就好。<br><a href="https://github.com/wangyuheng/pharos">https://github.com/wangyuheng/pharos</a> </p>
<h3 id="1-1-依赖项目"><a href="#1-1-依赖项目" class="headerlink" title="1.1 依赖项目"></a>1.1 依赖项目</h3><p>因为定位为http代理，并未使用数据库及持久化工具。</p>
<ol>
<li>springboot </li>
<li>企业微信接口 <a href="https://work.weixin.qq.com/api/doc">https://work.weixin.qq.com/api/doc</a> </li>
<li>可能是目前最好最全的微信Java开发工具包（SDK）<a href="https://github.com/Wechat-Group/weixin-java-tools">https://github.com/Wechat-Group/weixin-java-tools</a></li>
<li>swagger 工具 <a href="https://github.com/wangyuheng/spring-boot-swagger-starter">https://github.com/wangyuheng/spring-boot-swagger-starter</a></li>
</ol>
<h2 id="2-项目code"><a href="#2-项目code" class="headerlink" title="2. 项目code"></a>2. 项目code</h2><p>代理入口为健康检测工具，出口为企业微信、短信等。同时需要保障和健康检测工具之间的网络通畅。</p>
<p><img src="http://img.yuheng.wang/wechat-message-proxy-00.png" alt="wechat-message-proxy-00"></p>
<p>最近在尝试画图</p>
<h3 id="2-1-微信接口"><a href="#2-1-微信接口" class="headerlink" title="2.1 微信接口"></a>2.1 微信接口</h3><p>企业微信相关配置如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wechat:</span><br><span class="line">  cp:</span><br><span class="line">    corpid:</span><br><span class="line">    agentid:</span><br><span class="line">    corp:</span><br><span class="line">      secret:</span><br></pre></td></tr></table></figure>

<ol>
<li>corpid 企业ID</li>
<li>agentid 应用ID，在企业微信管理后台创建应用后，可以查看应用ID</li>
<li>corp.secret 应用的凭证密钥</li>
</ol>
<p>weixin-java-tools已经对微信接口进行了友好的封装，可以通过标签、部门等分组，查询用户标识。配置bean方法如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.crick.business.pharos.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.api.WxCpService;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.api.impl.WxCpDepartmentServiceImpl;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.api.impl.WxCpServiceImpl;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.api.impl.WxCpTagServiceImpl;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.api.impl.WxCpUserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.config.WxCpConfigStorage;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.config.WxCpInMemoryConfigStorage;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(WxCpService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatCpConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wechat.cp.corpid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String corpid;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wechat.cp.corp.secret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String corpSecret;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wechat.cp.agentid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer agentid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WxCpConfigStorage <span class="title">configStorage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        WxCpInMemoryConfigStorage configStorage = <span class="keyword">new</span> WxCpInMemoryConfigStorage();</span><br><span class="line">        logger.info(<span class="string">&quot;****************wechat properties start****************&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;corpid:&#123;&#125;&quot;</span>, corpid);</span><br><span class="line">        logger.info(<span class="string">&quot;corpSecret:&#123;&#125;&quot;</span>, corpSecret);</span><br><span class="line">        logger.info(<span class="string">&quot;agentid:&#123;&#125;&quot;</span>, agentid);</span><br><span class="line">        logger.info(<span class="string">&quot;****************wechat properties end****************&quot;</span>);</span><br><span class="line">        configStorage.setCorpId(corpid);</span><br><span class="line">        configStorage.setCorpSecret(corpSecret);</span><br><span class="line">        configStorage.setAgentId(agentid);</span><br><span class="line">        <span class="keyword">return</span> configStorage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WxCpService <span class="title">WxCpService</span><span class="params">(WxCpConfigStorage configStorage)</span> </span>&#123;</span><br><span class="line">        WxCpService wxCpService = <span class="keyword">new</span> WxCpServiceImpl();</span><br><span class="line">        wxCpService.setWxCpConfigStorage(configStorage);</span><br><span class="line">        wxCpService.setTagService(<span class="keyword">new</span> WxCpTagServiceImpl(wxCpService));</span><br><span class="line">        wxCpService.setDepartmentService(<span class="keyword">new</span> WxCpDepartmentServiceImpl(wxCpService));</span><br><span class="line">        wxCpService.setUserService(<span class="keyword">new</span> WxCpUserServiceImpl(wxCpService));</span><br><span class="line">        <span class="keyword">return</span> wxCpService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时也提供了发送消息、已经封装消息的类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.crick.business.pharos.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.bean.WxCpMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlertTextBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer agentid;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AlertTextBuilder</span><span class="params">(Integer agentid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.agentid = agentid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WxCpMessage <span class="title">buildForTag</span><span class="params">(String content, String tag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> WxCpMessage.TEXT().agentId(agentid).content(content).toTag(tag).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WxCpMessage <span class="title">buildForUsers</span><span class="params">(String content, String users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> WxCpMessage.TEXT().agentId(agentid).content(content).toUser(users).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.crick.business.pharos.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.common.exception.WxErrorException;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.api.WxCpService;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.cp.bean.WxCpUser;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatAlertService</span> <span class="keyword">implements</span> <span class="title">AlertService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WxCpService wxCpService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlertTextBuilder alertTextBuilder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">alertTextToTag</span><span class="params">(String content, String tag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wxCpService.messageSend(alertTextBuilder.buildForTag(content, tag));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WxErrorException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;alertTextToTag error! tag:&#123;&#125;&quot;</span>, tag, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">alertTextToUsers</span><span class="params">(String content, List&lt;String&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wxCpService.messageSend(alertTextBuilder.buildForUsers(content, String.join(<span class="string">&quot;,&quot;</span>, users)));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WxErrorException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;alertTextToUsers error! users:&#123;&#125;&quot;</span>, users, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">alertTextToDepartment</span><span class="params">(String content, Integer department)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;WxCpUser&gt; wxCpUserList = wxCpService.getUserService().listSimpleByDepartment(department, <span class="keyword">true</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != wxCpUserList) &#123;</span><br><span class="line">                String userList = wxCpUserList.stream()</span><br><span class="line">                        .map(WxCpUser::getUserId)</span><br><span class="line">                        .collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">                wxCpService.messageSend(alertTextBuilder.buildForUsers(content, userList));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WxErrorException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;alertTextToDepartment error! department:&#123;&#125;&quot;</span>, department, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-restful接口"><a href="#2-2-restful接口" class="headerlink" title="2.2 restful接口"></a>2.2 restful接口</h3><p>对外暴露的接口主要提供两个功能</p>
<ol>
<li>代理企业微信，用于查询部门、标签、userId等</li>
<li>发送告警信息</li>
</ol>
<p>具体实现在service中，restful暴露了http请求接口及swagger接口。并且将首页指向了swagger页面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:swagger-ui.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="http://img.yuheng.wang/wechat-message-proxy-01.png" alt="wechat-message-proxy-01"></p>
<h3 id="2-3-验权"><a href="#2-3-验权" class="headerlink" title="2.3 验权"></a>2.3 验权</h3><p>两种验权方式</p>
<ol>
<li>参数+secret通过SHA加密签名</li>
<li>ip白名单</li>
</ol>
<p>通过interceptor实现</p>
<h4 id="2-3-1-白名单校验"><a href="#2-3-1-白名单校验" class="headerlink" title="2.3.1 白名单校验"></a>2.3.1 白名单校验</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;&#x27;$&#123;white.list&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; whiteList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> HandlerMethod) &#123;</span><br><span class="line">            HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">            <span class="keyword">if</span> (handlerMethod.getBeanType().isAnnotationPresent(Anonymous.class)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        String clientIp = getIpAddress(request);</span><br><span class="line">        <span class="keyword">if</span> (!whiteList.contains(clientIp)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RestfulException(<span class="string">&quot;client ip: &quot;</span> + clientIp + <span class="string">&quot; not in white list&quot;</span>, RestfulErrorCode.AUTHOR_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getIpAddress</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String ip = request.getHeader(<span class="string">&quot;x-forwarded-for&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getHeader(<span class="string">&quot;Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getHeader(<span class="string">&quot;WL-Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getHeader(<span class="string">&quot;HTTP_CLIENT_IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getHeader(<span class="string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getRemoteAddr();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ip;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-接口参数签名校验"><a href="#2-3-2-接口参数签名校验" class="headerlink" title="2.3.2 接口参数签名校验"></a>2.3.2 接口参数签名校验</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SignInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;secret.key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> HandlerMethod) &#123;</span><br><span class="line">            HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">            <span class="keyword">if</span> (handlerMethod.getBeanType().isAnnotationPresent(Anonymous.class)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String sign = request.getParameter(<span class="string">&quot;sign&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == sign || <span class="string">&quot;&quot;</span>.equals(sign)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RestfulException(<span class="string">&quot;must have a sign param!&quot;</span>, RestfulErrorCode.SIGN_ERROR);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Map&lt;String, String[]&gt; parameters = request.getParameterMap();</span><br><span class="line">            <span class="keyword">if</span> (parameters.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                <span class="keyword">for</span> (String key : parameters.keySet()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;sign&quot;</span>.equals(key)) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    sb.append(key).append(<span class="string">&quot;-&quot;</span>).append(Arrays.toString(parameters.get(key))).append(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(<span class="string">&quot;token&quot;</span>).append(<span class="string">&quot;-&quot;</span>).append(secretKey);</span><br><span class="line">                <span class="keyword">if</span> (!sign.equals(EncryptUtil.sha1(sb.toString()))) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RestfulException(<span class="string">&quot;sign check fail!&quot;</span>, RestfulErrorCode.SIGN_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SHA加密工具封装</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncryptUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EncryptUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SHA_1_ALGORITHM = <span class="string">&quot;SHA-1&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SHA_256_ALGORITHM = <span class="string">&quot;SHA-256&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sha1</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sha(source, SHA_1_ALGORITHM);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sha256</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sha(source, SHA_256_ALGORITHM);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">sha</span><span class="params">(String source, String instance)</span> </span>&#123;</span><br><span class="line">        MessageDigest md;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            md = MessageDigest.getInstance(instance);</span><br><span class="line">            md.update(source.getBytes());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(Hex.encodeHex(md.digest()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要对sign有效期进行校验，需要提供获取服务器时钟的方法，避免因为服务器时间不一致导致的时间差, 此方法可以通过@Anonymous去掉验权操作。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;common&quot;)</span></span><br><span class="line"><span class="meta">@Anonymous</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取系统时间，避免客户端时间不一致</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;current&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">current</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-健康检测"><a href="#2-4-健康检测" class="headerlink" title="2.4 健康检测"></a>2.4 健康检测</h3><p>定时用http get 请求确认网络通畅，如果网络连接失败次数超过阈值，报警给系统管理员</p>
<p>通过Scheduled编写定时任务</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PingCheckTask</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;ping.service.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serviceUrl;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;ping.period:3&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> period;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Integer&gt; errorCalculate = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resetCount</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        errorCalculate.put(url, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">pushCount</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        errorCalculate.put(url, errorCalculate.getOrDefault(url, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> errorCalculate.get(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/20 * * * * ?&quot;)</span> <span class="comment">// 每20秒执行一次</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduler</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(serviceUrl)</span><br><span class="line">                .build();</span><br><span class="line">        Response response = okHttpClient.newCall(request).execute();</span><br><span class="line">        <span class="keyword">if</span> (response.isSuccessful()) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;ping check &#123;&#125; success!&quot;</span>, serviceUrl);</span><br><span class="line">            resetCount(serviceUrl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;ping check &#123;&#125; fail! response:&#123;&#125;&quot;</span>, serviceUrl, response);</span><br><span class="line">            <span class="keyword">int</span> count = pushCount(serviceUrl);</span><br><span class="line">            <span class="keyword">if</span> (count &gt; period) &#123;</span><br><span class="line">                <span class="comment">// alert to admin!</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置bean中需要注入bean并允许启动调度</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PingCheckTask <span class="title">pingCheckTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PingCheckTask();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-其他"><a href="#3-其他" class="headerlink" title="3. 其他"></a>3. 其他</h2><p>项目写的比较仓促，后续根据实际使用场景进行调整优化。都是站在巨人的肩膀上，利用现成的工具进行拼装。 如果有建议或者希望实现哪些功能，可以留言或者给我提issue <a href="https://github.com/wangyuheng/pharos">https://github.com/wangyuheng/pharos</a> 。 </p>
<blockquote>
<p>春城无处不飞花，寒食东风御柳斜。</p>
</blockquote>
<p>推荐大家吃 青团（艾团）， 简直发现了新大陆</p>
<p><img src="http://img.yuheng.wang/wechat-message-proxy-02.png" alt="wechat-message-proxy-02"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>wechat</tag>
      </tags>
  </entry>
  <entry>
    <title>Cypress入门</title>
    <url>/2023/09/10/test-cypress/</url>
    <content><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p><strong>Cypress</strong>是一款基于javascript的开源端到端测试框架。与大家比较熟悉的jmeter等基于网络请求自动化测试框架不同，cypress可以运行在各种浏览器上，包括chrome，firfox等，通过控制浏览器行为，对网页UI元素进行自动化测试。</p>
<span id="more"></span>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><blockquote>
<p>推荐使用npm方式进行安装。虽然cypress提供了安装包，但是测试case是基于nodejs进行运行编写，所以相关环境是逃不掉的。</p>
</blockquote>
<h3 id="1-安装nodejs"><a href="#1-安装nodejs" class="headerlink" title="1. 安装nodejs"></a>1. 安装nodejs</h3><p>通过官网根据系统选择下载对应版本，LTS为长期支持版本(Long Term Support)，Current为最新开发版本，推荐使用LTS版本。<br>下载后一路next即可</p>
<p><a href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
<p>安装完成后通过命令行查看安装是否成功。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<p>nodejs安装完成后会自带npm，及node的包管理工具。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm -v</span><br></pre></td></tr></table></figure>

<h3 id="2-通过npm安装cypress"><a href="#2-通过npm安装cypress" class="headerlink" title="2. 通过npm安装cypress"></a>2. 通过npm安装cypress</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install cypress --save-dev</span><br></pre></td></tr></table></figure>

<p><code>--save-dev</code> 表示下载至当前项目目录，而非全局。并且仅在dev模式下使用，生产环境不需要</p>
<p><img src="/uploads/test-cypress/test-cypress-00.png" alt="test-cypress-00"></p>
<p><strong>TIPS:</strong> 如果下载速度较慢，可以改动taobao提供的NPM镜像进行下载。</p>
<p><a href="https://npmmirror.com/">https://npmmirror.com/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>

<p>之后使用 <code>cnpm</code> 替换 <code>npm</code> 执行下载动作</p>
<h3 id="3-打开cypress"><a href="#3-打开cypress" class="headerlink" title="3. 打开cypress"></a>3. 打开cypress</h3><p>安装命令执行后，多了一个<strong>node_modules</strong>目录，相关的镜像依赖都在这个目录下，可以到对应的cypress目录下执行相关命令，如 open 可以打开cypress UI控制面，运行一个默认的TODO页面测试case</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/cypress/bin/cypress open</span><br></pre></td></tr></table></figure>

<p><img src="/uploads/test-cypress/test-cypress-01.png" alt="test-cypress-01"></p>
<p> 运行case会打开一个Chrome浏览器，对比case与实际浏览器展示效果。</p>
<p> <img src="/uploads/test-cypress/test-cypress-02.png" alt="test-cypress-02"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>以baidu网站登陆功能为例，测试用例为</p>
<ol>
<li><strong>访问</strong> <a href="https://www.baidu.com/">https://www.baidu.com</a></li>
<li>页面包含<strong>登录</strong>按钮并<strong>单击</strong></li>
<li>弹窗中<strong>不包含</strong>“请您输入手机号/用户名/邮箱”</li>
<li><strong>单击</strong>弹窗中登录按钮<ol>
<li>提示“请您输入手机号/用户名/邮箱”</li>
</ol>
</li>
<li>在username表单输入框中<strong>输入</strong>abc</li>
<li><strong>单击</strong>弹窗中登录按钮<ol>
<li>提示“请您输入密码”</li>
</ol>
</li>
<li>在passport表单输入框中<strong>输入</strong>123</li>
<li><strong>单击</strong>弹窗中登录按钮<ol>
<li>错误内容<strong>包含</strong>“用户名或密码有误，请重新输入或”</li>
</ol>
</li>
</ol>
<h3 id="编写测试用例"><a href="#编写测试用例" class="headerlink" title="编写测试用例"></a>编写测试用例</h3><p>在 <strong>cypress/integration</strong> 目录新建<strong>baidu.js</strong>文件用于编写行为代码及预期</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">&#x27;百度&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        cy.visit(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    it(<span class="string">&#x27;首页登录&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        cy.get(<span class="string">&#x27;#s-top-loginbtn&#x27;</span>)</span><br><span class="line">            .should(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;登录&#x27;</span>)</span><br><span class="line">            .click()</span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">&#x27;#passport-login-pop-api .pass-text-input.pass-text-input-userName&#x27;</span>)</span><br><span class="line">            .should(<span class="string">&#x27;not.have.value&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__submit&#x27;</span>)</span><br><span class="line">            .click(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line">        cy.contains(<span class="string">&#x27;请您输入手机号/用户名/邮箱&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">&#x27;#passport-login-pop-api .pass-text-input.pass-text-input-userName&#x27;</span>)</span><br><span class="line">            .type(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line">            .should(<span class="string">&#x27;have.value&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">&#x27;#passport-login-pop-api .pass-button.pass-button-submit&#x27;</span>)</span><br><span class="line">            .click(&#123; <span class="attr">multiple</span>: <span class="literal">true</span>,  <span class="attr">force</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line">        cy.contains(<span class="string">&#x27;请您输入密码&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__password&#x27;</span>)</span><br><span class="line">            .type(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__submit&#x27;</span>)</span><br><span class="line">            .click(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__error&#x27;</span>)</span><br><span class="line">            .contains(<span class="string">&#x27;用户名或密码有误，请重新输入或&#x27;</span>)</span><br><span class="line">            .should(<span class="string">&#x27;have.css&#x27;</span>, <span class="string">&#x27;display&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>可以通过 open 打开可视化页面，单击baidu.js用例运行测试用例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/cypress/bin/cypress open</span><br></pre></td></tr></table></figure>

<p>也可以直接在命令行运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./node_modules/cypress/bin/cypress run</span><br></pre></td></tr></table></figure>

<p>如果运行失败，则会在screenshots目录保存失败截图，及videos目录保存运行视频。</p>
<p> <img src="/uploads/test-cypress/test-cypress-03.png" alt="test-cypress-03"></p>
<p> <img src="/uploads/test-cypress/test-cypress-04.gif" alt="test-cypress-04"></p>
<h3 id="录制生成用例"><a href="#录制生成用例" class="headerlink" title="录制生成用例"></a>录制生成用例</h3><p>可以通过录制方式快速生成行为代码。</p>
<ol>
<li>在cypress.json文件中开启experimentalStudio功能</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;projectId&quot;</span>: <span class="string">&quot;3y3u55&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;experimentalStudio&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在cypress中可以确认experimentalStudio变为true</p>
<p> <img src="/uploads/test-cypress/test-cypress-05.png" alt="test-cypress-05"></p>
<p>在cypress/integration/中新建baidu-auto.js文件。输入下列内容，只需声明开启时访问<a href="https://www.baidu.com/">https://www.baidu.com</a> 并创建Login用例</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">&#x27;baidu&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        cy.visit(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    it(<span class="string">&quot;Login&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过open启动cypress并运行baidu-auto.js用例，在开启的chrome浏览器中Login用例开启 <strong>Add Commands toTest</strong></p>
<p> <img src="/uploads/test-cypress/test-cypress-06.png" alt="test-cypress-06"></p>
<p>在右侧浏览器中进行操作，左侧用例会实时生成对应的行为命令，单击 Save Commands 按钮，命令将保存在juenjin.js文件中</p>
<p> <img src="/uploads/test-cypress/test-cypress-07.png" alt="test-cypress-07"></p>
<p>查看baidu-auto.js文件，可以看到行为代码已生成，可以在此基础上编写预期代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">&#x27;baidu&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        cy.visit(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    it(<span class="string">&quot;Login&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/* ==== Generated with Cypress Studio ==== */</span></span><br><span class="line">        cy.get(<span class="string">&#x27;#s-top-loginbtn&#x27;</span>).click();</span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__submit&#x27;</span>).click();</span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__userName&#x27;</span>).clear();</span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__userName&#x27;</span>).type(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__submit&#x27;</span>).click();</span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__password&#x27;</span>).clear();</span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__password&#x27;</span>).type(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line">        cy.get(<span class="string">&#x27;#TANGRAM__PSP_11__submit&#x27;</span>).click();</span><br><span class="line">        <span class="comment">/* ==== End Cypress Studio ==== */</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="集成CI"><a href="#集成CI" class="headerlink" title="集成CI"></a>集成CI</h3><p>实际使用过程中，需要和各种CICD工具进行集成。<br>Jenkins</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent &#123;</span><br><span class="line">    &#x2F;&#x2F; this image provides everything needed to run Cypress</span><br><span class="line">    docker &#123;</span><br><span class="line">      image &#39;cypress&#x2F;base:10&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(&#39;build and test&#39;) &#123;</span><br><span class="line">      environment &#123;</span><br><span class="line">        &#x2F;&#x2F; we will be recording test results and video on Cypress dashboard</span><br><span class="line">        &#x2F;&#x2F; to record we need to set an environment variable</span><br><span class="line">        &#x2F;&#x2F; we can load the record key variable from credentials store</span><br><span class="line">        &#x2F;&#x2F; see https:&#x2F;&#x2F;jenkins.io&#x2F;doc&#x2F;book&#x2F;using&#x2F;using-credentials&#x2F;</span><br><span class="line">        CYPRESS_RECORD_KEY &#x3D; credentials(&#39;cypress-example-kitchensink-record-key&#39;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      steps &#123;</span><br><span class="line">        sh &#39;npm ci&#39;</span><br><span class="line">        sh &quot;npm run test:ci:record&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Gitlab CI</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">$&#123;CI_COMMIT_REF_SLUG&#125;</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node_modules/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">.npm/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">cypress/browsers:node12.14.1-chrome85-ff81</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="comment"># install dependencies</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">    <span class="comment"># start the server in the background</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">start:ci</span> <span class="string">&amp;</span></span><br><span class="line">    <span class="comment"># run Cypress tests</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">run</span> <span class="string">--browser</span> <span class="string">firefox</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cypress/videos/**/*.mp4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cypress/screenshots/**/*.png</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">1</span> <span class="string">day</span></span><br></pre></td></tr></table></figure>
<p>1</p>
]]></content>
      <categories>
        <category>test</category>
      </categories>
      <tags>
        <tag>test</tag>
        <tag>cypress</tag>
      </tags>
  </entry>
</search>
